<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯(è½¬)</title>
    <url>/2017/08/13/%E5%80%9A%E6%A5%BC%E5%90%AC%E9%A3%8E%E9%9B%A8%EF%BC%8C%E6%B7%A1%E7%9C%8B%E6%B1%9F%E6%B9%96%E8%B7%AF/</url>
    <content><![CDATA[<p>å€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯ã€‚ä½†è§æ³ªç—•æ¹¿ï¼Œä¸çŸ¥å¿ƒæ¨è°ï¼é›ªæ— è¸ªï¼Œæƒ…äº¦æ— è¸ªï¼Œé›ªæ— å½¢ï¼Œæƒ…äº¦æ— å½¢ã€‚å†¬æ¥ï¼Œé›ªå€¾åŸï¼Œçˆ±æ¥æƒ…å€¾åŸã€‚å†¬è¿‡ï¼Œé›ªåŒ–æ°´ï¼Œçˆ±è¿‡æƒ…åŒ–æ³ªï¼</p>
<p>â€”â€”ã€Šé£äº‘ã€‹æ¢¦å†™ç»™é£çš„ä¿¡</p>
<p>æ²§æµ·æ¡‘ç”°ï¼Œå¤©è’åœ°è€ï¼Œä¸å¦‚æœ‰ä¸ªäººç‰µæˆ‘çš„æ‰‹ï¼Œä¸€èµ·çœ‹å¤•é˜³è€å»ã€‚æµ·æ¯çŸ³çƒ‚ï¼Œå¤©é•¿åœ°ä¹…ï¼Œä¸å¦‚æœ‰ä¸ªäººé™ªæˆ‘ï¼Œå€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯ã€‚</p>
<p>å‰å°˜å¾€äº‹ï¼Œéƒ½è®©ä»–éšé£è€Œé€äº†å§ã€‚çº¢å°˜æ»šæ»šï¼Œéƒ½ä»»ä»–æ¹®æ²¡åœ¨å†å²ä¸­å»å§ã€‚ç¡çƒŸå¼¥æ¼«ï¼Œéƒ½è®©ä»–æ¶ˆæ²‰åœ¨å°˜ä¸–é—´é‡Œå§ã€‚</p>
<p>æˆ‘ï¼Œæ„¿ä½œä¸–é—´ç´ å¿ƒäººï¼Œæœ¬ä¸æƒ³æ¶‰å°˜ä¸–å¤ªæ·±çš„æ°´è€Œè¿‡ï¼Œåªæ„¿ç‹¬åä¸€éš…ï¼Œéšä¸–äº‹æµè½¬ï¼Œæ·¡çœ‹çº¢å°˜çš„æ•…äº‹ï¼Œæƒ…æ„Ÿï¼Œæ¢¦æƒ³ï¼Œçç¢çš„ç”Ÿæ´»ã€‚</p>
<p>å¾®é£ï¼Œæ·¡æ·¡çš„ä»é™Œä¸Šå¹æ¥ï¼Œæ è¿‡çª—å‰ï¼Œæˆ‘å¬åˆ°äº†ä»–çš„å¹æ¯ï¼Œé‚£æ˜¯å²æœˆæ·±å¤„çš„æ„Ÿæ…¨ï¼Œä¼¼æ°´æµå¹´ï¼Œæˆ‘ä»¬åƒèŠ±å„¿ä¸€æ ·å„è‡ªæ•£è½åœ¨äº†å¤©æ¶¯ã€‚</p>
<p>æœ‹å‹è¯´ï¼Œæˆ‘æ€»åœ¨ç¢ç¢å¿µç€æ‚²ä¼¤ï¼Œæ¼”ç»ç€åŒæ ·å¿§ä¼¤çš„çˆ±æƒ…ï¼Œè½å¯çš„æ€ç»ªï¼Œå¯‚å¯¥çš„æƒ…æ„«ï¼Œæ·¡æ·¡çš„æƒ…ç¼˜ï¼Œæµ…æ·¡çš„æ€å¿µï¼Œç—´æ‹çš„æ·±æƒ…ï¼Œå¿ƒåŠ¨çš„å”¯ç¾ï¼Œå¿ƒç¢çš„æƒ…æ®‡â€¦â€¦</p>
<p>æˆ‘ï¼Œæ— æ³•å¿˜è®°è®©æˆ‘æœ€åˆå¿ƒåŠ¨çš„äººï¼Œå´æ˜¯é‚£ä»½æƒ…æ„«åœ¨å¿µå¿µä¸å¿˜çš„æ—¥å­é‡Œï¼Œæ·¡äº†ã€‚é‚£æ—¶ï¼Œæˆ‘ç›¸ä¿¡çš„ä¸€ç”Ÿåªçˆ±ä¸€ä¸ªäººçš„ä¿¡å¿µï¼Œä¹Ÿå½»åº•å´©æºƒåœ¨è¾¹ç¼˜äº†ã€‚</p>
<p>ä»æ­¤ï¼Œæˆ‘ä¸çŸ¥è¯¥æ€ä¹ˆç»§ç»­æˆ‘çš„çº¢å°˜æƒ…ç¼˜ï¼Œäººæ•£ï¼Œæƒ…æ·¡ï¼Œå¿ƒæ€§å¼€å§‹å˜å¾—è–„å‡‰ã€‚ç»†æ•°æµå¹´ï¼Œè½¬èº«ç¦»å¼€çš„æ—¥å­ï¼Œäº¦æ˜¯å¾ˆä¹…å¾ˆè¿œäº†ï¼Œè¿™äº›å¹´ï¼Œå¯‚å¯ä¸€ç›´æ±©æ±©æµæ·Œåœ¨å¿ƒæºªã€‚</p>
<p>ä¹Ÿè®¸ï¼Œæˆ‘çˆ±ä¸Šäº†ä¸€ä¸ªäººï¼Œå°±çˆ±ä¸Šäº†å¯‚å¯ï¼Œä¹Ÿçˆ±ä¸Šäº†æ–‡å­—ã€‚æœ‰äººè¯´ï¼Œçˆ±ä¸Šäº†æ–‡å­—çš„å­©å­ï¼Œè‹è€çš„æ¯”è¾ƒå¿«ã€‚å› ä¸ºå¿ƒçš„æ²§æ¡‘ã€‚æˆ‘æƒ³ï¼Œæˆ‘ä¾¿å¦‚æ˜¯æ‰€è¯´ã€‚</p>
<p>æ‰€ä»¥ï¼Œè€Œä»Šå€šæ¥¼å¬é£é›¨ï¼Œæ‚²æ¬¢ç¦»åˆæ€»æ— æƒ…ï¼Œä¸€ä»»é˜¶å‰ç‚¹æ»´åˆ°å¤©æ˜ã€‚æ·¡çœ‹æ±Ÿæ¹–è·¯ï¼Œäººæ¸æ¸è¿œå»ï¼Œæƒ…æ·¡æ·¡æ•£å»ï¼Œä½†è§æ³ªç—•æ¹¿ï¼Œä¸çŸ¥å¿ƒçˆ±è°ã€‚</p>
<p>çº¢é¢œæ˜“è€ï¼Œæƒ…ç¼˜æ˜“é†‰ï¼Œæµå…‰å®¹æ˜“æŠŠäººæŠ›ï¼Œæƒ¹äº†å¿ƒç»ªï¼ŒæŸ“äº†å°˜åŸƒã€‚è‰¯è¾°ç¾æ™¯å¥ˆä½•å¤©ï¼Œæ³ªæ°´å‡‰äº†å¿ƒï¼Œæ‰æ‡‚å¾—ï¼Œæœ€åçš„ç–¼çˆ±æ˜¯æ‰‹æ”¾å¼€ã€‚</p>
<p>æ¸©æš–ï¼Œåˆ¹é‚£èŠ³è²å°½ã€‚æ‚²ä¼¤ï¼Œæ³¨å…¥åŠä¸–å¯‚å¯ã€‚æˆ‘ï¼Œä¸è¿‡æ˜¯ä¸€ä¸ªå¹³å‡¡çš„äººï¼Œä¸€æ¯åˆä¸€æ¯çš„çº¢å°˜é…’ï¼Œè‡ªæ–Ÿè‡ªé¥®ï¼Œé†‰äº†è¿™ä¸€ç”Ÿï¼Œæ·¡äº†çº¢å°˜è·¯ã€‚</p>
<p>é’çƒŸè¢…è¢…ï¼Œé‚£æ˜¯å¿ƒä¸­æŒ¥ä¹‹ä¸å»çš„å¿§ä¼¤ã€‚æ·¡æ·¡æµäº‘ï¼Œé‚£æ˜¯å¿ƒä¸­æ— ä»¥è¨€è¯´çš„ä¼¤ç—›ã€‚é£è½»äº‘æ·¡ï¼ŒæŠ¹æ·¡æµå¹´ï¼Œé™å¬é›¨å£°ï¼Œæ´—å°½èŠ³åï¼Œæ„¿ä½ æˆ‘å®‰å¥½ã€‚</p>
<p>è½»è½»åœ°æ¨å¼€çª—ï¼Œæ²äººå¿ƒè„¾çš„èŠ±é¦™é£˜æ•£åœ¨é£é›¨ä¸­ï¼Œæ‰‘é¼»è€Œæ¥ã€‚æ¸©æš–ï¼Œä¾ç„¶åœ¨çœ¼å‰ï¼Œæ˜¯æˆ‘çš„å¿ƒå¤ªå¤šè´ªæ‹äº†ã€‚ä¸å¦‚æ³¡ä¸€æ¯èŒ¶ï¼Œå®‰äºä¸€ä»½æ·¡ç„¶ã€‚</p>
<p>ä¹Ÿè®¸ï¼Œçˆ±ä¸ä¸çˆ±ï¼Œéƒ½æ˜¯æ®‡ã€‚æ¯•ç«Ÿï¼Œæˆ‘æ€»è§‰å¾—ï¼Œçˆ±æ˜¯äººé—´æœ€ç¾çš„æƒ…æ„«ï¼Œå¿ƒåŠ¨çš„æœ¦èƒ§ï¼ŒæŠµå¾—è¿‡å¿ƒå–œçš„ç—´æ‹è‡ªé†‰ï¼Œå¿ƒç—›çš„é»¯ç„¶é”€é­‚ã€‚</p>
<p>å…¶å®ï¼Œä¸æ˜¯å°†ä»–å¿˜äº†ï¼Œä¹Ÿä¸æ˜¯è®²æ•…äº‹å¿˜äº†ï¼Œæ›´ä¸æ˜¯å°†æƒ…æ„Ÿå¿˜äº†ã€‚è™½ç„¶äº‘æ·¡é£è½»äº†ï¼Œå´ä¾ç„¶æ˜¯ï¼Œå¤šå°‘äº‹ï¼Œæ‰ä¸‹çœ‰å¤´ï¼Œå´ä¸Šå¿ƒé—´ã€‚åªæ˜¯ï¼Œé€‰æ‹©ä¸‰ç¼„å…¶å£ï¼Œä¸è¯´äº†ã€‚</p>
<p>æ‹ˆèŠ±ä¸€ç¬‘ï¼Œæ£ç¢äº†å¿ƒï¼Œå¯‚é™è½¬èº«ï¼Œå®‰ç„¶å®ˆå€™ä¸€ä¸ä¸€ç¼•çš„æƒ…æ„«ï¼Œå¦‚ç¡è²èˆ¬é™èººåœ¨çº¢å°˜çš„æµæ°´é‡Œï¼Œå³ä½¿ï¼Œé£é›¨ç©¿é€ä¸–äº‹ï¼Œäº¦æ³¢æ¾œä¸æƒŠã€‚</p>
<p>å¤å¤œå¾®å‡‰ï¼Œçª—å¤–é›¨æ½ºæ½ºï¼Œéšç€æ—‹å¾‹è½»è½»æµæ³»æŒ‡å°–çš„å¿§ä¼¤ï¼Œäººæ·¡æƒ…è¿œï¼Œé™é™åœ°åç€ï¼Œæƒ³ç€å¿ƒäº‹ï¼Œä»»çº¢å°˜çº·çº­ä¸€ä¸€åŒ–äº†è™šæ— ï¼Œæ•£äº†äº‘çƒŸï¼Œæµ…äº†é£æƒ…ã€‚</p>
<p>ææµ…å¿ƒæ€ï¼ŒæŸä¹‹é«˜é˜ï¼Œè½¬èº«ç¦»å¼€ã€‚å¦‚è²ç¦…å®šï¼Œæ½œå…¥çº¢å°˜ï¼Œå‡ºæ·¤æ³¥è€Œä¸æŸ“ã€‚å€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯â€¦â€¦</p>
<p>ä½œè€…ï¼šè½å¶<br>é“¾æ¥ï¼š<a href="http://www.duwenzhang.com/wenzhang/xinqingriji/20140621/294982.html">http://www.duwenzhang.com/wenzhang/xinqingriji/20140621/294982.html</a><br>ä¾†æºï¼šæ–‡ç« é˜…è¯»ç½‘</p>
]]></content>
      <categories>
        <category>å¬é£é›¨</category>
      </categories>
      <tags>
        <tag>å¬é£é›¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªç®€å•çš„APIæˆæƒæµç¨‹</title>
    <url>/2017/08/16/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84api%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<p>å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°ç»™ç¬¬ä¸‰æ–¹å¼€æ”¾æˆ‘ä»¬é¡¹ç›®APIçš„è¿™ç§åœºæ™¯ã€‚è¿™æ—¶æˆ‘ä»¬è¦ä¿è¯apiçš„å®‰å…¨ï¼Œå‚è€ƒ<code>è…¾è®¯å¹¿ç‚¹é€š</code>çš„apiè°ƒç”¨ã€‚ç°å°†phpçš„ä»£ç å®ç°æ•´ç†è¿™æ­¤ã€‚</p>
<p>æˆ‘ä»¬çš„ç®—æ³•å¾ˆç®€å•ï¼š</p>
<blockquote>
<ol>
<li>æŠŠè°ƒç”¨æ–¹è‡ªå·±çš„appid,secret_key,å½“å‰çš„æ—¶é—´æˆ³timeè¿æ¥èµ·æ¥ç”¨sha1æ–¹æ³•ç”Ÿæˆä¸€ä¸ªsign</li>
<li>æŠŠappid,time,signç”¨è‹±æ–‡é€—å·è¿æ¥å¹¶ç”¨base64æ‰“åŒ…å˜æˆä¸€ä¸ªå‚æ•°token</li>
</ol>
</blockquote>
<h3 id="APIçš„å‡ ä¸ªæ–¹æ³•"><a href="#APIçš„å‡ ä¸ªæ–¹æ³•" class="headerlink" title="APIçš„å‡ ä¸ªæ–¹æ³•"></a>APIçš„å‡ ä¸ªæ–¹æ³•</h3><p><code>api_functions.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $appid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $secret_key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int $time</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_token</span>(<span class="params"><span class="variable">$appid</span>, <span class="variable">$secret_key</span>, <span class="variable">$time</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$sign</span> = sha1(<span class="variable">$appid</span> . <span class="variable">$secret_key</span> . <span class="variable">$time</span>);</span><br><span class="line">    <span class="keyword">return</span> base64_encode(<span class="variable">$appid</span> . <span class="string">&#x27;,&#x27;</span> . <span class="variable">$time</span> . <span class="string">&#x27;,&#x27;</span> . <span class="variable">$sign</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£åŒ…token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unpack_token</span>(<span class="params"><span class="variable">$token</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$params</span> = base64_decode(<span class="variable">$token</span>);</span><br><span class="line">    <span class="variable">$params</span> = explode(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$params</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">&#x27;appid&#x27;</span>=&gt; <span class="keyword">isset</span>(<span class="variable">$params</span>[<span class="number">0</span>]) ? <span class="variable">$params</span>[<span class="number">0</span>] : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;time&#x27;</span>=&gt; <span class="keyword">isset</span>(<span class="variable">$params</span>[<span class="number">1</span>]) ? <span class="variable">$params</span>[<span class="number">1</span>] : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sign&#x27;</span>=&gt; <span class="keyword">isset</span>(<span class="variable">$params</span>[<span class="number">2</span>]) ? <span class="variable">$params</span>[<span class="number">2</span>] : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $url</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $data</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bool $is_post</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $header</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sub_curl</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="params"></span>), <span class="variable">$is_post</span> = <span class="literal">false</span>, <span class="variable">$header</span> = <span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$ch</span> = curl_init();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$is_post</span> &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$url</span> . <span class="string">&#x27;?&#x27;</span> . http_build_query(<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_POST, <span class="variable">$is_post</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$is_post</span>) &#123;</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span class="literal">false</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span class="literal">false</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_CONNECTTIMEOUT, <span class="number">20</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$header</span>)) &#123;</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_HTTPHEADER, <span class="variable">$header</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$info</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="variable">$code</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$code</span> != <span class="number">200</span>)&#123;</span><br><span class="line"></span><br><span class="line">        echo_json(<span class="variable">$code</span>, <span class="string">&#x27;apiè°ƒç”¨å‡ºé”™&#x27;</span>.<span class="variable">$code</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_close(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$info</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int $code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $msg</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo_json</span>(<span class="params"><span class="variable">$code</span>, <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>, <span class="variable">$data</span> = <span class="keyword">array</span>(<span class="params"></span>)</span>)</span>&#123;</span><br><span class="line">    header(<span class="string">&#x27;Content-type:application/json&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">&#x27;ret&#x27;</span> =&gt; <span class="variable">$code</span>, <span class="string">&#x27;msg&#x27;</span> =&gt; <span class="variable">$msg</span>, <span class="string">&#x27;data&#x27;</span> =&gt; <span class="variable">$data</span>));</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="APIæä¾›æ–¹"><a href="#APIæä¾›æ–¹" class="headerlink" title="APIæä¾›æ–¹"></a>APIæä¾›æ–¹</h3><p><code>api.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;api_functions.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆæƒçš„ä½¿ç”¨æ–¹åå• ç°ä¸ºæ¼”ç¤ºæ–¹ä¾¿ç›´æ¥ä½¿ç”¨æ•°ç»„</span></span><br><span class="line"><span class="variable">$users</span> = [</span><br><span class="line">    <span class="string">&#x27;user_001&#x27;</span>=&gt;[</span><br><span class="line">        <span class="string">&#x27;appid&#x27;</span>=&gt;<span class="string">&#x27;user_001&#x27;</span>,    <span class="comment">//ä½¿ç”¨æ–¹å¯¹äºæä¾›æ–¹apiçš„å”¯ä¸€id</span></span><br><span class="line">        <span class="string">&#x27;secret_key&#x27;</span>=&gt;<span class="string">&#x27;97bc847d4ea7dd9f035d41a657302f1c&#x27;</span>    <span class="comment">//å¯†é’¥ ä¹Ÿå”¯ä¸€</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;user_002&#x27;</span>=&gt;[</span><br><span class="line">        <span class="string">&#x27;appid&#x27;</span>=&gt;<span class="string">&#x27;user_002&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;secret_key&#x27;</span>=&gt;<span class="string">&#x27;c763b64a62186ae6831edd22063539c4&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;user_003&#x27;</span>=&gt;[</span><br><span class="line">        <span class="string">&#x27;appid&#x27;</span>=&gt;<span class="string">&#x27;user_003&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;secret_key&#x27;</span>=&gt;<span class="string">&#x27;51a683bea5e5c138fd0342fb70e03c65&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ£€éªŒç­¾å</span></span><br><span class="line"><span class="variable">$token</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>]) ? trim(<span class="variable">$_GET</span>[<span class="string">&#x27;token&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$token</span>))&#123;</span><br><span class="line">    echo_json(<span class="number">1000</span>, <span class="string">&#x27;token missed&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£åŒ…token</span></span><br><span class="line"><span class="variable">$token_params</span> = unpack_token(<span class="variable">$token</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$token_params</span>[<span class="string">&#x27;sign&#x27;</span>]))&#123;</span><br><span class="line">    echo_json(<span class="number">1001</span>, <span class="string">&#x27;sign error&#x27;</span>);  <span class="comment">//ç­¾åä¸ºç©ºæˆ–è€…é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$token_params</span>[<span class="string">&#x27;appid&#x27;</span>]))&#123;</span><br><span class="line">    echo_json(<span class="number">1002</span>, <span class="string">&#x27;appid error&#x27;</span>);  <span class="comment">//appidä¸ºç©ºæˆ–è€…é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$token_params</span>[<span class="string">&#x27;time&#x27;</span>]))&#123;</span><br><span class="line">    echo_json(<span class="number">1003</span>, <span class="string">&#x27;time error&#x27;</span>);  <span class="comment">//timeä¸ºç©ºæˆ–è€…é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(abs(<span class="variable">$token_params</span>[<span class="string">&#x27;time&#x27;</span>] - time()) &gt; <span class="number">10</span> * <span class="number">60</span>)&#123;    <span class="comment">// api è°ƒç”¨æ—¶é—´é™åˆ¶å·¦å³æµ®åŠ¨10åˆ†é’Ÿ</span></span><br><span class="line">    echo_json(<span class="number">1004</span>, <span class="string">&#x27;time expired&#x27;</span>);  <span class="comment">// 10 minutes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨appidå–ç”¨æˆ·</span></span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">isset</span>(<span class="variable">$users</span>[<span class="variable">$token_params</span>[<span class="string">&#x27;appid&#x27;</span>]]) ? <span class="variable">$users</span>[<span class="variable">$token_params</span>[<span class="string">&#x27;appid&#x27;</span>]] : [];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$user</span>))&#123;</span><br><span class="line">    echo_json(<span class="number">1005</span>, <span class="string">&#x27;appid not exists&#x27;</span>);  <span class="comment">//è°ƒç”¨æ–¹ä¸å­˜åœ¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨è°ƒç”¨æ–¹å‚æ•°ç”Ÿæˆtoken</span></span><br><span class="line"><span class="variable">$create_token</span> = generate_token(<span class="variable">$user</span>[<span class="string">&#x27;appid&#x27;</span>], <span class="variable">$user</span>[<span class="string">&#x27;secret_key&#x27;</span>], <span class="variable">$token_params</span>[<span class="string">&#x27;time&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$token</span> !== <span class="variable">$create_token</span>)&#123;</span><br><span class="line">    echo_json(<span class="number">1006</span>, <span class="string">&#x27;token error&#x27;</span>);  <span class="comment">//tokené”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ°æ­¤ è°ƒç”¨æƒé™çš„éªŒè¯å°±okäº†</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$api</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;api&#x27;</span>]) ? trim(<span class="variable">$_GET</span>[<span class="string">&#x27;api&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥ä¸‹æ¥ä½ å¯ä»¥æœ‰å…¶ä»–å¯¹å…·ä½“æ¥å£çš„éªŒè¯...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line">echo_json(<span class="number">200</span>, <span class="string">&#x27;your request api &#x27;</span>.<span class="variable">$api</span>. <span class="string">&#x27; success!&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="APIè°ƒç”¨æ–¹"><a href="#APIè°ƒç”¨æ–¹" class="headerlink" title="APIè°ƒç”¨æ–¹"></a>APIè°ƒç”¨æ–¹</h3><p><code>use_api.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;api_functions.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡è®¾ä½¿ç”¨æ–¹æ˜¯ user_001 ä»–æ‹¥æœ‰è‡ªå·±çš„appidå’Œsecret_key</span></span><br><span class="line"><span class="variable">$user</span> = [</span><br><span class="line">    <span class="string">&#x27;appid&#x27;</span> =&gt; <span class="string">&#x27;user_001&#x27;</span>,    <span class="comment">//ä½¿ç”¨æ–¹å¯¹äºæä¾›æ–¹apiçš„å”¯ä¸€id</span></span><br><span class="line">    <span class="string">&#x27;secret_key&#x27;</span> =&gt; <span class="string">&#x27;97bc847d4ea7dd9f035d41a657302f1c&#x27;</span>    <span class="comment">//å¯†é’¥ ä¹Ÿå”¯ä¸€</span></span><br><span class="line"></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿæˆtoken</span></span><br><span class="line"><span class="variable">$token</span> = generate_token(<span class="variable">$user</span>[<span class="string">&#x27;appid&#x27;</span>], <span class="variable">$user</span>[<span class="string">&#x27;secret_key&#x27;</span>], time());</span><br><span class="line"></span><br><span class="line"><span class="comment">//urlæ¢æˆä½ è‡ªå·±çš„æ¥å£url</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://&#x27;</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>] . dirname(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> .= <span class="string">&#x27;/api.php?api=user_info&#x27;</span>; <span class="comment">//è°ƒç”¨user_infoçš„æ¥å£</span></span><br><span class="line"><span class="variable">$url</span> .= <span class="string">&#x27;&amp;token=&#x27;</span> . <span class="variable">$token</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr&gt;&lt;pre&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯·æ±‚æ¥å£</span></span><br><span class="line"><span class="variable">$res</span> = sub_curl(<span class="variable">$url</span>);</span><br><span class="line"></span><br><span class="line">var_dump(json_decode(<span class="variable">$res</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è°ƒç”¨æˆåŠŸç»“æœ</span></span><br><span class="line"><span class="comment">array(3) &#123;</span></span><br><span class="line"><span class="comment">  [&quot;ret&quot;]=&gt;</span></span><br><span class="line"><span class="comment">  int(200)</span></span><br><span class="line"><span class="comment">  [&quot;msg&quot;]=&gt;</span></span><br><span class="line"><span class="comment">  string(35) &quot;your request api user_info success!&quot;</span></span><br><span class="line"><span class="comment">  [&quot;data&quot;]=&gt;</span></span><br><span class="line"><span class="comment">  array(0) &#123;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>API</tag>
        <tag>PHP</tag>
        <tag>æˆæƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨PHPè¿›è¡ŒHTTPè®¤è¯</title>
    <url>/2017/08/21/%E7%94%A8PHP%E8%BF%9B%E8%A1%8CHTTP%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<p>PHPçš„HTTPè®¤è¯æœºåˆ¶ï¼Œå°±æ˜¯ç”¨<code>header()</code>å‡½æ•°æ¥å‘å®¢æˆ·ç«¯æµè§ˆå™¨å‘é€â€œAuthentication Requiredâ€ä¿¡æ¯ï¼Œä½¿å…¶å¼¹å‡ºä¸€ä¸ªç”¨æˆ·åï¼å¯†ç è¾“å…¥çª—å£ã€‚å½“ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç åï¼ŒåŒ…å«æœ‰URLçš„PHPè„šæœ¬å°†ä¼šåŠ ä¸Šé¢„å®šä¹‰å˜é‡<code>PHP_AUTH_USER</code>ï¼Œ<code>PHP_AUTH_PW</code>å’Œ<code>AUTH_TYPE</code>è¢«å†æ¬¡è°ƒç”¨ï¼Œè¿™ä¸‰ä¸ªå˜é‡åˆ†åˆ«è¢«è®¾å®šä¸ºç”¨æˆ·åï¼Œå¯†ç å’Œè®¤è¯ç±»å‹ã€‚é¢„å®šä¹‰å˜é‡ä¿å­˜åœ¨ <code>$_SERVER</code> æˆ–è€… <code>$HTTP_SERVER_VARS</code> æ•°ç»„ä¸­ã€‚æ”¯æŒâ€œBasicâ€å’Œâ€œDigestâ€ï¼ˆè‡ª PHP 5.1.0 èµ·ï¼‰è®¤è¯æ–¹æ³•ã€‚è¿™æ˜¯phpå®˜ç½‘çš„è§£é‡Šã€‚<br>å¤§å®¶çœ‹ç¤ºä¾‹ä½“ä¼šã€‚ğŸ˜</p>
<p>å‚è€ƒè¿æ¥ï¼š<a href="http://php.net/manual/zh/features.http-auth.php">http://php.net/manual/zh/features.http-auth.php</a></p>
<h3 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_USER&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&#x27;WWW-Authenticate: Basic realm=&quot;My Realm&quot;&#x27;</span>);</span><br><span class="line">    header(<span class="string">&#x27;HTTP/1.0 401 Unauthorized&#x27;</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;401 Unauthorized&#x27;</span>.<span class="string">&#x27;&lt;br&gt; &lt;button onclick=&quot;window.location.reload();&quot;&gt;Login Again&lt;/button&gt;&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_USER&#x27;</span>] !== <span class="string">&#x27;James Bond&#x27;</span> || <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_PW&#x27;</span>] !== <span class="string">&#x27;007&#x27;</span>)&#123;</span><br><span class="line">        header(<span class="string">&#x27;WWW-Authenticate: Basic realm=&quot;My Realm&quot;&#x27;</span>);</span><br><span class="line">        header(<span class="string">&#x27;HTTP/1.0 401 Unauthorized&#x27;</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;401 Unauthorized&#x27;</span>.<span class="string">&#x27;&lt;br&gt; &lt;button onclick=&quot;window.location.reload();&quot;&gt;Login Again&lt;/button&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‹é¢æ˜¯ä½ çš„ä¸šåŠ¡ä»£ç </span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="/assets/images/20170821120459.png" alt="example-pic"></p>
<p>è¿™æ ·å°±ä¼šå¼¹å‡ºä¸€ä¸ªç™»é™†æ¡†ï¼Œè¾“å…¥ç”¨æˆ·åï¼š<code>James Bond</code> å¯†ç ï¼š<code>007</code> ç™»é™†å§ï¼</p>
<p>æˆåŠŸäº†æ²¡ï¼Œå“ˆå“ˆï¼Œå¤§å®¶è§‰å¾—æ˜¯ä¸æ˜¯å¾ˆå¥½ç©~</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>HTTP</tag>
        <tag>è®¤è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¹æœˆï¼ŒåŠ æ²¹ï¼</title>
    <url>/2017/09/06/%E4%B9%9D%E6%9C%88%EF%BC%8C%E5%8A%A0%E6%B2%B9/</url>
    <content><![CDATA[<p><img src="/assets/images/IMG_20170906_101345.png" alt="example-pic"></p>
<p>ä¸çŸ¥ä¸è§‰è¿™ä¸€å¹´å·²ç»è¿‡äº†å¤§åŠã€‚ä¹æœˆäº†ï¼ŒåŠ æ²¹ï¼</p>
]]></content>
      <categories>
        <category>å²æœˆé™å¥½</category>
      </categories>
      <tags>
        <tag>å²æœˆé™å¥½</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªç™¾åº¦åœ°å›¾çš„å¸¸ç”¨ä½¿ç”¨ç¤ºä¾‹</title>
    <url>/2017/09/07/%E4%B8%80%E4%B8%AA%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%B8%B8%E7%94%A8%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<p>ä»Šå¤©åœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†ç™¾åº¦åœ°å›¾ï¼Œæ„Ÿè§‰ä¹Ÿæ˜¯ä¸ªåŸºæœ¬ç”¨æ³•çš„å¸¸ç”¨ç¤ºä¾‹ï¼Œåœ¨è¿™å’Œå¤§å®¶åˆ†äº«ä¸‹ğŸ˜</p>
<p>æ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="/assets/images/20170907200341.png" alt="example-pic"></p>
<p>å…ˆè¯´è¯´éœ€æ±‚å§ï¼š</p>
<blockquote>
<ol>
<li>æ‰“å¼€åœ°å›¾ï¼Œè‡ªåŠ¨<strong>å®šä½åˆ°å½“å‰æ‰€åœ¨ä½ç½®</strong>ï¼Œå¹¶åœ¨åœ°å›¾ä¸Šæ·»åŠ ä¸€ä¸ª<strong>å¯æ‹–æ‹½</strong>çš„æ ‡æ³¨ï¼ˆmarkerï¼‰ </li>
<li>ç”¨æˆ·å¯ä»¥æ‹–æ‹½æ ‡æ³¨é€‰æ‹©åœ°å›¾ä¸Šçš„ä½ç½®ï¼ŒåŒæ—¶æ ‡æ³¨çš„<strong>ç»çº¬åº¦</strong>æ˜¾ç¤ºåœ¨inputæ¡†ä¸­ï¼ˆå…¶å®è¿™ä¸ªæ˜¯ä¸ºäº†çœ‹æ•ˆæœï¼Œä¸€èˆ¬éƒ½ç”¨éšè—åŸŸï¼‰ï¼Œæ ‡æ³¨çš„<strong>å½“å‰åœ°å€</strong>æ˜¾ç¤ºåœ¨åœ°å€çš„è¾“å…¥æ¡†ä¸­</li>
<li>ç”¨æˆ·è¾“å…¥åœ°å€ä¹‹åè‡ªåŠ¨è°ƒç”¨ç™¾åº¦åœ°å›¾çš„APIï¼Œæ‰¾åˆ°è¾“å…¥åœ°å€å¯¹åº”åˆ°åœ°å›¾çš„ç‚¹å¹¶ç§»åŠ¨æ ‡æ³¨åˆ°æ­¤ã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬æ˜¾ç¤ºç»çº¬åº¦ã€‚</li>
</ol>
</blockquote>
<p>HTMLé¡µé¢éƒ¨åˆ†æ˜¯è¿™æ ·å­ï¼Œä½¿ç”¨bootstrap3çš„æ ·å¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">form</span>&quot;&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">label</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">lg</span>-2 <span class="title">col</span>-<span class="title">sm</span>-2 <span class="title">control</span>-<span class="title">label</span>&quot;&gt;åœ°å€&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">lg</span>-10&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span> <span class="title">pwd</span>-<span class="title">input</span>&quot; <span class="title">name</span>=&quot;<span class="title">address</span>&quot; <span class="title">id</span>=&quot;<span class="title">address</span>&quot; <span class="title">value</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> !<span class="title">empty</span>($<span class="title">info</span>[&#x27;<span class="title">address</span>&#x27;]) ? $<span class="title">info</span>[&#x27;<span class="title">address</span>&#x27;] : &#x27;&#x27;;?&gt;&quot; <span class="title">placeholder</span>=&quot;è¯·è¾“å…¥åœ°å€&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">p</span> <span class="title">class</span>=&quot;<span class="title">help</span>-<span class="title">block</span>&quot;&gt;&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">label</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">lg</span>-2 <span class="title">col</span>-<span class="title">sm</span>-2 <span class="title">control</span>-<span class="title">label</span>&quot;&gt;é€‰æ‹©ä½ç½®&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">col</span>-<span class="title">lg</span>-10&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">clearfix</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">class</span>=&quot;<span class="title">control</span>-<span class="title">label</span> <span class="title">pull</span>-<span class="title">left</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">right</span>: 5<span class="title">px</span>;&quot;&gt;ç»åº¦&lt;/<span class="title">label</span>&gt;&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">lng</span>&quot; <span class="title">id</span>=&quot;<span class="title">lng</span>&quot; <span class="title">value</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> !<span class="title">empty</span>($<span class="title">info</span>[&#x27;<span class="title">lng</span>&#x27;]) ? $<span class="title">info</span>[&#x27;<span class="title">lng</span>&#x27;] : &#x27;&#x27;;?&gt;&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span> <span class="title">pull</span>-<span class="title">left</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>: 120<span class="title">px</span>;<span class="title">margin</span>-<span class="title">right</span>: 15<span class="title">px</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">label</span> <span class="title">class</span>=&quot;<span class="title">control</span>-<span class="title">label</span> <span class="title">pull</span>-<span class="title">left</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">right</span>: 5<span class="title">px</span>;&quot;&gt;ç»´åº¦&lt;/<span class="title">label</span>&gt;&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">name</span>=&quot;<span class="title">lat</span>&quot; <span class="title">id</span>=&quot;<span class="title">lat</span>&quot; <span class="title">value</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> !<span class="title">empty</span>($<span class="title">info</span>[&#x27;<span class="title">lat</span>&#x27;]) ? $<span class="title">info</span>[&#x27;<span class="title">lat</span>&#x27;] : &#x27;&#x27;;?&gt;&quot; <span class="title">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span> <span class="title">pull</span>-<span class="title">left</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>: 120<span class="title">px</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">l</span>-<span class="title">map</span>&quot; <span class="title">style</span>=&quot;<span class="title">width</span>: 600<span class="title">px</span>;<span class="title">height</span>: 400<span class="title">px</span>;&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ˜¯jsï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç»çº¬åº¦</span></span><br><span class="line"><span class="keyword">var</span> lat = <span class="string">&#x27;&lt;?php echo !empty($info[&#x27;</span>lat<span class="string">&#x27;]) ? $info[&#x27;</span>lat<span class="string">&#x27;] : &#x27;</span><span class="string">&#x27;;?&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> lng = <span class="string">&#x27;&lt;?php echo !empty($info[&#x27;</span>lng<span class="string">&#x27;]) ? $info[&#x27;</span>lng<span class="string">&#x27;] : &#x27;</span><span class="string">&#x27;;?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™¾åº¦åœ°å›¾APIåŠŸèƒ½</span></span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">&quot;l-map&quot;</span>);    <span class="comment">//newä¸ªåœ°å›¾å‡ºæ¥</span></span><br><span class="line"><span class="keyword">var</span> point;</span><br><span class="line"><span class="keyword">var</span> marker;</span><br><span class="line"><span class="keyword">if</span>(lat &amp;&amp; lng)&#123;</span><br><span class="line">    point = <span class="keyword">new</span> BMap.Point(lng,lat);    <span class="comment">//newä¸ªç‚¹</span></span><br><span class="line">    marker = <span class="keyword">new</span> BMap.Marker(point);    <span class="comment">//newä¸ªæ ‡æ³¨</span></span><br><span class="line">    marker.enableDragging();           <span class="comment">// å¯æ‹–æ‹½</span></span><br><span class="line">    map.addOverlay(marker);             <span class="comment">// å°†æ ‡æ³¨æ·»åŠ åˆ°åœ°å›¾ä¸­</span></span><br><span class="line">    getPosition(marker);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    point = <span class="keyword">new</span> BMap.Point(<span class="number">107.475903</span>, <span class="number">31.214995</span>);</span><br><span class="line">    <span class="comment">//map.addControl(new BMap.GeolocationControl());  //å®šä½</span></span><br><span class="line">    map.addControl(<span class="keyword">new</span> BMap.NavigationControl());  </span><br><span class="line">    <span class="keyword">var</span> geolocation = <span class="keyword">new</span> BMap.Geolocation();   <span class="comment">//è·å–å½“å‰ä½ç½®</span></span><br><span class="line">    geolocation.getCurrentPosition(<span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.getStatus() == BMAP_STATUS_SUCCESS)&#123;</span><br><span class="line">            marker = <span class="keyword">new</span> BMap.Marker(r.point);</span><br><span class="line">            marker.enableDragging();           <span class="comment">// å¯æ‹–æ‹½</span></span><br><span class="line">            map.addOverlay(marker);</span><br><span class="line">            map.panTo(r.point);</span><br><span class="line">            <span class="comment">//console.log(&#x27;æ‚¨çš„ä½ç½®ï¼š&#x27;+r.point.lng+&#x27;,&#x27;+r.point.lat);</span></span><br><span class="line">            getPosition(marker);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            marker = <span class="keyword">new</span> BMap.Marker(point);</span><br><span class="line">            marker.enableDragging();           <span class="comment">// å¯æ‹–æ‹½</span></span><br><span class="line">            map.addOverlay(marker);             <span class="comment">// å°†æ ‡æ³¨æ·»åŠ åˆ°åœ°å›¾ä¸­</span></span><br><span class="line">            getPosition(marker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,&#123;<span class="attr">enableHighAccuracy</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">map.centerAndZoom(point, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gc = <span class="keyword">new</span> BMap.Geocoder();<span class="comment">//åœ°å€è§£æç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ°å€è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶æœç´¢è¾“å…¥çš„ä½ç½®</span></span><br><span class="line">$(<span class="string">&quot;#address&quot;</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> address = $(<span class="built_in">this</span>).val();</span><br><span class="line">    parseAddress(address, <span class="string">&#x27;ä¸Šæµ·å¸‚&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£æåœ°å€</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseAddress</span>(<span class="params">address, city</span>)</span>&#123;</span><br><span class="line">    gc.getPoint(address, <span class="function"><span class="keyword">function</span>(<span class="params">point</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(point);</span><br><span class="line">        <span class="keyword">if</span>(point)&#123;</span><br><span class="line">            <span class="comment">//æ”¾å¤§åœ°å›¾ ä¹‹å‰zoomæ˜¯12</span></span><br><span class="line">            map.setZoom(<span class="number">15</span>);</span><br><span class="line">            <span class="comment">// console.log(marker);</span></span><br><span class="line">            </span><br><span class="line">            $(<span class="string">&quot;#lng&quot;</span>).val(point.lng);</span><br><span class="line">            $(<span class="string">&quot;#lat&quot;</span>).val(point.lat);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ¥ä¸‹æ¥çš„æ“ä½œæƒ³æƒ³åº”è¯¥æ—¶ç§»åŠ¨æ ‡æ³¨åˆ°æ–°çš„ä½ç½®ï¼Œä½†æ˜¯å¥½åƒapiæ²¡è¿™ä¸­æ“ä½œï¼Œåªæœ‰å…ˆæŠŠæ ‡æ³¨ä»åœ°å›¾ä¸Šå–ä¸‹æ¥ æ¢ä¸ªä½ç½®å†æ”¾ä¸Šå»</span></span><br><span class="line">            <span class="keyword">var</span> allOverlay = map.getOverlays(); <span class="comment">//è·å–åœ°å›¾è¦†ç›–ç‰©</span></span><br><span class="line">            <span class="comment">//console.log(allOverlay);</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;allOverlay.length;i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> pos = allOverlay[i].getPosition();</span><br><span class="line">                <span class="comment">//åˆ é™¤æŒ‡å®šç»åº¦çš„è¦†ç›–ç‰©</span></span><br><span class="line">                <span class="keyword">if</span> (pos &amp;&amp; pos.lng == point.lng &amp;&amp; pos.lat == point.lat) &#123;</span><br><span class="line">                    map.removeOverlay(allOverlay[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é‡è®¾æ ‡æ³¨çš„ä½ç½®</span></span><br><span class="line">            marker.setPosition(point);</span><br><span class="line">            <span class="comment">//æŠŠæ ‡æ³¨é‡æ–°æ”¾åˆ°åœ°å›¾ä¸Š</span></span><br><span class="line">            map.addOverlay(marker);</span><br><span class="line">            <span class="comment">//ç§»åŠ¨åœ°å›¾åˆ°æ–°ä½ç½®</span></span><br><span class="line">            map.panTo(point);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, city);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPosition</span>(<span class="params">marker</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//æ·»åŠ æ ‡è®°ç‚¹å‡»ç›‘å¬</span></span><br><span class="line">    marker.addEventListener(<span class="string">&quot;mouseup&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        gc.getLocation(e.point, <span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</span><br><span class="line">            <span class="comment">//console.log(&quot;åœ°å›¾ä¸­å¿ƒç‚¹å˜æ›´ä¸ºï¼š&quot; + rs.lng + &quot;, &quot; + rs.lat);</span></span><br><span class="line">            <span class="built_in">console</span>.log(rs.point.lat + <span class="string">&#x27;,&#x27;</span> + rs.point.lng);</span><br><span class="line">            $(<span class="string">&quot;#lng&quot;</span>).val(rs.point.lng);</span><br><span class="line">            $(<span class="string">&quot;#lat&quot;</span>).val(rs.point.lat);</span><br><span class="line">            $(<span class="string">&quot;#address&quot;</span>).val(rs.address);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®åŸºæœ¬çš„æ“ä½œè¿˜æŒºé¡ºåˆ©çš„ï¼Œåªæ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹ç¢°åˆ°äº†å‘ï¼š<strong>ç§»åŠ¨æ ‡æ³¨</strong></p>
<p>æ€ä¹ˆç§»åŠ¨å‘¢ï¼Ÿç¿»äº†ç™¾åº¦APIæ²¡æ‰¾åˆ°ï¼Œæœ€åä¹Ÿæ˜¯é€šè¿‡æœç´ å¼•æ“æŸ¥æŸ¥æŸ¥ï¼Œæ‰æ‰¾åˆ°æ€è·¯ã€‚</p>
<p>åŸæ¥æ ‡æ³¨æ·»åŠ æ ‡æ³¨(marker)æ·»åŠ åˆ°åœ°å›¾ä¸Šæ˜¯å±äºè¦†ç›–ç‰©(Overlay)ã€‚æƒ³ç§»åŠ¨å°±æ¢ä¸ªæ€è·¯ï¼ŒæŠŠè¿™ä¸ªè¦†ç›–ç‰©ç§»é™¤ï¼Œç„¶åé‡æ–°ç»™æ ‡æ³¨èµ‹äºˆæ–°çš„ä½ç½®å±æ€§ï¼Œç„¶åé‡æ–°æ·»åŠ åˆ°åœ°å›¾ä¸Šã€‚</p>
<p>(ã€‚ãƒ»âˆ€ãƒ»)ãƒ è¿™ä¸‹æå®šå•¦~ èµ¶ç´§å…³æœºä¸‹ç­ï¼Œåº†ç¥ä¸€ä¸‹ ğŸ‰</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>ç™¾åº¦åœ°å›¾</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå·±å®ç°AJAXå¼‚æ­¥ä¸Šä¼ æ–‡ä»¶</title>
    <url>/2017/09/09/%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0AJAX%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p>åœ¨é¡¹ç›®ä¸­ç»å¸¸ç”¨åˆ°æ–‡ä»¶ä¸Šä¼ ï¼Œç„¶åå°±æ‰¾å„ç§å„æ ·çš„æ’ä»¶ã€‚ä½†ç”¨ç€ç”¨ç€æ€»ä¸æ˜¯å¾ˆå¤šåœ°æ–¹ä¸æ˜¯å¾ˆç§°æ‰‹ï¼Œéœ€è¦ä¿®ä¿®æ”¹æ”¹ã€‚æ‰€ä»¥ä»Šå¤©å¹²è„†è‡ªå·±å†™ä¸ªå§ã€‚</p>
<p>å…ˆè¯´è¯´å…·ä½“éœ€æ±‚ï¼š</p>
<blockquote>
<ol>
<li>ä¸Šä¼ æ–‡ä»¶åšåˆ°æ‰€è§æ‰€å¾—ï¼Œå°±æ˜¯é€‰æ‹©æ–‡ä»¶ä¹‹åèƒ½ç«‹é©¬çœ‹åˆ° </li>
<li>å¯ä»¥æ–¹ä¾¿ç”¨åœ¨ç”¨jså¼‚æ­¥æäº¤çš„è¡¨å•ä¸­</li>
</ol>
</blockquote>
<p>HTMLé¡µé¢éƒ¨åˆ†æ˜¯è¿™æ ·å­</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å›¾ç‰‡./images/add_img.pngå°±æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åŠ å· +  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;cursor: pointer;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./images/add_img.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;ç‚¹å‡»ä¸Šä¼ &quot;</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">title</span>=<span class="string">&quot;ç‚¹å‡»ä¸Šä¼ &quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload-img&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;img&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;image&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload-img-input&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;img&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/gif,image/jpeg,image/jpg,image/png,image/bmp&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file_img&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;img&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;upload_image(this);&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨input:fileçš„acceptå±æ€§ä¸­å®šä¹‰å¯ä»¥ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼ï¼ˆMIME ç±»å‹ï¼‰åœ¨è¿™é‡Œæˆ‘ä»¬åˆ—å‡ºå¸¸ç”¨çš„å›¾ç‰‡ç±»å‹ï¼šimage/gif,image/jpeg,image/jpg,image/png,image/bmp</p>
<p>å…¶å®åœ¨è¿™å¤§å®¶ä¼šè¯´åç¼€æ˜¯<code>.jpg</code>å’Œ<code>.jpeg</code>çš„å›¾ç‰‡çš„mime typeä¸éƒ½æ˜¯<code>image/jpeg</code>å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦åŠ ä¸ª<code>image/jpg</code>?</p>
<p>æ²¡é”™ï¼Œæ˜¯è¿™æ ·å¦‚æœä½ åªå†™<code>image/jpeg</code>ç”¨è°·æ­Œæµè§ˆå™¨æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯åœ¨å¾®ä¿¡æµè§ˆå™¨ï¼ŒQQæµè§ˆå™¨ä¸­å°±ä¸è¡Œäº†ï¼Œåæ¥æ‰¾ä¸åˆ°é—®é¢˜ï¼Œå°è¯•äº†å¥½å¤šæ¬¡æ‰å‘ç°è¿™ä¸ªé—®é¢˜ã€‚æ²¡åŠæ³•ï¼Œå›½äº§æµè§ˆå™¨ä¸æŒ‰æ ‡å‡†é€ çš„åŸå›  â•®(â•¯â–½â•°)â•­</p>
<p>å…¶ä»–æ–‡ä»¶æ ¼å¼å¤§å®¶çœ‹è¿™é‡Œ  <a href="http://www.w3school.com.cn/media/media_mimeref.asp">w3school</a> </p>
<p>é‡ç‚¹æ˜¯jsï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å‡»å›¾ç‰‡çš„æ—¶å€™ è§¦å‘éšè—çš„input:fileçš„ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">$(<span class="string">&quot;.upload-img&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id = $(<span class="built_in">this</span>).data(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;file_&#x27;</span> + id);</span><br><span class="line">    file.click();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_image</span>(<span class="params">pic_file</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id = $(pic_file).data(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> input = $(<span class="string">&quot;input.upload-img-input[data-id=&quot;</span>+id+<span class="string">&quot;]&quot;</span>);    <span class="comment">//æ‰¾åˆ°ç›¸åº”çš„éšè—åŸŸ</span></span><br><span class="line">    <span class="keyword">var</span> pic = $(<span class="string">&quot;img.upload-img[data-id=&quot;</span>+id+<span class="string">&quot;]&quot;</span>);              <span class="comment">//æ‰¾åˆ°ç›¸åº”çš„é¢„è§ˆå›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> file = pic_file.files[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (file.size &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;   <span class="comment">//è®¾ç½®é™åˆ¶æ–‡ä»¶å¤§å° ä¸å¤§äº2MB</span></span><br><span class="line">        alert(<span class="string">&#x27;ä¸Šä¼ æ–‡ä»¶ä¸èƒ½å¤§äº2M!&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();    <span class="comment">//ä½¿ç”¨formDataå¯¹è±¡</span></span><br><span class="line">    fd.append(<span class="string">&quot;pic_file&quot;</span>, file);</span><br><span class="line">    <span class="comment">//fd.append(&quot;name&quot;, name);  //å¯ä»¥æ·»åŠ å…¶ä»–å­—æ®µï¼Œæ¯”å¦‚æœ‰äº›æ¡†ä¸ºäº†å®‰å…¨åŠ çš„csrf_token</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">    xhr.open(<span class="string">&quot;POST&quot;</span>, <span class="string">&#x27;upload_file.php&#x27;</span>);    <span class="comment">//è¿™é‡Œæ˜¯åç«¯å¤„ç†çš„åœ°å€</span></span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.status == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> obj = <span class="built_in">eval</span>(<span class="string">&#x27;(&#x27;</span> + xhr.responseText + <span class="string">&#x27;)&#x27;</span>);   <span class="comment">//æŠŠjsonå­—ç¬¦ä¸²è½¬æ¢æˆjså¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (obj.ret == <span class="number">200</span>) &#123;   <span class="comment">//ä¸Šä¼ æˆåŠŸ</span></span><br><span class="line">                <span class="keyword">var</span> pic_url = obj.data.url; <span class="comment">//æ˜¾ç¤ºé¢„è§ˆå›¾</span></span><br><span class="line">                input.val(pic_url);         <span class="comment">//æŠŠåœ°å€æ”¾åˆ°éšè—åŸŸ</span></span><br><span class="line">                pic.attr(<span class="string">&#x27;src&#x27;</span>, pic_url);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(obj.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(<span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨å€™å†è¯•&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.send(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœåŠ¡ç«¯ä¸Šä¼ è¿”å›çš„jsonæ ¼å¼æ˜¯è¿™æ ·</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;ret&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;ä½ çš„å›¾ç‰‡urlåœ°å€&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>HTML5</tag>
        <tag>AJAX</tag>
      </tags>
  </entry>
  <entry>
    <title>EFIæ¨¡å¼ä¸‹å®‰è£…win10+Archlinux</title>
    <url>/2017/09/13/EFI%E6%A8%A1%E5%BC%8F%E4%B8%8B%E5%AE%89%E8%A3%85win10+Archlinux/</url>
    <content><![CDATA[<p>å°±æœ€è¿‘ä¸€æ¬¡å®‰è£…Archlinuxåšä¸€æ¬¡ç¬”è®°å§ã€‚åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆæ²¡äº‹å°±è£…archï¼Œå› ä¸ºä»–æ˜¯arch  ğŸ˜œ </p>
<p>Win10å®‰è£…å°±ç•¥è¿‡äº†ï¼Œæˆ‘çš„ç”µè„‘linuxè€æ¢ï¼Œwin10å§‹ç»ˆç¨³ç¨³çš„åœ¨é‚£èººç€ï¼Œä¸€åŠ¨ä¸åŠ¨ã€‚ã€‚ã€‚</p>
<p>å› ä¸ºwin10æ˜¯æå‰å®‰è£…å¥½çš„ï¼Œè€Œä»–æ˜¯ä½¿ç”¨EFIæ¨¡å¼å®‰è£…çš„ æˆ‘ä»¬åœ¨win10ä¸‹åœ¨ç¡¬ç›˜ä¸Šç»™å’‹archæŒªå‡ºç‚¹ç©ºé—´æ¥ï¼Œå‡ åä¸ªGBå°±è¡Œã€‚çœ‹ä½ ç¡¬ç›˜å¤§å°äº†å’Œå¿ƒæƒ…äº†ã€‚</p>
<h3 id="å¯åŠ¨liveCD"><a href="#å¯åŠ¨liveCD" class="headerlink" title="å¯åŠ¨liveCD"></a>å¯åŠ¨liveCD</h3><p>ç”¨åœ¨<a href="https://www.archlinux.org/download/">å®˜ç½‘</a>æˆ–è€…<a href="http://mirrors.163.com/archlinux/iso/2017.09.01/">163</a>æºä¸‹è½½æœ€æ–°çš„liveCDé•œåƒï¼ˆæ¯”å¦‚æœ€æ–°æ˜¯archlinux-2017.09.01-x86_64.isoï¼‰ï¼Œåˆ»å½•åˆ°uç›˜ï¼Œæˆ‘å–œæ¬¢ç”¨<a href="http://rufus.akeo.ie/">rufs</a>ï¼Œè¿™ä¸ªä¸å¤§äº1Mçš„å°å·¥å…·å¾ˆç®€å•å¼ºå¤§æˆ‘å–œæ¬¢ã€‚ å½“ç„¶äº†ï¼Œç†Ÿæ‚‰linuxçš„åŒå­¦å¯ä»¥ç”¨<a href="https://wiki.archlinux.org/index.php/Core_utilities#dd">dd</a>å‘½ä»¤ã€‚</p>
<p>æ’ä¸Šuç›˜ï¼Œé‡å¯åˆ°liveCDé‡Œé¢ã€‚é‡Œé¢ä¹Ÿæ˜¯ä¸ªæ²¡æ¡Œé¢çš„shellç³»ç»Ÿã€‚</p>
<h3 id="çœ‹Archlinux-wiki"><a href="#çœ‹Archlinux-wiki" class="headerlink" title="çœ‹Archlinux wiki"></a>çœ‹Archlinux wiki</h3><p>åœ¨å¼€å§‹ä¹‹å‰æœ€å¥½è¿˜æ˜¯çœ‹çœ‹<a href="https://wiki.archlinux.org/index.php/Installation_guide">archçš„wiki</a>Installation guide(å®‰è£…æŒ‡å—)ï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œæœ€å¥½çœ‹è‹±æ–‡çš„ï¼Œä¸­æ–‡çš„ç¿»è¯‘æœ‰ç‚¹å»¶è¿Ÿã€‚</p>
<h3 id="è”ç½‘"><a href="#è”ç½‘" class="headerlink" title="è”ç½‘"></a>è”ç½‘</h3><p>å¦‚æœä½ æ˜¯æœ‰çº¿ç½‘ç»œï¼Œæ’ä¸Šç½‘çº¿ï¼Œå¯åŠ¨<a href="https://wiki.archlinux.org/index.php/Dhcpcd">dhcpd</a>æœåŠ¡ï¼ˆä¹Ÿå°±æ˜¯åŠ¨æ€è·å–ipï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start dhcpcd</span><br></pre></td></tr></table></figure>
<p>æ— çº¿ç½‘ç»œç”¨wifi-menué“¾æ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wifi-menu</span><br></pre></td></tr></table></figure>
<p>çœ‹çœ‹é“¾æ¥æˆåŠŸäº†æ²¡ æŸ¥çœ‹ä¸‹ip</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æˆåŠŸï¼Œæˆ–è€…å…¶ä»–çš„è”ç½‘æ–¹å¼ï¼Œçœ‹çœ‹<a href="https://wiki.archlinux.org/index.php/Network_configuration">archçš„wiki</a></p>
<p>å…¶å®è¯´åˆ°è¿™ï¼Œå†æ¬¡æé†’å¤§å®¶ï¼Œçœ‹<a href="https://wiki.archlinux.org/">archçš„wiki</a></p>
<p>è¿ä¸Šç½‘ç»œäº†ï¼Œå¼€å·¥å§!</p>
<h3 id="åˆ†åŒºï¼š"><a href="#åˆ†åŒºï¼š" class="headerlink" title="åˆ†åŒºï¼š"></a>åˆ†åŒºï¼š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fdisk /dev/sda</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥fdiskä¹‹åæŒ‰<code>p</code>ï¼Œçœ‹çœ‹ç°æœ‰åˆ†åŒºçš„æƒ…å†µ<br>è¿™æ˜¯æˆ‘çš„ç¡¬ç›˜åˆ†åŒºæƒ…å†µï¼Œç¡¬ç›˜æ ¼å¼<code>gpt</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/dev/sda1        2048     923647    921600   450M Windows æ¢å¤ç¯å¢ƒ</span><br><span class="line">/dev/sda2      923648    1128447    204800   100M EFI ç³»ç»Ÿ</span><br><span class="line">/dev/sda3     1128448    1161215     32768    16M Microsoft ä¿ç•™</span><br><span class="line">/dev/sda4     1161216  209256750 208095535  99.2G Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line">/dev/sda5   209258496  210888703   1630208   796M Windows æ¢å¤ç¯å¢ƒ</span><br><span class="line">/dev/sda6   210890752  462559542 251668791   120G Microsoft åŸºæœ¬æ•°æ®</span><br></pre></td></tr></table></figure>
<p>å‡å¦‚æˆ‘çš„ç¡¬ç›˜ä¸­ç©ºé—²ç©ºé—´100GBï¼Œç”¨fdisk ç»™è¿™100GBåˆ†ä¸€åˆ†</p>
<p>æˆ‘çš„æ–¹æ¡ˆæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/dev/sda7    /boot           ext4    500MB    #bootå¯åŠ¨åˆ†åŒº 500MBå¤Ÿç”¨äº†</span><br><span class="line">/dev/sda8    swap                        8GB         #äº¤æ¢åˆ†åŒºï¼Œ æˆ‘çš„å†…å­˜ä¹Ÿ8GBï¼Œæˆ‘å°±åˆ†ä¸€æ ·å¤§å°äº†</span><br><span class="line">/dev/sda9    /                   ext4                   #å‰©ä¸‹çš„å…¨ç»™ / æ ¹åˆ†åŒº</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®è‡ªå·±çš„ç©ºé—´å¤§å°è‡ªè¡Œè°ƒæ•´ã€‚</p>
<p>æ ¼å¼åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkfs.ext4 /dev/sda7</span><br><span class="line">mkfs.ext4 /dev/sda9</span><br><span class="line">mkswap /dev/sda8</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…åŸºç¡€ç³»ç»Ÿ"><a href="#å®‰è£…åŸºç¡€ç³»ç»Ÿ" class="headerlink" title="å®‰è£…åŸºç¡€ç³»ç»Ÿ"></a>å®‰è£…åŸºç¡€ç³»ç»Ÿ</h3><p>æŒ‚è½½åˆ†åŒºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mount /dev/sda9 /mnt</span><br><span class="line">mkdir /mnt/boot</span><br><span class="line">mount /dev/sda7 /mnt/boot</span><br><span class="line">mkdir /mnt/boot/EFI</span><br><span class="line">mount /dev/sda2 /mnt/boot/EFI          #è¿™ä¸ªEFIåˆ†åŒºåœ¨åˆ†åŒºæƒ…å†µé‡Œé¢èƒ½çœ‹åˆ°æˆ‘çš„æ˜¯sda2</span><br><span class="line">swapon /dev/sda8</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure>
<p>æŠŠ163ï¼Œustcè¿™å‡ ä¸ªæ¯”è¾ƒå¥½ä½¿çš„ä¸­å›½æºå¤åˆ¶åˆ°æ–‡ä»¶æœ€ä¸Šé¢ï¼Œåˆ°æ—¶å€™ä¸‹è½½å®‰è£…çš„æ—¶å€™è·‘çš„å¿«ä¸€ç‚¹</p>
<p>å¼€å§‹å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pacstrap -i /mnt base vim dialog wpa_supplicant     </span><br></pre></td></tr></table></figure>
<p>baseæ˜¯åŸºç¡€ç³»ç»Ÿï¼Œdialogæ˜¯ä¸Šé¢æåˆ°çš„é“¾æ¥æ— çº¿ç½‘çš„wifi-menuï¼Œwpa_supplicantä¹Ÿæ˜¯æ‰‹åŠ¨é“¾æ¥æ— çº¿ç½‘çš„åŒ…ï¼Œvim ä¸è§£é‡Š </p>
<p>å®‰è£…å®Œæˆä¹‹å</p>
<p>æŠŠåˆ†åŒºæŒ‚è½½æƒ…å†µå†™å…¥fstabä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">genfstab -U -p /mnt &gt; /mnt/etc/fstab</span><br></pre></td></tr></table></figure>

<p>chrootè¿›æ–°ç³»ç»Ÿï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">arch-chroot /mnt /bin/bash</span><br></pre></td></tr></table></figure>

<p>ä¸€äº›é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &#x27;my-archlinux&#x27; &gt; /etc/hostname     #è®¾ç½®ä¸»æœºåå­—</span><br><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai   #è®¾ç½®æ—¶åŒº</span><br><span class="line">timedatectl set-timezone Asia/Shanghai      #ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªè®¾ç½®æ—¶åŒº</span><br><span class="line">timedatectl set-ntp true        # è®¾ç½®æ—¶é—´ntpåŒæ­¥ç½‘ç»œæ—¶é—´</span><br><span class="line">vim /etc/locale.gen     # åŒºåŸŸè®¾ç½® å–æ¶ˆè‹±æ–‡ï¼ˆen_US.UTF-8ï¼‰å’Œä¸­æ–‡(zh_CN.UTF-8)çš„æ³¨é‡Š</span><br><span class="line">locale-gen      #ç”Ÿæˆè®¾ç½®åŒºåŸŸè®¾ç½®</span><br><span class="line">echo &quot;LANG=en_US.UTF-8&quot; &gt; /etc/locale.conf #è®¾ç½®è¯­è¨€ï¼Œå› ä¸ºå…ˆå®‰è£…çš„æ˜¯æ²¡æ¡Œé¢çš„æ¨¡å¼ï¼Œå…ˆç”¨è‹±æ–‡ï¼Œä¸­æ–‡ä¼šæ˜¾ç¤ºæˆå°æ–¹å—</span><br></pre></td></tr></table></figure>
<p> åˆ›å»ºåˆå§‹å†…å­˜ç›˜<a href="https://wiki.archlinux.org/index.php/Mkinitcpio">mkinitcpio</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkinitcpio -p linux  </span><br></pre></td></tr></table></figure>
<p>è®¾ç½®rootå¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">passwd      </span><br></pre></td></tr></table></figure>
<p>è¿™æ­¥å¿˜äº†ï¼Œä½ å°±è¿›ä¸å»ç³»ç»Ÿäº†ï¼Œâ•®(â•¯â–½â•°)â•­</p>
<p>æå®šå¯åŠ¨é¡¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pacman -S grub efibootmgr       #å®‰è£…grub efibootmgrç®¡ç†å¯åŠ¨é¡¹</span><br><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot/EFI --bootloader-id=arch_grub --recheck</span><br><span class="line">pacman -S os-prober     #å®‰è£…è¿™ä¸ªåŒ…æ˜¯ä¸ºäº†è®©grub-mkconfigå‘ç°win10çš„å¯åŠ¨é¡¹</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg   #æŠŠå¯åŠ¨é¡¹å†™åˆ°æ–‡ä»¶é…ç½®é‡Œ </span><br></pre></td></tr></table></figure>
<p>å¦‚æœwin10çš„å¯åŠ¨é¡¹æ²¡æœ‰è¢«å‘ç°ï¼Œä¸è¦ç€æ€¥ï¼Œåœ¨æ–°çš„ç³»ç»Ÿå®‰è£…é‡å¯ä¹‹åï¼Œé‡æ–°æ‰§è¡Œä¸Šé¢<code>grub-mkconfig</code>å‘½ä»¤å°±è¡Œäº†</p>
<p>é€€å‡ºæ–°ç³»ç»Ÿ,é‡å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exit        #é€€å‡º</span><br><span class="line">unmout -R /mnt  #å–æ¶ˆæŒ‚è½½ç£ç›˜</span><br><span class="line">reboot   #é‡å¯</span><br></pre></td></tr></table></figure>

<p>å¥½äº†å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œé‡å¯ä¹‹åå°±èƒ½çœ‹åˆ°ä½ çš„æ–°ç³»ç»Ÿäº†  (ã€‚ãƒ»âˆ€ãƒ»)ãƒ </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>EFI</tag>
        <tag>Archlinux</tag>
      </tags>
  </entry>
  <entry>
    <title>Win10å­ç³»ç»Ÿubuntuæ›´æ¢æº</title>
    <url>/2017/09/17/win10%E5%AD%90%E7%B3%BB%E7%BB%9Fubuntu%E6%9B%B4%E6%8D%A2%E6%BA%90/</url>
    <content><![CDATA[<p>ä½œä¸ºä¸€ä¸ªwindowsä¸‹é¢çš„å¼€å‘è€…ï¼Œä¹‹å‰å·¥ä½œä¸€ç›´ç”¨cygwinã€‚cygwinè™½ç„¶æ–¹ä¾¿ä½†æ˜¯å¾ˆå¤šæ—¶å€™å®‰è£…ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚jekyll,æ˜¯å„ç§ä¾èµ–ä¸è¶³ï¼Œå¤ªç—›è‹¦äº†ã€‚å¥½åœ¨å¾®è½¯win10å‡ºäº†é’ˆå¯¹å¼€å‘è€…çš„linuxå­ç³»ç»Ÿï¼Œé‚£å°±å…ˆè¯•ç”¨ä¸€æ®µæ—¶é—´å§ã€‚</p>
<p>ç°åœ¨win10çš„linuxå­ç³»ç»Ÿå·²ç»æœ‰ubuntuå’Œopensuseä¸¤ä¸ªç‰ˆæœ¬äº†,åº”è¯¥åç»­è¿˜ä¼šæ¨å‡ºæ›´å¤šçš„linuxå‘è¡Œç‰ˆã€‚å¤§å®¶æŒ‰ä¸ªäººå–œå¥½å®‰è£…å§ã€‚</p>
<p>å®‰è£…è¿‡ç¨‹ï¼Œç½‘ä¸Šå¾ˆå¤šä¹Ÿä¸éš¾ï¼Œå°±ç•¥è¿‡äº†ï¼Œå¤§å®¶è‡ªè¡Œæœç´¢å§ã€‚</p>
<p>æˆ‘çš„linuxå­ç³»ç»Ÿç”¨çš„æ˜¯ubuntuï¼Œä½¿ç”¨èµ·æ¥ç®€å•æ–¹ä¾¿å•ŠğŸ˜</p>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œé¡ºæ‰‹å°±æ˜¯ä¸€ä¸ª <code>apt update</code>ï¼Œä½†æ˜¯é»˜è®¤çš„æºå¤ªæ…¢äº†ï¼Œæ²¡æ³•å¿ã€‚é‚£æˆ‘ä»¬å°±æ¢å›½å†…æºå§ã€‚</p>
<p>å›½å†…æœ‰å¥½å¤šæºï¼Œ<a href="http://mirrors.aliyun.com/">é˜¿é‡Œäº‘</a>ï¼Œ<a href="http://mirrors.163.com/">163</a>ï¼Œ<a href="http://mirrors.sohu.com/">æœç‹</a>ï¼Œ<a href="http://mirrors.ustc.edu.cn/">ä¸­ç§‘å¤§</a>ç­‰ç­‰ã€‚æˆ‘ä»¬å°±ä»¥é˜¿é‡Œäº‘åšä¸ªä¾‹å­å§ï¼š</p>
<p>æµè§ˆå™¨æ‰“å¼€ <a href="http://mirrors.aliyun.com/">http://mirrors.aliyun.com/</a></p>
<p><img src="/assets/images/20170917191649.png" alt="example-pic"></p>
<p>æ‰¾åˆ°ubuntuçš„help </p>
<p><img src="/assets/images/20170917192021.png" alt="pic"></p>
<p>å‘ç°é‡Œé¢æœ€æ–°çš„æ˜¯ Quantal(12.10) çœ‹æ¥ä¸èƒ½ç›´æ¥å¤åˆ¶</p>
<p>åœ¨ä½ çš„å­ç³»ç»Ÿbashä¸­æ‰§è¡Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat /etc/apt/sources.list</span><br><span class="line">-------------------------</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ xenial main restricted universe multiverse</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ xenial-updates main restricted universe multiverse</span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ xenial-security main restricted universe multiverse</span><br><span class="line">-------------------------</span><br></pre></td></tr></table></figure>
<p>ç´¢æ€§æœ€æ–°ç‰ˆubuntu16.04ä»£å·å«xenial</p>
<p>é‚£ç›´æ¥æŠŠurlæ¢æ¢å°±è¡Œäº†</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bk     <span class="comment"># æ”¹é…ç½®æ–‡ä»¶ï¼Œå…ˆå¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯</span></span><br><span class="line">sudo vim /etc/apt/sources.list   <span class="comment"># æŠŠå†…å®¹æ¢æˆä¸‹é¢çš„å°±è¡Œäº†ï¼Œå…¶å®å°±æ˜¯urlå˜äº†</span></span><br><span class="line">-------------------------</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse</span><br><span class="line">-------------------------</span><br></pre></td></tr></table></figure>
<p>æå®šäº†ï¼Œæµ‹è¯•ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>
<p>æ²¡é—®é¢˜å°±å¯ä»¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Win10</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>MSYS2åˆä½“éªŒ</title>
    <url>/2017/09/22/MSYS2%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
    <content><![CDATA[<p>ä½œä¸ºä¸€åwindowsä¸‹é¢å¼€å‘è€…ï¼Œä¹‹å‰å·¥ä½œCygwinåšä¸ºè¾…åŠ©ã€‚å‰äº›å¤©çªç„¶å‘ç°äº†ä¸€ä¸ªå«MSYS2çš„å®¶ä¼™ã€‚</p>
<p>å‘ç°è¿™å®¶ä¼™è¿˜ä¸é”™ï¼Œè¿™æ˜¯<a href="https://baike.baidu.com/item/MSYS2">ç™¾åº¦ç™¾ç§‘</a>çš„ä»‹ç»ï¼š</p>
<blockquote>
<p>MSYS2 ï¼ˆMinimal SYStem 2ï¼‰ æ˜¯ä¸€ä¸ªMSYSçš„ç‹¬ç«‹æ”¹å†™ç‰ˆæœ¬ï¼Œä¸»è¦ç”¨äº shell å‘½ä»¤è¡Œå¼€å‘ç¯å¢ƒã€‚åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªåœ¨Cygwin ï¼ˆPOSIX å…¼å®¹æ€§å±‚ï¼‰ å’Œ MinGW-w64ï¼ˆä»â€MinGW-ç”Ÿæˆâ€ï¼‰åŸºç¡€ä¸Šäº§ç”Ÿçš„ï¼Œè¿½æ±‚æ›´å¥½çš„äº’æ“ä½œæ€§çš„ Windows è½¯ä»¶ã€‚<br>MSYS2 æ˜¯MSYSçš„ä¸€ä¸ªå‡çº§ç‰ˆ,å‡†ç¡®çš„è¯´æ˜¯é›†æˆäº†pacman(æˆ‘å–œæ¬¢å«åƒè±†äºº)å’ŒMingw-w64çš„Cygwinå‡çº§ç‰ˆ, æä¾›äº†bash shellç­‰linuxç¯å¢ƒã€ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ï¼ˆgit/hgï¼‰å’ŒMinGW-w64 å·¥å…·é“¾ã€‚ä¸MSYSæœ€å¤§çš„åŒºåˆ«æ˜¯ç§»æ¤äº† Arch Linuxçš„è½¯ä»¶åŒ…ç®¡ç†ç³»ç»Ÿ Pacman(å…¶å®æ˜¯ä¸Cygwinçš„åŒºåˆ«)ã€‚</p>
</blockquote>
<p>çœ‹èµ·æ¥è¿˜ä¸é”™ï¼Œè¿™æ˜¯<a href="http://www.msys2.org/">å®˜ç½‘</a></p>
<p>å®‰è£…å°±ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…ç¨‹åºå®‰è£…å°±å¯ä»¥äº†ã€‚</p>
<p>å®‰è£…ä¹‹åæ€¥åˆ‡åœ° <code>pacman -Sy</code> åˆ·æ–°è½¯ä»¶åŒ…æ•°æ®ï¼Œå®˜ç½‘çš„æºè¿˜æœ‰ç‚¹æ…¢ã€‚æ¢<a href="http://mirrors.ustc.edu.cn/">ä¸­ç§‘å¤§</a>çš„æºå§ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/pacman.d</span><br><span class="line">ls</span><br><span class="line">-------------------</span><br><span class="line">gnupg mirrorlist.mingw32  mirrorlist.mingw64  mirrorlist.msys</span><br></pre></td></tr></table></figure>

<p>ä¸‰ä¸ª<code>mirrorlist</code>å¼€å¤´çš„æ–‡ä»¶å°±æ˜¯æºçš„é…ç½®æ–‡ä»¶</p>
<p>ç¼–è¾‘ /etc/pacman.d/mirrorlist.mingw32 ï¼Œåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Server = http://mirrors.ustc.edu.cn/msys2/mingw/i686</span><br></pre></td></tr></table></figure>

<p>ç¼–è¾‘ /etc/pacman.d/mirrorlist.mingw64 ï¼Œåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Server = http://mirrors.ustc.edu.cn/msys2/mingw/x86_64</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘ /etc/pacman.d/mirrorlist.msys ï¼Œåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Server = http://mirrors.ustc.edu.cn/msys2/msys/$arch</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œ <code>pacman -Sy</code> åˆ·æ–°è½¯ä»¶åŒ…æ•°æ®å³å¯ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œcygwinåˆ‡æ¢ç³»ç»Ÿç£ç›˜æ˜¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /cygdrive/d/   <span class="comment">#æ¯”å¦‚åˆ‡æ¢åˆ°dç›˜</span></span><br></pre></td></tr></table></figure>

<p>MYSYS2æ˜¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /d</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨windowsåŸç”Ÿå‘½ä»¤æ¯”å¦‚pingä¼šä¸­æ–‡ä¹±ç ï¼Œè¿™ä¹ˆè§£å†³ï¼š</p>
<p>æ–°å»º /bin/winï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="variable">$@</span> |iconv -f gbk -t utf-8</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/bin/win ping baidu.com</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Win10</tag>
        <tag>MSYS2</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­å»ºGitæœåŠ¡å™¨ã€ç¼–å†™è‡ªåŠ¨éƒ¨ç½²è„šæœ¬</title>
    <url>/2017/09/29/%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%81%E7%BC%96%E5%86%99%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<p>ä»Šå¤©è¯•äº†ä¸‹åœ¨linuxæœåŠ¡å™¨ä¸Šæ­å»ºGitæœåŠ¡å™¨ï¼Œå¹¶ä¸”ç¼–å†™ä¸€ä¸ªç®€å•çš„è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ã€‚</p>
<p>ä¸»è¦å‚è€ƒ <a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137583770360579bc4b458f044ce7afed3df579123eca000">å»–é›ªå³°-GITæ•™ç¨‹-æ­å»ºGitæœåŠ¡å™¨</a></p>
<p>ç°åœ¨å¼€å§‹å§ï¼</p>
<h3 id="åˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡"><a href="#åˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡"></a>åˆ›å»ºä¸€ä¸ª<code>git</code>ç”¨æˆ·ï¼Œç”¨æ¥è¿è¡Œ<code>git</code>æœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adduser git</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºè¯ä¹¦ç™»å½•"><a href="#åˆ›å»ºè¯ä¹¦ç™»å½•" class="headerlink" title="åˆ›å»ºè¯ä¹¦ç™»å½•"></a>åˆ›å»ºè¯ä¹¦ç™»å½•</h3><p>æ”¶é›†æ‰€æœ‰éœ€è¦ç™»å½•çš„ç”¨æˆ·çš„å…¬é’¥ï¼Œå°±æ˜¯ä»–ä»¬è‡ªå·±çš„<code>id_rsa.pub</code>æ–‡ä»¶ï¼ŒæŠŠæ‰€æœ‰å…¬é’¥å¯¼å…¥åˆ°<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶é‡Œï¼Œä¸€è¡Œä¸€ä¸ªã€‚</p>
<h3 id="åˆå§‹åŒ–Gitä»“åº“"><a href="#åˆå§‹åŒ–Gitä»“åº“" class="headerlink" title="åˆå§‹åŒ–Gitä»“åº“"></a>åˆå§‹åŒ–Gitä»“åº“</h3><p>å…ˆé€‰å®šä¸€ä¸ªç›®å½•ä½œä¸ºGitä»“åº“ï¼Œå‡å®šæ˜¯<code>/home/git/sample.git</code>ï¼Œåœ¨<code>/home/git</code>ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git init --bare sample.git</span><br></pre></td></tr></table></figure>
<p>Gitå°±ä¼šåˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œè£¸ä»“åº“æ²¡æœ‰å·¥ä½œåŒºï¼Œå› ä¸ºæœåŠ¡å™¨ä¸Šçš„Gitä»“åº“çº¯ç²¹æ˜¯ä¸ºäº†å…±äº«ï¼Œæ‰€ä»¥ä¸è®©ç”¨æˆ·ç›´æ¥ç™»å½•åˆ°æœåŠ¡å™¨ä¸Šå»æ”¹å·¥ä½œåŒºï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šçš„Gitä»“åº“é€šå¸¸éƒ½ä»¥<code>.git</code>ç»“å°¾ã€‚ç„¶åï¼ŒæŠŠowneræ”¹ä¸º<code>git</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chown -R git:git sample.git</span><br></pre></td></tr></table></figure>

<h3 id="ç¦ç”¨gitç”¨æˆ·shellç™»å½•"><a href="#ç¦ç”¨gitç”¨æˆ·shellç™»å½•" class="headerlink" title="ç¦ç”¨gitç”¨æˆ·shellç™»å½•"></a>ç¦ç”¨gitç”¨æˆ·shellç™»å½•</h3><p>é€šè¿‡ç¼–è¾‘<code>/etc/passwd</code>æ–‡ä»¶å®Œæˆï¼Œæ‰¾åˆ°ä½ çš„gitç”¨æˆ·çš„ä¸€è¡Œ,ä¾‹å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git:x:1001:1001:,,,:/home/git:/bin/bash</span><br></pre></td></tr></table></figure>
<p>æŠŠ<code>/bin/bash</code>æ”¹ä¸º<code>/usr/bin/git-shell</code>,ä¾‹å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œgitç”¨æˆ·å¯ä»¥æ­£å¸¸é€šè¿‡sshä½¿ç”¨gitï¼Œä½†æ— æ³•ç™»å½•shellï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºgitç”¨æˆ·æŒ‡å®šçš„git-shellæ¯æ¬¡ä¸€ç™»å½•å°±è‡ªåŠ¨é€€å‡ºã€‚</p>
<h3 id="å…‹éš†è¿œç¨‹ä»“åº“"><a href="#å…‹éš†è¿œç¨‹ä»“åº“" class="headerlink" title="å…‹éš†è¿œç¨‹ä»“åº“"></a>å…‹éš†è¿œç¨‹ä»“åº“</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@server:sample.git</span><br></pre></td></tr></table></figure>
<p>serveræ˜¯ä½ çš„æœåŠ¡å™¨åŸŸåæˆ–ipåœ°å€</p>
<p>å¦‚æœgitä»“åº“å’Œwebç›®å½•åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸»æœºä¸Š:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> /home/git/sample.git</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸æ˜¯åœ¨gitç”¨æˆ·çš„å®¶ç›®å½•ä¸­åˆ›å»ºçš„,æ¯”å¦‚<code>/srv/gits/sample.git</code>ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@server:/srv/gits/sample.git</span><br></pre></td></tr></table></figure>

<p>å¦‚æœcloneæˆåŠŸï¼Œé‚£ä¹ˆä½ çš„gitæœåŠ¡å™¨å°±æ­å»ºæˆåŠŸäº†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼š</p>
<h3 id="è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬"><a href="#è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬" class="headerlink" title="è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬"></a>è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬</h3><p>å› ä¸ºæˆ‘æ˜¯webç›®å½•å’Œgitæ˜¯åŒä¸€å°æœåŠ¡å™¨</p>
<p>ç¼–è¾‘ <code>/home/git/sample.git/hooks/post-receive</code>, <code>post-receive</code>å°±æ˜¯åœ¨gitæœåŠ¡å™¨æ”¶åˆ°ä»£ç æ¨é€å(<code>push</code>å®Œæˆä¹‹å)æ‰§è¡Œçš„è„šæœ¬ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">while read oldrev newrev refname</span><br><span class="line">do</span><br><span class="line">    branch=$(git rev-parse --symbolic --abbrev-ref $refname)</span><br><span class="line">    if [ &quot;master&quot; == &quot;$branch&quot; ]; then</span><br><span class="line">        # Do something</span><br><span class="line">        echo &quot;post-receive in branch master&quot; &gt;&gt; /tmp/git-sample.log</span><br><span class="line">        unset GIT_DIR</span><br><span class="line">        wwwPath=/var/www/html/sample</span><br><span class="line">        cd $wwwPath &amp;&amp; /usr/bin/git pull origin master</span><br><span class="line">        exit 0</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>ä»è„šæœ¬å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨åˆ¤æ–­å½“å‰<code>push</code>çš„åˆ†æ”¯æ˜¯<code>master</code>æ—¶æ‰§è¡Œ<code>git pull origin master</code>æ“ä½œã€‚</p>
<p>ç»™æ‰§è¡Œæƒé™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chown -R git:git /home/git/sample.git/hooks/post-receive</span><br><span class="line">chmod +x /home/git/sample.git/hooks/post-receive</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ˜¯gitä»“åº“å’Œwebç›®å½•åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸»æœºä¸Š,è¿™é‡Œcloneä½¿ç”¨çš„æ˜¯:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> /home/git/sample.git</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºåŒæ­¥è„šæœ¬çš„æ‰§è¡Œç”¨æˆ·æ˜¯gitï¼Œæ‰€ä»¥è¦ä¿è¯é¡¹ç›®ç›®å½•è¦èµ‹äºˆgitå†™æƒé™ã€‚å®¹æ˜“å‡ºé—®é¢˜çš„ä¹Ÿæ˜¯æƒé™é—®é¢˜ã€‚</p>
<p>å¥½äº†ï¼Œè¯•è¯•å§~</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>DockeråŸºç¡€å‘½ä»¤</title>
    <url>/2017/10/26/Docker%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>æœ€è¿‘å¿™é‡Œå·é—²ç ”ç©¶äº†ä¸‹dockerè¿™ä¸ªå¾ˆç«çš„ä¸œä¸œã€‚åšç‚¹ç¬”è®°ğŸ˜</p>
<h3 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h3><p>åˆ—å‡ºé•œåƒåˆ—è¡¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>è·å–ä¸€ä¸ªæ–°çš„é•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker pull base/archlinux</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤é•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker rmi imageID</span><br></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾é•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker search php</span><br></pre></td></tr></table></figure>
<p>æ„å»º</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/Dockerfile</span><br><span class="line">docker build -t imageName ./</span><br></pre></td></tr></table></figure>

<h3 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run  base/archlinux /bin/echo &quot;hello world&quot;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œäº¤äº’å¼çš„å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -i -t base/archlinux /bin/bash</span><br></pre></td></tr></table></figure>
<pre><code>* -t:åœ¨æ–°å®¹å™¨å†…æŒ‡å®šä¸€ä¸ªä¼ªç»ˆç«¯æˆ–ç»ˆç«¯ã€‚
* -i:å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥ (STDIN) è¿›è¡Œäº¤äº’ã€‚</code></pre><p>åˆ†é…ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -P php7.0-app    <span class="comment">#è‡ªåŠ¨åˆ†é…</span></span><br><span class="line">docker run -p 5000:80       <span class="comment">#å®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 5000 ç«¯å£ä¸Š</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker container ls <span class="comment">#æˆ–è€…</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker port containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ—¥å¿—</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker logs </span><br><span class="line">docker -f containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¿›ç¨‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker top containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹Dockerçš„åº•å±‚ä¿¡æ¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker inspect containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>åœæ­¢å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker stop containerID/contaienrName</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker start containerID/contaienrName</span><br></pre></td></tr></table></figure>
<p>æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker restart</code> å‘½ä»¤æ¥é‡å¯</p>
<p>æŸ¥çœ‹æœ€åä¸€æ¬¡åˆ›å»ºçš„å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker ps -l</span><br></pre></td></tr></table></figure>
<p>ç§»é™¤å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker rm containerID/contaienrName</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>è™šæ‹ŸåŒ–</tag>
        <tag>å®¹å™¨</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ç™¾åº¦UEditorè‡ªå®šä¹‰ä¸Šä¼ åœ°å€</title>
    <url>/2017/10/26/%E7%99%BE%E5%BA%A6ueditor%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%BC%A0%E5%9C%B0%E5%9D%80/</url>
    <content><![CDATA[<p>ä¹‹å‰æœ‰ä¸ªå°æœ‹å‹é—®æˆ‘ç™¾åº¦UEditoræ€ä¹ˆè‡ªå®šä¹‰æœåŠ¡ç«¯ä¸Šä¼ åœ°å€, æ­£å¥½ä¹Ÿç”¨è¿‡ï¼Œç°åœ¨åšä¸‹ç¬”è®°å§ã€‚</p>
<p>åœ¨ueå®ä¾‹åŒ–çš„æ—¶å€™ä½ æœåŠ¡ç«¯ä¸Šä¼ çš„è¯·æ±‚åœ°å€èµ‹å€¼ç»™<code>serverUrl</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ue;</span><br><span class="line">ue = UE.getEditor(<span class="string">&#x27;editor&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">toolbars</span>: [		<span class="comment">//è¿™ä¸ªæ˜¯å·¥å…·æ é…ç½®ï¼Œè‡ªå·±å®šä¹‰å’Œä»Šå¤©ä¸»é¢˜æ— å…³</span></span><br><span class="line">        [</span><br><span class="line">            <span class="string">&#x27;fullscreen&#x27;</span>, <span class="string">&#x27;source&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;undo&#x27;</span>, <span class="string">&#x27;redo&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;bold&#x27;</span>, <span class="string">&#x27;italic&#x27;</span>, <span class="string">&#x27;underline&#x27;</span>, <span class="string">&#x27;fontborder&#x27;</span>, <span class="string">&#x27;strikethrough&#x27;</span>, <span class="string">&#x27;superscript&#x27;</span>, <span class="string">&#x27;subscript&#x27;</span>, <span class="string">&#x27;removeformat&#x27;</span>, <span class="string">&#x27;formatmatch&#x27;</span>, <span class="string">&#x27;autotypeset&#x27;</span>, <span class="string">&#x27;blockquote&#x27;</span>, <span class="string">&#x27;pasteplain&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;forecolor&#x27;</span>, <span class="string">&#x27;backcolor&#x27;</span>, <span class="string">&#x27;insertorderedlist&#x27;</span>, <span class="string">&#x27;insertunorderedlist&#x27;</span>, <span class="string">&#x27;selectall&#x27;</span>, <span class="string">&#x27;cleardoc&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;rowspacingtop&#x27;</span>, <span class="string">&#x27;rowspacingbottom&#x27;</span>, <span class="string">&#x27;lineheight&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;customstyle&#x27;</span>, <span class="string">&#x27;paragraph&#x27;</span>, <span class="string">&#x27;fontfamily&#x27;</span>, <span class="string">&#x27;fontsize&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;directionalityltr&#x27;</span>, <span class="string">&#x27;directionalityrtl&#x27;</span>, <span class="string">&#x27;indent&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;justifyleft&#x27;</span>, <span class="string">&#x27;justifycenter&#x27;</span>, <span class="string">&#x27;justifyright&#x27;</span>, <span class="string">&#x27;justifyjustify&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;touppercase&#x27;</span>, <span class="string">&#x27;tolowercase&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;link&#x27;</span>, <span class="string">&#x27;unlink&#x27;</span>, <span class="string">&#x27;anchor&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;imagenone&#x27;</span>, <span class="string">&#x27;imageleft&#x27;</span>, <span class="string">&#x27;imageright&#x27;</span>, <span class="string">&#x27;imagecenter&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;simpleupload&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;pagebreak&#x27;</span>, <span class="string">&#x27;template&#x27;</span>, <span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;horizontal&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;time&#x27;</span>, <span class="string">&#x27;spechars&#x27;</span>, <span class="string">&#x27;snapscreen&#x27;</span>, <span class="string">&#x27;wordimage&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;inserttable&#x27;</span>, <span class="string">&#x27;deletetable&#x27;</span>, <span class="string">&#x27;insertparagraphbeforetable&#x27;</span>, <span class="string">&#x27;insertrow&#x27;</span>, <span class="string">&#x27;deleterow&#x27;</span>, <span class="string">&#x27;insertcol&#x27;</span>, <span class="string">&#x27;deletecol&#x27;</span>, <span class="string">&#x27;mergecells&#x27;</span>, <span class="string">&#x27;mergeright&#x27;</span>, <span class="string">&#x27;mergedown&#x27;</span>, <span class="string">&#x27;splittocells&#x27;</span>, <span class="string">&#x27;splittorows&#x27;</span>, <span class="string">&#x27;splittocols&#x27;</span>, <span class="string">&#x27;charts&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;preview&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">serverUrl</span>: <span class="string">&#x27;http://your-server-address&#x27;</span>  <span class="comment">//è¿™é‡Œæ˜¯ä½ æœåŠ¡ç«¯ä¸Šä¼ çš„è¯·æ±‚åœ°å€</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢è‡ªå®šä¹‰äº†æœåŠ¡ç«¯åœ°å€ä¹‹åï¼Œæˆ‘ä»¬åˆ·æ–°é¡µé¢ï¼Œueå®ä¾‹åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è¯·æ±‚ä½ çš„åœ°å€å¹¶ä¸”å¸¦ç€queryå‚æ•°ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š<code>http://your-server-address?action=config</code>ã€‚è¿™æ˜¯ueå®ä¾‹åŒ–ä¼šè¯·æ±‚é…ç½®æ–‡ä»¶ï¼Œç®€å•ç‚¹ä½ å¯ä»¥ç›´æ¥è¿”å›ueæ’ä»¶æ–‡ä»¶å¤¹ä¸­<code>ueditor/1.4.3.3/php/config.json</code>çš„å†…å®¹å°±å¯ä»¥äº†ã€‚å½“ç„¶äº†å…·ä½“é…ç½®ä½ æ˜¯å¯ä»¥è‡ªå·±æŒ‰è‡ªå·±éœ€æ±‚æ”¹åŠ¨ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸Šä¼ å›¾ç‰‡ï¼Œéšä¾¿ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œä¼šå‘ç°ueçš„è¯·æ±‚åœ°å€æ˜¯<code>http://your-server-address?action=uploadimage</code>ã€‚è¿™æ ·æ˜¯ä¸æ˜¯æç„¶å¤§æ‚Ÿï¼š</p>
<blockquote>
<p>   actionå‚æ•°æ˜¯configï¼Œä½ å°±ç»™ä»–è¿”å›é…ç½®å†…å®¹;<br>   actionå‚æ•°æ˜¯uploadimageå°±æ˜¯å›¾ç‰‡ä¸Šä¼ ï¼Œä½ å°±ä¿å­˜å›¾ç‰‡æ–‡ä»¶ï¼Œè¿”å›æˆåŠŸæˆ–è€…å¤±è´¥çš„ç»“æœã€‚</p>
</blockquote>
<p>ä¸Šä¼ ç»“æœè¿”å›æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<p>å¤±è´¥çš„æƒ…å†µ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;state&quot;</span>: <span class="string">&quot;Failed&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;error msg&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸçš„æƒ…å†µ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;state&quot;</span>: <span class="string">&quot;SUCCESS&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;original&quot;</span>: <span class="string">&quot;aaa.jpg&quot;</span>,	<span class="comment">//å›¾ç‰‡æºæ–‡ä»¶å</span></span><br><span class="line">	<span class="attr">&quot;type&quot;</span>: <span class="string">&quot;.jpg&quot;</span>,		<span class="comment">//å›¾ç‰‡åç¼€</span></span><br><span class="line">	<span class="attr">&quot;size&quot;</span>: <span class="number">10240000</span>,	<span class="comment">//å›¾ç‰‡å¤§å°</span></span><br><span class="line">	<span class="attr">&quot;title&quot;</span>: <span class="string">&quot;aaa&quot;</span>,		<span class="comment">//å›¾ç‰‡imgæ ‡ç­¾ä¸Šçš„å±æ€§title</span></span><br><span class="line">	<span class="attr">&quot;url&quot;</span>: <span class="string">&quot;/upload/fsf3r.jpg&quot;</span>			<span class="comment">//å›¾ç‰‡ä¸Šä¼ ä¹‹åçš„url</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¥½äº†å°±è¿™æ ·</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>UEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨dockerç©è½¬phpå¼€å‘ç¯å¢ƒ</title>
    <url>/2017/11/16/%E4%BD%BF%E7%94%A8docker%E7%8E%A9%E8%BD%ACphp%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<p>è¿˜æ˜¯å¿™é‡Œå·é—²ç ”ç©¶äº†ä¸‹æ€ä¹ˆç”¨dockerè¿™ä¸ªä¸œä¸œæ¥æ•´phpå¼€å‘ã€‚åšç‚¹ç¬”è®°ğŸ˜</p>
<p>å…ˆçœ‹<code>Dockerfile</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä½¿ç”¨åŸºäºalpine linux çš„é•œåƒï¼Œä½“ç§¯å°ï¼Œä¸‹è½½å¿«</span><br><span class="line">FROM php:7.0-cli-alpine</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ä¸­ç§‘å¤§çš„æºåŠ å¿«ä¸‹è½½é€Ÿåº¦</span><br><span class="line">RUN sed -i &#x27;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#x27; /etc/apk/repositories</span><br><span class="line"></span><br><span class="line"># å®‰è£…ä¸‹åŸºæœ¬çš„phpæ‰©å±•</span><br><span class="line">RUN docker-php-ext-install pdo pdo_mysql mysqli</span><br></pre></td></tr></table></figure>

<h4 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker build -t heropoo/php-cli-alpine .  <span class="comment">#å…ˆåˆ‡æ¢åˆ°ä½ çš„Dockerfileç›®å½•</span></span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -it --rm --name php-cli-server -p 8080:80  -v //c/Users/ttt/www:/usr/src/www -w /usr/src/www php:7.0-cli-alpine php -S 0.0.0.0:80</span><br></pre></td></tr></table></figure>
<p>è¿™å¥å¥½é•¿å•Šï¼Œè§£é‡Šä¸‹å„ä¸ªå‚æ•°ï¼š</p>
<blockquote>
<p>-tåœ¨æ–°å®¹å™¨å†…æŒ‡å®šä¸€ä¸ªä¼ªç»ˆç«¯æˆ–ç»ˆç«¯</p>
<p>-i    å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥ (STDIN) </p>
<p>-p æ˜ å°„å®¿ä¸»æœºç«¯å£åˆ°å®¹å™¨çš„ç«¯å£ï¼Œä¸Šé¢å°±æ˜¯å®¿ä¸»æœºçš„8080åˆ°å®¹å™¨çš„80</p>
<p>-v æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨çš„ç›®å½•ï¼Œä¸Šé¢å°±æ˜¯å®¿ä¸»æœº/c/Users/ttt/wwwåˆ°å®¹å™¨/usr/src/www    </p>
<p>-w    è®¾ç½®å·¥ä½œç›®å½•</p>
<p>â€“rm å®¹å™¨è¿è¡Œå®Œä¹‹ååˆ é™¤</p>
<p>â€“name    ç»™å®¹å™¨åå­—</p>
<p>php -S 0.0.0.0:80 å°±æ˜¯ç”¨phpå†…ç½®çš„æœåŠ¡å™¨å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡äº†ï¼Œç®€å•ç‚¹æ¥ å“ˆå“ˆ </p>
</blockquote>
<p>æˆ‘ç³»ç»Ÿæ˜¯windowsï¼Œæˆ‘åœ¨æµè§ˆå™¨è®¿é—®dockerçš„webæœåŠ¡ï¼š<code>http://ip:8080</code>,ipæ˜¯ä½ çš„dockerçš„ip,å°±å¯ä»¥äº†ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆå¥½ç©ğŸ˜œ</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>è™šæ‹ŸåŒ–</tag>
        <tag>å®¹å™¨</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>2018,æ–°å¹´å¿«ä¹ï¼</title>
    <url>/2017/12/31/2018-happy-new-year/</url>
    <content><![CDATA[<p><img src="/assets/images/20180101000832.png" alt="example-pic"></p>
<p>2018å¹´äº†ï¼Œæ–°å¹´å¿«ä¹ï¼</p>
<p>åŠ æ²¹ï¼</p>
]]></content>
      <categories>
        <category>å²æœˆé™å¥½</category>
      </categories>
      <tags>
        <tag>å²æœˆé™å¥½</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•´ç†å‡ ä¸ªå¸¸ç”¨çš„å›½å†…æºï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <url>/2018/01/20/cn-mirrors/</url>
    <content><![CDATA[<p>æœ€åæ›´æ–°ï¼š2019-11-17</p>
<h3 id="Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶"><a href="#Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶" class="headerlink" title="Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶"></a>Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶</h3><p>ä¸€äº›ä¼ä¸šçš„ï¼š</p>
<ul>
<li>ç½‘æ˜“å¼€æºé•œåƒç«™ <a href="http://mirrors.163.com/">http://mirrors.163.com/</a></li>
<li>æœç‹å¼€æºé•œåƒç«™ <a href="http://mirrors.sohu.com/">http://mirrors.sohu.com/</a></li>
<li>é˜¿é‡Œäº‘æºé•œåƒç«™ <a href="http://mirrors.aliyun.com/">http://mirrors.aliyun.com/</a></li>
<li>é¦–éƒ½åœ¨çº¿ <a href="http://mirrors.yun-idc.com/">http://mirrors.yun-idc.com/</a></li>
</ul>
<p>å„å¤§é«˜æ ¡çš„ï¼š</p>
<ul>
<li>ä¸­ç§‘å¤§å¼€æºé•œåƒç«™ <a href="http://mirrors.ustc.edu.cn/">http://mirrors.ustc.edu.cn/</a></li>
<li>æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ <a href="https://mirrors.tuna.tsinghua.edu.cn/">https://mirrors.tuna.tsinghua.edu.cn/</a></li>
<li>åä¸­ç§‘æŠ€å¤§å­¦å¼€æºé•œåƒç«™ <a href="http://mirror.hust.edu.cn/">http://mirror.hust.edu.cn/</a></li>
<li>æµ™æ±Ÿå¤§å­¦å¼€æºé•œåƒç«™ <a href="http://mirrors.zju.edu.cn/">http://mirrors.zju.edu.cn/</a></li>
<li>ä¸œè½¯ä¿¡æ¯å­¦é™¢å¼€æºé•œåƒç«™ <a href="http://mirrors.neusoft.edu.cn/">http://mirrors.neusoft.edu.cn/</a></li>
<li>åŒ—äº¬ç†å·¥å¤§å­¦å¼€æºè½¯ä»¶é•œåƒ <a href="http://mirror.bit.edu.cn/">http://mirror.bit.edu.cn/</a></li>
<li>åŒ—äº¬äº¤é€šå¤§å­¦è‡ªç”±ä¸å¼€æºè½¯ä»¶é•œåƒç«™ <a href="https://mirror.bjtu.edu.cn/">https://mirror.bjtu.edu.cn/</a></li>
<li>å…°å·å¤§å­¦å¼€æºç¤¾åŒºé•œåƒç«™ <a href="http://mirror.lzu.edu.cn/">http://mirror.lzu.edu.cn/</a></li>
<li>ä¸Šæµ·äº¤é€šå¤§å­¦ <a href="http://ftp.sjtu.edu.cn/">http://ftp.sjtu.edu.cn/</a></li>
<li>ä¸œåŒ—å¤§å­¦ <a href="http://mirror.neu.edu.cn/">http://mirror.neu.edu.cn/</a></li>
</ul>
<h3 id="js-npm"><a href="#js-npm" class="headerlink" title="js npm"></a>js npm</h3><ul>
<li>æ·˜å®NPMé•œåƒ <a href="http://npm.taobao.org/">http://npm.taobao.org/</a></li>
</ul>
<h3 id="php-composer"><a href="#php-composer" class="headerlink" title="php composer"></a>php composer</h3><ul>
<li>é˜¿é‡Œäº‘ï¼š<a href="https://developer.aliyun.com/composer">https://developer.aliyun.com/composer</a></li>
<li>LaravelChinaç¤¾åŒºæä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://packagist.laravel-china.org">https://packagist.laravel-china.org</a></li>
<li>å®‰ç•…ç½‘ç»œï¼š<a href="https://php.cnpkg.org/">https://php.cnpkg.org/</a></li>
<li>Composerä¸­æ–‡ç½‘ï¼š <a href="https://pkg.phpcomposer.com/">https://pkg.phpcomposer.com/</a></li>
</ul>
<h3 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h3><ul>
<li>ä¸­ç§‘å¤§ <a href="http://mirrors.ustc.edu.cn/help/rust-static.html">Rust Toolchainåå‘ä»£ç†</a></li>
<li>ä¸­ç§‘å¤§ <a href="http://mirrors.ustc.edu.cn/help/crates.io-index.html">Rust Crates æº</a></li>
</ul>
<h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><ul>
<li>é˜¿é‡Œäº‘Go Moduleä»£ç†ä»“åº“æœåŠ¡ <a href="https://mirrors.aliyun.com/goproxy/">https://mirrors.aliyun.com/goproxy/</a></li>
</ul>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul>
<li>DaoCloud <a href="https://www.daocloud.io/mirror">https://www.daocloud.io/mirror</a></li>
<li>é˜¿é‡Œäº‘ è¦æ³¨å†Œç‹¬ç«‹åˆ†é… <a href="https://yq.aliyun.com/articles/29941">https://yq.aliyun.com/articles/29941</a></li>
</ul>
<p>å¤§æ¦‚å°±æ•´ç†è¿™ä¹ˆå¤šäº†ï¼Œè‡³äºå„ä¸ªé•œåƒçš„æ›´æ¢æ–¹æ³•å¤§å®¶æ ¹æ®è‡ªå·±çš„åº”ç”¨è‡ªè¡Œç™¾åº¦å§~</p>
]]></content>
      <categories>
        <category>èµ„æº</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>JavaScript</tag>
        <tag>Linux</tag>
        <tag>Docker</tag>
        <tag>Rust</tag>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚æœç¼–ç¨‹è¯­è¨€æ˜¯ä¸€ç§æ­¦å™¨(è½¬è‡ªäº’è”ç½‘)</title>
    <url>/2018/01/23/If-the-programming-language-is-a-weapon/</url>
    <content><![CDATA[<p>å¯¹ç¨‹åºå‘˜æ¥è¯´ï¼Œç¼–ç¨‹è¯­è¨€å°±æ˜¯æ­¦å™¨ï¼Œä½†æœ‰çš„æ­¦å™¨å¥½ç”¨ï¼Œæœ‰çš„æ­¦å™¨ä¸å¥½ç”¨ï¼Œæœ‰çš„æ­¦å™¨ç”šè‡³ä¼šæ€äº†è‡ªå·±</p>
<p><img src="/assets/images/uuaMZv.png" alt="pic"></p>
<p>Cè¯­è¨€æ˜¯M1å¼åŠ å…°å¾·æ­¥æªï¼Œå¾ˆè€ä½†å¯é ã€‚</p>
<p><img src="/assets/images/mE3eaiv.png" alt="pic"></p>
<p>C++æ˜¯åŒæˆªæ£ï¼ŒæŒ¥èˆèµ·æ¥å¾ˆå¼ºæ‚ï¼Œå¾ˆå¸å¼•äººï¼Œä½†éœ€è¦ä½ å¤šå¹´çš„ç£¨ç»ƒæ¥æŒæ¡ï¼Œå¾ˆå¤šäººå¸Œæœ›æ”¹ç”¨åˆ«çš„æ­¦å™¨ã€‚</p>
<p><img src="/assets/images/yuMVfu.png" alt="pic"></p>
<p>Perlè¯­è¨€æ˜¯ç‡ƒçƒ§å¼¹ï¼Œæ›¾ç»åœ¨æˆ˜åœºä¸Šå¾ˆæœ‰ç”¨ï¼Œä½†ç°åœ¨å¾ˆå°‘äººä½¿ç”¨å®ƒã€‚</p>
<p><img src="/assets/images/UvUNJz.png" alt="pic"></p>
<p>Javaæ˜¯M240é€šç”¨å¼¹å¤¹å¼è‡ªåŠ¨æœºæªï¼Œæœ‰æ—¶å®ƒçš„å¼¹å¤¹æ˜¯åœ†çš„ï¼Œä½†æœ‰æ—¶å€™ä¸æ˜¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œå½“ä½ å¼€ç«æ—¶ï¼Œä¼šé‡åˆ°NullPointerExceptioné—®é¢˜ï¼Œæªå°±ä¼šçˆ†ç‚¸ï¼Œä½ è¢«ç‚¸æ­»ã€‚</p>
<p><img src="/assets/images/veQb227.png" alt="pic"></p>
<p>Scalaæ˜¯M240é€šç”¨æœºæªçš„å˜ç§ï¼Œä½†å®ƒçš„ä½¿ç”¨æ‰‹å†Œæ˜¯ç”¨ä¸€ç§çœ‹ä¸æ‡‚çš„æ–¹è¨€å†™çš„ï¼Œå¾ˆå¤šäººæ€€ç–‘é‚£åªæ˜¯ä¸€äº›æ¢¦è¯ã€‚</p>
<p><img src="/assets/images/3yYZVj2.png" alt="pic"></p>
<p>JavaScriptæ˜¯ä¸€æŠŠå®å‰‘ï¼Œä½†æ²¡æœ‰å‰‘æŸ„ã€‚</p>
<p><img src="/assets/images/3qIb6rU.png" alt="pic"></p>
<p>Goè¯­è¨€æ˜¯ä¸€ç§è‡ªåˆ¶çš„â€if err != nilâ€å‘ä»¤æªï¼Œæ¯ä¸€æ¬¡å‘å°„åï¼Œä½ éƒ½å¿…é¡»è¦æ£€æŸ¥å®ƒæ˜¯å¦çœŸçš„å‘å°„äº†ã€‚</p>
<p><img src="/assets/images/AFZBvy2.png" alt="pic"></p>
<p>Rustè¯­è¨€æ˜¯ä¸€ç§3Dæ‰“å°å‡ºçš„æªã€‚å°†æ¥ä¹Ÿè®¸çœŸçš„èƒ½æ´¾ä¸Šç”¨åœºã€‚</p>
<p><img src="/assets/images/2URZfy.png" alt="pic"></p>
<p>bashæ˜¯ä¸€ä¸ªååˆ†ç¢æ‰‹çš„é”¤å­ï¼Œä½ æŠ¡èµ·å®ƒæ—¶ä¼šå‘ç°æ‰€æœ‰ä¸œè¥¿çœ‹èµ·æ¥éƒ½åƒé’‰å­ï¼Œå°¤å…¶æ˜¯ä½ çš„æŒ‡å¤´ã€‚</p>
<p><img src="/assets/images/v2U3qef.png" alt="pic"></p>
<p>Pythonæ˜¯ä¸€ç§â€v2/v3â€åŒç®¡æªï¼Œæ¯æ¬¡åªèƒ½ç”¨ä¸€ä¸ªç®¡å­å‘å°„ï¼Œä½ æ°¸è¿œä¸çŸ¥é“è¯¥ç”¨å“ªä¸ªç®¡å­å‘å°„å¥½ã€‚</p>
<p><img src="/assets/images/7VZvMn.png" alt="pic"></p>
<p>Rubyæ˜¯ä¸€æŠŠå¤–åµŒçº¢å®çŸ³çš„å®åˆ€ï¼Œäººä»¬ä½¿ç”¨å®ƒé€šå¸¸æ˜¯å› ä¸ºçœ‹èµ·æ¥å¾ˆç‚«ã€‚</p>
<p><img src="/assets/images/iUFzqi.png" alt="pic"></p>
<p>PHPæ˜¯æ°´ç®¡å­ï¼Œä½ é€šå¸¸ä¼šæŠŠå®ƒçš„ä¸€æ®µæ¥åˆ°æ±½è½¦çš„æ’æ°”ç®¡ï¼Œå¦ä¸€ç«¯æ’è¿›è½¦çª—é‡Œï¼Œç„¶åä½ åè¿›è½¦é‡Œï¼Œå¼€åŠ¨å¼•æ“ã€‚</p>
<p><img src="/assets/images/eAj6Nra.png" alt="pic"></p>
<p>Mathematicaæ˜¯ä¸€ç§åœ°çƒä½è½¨é“ç²’å­å¤§ç‚®ï¼Œå®ƒä¹Ÿè®¸èƒ½å¤Ÿå¹²å‡ºå¾ˆç¥å¥‡çš„äº‹æƒ…ï¼Œä½†åªæœ‰ä»˜å¾—èµ·è´¹ç”¨çš„äººæ‰èƒ½ä½¿ç”¨å®ƒã€‚</p>
<p><img src="/assets/images/7v6jei.png" alt="pic"></p>
<p>C#æ˜¯ä¸€ç§å¼ºæ‚çš„æ¿€å…‰å¤§ç‚®ï¼Œæ¶å­ä¸€å¤´é©´å­ä¸Šï¼Œå¦‚æœä»é©´å­ä¸Šå¸ä¸‹æ¥ï¼Œå®ƒå¥½åƒå°±å‘ä¸å‡ºæ¿€å…‰ã€‚</p>
<p><img src="/assets/images/jUR7be.png" alt="pic"></p>
<p>Prologè¯­è¨€æ˜¯ä¸€ç§äººå·¥æ™ºèƒ½æ­¦å™¨ï¼Œä½ å‘Šè¯‰å®ƒè¦åšä»€ä¹ˆï¼Œå®ƒä¼šç…§åšä¸è¯¯ï¼Œä½†ä¹‹åï¼Œå®ƒä¼šå¼„å‡ ä¸ªç»ˆç»“è€…å‡ºæ¥ï¼Œçƒ§æ‰ä½ çš„æˆ¿å­ã€‚</p>
<p><img src="/assets/images/bM3aaab.png" alt="pic"></p>
<p>Lispè¯­è¨€æ˜¯ä¸€æŠŠå‰ƒé¡»åˆ€ï¼Œæœ‰å¾ˆå¤šæ¬¾å¼ã€‚åªæœ‰å¯»æ±‚åˆºæ¿€å’Œå±é™©çš„äººæ‰ä¼šä½¿ç”¨å®ƒã€‚</p>
]]></content>
      <categories>
        <category>äº’è”ç½‘</category>
      </categories>
      <tags>
        <tag>äº’è”ç½‘</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustæ›´æ¢å›½å†…æº</title>
    <url>/2018/01/24/change-rust-mirrors/</url>
    <content><![CDATA[<p>ä»Šå¤©å­¦cargoè¿™èŠ‚ï¼Œ<code>cargo build</code>æ—¶å®‰è£…å¤–éƒ¨ä¾èµ–çœŸçš„æ…¢å•Šã€‚æœæ–­æ‰¾å›½å†…æº,æœæ–­åˆæ˜¯ustc(ä¸­ç§‘å¤§, emmmä»¥å‰åº”è¯¥åŠªåŠ›ä¸€ç‚¹è€ƒä¸­ç§‘å¤§<del>(ï¿£â–½ï¿£)</del>*)</p>
<p>æ•™ç¨‹å¼€å§‹ï¼š</p>
<p>è®¾ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static</span><br><span class="line"><span class="built_in">export</span> RUSTUP_UPDATE_ROOT=https://mirrors.ustc.edu.cn/rust-static/rustup</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç›´æ¥å†™å…¥<code>~/.bashrc</code></p>
<p>ä½¿ç”¨ustcuçš„æºä¸‹è½½å®‰è£…rust</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -sSf https://mirrors.ustc.edu.cn/rust-static/rustup.sh | sh</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘<code>~/.cargo/config</code>å†™å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[registry]</span><br><span class="line">index = &quot;https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span><br><span class="line">[source.crates-io]</span><br><span class="line">registry = &quot;https://github.com/rust-lang/crates.io-index&quot;</span><br><span class="line">replace-with = &#x27;ustc&#x27;</span><br><span class="line">[source.ustc]</span><br><span class="line">registry = &quot;https://mirrors.ustc.edu.cn/crates.io-index/&quot;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨cargoå®‰è£…å¤–éƒ¨ä¾èµ–æ˜¯ä¸æ˜¯è´¼æºœ~ğŸ˜‰</p>
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitçš„ä¸€äº›åŸºæœ¬æ“ä½œã€æŒç»­æ›´æ–°ã€‘</title>
    <url>/2018/03/31/git/</url>
    <content><![CDATA[<p>ç»å¸¸ç”¨gitï¼Œä½†å¥½å¤šå‘½ä»¤æ€»æ˜¯è®°ä¸ä½ï¼Œæ¯æ¬¡éƒ½ç™¾åº¦ã€‚ç°åœ¨æ•´ç†ä¸‹åšä¸ªç¬”è®°å§ã€‚</p>
<h2 id="Branch-åˆ†æ”¯æ“ä½œ"><a href="#Branch-åˆ†æ”¯æ“ä½œ" class="headerlink" title="Branch åˆ†æ”¯æ“ä½œ"></a>Branch åˆ†æ”¯æ“ä½œ</h2><h3 id="æŸ¥çœ‹åˆ†æ”¯"><a href="#æŸ¥çœ‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯"></a>æŸ¥çœ‹åˆ†æ”¯</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git branch  <span class="comment">#åªæ˜¾ç¤ºæœ¬åœ°åˆ†æ”¯</span></span><br><span class="line">git branch -a <span class="comment">#æ˜¾ç¤ºæœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºåˆ†æ”¯"><a href="#åˆ›å»ºåˆ†æ”¯" class="headerlink" title="åˆ›å»ºåˆ†æ”¯"></a>åˆ›å»ºåˆ†æ”¯</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git checkout -b branch_name</span><br><span class="line"><span class="comment">#å¦‚æœæœ‰ä¸€ä¸ªè¿œç¨‹åˆ†æ”¯remotes/origin/branch_name,é‚£ä¹ˆæ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°†ä¼šåˆ›å»ºæ–°çš„åä¸º`branch_name`æœ¬åœ°åˆ†æ”¯å¹¶ä¸”è·Ÿè¸ªåŒåçš„è¿œç¨‹åˆ†æ”¯remotes/origin/branch_name</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¨é€è¿œç¨‹åˆ†æ”¯"><a href="#æ¨é€è¿œç¨‹åˆ†æ”¯" class="headerlink" title="æ¨é€è¿œç¨‹åˆ†æ”¯"></a>æ¨é€è¿œç¨‹åˆ†æ”¯</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push origin branch_name</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤åˆ†æ”¯"><a href="#åˆ é™¤åˆ†æ”¯" class="headerlink" title="åˆ é™¤åˆ†æ”¯"></a>åˆ é™¤åˆ†æ”¯</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git branch -d branch_name</span><br><span class="line"><span class="comment"># åˆ é™¤æœ¬åœ°åˆ†æ”¯åå¹¶åˆ é™¤è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">git push --delete origin branch_name</span><br></pre></td></tr></table></figure>

<h2 id="Tag-æ ‡ç­¾æ“ä½œ"><a href="#Tag-æ ‡ç­¾æ“ä½œ" class="headerlink" title="Tag æ ‡ç­¾æ“ä½œ"></a>Tag æ ‡ç­¾æ“ä½œ</h2><h3 id="æŸ¥çœ‹tagåˆ—è¡¨"><a href="#æŸ¥çœ‹tagåˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹tagåˆ—è¡¨"></a>æŸ¥çœ‹tagåˆ—è¡¨</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å¢tag"><a href="#æ–°å¢tag" class="headerlink" title="æ–°å¢tag"></a>æ–°å¢tag</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git tag tag_name <span class="comment"># æ¯”å¦‚v1.0</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¨é€æœ¬åœ°æŒ‡å®štagåˆ°è¿œç¨‹"><a href="#æ¨é€æœ¬åœ°æŒ‡å®štagåˆ°è¿œç¨‹" class="headerlink" title="æ¨é€æœ¬åœ°æŒ‡å®štagåˆ°è¿œç¨‹"></a>æ¨é€æœ¬åœ°æŒ‡å®štagåˆ°è¿œç¨‹</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push origin tag_name </span><br></pre></td></tr></table></figure>

<h3 id="æ¨é€å…¨éƒ¨æœ¬åœ°tagåˆ°è¿œç¨‹"><a href="#æ¨é€å…¨éƒ¨æœ¬åœ°tagåˆ°è¿œç¨‹" class="headerlink" title="æ¨é€å…¨éƒ¨æœ¬åœ°tagåˆ°è¿œç¨‹"></a>æ¨é€å…¨éƒ¨æœ¬åœ°tagåˆ°è¿œç¨‹</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push --tags </span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤tag"><a href="#åˆ é™¤tag" class="headerlink" title="åˆ é™¤tag"></a>åˆ é™¤tag</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git tag -d </span><br><span class="line"><span class="comment"># åˆ é™¤tagåå¹¶åˆ é™¤è¿œç¨‹tag</span></span><br><span class="line">git push --delete origin tag_name</span><br></pre></td></tr></table></figure>

<h2 id="submoduleå­æ¨¡å—æ“ä½œ"><a href="#submoduleå­æ¨¡å—æ“ä½œ" class="headerlink" title="submoduleå­æ¨¡å—æ“ä½œ"></a>submoduleå­æ¨¡å—æ“ä½œ</h2><h3 id="å­æ¨¡å—çš„æ·»åŠ "><a href="#å­æ¨¡å—çš„æ·»åŠ " class="headerlink" title="å­æ¨¡å—çš„æ·»åŠ "></a>å­æ¨¡å—çš„æ·»åŠ </h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git submodule add &lt;url&gt; &lt;path&gt;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>url</code>ä¸ºå­æ¨¡å—çš„è·¯å¾„ï¼Œ<code>path</code>ä¸ºè¯¥å­æ¨¡å—å­˜å‚¨çš„ç›®å½•è·¯å¾„ã€‚</p>
<p>æ‰§è¡ŒæˆåŠŸåï¼Œ<code>git status</code>ä¼šçœ‹åˆ°é¡¹ç›®ä¸­ä¿®æ”¹äº†<code>.gitmodules</code>ï¼Œå¹¶å¢åŠ äº†ä¸€ä¸ªæ–°æ–‡ä»¶ï¼ˆä¸ºåˆšåˆšæ·»åŠ çš„è·¯å¾„ï¼‰</p>
<p><code>git diff --cached</code>æŸ¥çœ‹ä¿®æ”¹å†…å®¹å¯ä»¥çœ‹åˆ°å¢åŠ äº†å­æ¨¡å—ï¼Œå¹¶ä¸”æ–°æ–‡ä»¶ä¸‹ä¸ºå­æ¨¡å—çš„æäº¤hashæ‘˜è¦</p>
<p><code>git commit</code>æäº¤å³å®Œæˆå­æ¨¡å—çš„æ·»åŠ </p>
<h3 id="å­æ¨¡å—çš„clone"><a href="#å­æ¨¡å—çš„clone" class="headerlink" title="å­æ¨¡å—çš„clone"></a>å­æ¨¡å—çš„clone</h3><p>å…‹éš†é¡¹ç›®åï¼Œé»˜è®¤å­æ¨¡å—ç›®å½•ä¸‹æ— ä»»ä½•å†…å®¹ï¼Œéœ€è¦åœ¨é¡¹ç›®ç›®å½•ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤cloneå­æ¨¡å—</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">git submodule update --init --recursive</span><br></pre></td></tr></table></figure>

<h3 id="å­æ¨¡å—çš„æ›´æ–°"><a href="#å­æ¨¡å—çš„æ›´æ–°" class="headerlink" title="å­æ¨¡å—çš„æ›´æ–°"></a>å­æ¨¡å—çš„æ›´æ–°</h3><p>å¦‚æœé¡¹ç›®ä¸­æäº¤äº†å­æ¨¡å—çš„æœ€æ–°æ›´æ–°ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git submodule update</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé¡¹ç›®ä¸­æœªæäº¤å­æ¨¡å—çš„æœ€æ–°æ›´æ–°ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git submodule update --remote</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤å­æ¨¡å—"><a href="#åˆ é™¤å­æ¨¡å—" class="headerlink" title="åˆ é™¤å­æ¨¡å—"></a>åˆ é™¤å­æ¨¡å—</h3><ol>
<li><code>rm -rf å­æ¨¡å—ç›®å½•</code> åˆ é™¤å­æ¨¡å—ç›®å½•åŠæºç </li>
<li><code>vi .gitmodules</code> åˆ é™¤é¡¹ç›®ç›®å½•ä¸‹<code>.gitmodules</code>æ–‡ä»¶ä¸­å­æ¨¡å—ç›¸å…³æ¡ç›®</li>
<li><code>vi .git/config</code> åˆ é™¤é…ç½®é¡¹ä¸­å­æ¨¡å—ç›¸å…³ä¿¡æ¯</li>
<li><code>rm .git/module/å­æ¨¡å—ç›®å½•</code> åˆ é™¤æ¨¡å—ä¸‹çš„å­æ¨¡å—ç›®å½•ï¼Œæ¯ä¸ªå­æ¨¡å—å¯¹åº”ä¸€ä¸ªç›®å½•</li>
</ol>
<p>æ‰§è¡Œå®Œæˆåï¼Œå†æ‰§è¡Œæ·»åŠ å­æ¨¡å—å‘½ä»¤å³å¯ï¼Œå¦‚æœä»ç„¶æŠ¥é”™ï¼Œæ‰§è¡Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git rm --cached å­æ¨¡å—åç§°</span><br></pre></td></tr></table></figure>
<p>å®Œæˆåˆ é™¤åï¼Œæäº¤åˆ°ä»“åº“å³å¯ã€‚</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥"><a href="#githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥" class="headerlink" title="githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥"></a>githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥</h3><p>å‡å¦‚ä¸€ä¸ªé¡¹ç›®<code>Evil-S0ul/write-doc</code>åœ°å€: <a href="https://github.com/Evil-S0ul/write-doc">https://github.com/Evil-S0ul/write-doc</a></p>
<p>æˆ‘forkä¹‹åçš„é¡¹ç›®æ˜¯<code>heropoo/write-doc</code>åœ°å€: <a href="https://github.com/heropoo/write-doc">https://github.com/heropoo/write-doc</a></p>
<p>æ¥ä¸‹æ¥å¼€å§‹æ“ä½œï¼š</p>
<ol>
<li>åˆ‡æ¢åˆ°æˆ‘forkçš„é¡¹ç›®ç›®å½•é‡Œï¼Œç„¶åå¢åŠ æºä»“åº“åœ°å€åˆ°ä½ é¡¹ç›®çš„è¿œç¨‹åˆ†æ”¯ä¸­<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> write-doc</span><br><span class="line">git remote add Evil-S0ul https://github.com/Evil-S0ul/write-doc</span><br></pre></td></tr></table></figure></li>
<li>fetchåˆšæ·»åŠ çš„æºåˆ†æ”¯åˆ°æœ¬åœ°<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git fetch Evil-S0ul</span><br></pre></td></tr></table></figure></li>
<li>åˆå¹¶ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç <figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git merge Evil-S0ul/master</span><br></pre></td></tr></table></figure></li>
<li>æœ€åæŠŠåˆå¹¶åçš„ä»£ç pushåˆ°ä½ çš„Githubé¡¹ç›®ä¸Šå»å°±okå•¦<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag"><a href="#æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag" class="headerlink" title="æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag"></a>æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git fetch</span><br><span class="line">git checkout branch_name</span><br><span class="line"><span class="comment">#æˆ–è€…</span></span><br><span class="line">git checkout tag_name</span><br></pre></td></tr></table></figure>

<h3 id="åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯"><a href="#åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯" class="headerlink" title="åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯"></a>åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git pull origin other_branch_name</span><br></pre></td></tr></table></figure>

<h3 id="Gitæ— æ³•pullä»“åº“refusing-to-merge-unrelated-histories"><a href="#Gitæ— æ³•pullä»“åº“refusing-to-merge-unrelated-histories" class="headerlink" title="Gitæ— æ³•pullä»“åº“refusing to merge unrelated histories"></a>Gitæ— æ³•pullä»“åº“refusing to merge unrelated histories</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬çš„æœ¬åœ°ä»“åº“æ·»åŠ äº†ä¸€ä¸ªè¿œç¨‹ä»“åº“åœ°å€ï¼Œpullä»£ç æ—¶ä¼šæŠ¥<code>refusing to merge unrelated histories</code>çš„é”™ã€‚è§£å†³æ–¹æ³•æ˜¯åŠ ä¸€ä¸ªå‚æ•°<code>--allow-unrelated-histories</code>ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬çš„åˆ†æ”¯æ˜¯master</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git pull origin master --allow-unrelated-histories</span><br></pre></td></tr></table></figure>

<p>æœ€åæ›´æ–°ï¼š 2020-05-22 17:05:50</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨PHPå†™Gitçš„è‡ªåŠ¨éƒ¨ç½²webhookè„šæœ¬</title>
    <url>/2018/05/01/git-webhook/</url>
    <content><![CDATA[<p>ç°åœ¨å¼€å‘é¡¹ç›®å¤§å¤šä½¿ç”¨gitä½œä¸ºç‰ˆæœ¬æ§åˆ¶å™¨ï¼Œè€Œä¸”ç°åœ¨å¤§å¤šæ•°çš„ä»£ç æ‰˜ç®¡å¹³å°éƒ½æ”¯æŒè‡ªå®šä¹‰webhookè„šæœ¬ã€‚æ­£å¥½åˆ©ç”¨è¿™ä¸ªè„šæœ¬ï¼Œç»“åˆgitçš„workflowï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„åšåˆ°é¡¹ç›®ä»£ç çš„è‡ªåŠ¨å‘å¸ƒéƒ¨ç½²ã€‚</p>
<h3 id="æœ€ç®€å•çš„æµç¨‹"><a href="#æœ€ç®€å•çš„æµç¨‹" class="headerlink" title="æœ€ç®€å•çš„æµç¨‹"></a>æœ€ç®€å•çš„æµç¨‹</h3><p>æ¯”å¦‚ä½ çš„é¡¹ç›®æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªæ˜¯ä»£ç å·²ç»ç»è¿‡æµ‹è¯•å¯ç”¨äºéƒ¨ç½²åˆ°æœåŠ¡å™¨çš„masteråˆ†æ”¯ï¼Œä¸€ä¸ªç”¨äºå¼€å‘çš„devåˆ†æ”¯ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸Šçº¿çš„è¿‡ç¨‹å°±æ˜¯merge devçš„ä»£ç åˆ°masteråˆ†æ”¯ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªä»£ç pushè§¦å‘çš„webhookã€‚è¿™ä¸ªwebhookè„šæœ¬çš„ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯<code>git pull origin master</code>ã€‚</p>
<h3 id="æœ€ç®€å•çš„å®ç°"><a href="#æœ€ç®€å•çš„å®ç°" class="headerlink" title="æœ€ç®€å•çš„å®ç°"></a>æœ€ç®€å•çš„å®ç°</h3><ul>
<li>ç¼–å†™<code>webhook.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// todo åœ¨æ­¤å¯ä»¥å†™æ ¡éªŒæƒé™å¯†ç ä¹‹ç±»çš„ä»£ç </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span> = dirname(<span class="keyword">__DIR__</span>);</span><br><span class="line"><span class="variable">$log_file</span> = <span class="variable">$path</span>.<span class="string">&#x27;/runtime/logs/webhook-pull-error-output.log&#x27;</span>;	<span class="comment">//é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$descriptorspec</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="number">0</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;r&quot;</span>),  <span class="comment">// æ ‡å‡†è¾“å…¥ï¼Œå­è¿›ç¨‹ä»æ­¤ç®¡é“ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>, <span class="string">&quot;w&quot;</span>),  <span class="comment">// æ ‡å‡†è¾“å‡ºï¼Œå­è¿›ç¨‹å‘æ­¤ç®¡é“ä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">    <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;file&quot;</span>, <span class="variable">$log_file</span>, <span class="string">&quot;a&quot;</span>) <span class="comment">// æ ‡å‡†é”™è¯¯ï¼Œå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cwd</span> = <span class="variable">$path</span>;</span><br><span class="line"><span class="variable">$env</span> = <span class="keyword">array</span>(<span class="string">&#x27;PATH&#x27;</span> =&gt; <span class="variable">$_SERVER</span>[<span class="string">&#x27;PATH&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$process</span> = proc_open(<span class="string">&#x27;sudo git pull origin master&#x27;</span>, <span class="variable">$descriptorspec</span>, <span class="variable">$pipes</span>, <span class="variable">$cwd</span>, <span class="variable">$env</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (is_resource(<span class="variable">$process</span>)) &#123;</span><br><span class="line">    <span class="comment">// $pipes ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</span></span><br><span class="line">    <span class="comment">// 0 =&gt; å¯ä»¥å‘å­è¿›ç¨‹æ ‡å‡†è¾“å…¥å†™å…¥çš„å¥æŸ„</span></span><br><span class="line">    <span class="comment">// 1 =&gt; å¯ä»¥ä»å­è¿›ç¨‹æ ‡å‡†è¾“å‡ºè¯»å–çš„å¥æŸ„</span></span><br><span class="line">    <span class="comment">// é”™è¯¯è¾“å‡ºå°†è¢«è¿½åŠ åˆ°æ–‡ä»¶ /tmp/error-output.txt</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> stream_get_contents(<span class="variable">$pipes</span>[<span class="number">1</span>]);</span><br><span class="line">    fclose(<span class="variable">$pipes</span>[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡è®°ï¼šåœ¨è°ƒç”¨ proc_close ä¹‹å‰å…³é—­æ‰€æœ‰çš„ç®¡é“ä»¥é¿å…æ­»é”ã€‚</span></span><br><span class="line">    <span class="variable">$return_value</span> = proc_close(<span class="variable">$process</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL.<span class="string">&quot;command returned <span class="subst">$return_value</span>\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ·»åŠ phpè„šæœ¬çš„æ‰§è¡Œç”¨æˆ·sudoersä¸­</li>
</ul>
<p>æ¯”å¦‚ä½ ä½¿ç”¨nginx+php-fpmçš„æœåŠ¡å™¨æ¶æ„ï¼Œä½ çš„php-fpmçš„ç”¨æˆ·æ˜¯www-data</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">visudo</span><br><span class="line">--------------------------------</span><br><span class="line">...</span><br><span class="line"><span class="comment">#Defaults   !visiblepw   #æ³¨é‡Šæ‰è¿™å¥ è¿™å¥æ˜¯é™åˆ¶sudoåªèƒ½åœ¨å‘½ä»¤è¡Œæ‰§è¡Œçš„</span></span><br><span class="line">www-data ALL=(ALL:ALL) NOPASSWD: /usr/bin/git</span><br></pre></td></tr></table></figure>

<ul>
<li>pushä»£ç åˆ°masteråˆ†æ”¯æµ‹è¯•ä¸‹å§~ ç™»é™†æœåŠ¡å™¨çœ‹çœ‹ä»£ç æ˜¯ä¸æ˜¯å·²ç»åŒæ­¥å¥½äº†ã€€</li>
</ul>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Git</tag>
        <tag>Webhook</tag>
      </tags>
  </entry>
  <entry>
    <title>Composerå®˜æ–¹é•œåƒå¤ªæ…¢æˆ–è€…è¢«å¢™æ— æ³•ä½¿ç”¨æ—¶çš„å‡ ç§è§£å†³æ–¹æ¡ˆ</title>
    <url>/2018/08/02/composer-mirrors/</url>
    <content><![CDATA[<p>Composerå®˜æ–¹é•œåƒå¤ªæ…¢æˆ–è€…è¢«å¢™æ— æ³•ä½¿ç”¨æ—¶çš„å‡ ç§è§£å†³æ–¹æ¡ˆ</p>
<h3 id="ä½¿ç”¨ä»£ç†"><a href="#ä½¿ç”¨ä»£ç†" class="headerlink" title="ä½¿ç”¨ä»£ç†"></a>ä½¿ç”¨ä»£ç†</h3><p>è¢«å¢™ä½¿ç”¨å›½å¤–ä»£ç†ä¸Šç½‘ï¼Œæ€»æ˜¯ä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•ã€‚å‡å¦‚ä½ ä½¿ç”¨shadowsocksä»£ç†ï¼Œå¼€å¯ä¹‹åé»˜è®¤çš„æœ¬åœ°ç«¯å£æ˜¯1080ã€‚åªè¦è®¾ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡<code>http_proxy</code>å’Œ<code>https_proxy</code>å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<p>Mac OS / Linux ç»ˆç«¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=127.0.0.1:1080</span><br><span class="line"><span class="built_in">export</span> https_proxy=127.0.0.1:1080</span><br></pre></td></tr></table></figure>
<p>windows cmdå‘½ä»¤è¡Œ</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> http_proxy=<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">1080</span></span><br><span class="line"><span class="built_in">set</span> https_proxy=<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">1080</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œæ„‰å¿«çš„ä¸‹è½½å„ç§åŒ…å§~</p>
<h3 id="ä½¿ç”¨å›½å†…é•œåƒåœ°å€"><a href="#ä½¿ç”¨å›½å†…é•œåƒåœ°å€" class="headerlink" title="ä½¿ç”¨å›½å†…é•œåƒåœ°å€"></a>ä½¿ç”¨å›½å†…é•œåƒåœ°å€</h3><blockquote>
<ul>
<li>é˜¿é‡Œäº‘æä¾›çš„é•œåƒåœ°å€(æ¨è)ï¼š<a href="https://developer.aliyun.com/composer">https://developer.aliyun.com/composer</a></li>
<li>cnpkgæä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://php.cnpkg.org">https://php.cnpkg.org</a></li>
<li>LaravelChinaç¤¾åŒºæä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://packagist.laravel-china.org">https://packagist.laravel-china.org</a></li>
<li>Composerä¸­æ–‡ç½‘æä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://packagist.phpcomposer.com">https://packagist.phpcomposer.com</a></li>
</ul>
</blockquote>
<p>é•œåƒä½¿ç”¨æ–¹æ³•:</p>
<p>å…¨å±€é…ç½®ï¼ˆæ¨èï¼‰:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</span><br></pre></td></tr></table></figure>

<p>å–æ¶ˆé•œåƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer config -g --unset repos.packagist</span><br></pre></td></tr></table></figure>

<p>åœ¨å•ç‹¬é¡¹ç›®ä¸­ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer config repo.packagist composer https://mirrors.aliyun.com/composer/</span><br></pre></td></tr></table></figure>

<p>åœ¨å•ç‹¬é¡¹ç›®ä¸­å–æ¶ˆé…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer config --unset repos.packagist</span><br></pre></td></tr></table></figure>

<p>â€”- æœ€åæ›´æ–°æ—¶é—´ï¼š 2020-03-25 10:02</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Bingæœç´¢å¼•æ“åšç«™å†…æœç´¢</title>
    <url>/2018/09/15/bing-site-search/</url>
    <content><![CDATA[<p>å› ä¸ºè‡ªå·±çš„åšå®¢ç™¾åº¦æœªæ”¶å½•â•®(â•¯-â•°)â•­ï¼Œæœ¬æ¥ä¹‹å‰ç”¨çš„è°·æ­Œï¼Œä½†æ˜¯è°·æ­Œæ¯•ç«Ÿç¿»å¢™æ‰èƒ½ç”¨ã€‚å†³å®šè¿˜æ˜¯æ¢å¾®è½¯çš„Bingæœç´¢å¼•æ“æ¥åšç«™å†…æœç´¢å§ã€‚</p>
<p>å¤§æ¦‚æ˜¯è¿™æ ·çš„æ•ˆæœ<br><img src="/assets/images/20180916201818.png" alt="example-pic"></p>
<p>è§‚å¯Ÿäº†ä¸‹ï¼ŒBingæŒ‡å®šç«™ç‚¹æœç´¢å¾ˆç®€å•ï¼Œæ¯”å¦‚æœç´¢æ¡†è¾“å…¥å…³é”®å­—<code>git site:www.ioio.pw</code>æäº¤ä¹‹åçš„urlæ˜¯<code>https://bing.com/search?q=git+site%3Awww.ioio.pw</code></p>
<p>æ‰€ä»¥å¼€å§‹å†™ä¸ªç®€å•çš„formè¡¨å•å°±å¥½äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>bing search<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Bing Search<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://bing.com/search&quot;</span> <span class="attr">id</span>=<span class="string">&quot;searchForm&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;q&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;site&quot;</span> <span class="attr">value</span>=<span class="string">&quot;www.ioio.pw&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Search&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> searchForm = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;searchForm&#x27;</span>);</span></span><br><span class="line"><span class="javascript">	searchForm.onsubmit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> url = <span class="built_in">this</span>.action;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> q = <span class="built_in">this</span>.children[<span class="string">&#x27;q&#x27;</span>].value;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> site = <span class="built_in">this</span>.children[<span class="string">&#x27;site&#x27;</span>].value;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> url = url + <span class="string">&#x27;?q=&#x27;</span>+q+<span class="string">&#x27; site:&#x27;</span>+ site;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">window</span>.open(url);</span></span><br><span class="line"><span class="javascript">		<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">	&#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œæå®š~</p>
]]></content>
      <categories>
        <category>æœç´¢å¼•æ“</category>
      </categories>
      <tags>
        <tag>æœç´¢å¼•æ“</tag>
        <tag>ç«™å†…æœç´¢</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerå®¹å™¨åŠ¨æ€æ·»åŠ ç«¯å£</title>
    <url>/2018/09/16/docker-container-port/</url>
    <content><![CDATA[<p>çªç„¶é‡åˆ°ä¸€ä¸ªé—®é¢˜æ€ä¹ˆç»™ä¸€ä¸ªå·²ç»åœ¨è¿è¡Œçš„dockerå®¹å™¨æ·»åŠ ç«¯å£ï¼Œæ‰¾äº†æ‰¾èµ„æ–™ï¼Œè®°ä¸ªç¬”è®°ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://blog.csdn.net/zuoshenglo/article/details/78402772">æ€ä¹ˆç»™è¿è¡Œä¸­çš„dockerå®¹å™¨æ·»åŠ æ–°çš„ç«¯å£</a></li>
<li><a href="https://blog.csdn.net/wesleyflagon/article/details/78961990">ä¿®æ”¹dockerå®¹å™¨ç«¯å£æ˜ å°„çš„æ–¹æ³•</a></li>
<li><a href="https://blog.csdn.net/xfks55/article/details/50148389">iptableè§„åˆ™æŸ¥çœ‹ï¼Œæ·»åŠ ï¼Œåˆ é™¤å’Œä¿®æ”¹</a></li>
</ul>
<h2 id="æ–¹æ³•1-ä¿®æ”¹iptablesç«¯å£æ˜ å°„"><a href="#æ–¹æ³•1-ä¿®æ”¹iptablesç«¯å£æ˜ å°„" class="headerlink" title="æ–¹æ³•1 ä¿®æ”¹iptablesç«¯å£æ˜ å°„"></a>æ–¹æ³•1 ä¿®æ”¹iptablesç«¯å£æ˜ å°„</h2><blockquote>
<p>dockerçš„ç«¯å£æ˜ å°„å¹¶ä¸æ˜¯åœ¨dockeræŠ€æœ¯ä¸­å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡å®¿ä¸»æœºçš„iptablesæ¥å®ç°ã€‚é€šè¿‡æ§åˆ¶ç½‘æ¡¥æ¥åšç«¯å£æ˜ å°„ï¼Œç±»ä¼¼è·¯ç”±å™¨ä¸­è®¾ç½®è·¯ç”±ç«¯å£æ˜ å°„ã€‚</p>
</blockquote>
<p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8080ç«¯å£ï¼Œå…ˆæŸ¥çœ‹iptablesåˆ°åº•è®¾ç½®äº†ä»€ä¹ˆè§„åˆ™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -vnL</span><br></pre></td></tr></table></figure>

<p>åœ¨ç»“æœä¸­æœ‰ä¸€æ¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Chain DOCKER</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">RETURN     all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:8080 to:172.17.0.3:80</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°dockeråˆ›å»ºäº†ä¸€ä¸ªåä¸ºDOKCERçš„è‡ªå®šä¹‰çš„é“¾æ¡Chainã€‚è€Œæˆ‘å¼€æ”¾80ç«¯å£çš„å®¹å™¨çš„ipæ˜¯172.17.0.3</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡inspectå‘½ä»¤æŸ¥çœ‹å®¹å™¨ip</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker inspect containerId |grep IPAddress</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æƒ³å†å¢åŠ ä¸€ä¸ªç«¯å£æ˜ å°„ï¼Œæ¯”å¦‚<code>8081-&gt;81</code>ï¼Œå°±åœ¨è¿™ä¸ªé“¾æ¡æ˜¯å†åŠ ä¸€æ¡è§„åˆ™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -A  DOCKER -p tcp --dport 8081 -j DNAT --to-destination 172.17.0.3:81</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåŠ é”™äº†æˆ–è€…æƒ³ä¿®æ”¹ï¼š</p>
<p>å…ˆæ˜¾ç¤ºè¡Œå·æŸ¥çœ‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -vnL DOCKER --line-number</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤è§„åˆ™3</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -D DOCKER 3</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ³•2-ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶"><a href="#æ–¹æ³•2-ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶" class="headerlink" title="æ–¹æ³•2 ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶"></a>æ–¹æ³•2 ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶</h2><p>å®¹å™¨çš„é…ç½®æ–‡ä»¶<code>/var/lib/docker/containers/[containerId]</code>ç›®å½•ä¸‹ï¼Œ<code>hostconfig.json</code>å’Œ<code>config.v2.json</code><br>ä¿®æ”¹å¥½ä¹‹åï¼Œé‡å¯å®¹å™¨æœåŠ¡ã€‚</p>
<h2 id="æ–¹æ³•3-æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ"><a href="#æ–¹æ³•3-æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ" class="headerlink" title="æ–¹æ³•3 æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ"></a>æ–¹æ³•3 æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ</h2><ol>
<li><p>æäº¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ä¸ºé•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker commit containerid heropoo/example</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œ<code>heropoo/example</code>é•œåƒå¹¶æ·»åŠ 8080æ˜ å°„å®¹å™¨80ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d -p 8000:80  heropoo/example /bin/sh</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>è¯•è¯•å§~ğŸ˜</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>è™šæ‹ŸåŒ–</tag>
        <tag>å®¹å™¨</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›—å°†è¡Œ(è½¬)</title>
    <url>/2018/09/18/%E7%9B%97%E5%B0%86%E8%A1%8C/</url>
    <content><![CDATA[<p>é‡å²è®°è½½:å®‹å¾½å®—äºŒåå¹´ï¼ˆ1120å¹´ï¼‰ï¼Œæœé‡åŠ¨è¡ï¼Œè¾¹ç–†ä¸ç¨³ã€‚æ—¶æœ‰ç›—è€…ï¼Œå–å®˜æµæ°‘ï¼Œå‡¡äº¬ä¸­è´ªå®˜ï¼Œæ— ä¸€å¹¸å…ï¼Œæ°‘å’¸æ•¬ä¹‹ï¼Œå´æ— äººçŸ¥å…¶çœŸé¢ç›®ã€‚ç„¶è‡ªå¾½å®—äºŒåä¸‰å¹´ï¼Œæ­¤ç›—æœªæ›¾å‡ºç°ï¼Œè‡³å¾½å®—äºŒåå…­å¹´ï¼Œæ­¤ç›—å…¥å—äº¬ç‹åºœï¼Œæœªå–å®ƒç‰©ï¼Œä»…ç›—èµ°ä¸€ç‰ç°ªï¼Œè‡ªæ­¤åŒ¿è¿¹â€¦â€¦</p>
<p>é‡å²è®°è½½:å®‹é’¦å®—å…ƒå¹´ï¼ˆ1126å¹´ï¼‰ï¼Œé‡‘å†›å°†é¢†å®Œé¢œå…‹å›¾ç‡å†›æ”»é™·å®‹éƒ½æ±´æ¢ï¼Œé’¦å®—è¢«ä¿˜ï¼Œæ°‘ä¸èŠç”Ÿã€‚1127å¹´ï¼Œå®‹é«˜å®—èµµæ„å»ºç«‹å—å®‹æ”¿æƒï¼Œæ—¶å®‹å†›ä¸é‡‘å†›äº¤æˆ˜ï¼Œä¸€å°å’ä¸€ç®­å°„æ€å®Œé¢œå…‹å›¾ï¼Œè€Œåå±¡ç«‹æˆ˜åŠŸï¼Œå®˜è‡³æŠ¤å›½å°†å†›ï¼Œç­å¸ˆå›æœåï¼Œå®‹ä¸»æ¬²å¯¹å…¶å¤§è¡Œå°èµï¼Œç„¶å…¶è‡ªè¾å®˜èŒï¼Œè‡ªæ­¤åŒ¿è¿¹â€¦â€¦</p>
<p>å…¬å…ƒ1137å¹´ï¼Œä¸€ç¬‘è½©å†…ï¼Œåº§æ— è™šå¸­ï¼Œå¸­å‰åä¸€ä¸­å¹´ç”·å­ï¼Œç›¸è²Œéå‡¡ï¼Œæ–‡å¢¨ä¸­é¢‡æœ‰æ­¦å°†é£é‡‡ï¼Œæœ‰å¬è€…å¸­ä¸‹æš—å¹:æ­¤ç­‰äººé—´ç¢ç‰éƒï¼Œå¤©åº”ä¹ä¸ç‚¹é…¥å¨˜ï¼Œå¥ˆä½•å¤©å…¬ä¸ä½œç¾å•Šâ€¦â€¦ï¼Œåªè§ç”·å­æ‰‹æ‰§é†’æœ¨ä¸€æ•²ï¼Œâ€œä»Šæ—¥æˆ‘ç»™è¯¸ä½è®²è®²é‚£ä½æ¶ˆå¤±å¤§ç›—çš„æ•…äº‹ã€‚è¯¸ä½éƒ½çŸ¥é“è¿™å¤§ç›—åœ¨åå¤šå¹´å‰åŠ«å¯Œæµè´«ï¼Œç™¾å§“è§†ä¹‹ä¸ºç¥æ˜ï¼Œè¯¸ä½å¯çŸ¥ä¸ºä½•è¿™å¤§ç›—æ¶ˆå¤±å‡ å¹´åï¼Œåˆäºå—äº¬ç‹åºœç›—å–ä¸€æ”¯ç‰ç°ªæ­¤åä¾¿å†æ— æ¶ˆæ¯â€¦â€¦â€</p>
<p>â€œæ²¡é”™ï¼Œæˆ‘å°±æ˜¯è¯´ä¹¦äººï¼Œä¹Ÿæ˜¯å¤§ç›—ï¼Œäº¦æ˜¯æŠ¤å›½å°†å†›ï¼ŒäºŒåå²ä¹‹å‰ï¼Œæˆ‘ä»å¸ˆå‚…é‚£é‡Œä¹ å¾—æ­¦è‰ºï¼Œå­¦æˆåå› å–œè‡ªåœ¨ç”Ÿæ´»ï¼Œå´çœ‹ä¸æƒ¯è´ªå®˜æ±¡åï¼Œç”±æ­¤å¼€å§‹äº†åŠ«è´ªæµè´«çš„ç”Ÿæ´»ï¼Œæœ¬ä»¥ä¸ºè‡ªå·±ä¸€ç”Ÿéƒ½ä¼šè¿™æ ·ä¸€ä¸ªäººæ¸¡è¿‡ï¼Œæ¸…é£æ˜æœˆã€è½æ—¥ä½™éœï¼Œå´ä¸æ›¾æƒ³å¥¹èµ°è¿›äº†æˆ‘çš„ç”Ÿæ´»ï¼Œé‚£æ—¥ï¼Œåœ¨ç›—å–åº·ç‹åºœçå®å¤œæ˜ç åï¼Œä¸ºèº²é¿è¿½æ•ï¼Œæˆ‘çºµé©¬é€ƒå‡ºåŸå¤–ï¼Œå´å› å‹’é©¬ä¸åŠï¼Œæ— æ„ä¸­è½»å¾®å¸¦èµ·è·¯è¾¹ä¸€å¥³å­çš„è£™è¾¹ï¼Œçœ‹å®˜å…µå¹¶æœªè¿½æ¥ï¼Œæˆ‘ä¸‹é©¬å‘å¥³å­é“æ­‰ï¼Œå´ä¸æƒ³åªæ­¤ä¸€çœ¼ï¼Œä¾¿æ˜¯ä¸€ç”Ÿï¼Œè‡ªè®¤è¿™ä¸–é—´æ²¡æœ‰ç›—ä¸åˆ°çš„ä¸œè¥¿çš„æˆ‘ï¼Œå´å¼€å§‹æ‹…å¿ƒç›—ä¸åˆ°å¥¹çš„å¿ƒï¼Œç„¶è€Œè‡ªå·±çš„å¿ƒå´å·²è¢«å¥¹å¸¦èµ°ï¼Œå› ä¸ºè¿™ä¸€çœ¼ï¼Œæˆ‘å¿½ç„¶æƒ³ä¸å†ä¸ºç›—ï¼Œå¨¶å…¶ä¸ºå¦»ã€‚è€å¤©å¾…æˆ‘ä¸è–„ï¼Œæˆ‘ç›—å¾—äº†å¥¹çš„å¿ƒï¼Œç„¶åæˆ‘æ¸¡è¿‡äº†æ­¤ç”Ÿæœ€å¿«ä¹çš„ä¸‰å¹´ï¼Œæˆ‘é™ªå¥¹åƒå··å­é‡Œçš„é‚£å®¶æ±¤é¢ã€è°ˆç¬‘ä¸­çª—å¤–ç™½é›ªçº·é£ï¼Œä¸æƒœç”¨å¤œæ˜ç åšå¼¹ç å¼¹å±±é›€â€¦â€¦å…¬å…ƒ1126å¹´ï¼Œæˆ‘å†³å®šå¨¶å¥¹ï¼Œå¬é—»å—äº¬ç‹åºœä¸­æœ‰ä¸€ç‰ç°ªï¼Œå¾—ä¹‹èµ äºˆå¿ƒçˆ±ä¹‹äººï¼Œå¯ä¸å…¶ç”Ÿç”Ÿä¸–ä¸–æ°¸ä¸åˆ†ç¦»ï¼Œæˆ‘å†³å®šå°†å®ƒå·æ¥é€ç»™å¥¹ï¼Œå’Œå¥¹è¯´å¥½è¿‡äº›æ—¥å­æˆ‘å°±ä¼šå›æ¥è¿å¨¶å¥¹ï¼Œä¹‹åå°±è¸ä¸Šäº†å»å—äº¬çš„è·¯ï¼Œåœ¨æˆ‘ç›—å¾—ç‰ç°ªè¿”é€”ä¸­ï¼Œå¬é—»é‡‘å†›æ”»é™·æ±´æ¢ï¼Œä¸€è·¯çƒ§æ€æŠ¢æ ï¼Œæ°‘ä¸èŠç”Ÿï¼Œæˆ‘æ…Œå¼ çš„å›åˆ°æ±´æ¢ï¼Œè·¯ä¸Šä¸åœçš„å®‰æ…°è‡ªå·±å¥¹ä¸€å®šæ²¡äº‹ï¼Œå´ä¸å¾—ä¸æ¥å—å¥¹å·²è¿‡ä¸–çš„ç°å®ï¼Œå¯èƒ½è´¼å°±æ˜¯è´¼å§ï¼Œä¸è®ºæˆ‘æ˜¯å¦åŠ«å¯Œæµè´«ï¼ŒæŠ¥åº”ç»ˆç©¶è¿˜æ˜¯æ¥äº†ï¼Œæˆ‘å¤±å»äº†æœ€å¿ƒçˆ±çš„äººï¼Œè‡ªæ­¤æˆ‘å¼ƒç›—ä»å†›ï¼Œå¸¦ç€å¯¹å¥¹çš„ç•™æ‹ï¼Œå°†ä¸€è…”æ¨æ„å…¨éƒ¨æ”¾åœ¨äº†é‡‘å†›èº«ä¸Šï¼Œå°†å£«ä»¬éƒ½è¯´æˆ‘åœ¨æˆ˜åœºå‹‡çŒ›å¼‚å¸¸ï¼Œå´ä¸çŸ¥æˆ‘å¿ƒä¸­æ»¡æ˜¯ä¸ºå¥¹æŠ¥ä»‡çš„æ€’æ„ä¸æ²¡æœ‰ç•™åœ¨å¥¹èº«è¾¹çš„æ‚”æ„ã€‚æœ€ç»ˆé‡‘å†›è´¥é€€ï¼Œæˆ‘å°„æ€äº†å®Œé¢œå…‹å›¾ï¼Œä¹Ÿå› æ­¤è¢«å°ä¸ºæŠ¤å›½å¤§å°†å†›ï¼Œæœå ‚ä¹‹ä¸Šï¼Œæˆ‘æ¨å´äº†èµèµï¼Œè¾æ‰äº†å®˜èŒï¼Œæ¥åˆ°äº†é‚£ä¸ªæœ‰ç€å¥¹çˆ±åƒçš„æ±¤é¢çš„å··å­ï¼Œå¼€äº†è¿™ä¸€ç¬‘è½©ï¼Œæˆä¸ºäº†ä¸€ä¸ªè®²å°½æ•…äº‹ï¼Œå´èµ°ä¸å‡ºè‡ªå·±æ•…äº‹çš„è¯´ä¹¦äººã€‚â€</p>
<p>â€œâ€¦â€¦åœ¨å¤§å°†å†›è¾å®˜ä¹‹åï¼Œä¾¿æ— äººçŸ¥æ™“å…¶å»å¤„ï¼Œå¾’ç•™è¿™ä¹ˆä¸€ä¸ªæ•…äº‹ï¼Œæˆ‘å¶ç„¶é—»å¾—ï¼Œè®²ä¸è¯¸ä½å¬ã€‚ä»Šæ—¥å°±è®²åˆ°è¿™é‡Œï¼Œå¤šè°¢è¯¸ä½æ§åœºã€‚â€ä¸€å£°é†’æœ¨ï¼Œä¼—äººè¿˜æœªä»å¤§ç›—çš„æ•…äº‹ä¸­å›è¿‡ç¥æ¥ï¼Œå´å‘ç°è¯´ä¹¦äººå·²ç„¶è½¬è¿›åå ‚ï¼Œä¼—äººèµ·èº«å››æ•£ï¼Œè¯´ä¹¦äººè½¬è¿›åå ‚å·²æ˜¯æ³ªæµæ»¡é¢ï¼Œçœ‹ç€åå ‚é™¢ä¸­çš„æ‡æ·æ ‘ï¼Œæ ‘ä¸ŠæŒ‚ç€é‚£åªæœªé€å‡ºçš„ç‰ç°ªâ€¦â€¦</p>
<p>ä½œè€…ï¼šä¸€ä¸ªäººçš„å…µè’é¦¬ä¹±<br>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/7aa6bfbb0df1">https://www.jianshu.com/p/7aa6bfbb0df1</a><br>ä¾†æºï¼šç®€ä¹¦</p>
]]></content>
      <categories>
        <category>å¬é£é›¨</category>
      </categories>
      <tags>
        <tag>å¬é£é›¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºYii2æŸ¥è¯¢æ•°æ®å¯¹è±¡ActiveRecordçš„jsonåºåˆ—åŒ–é—®é¢˜</title>
    <url>/2018/10/16/yii2-activerecord-to-json/</url>
    <content><![CDATA[<p>ä»Šå¤©åœ¨ä½¿ç”¨<code>json_encode</code>å‡½æ•°åºåˆ—åŒ–Yii2æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®æ¨¡å‹å¯¹è±¡ï¼ˆé€šå¸¸ç»§æ‰¿<code>ActiveRecord</code>ç±»ï¼‰æ—¶ï¼Œå‘ç°è¿”å›ç»“æœæ˜¯<code>&#123;&#125;</code>,è€Œä¸æ˜¯é¢„æœŸçš„æ•°æ®åº“å­—æ®µé”®å€¼å¯¹è¿™ç§å½¢å¼ï¼š<code>&#123;&quot;name&quot;ï¼š &quot;xxx&quot;, &quot;sex&quot;: 1&#125;</code></p>
<p>åæ¥èµ¶æ—¶é—´å°±ç›´æ¥åœ¨æ‰‹åŠ¨å¤„ç†äº†ä¸‹ï¼Œæ”¹åŠ¨äº†ä¸‹æ¨¡å‹å¯¹è±¡è®©å®ƒæ¥å…¥<code>JsonSerializable</code>æ¥å£ï¼Œå¹¶å®ç°å…¶æ¥å£æ–¹æ³•ï¼Œç±»ä¼¼è¿™æ ·ï¼›</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">ActiveRecord</span> <span class="keyword">implements</span> \<span class="title">JsonSerializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//... å…¶ä»–ä»£ç </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonSerialize</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;toArray();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå®Œç¾çš„è§£å†³äº†ã€‚ </p>
<p>ä½†æ˜¯åæ¥ä»£ç å†™å®Œäº†ï¼Œè§‰å¾—è¿™ä¸ªæ¡†æ¶åº”è¯¥æä¾›äº†è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•äº†å§ã€‚ç„¶åæ‰¾äº†æ‰¾ï¼Œæœç„¶æœ‰çš„ï¼š <code>\yii\helpers\BaseJson::encode($user)</code>ã€‚ç„¶åç¿»äº†ç¿»æºä»£ç ï¼Œéƒ¨åˆ†ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//from \yii\helpers\BaseJson::processData</span></span><br><span class="line"><span class="keyword">if</span> (is_object(<span class="variable">$data</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$data</span> <span class="keyword">instanceof</span> JsExpression) &#123;</span><br><span class="line">        <span class="variable">$token</span> = <span class="string">&quot;!&#123;[<span class="subst">$expPrefix</span>=&quot;</span> . count(<span class="variable">$expressions</span>) . <span class="string">&#x27;]&#125;!&#x27;</span>;</span><br><span class="line">        <span class="variable">$expressions</span>[<span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$token</span> . <span class="string">&#x27;&quot;&#x27;</span>] = <span class="variable">$data</span>-&gt;expression;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$token</span>;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$data</span> <span class="keyword">instanceof</span> \JsonSerializable) &#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$data</span>-&gt;jsonSerialize();</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$data</span> <span class="keyword">instanceof</span> Arrayable) &#123; <span class="comment">// &lt;---here</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$data</span>-&gt;toArray();</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$data</span> <span class="keyword">instanceof</span> \SimpleXMLElement) &#123;</span><br><span class="line">        <span class="variable">$data</span> = (<span class="keyword">array</span>) <span class="variable">$data</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$result</span> = [];</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$name</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$result</span>[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$data</span> === []) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> \<span class="built_in">stdClass</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½œè€…åœ¨å¤„ç†æ•°æ®çš„æ—¶å€™åšäº†åˆ¤æ–­ï¼Œ<code>ActiveRecord</code>ç±»æ¥äº†<code>Arrayable</code>æ¥å£ï¼Œç„¶åä½œè€…ä¹Ÿæ˜¯ä½¿ç”¨<code>toArray()</code>æ–¹æ³•ã€‚ç„¶åæˆ‘è§‰å¾—æ”¾å¿ƒäº†ã€‚æˆ‘çš„æ”¹é€ ä¹Ÿæ²¡æœ‰é”™ã€‚å½“ç„¶äº†ä½¿ç”¨æ¡†æ¶æä¾›çš„æ–¹æ³•æ›´ç®€å•ç‚¹ã€‚</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Yii2</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿®å¤gitmentè¯„è®º</title>
    <url>/2018/10/27/fix-gitment/</url>
    <content><![CDATA[<p>æœ€è¿‘å‡ ä¸ªæœˆåšå®¢å¤–æŒ‚çš„gitmentè¯„è®ºè€æ˜¯æŒ‚ï¼Œä¹Ÿä¸€ç›´æ²¡æ—¶é—´ä¿®å¤ã€‚è¿™å‡ å¤©æƒ³åŠæ³•ä¿®å¥½äº†ã€‚å°±è¯´è¯´ä¿®å¤çš„è¿‡ç¨‹å§ã€‚</p>
<p>ä»æˆ‘å¼€å§‹ç”¨gitmentçš„è¯„è®ºç³»ç»Ÿï¼Œæ€»å…±å‡ºç°è¿‡ä¸¤æ¬¡é—®é¢˜ï¼š</p>
<h2 id="1-github-issue-labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶"><a href="#1-github-issue-labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶" class="headerlink" title="1. github-issue labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶"></a>1. github-issue labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶</h2><p>è¿™æ¬¡å¯¼è‡´åŸæœ¬é»˜è®¤ä½¿ç”¨ç½‘é¡µurlåœ°å€åšlabelåˆå§‹åŒ–è¯„è®ºçš„æ–¹å¼æ— æ³•ä½¿ç”¨ï¼Œurlå¤ªé•¿äº†è¶…è¿‡äº†50ä¸ªå­—ç¬¦ã€‚è€Œä¹‹å‰å·²ç»åˆå§‹åŒ–å¥½çš„è¯„è®ºï¼ˆissueï¼‰ä¸æ”¶å½±å“ã€‚æ‰€ä»¥åæ¥æˆ‘æƒ³äº†ä¸ªåŠæ³•æ¥æ”¹ï¼Œå°±æ˜¯ç”¨æ—¶é—´æ¥åˆå§‹åŒ–ï¼Œå¹¶ä¸”å¯¹äºä¸ºäº†å…¼å®¹ä¹‹å‰çš„è¯„è®ºï¼ŒåŠ äº†æ—¶é—´åˆ¤æ–­ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> page_date = <span class="string">&#x27;&#123;&#123; page.date &#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> id = <span class="built_in">window</span>.location.href;</span><br><span class="line"><span class="keyword">if</span>(page_date &gt; <span class="string">&#x27;2018-04-31 00:00:00 +0000&#x27;</span>)&#123;</span><br><span class="line">    id = page_date;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> gitment = <span class="keyword">new</span> Gitment(&#123;</span><br><span class="line">    <span class="attr">id</span>: id, <span class="comment">// å¯é€‰ã€‚é»˜è®¤ä¸º location.href</span></span><br><span class="line">    <span class="attr">owner</span>: <span class="string">&#x27;heropoo&#x27;</span>,</span><br><span class="line">    <span class="attr">repo</span>: <span class="string">&#x27;heropoo.github.io&#x27;</span>,</span><br><span class="line">    <span class="attr">oauth</span>: &#123;</span><br><span class="line">        <span class="attr">client_id</span>: <span class="string">&#x27;cccc&#x27;</span>,</span><br><span class="line">        <span class="attr">client_secret</span>: <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">gitment.render(<span class="string">&#x27;container&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="2-gitment-ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨"><a href="#2-gitment-ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨" class="headerlink" title="2. gitment ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨"></a>2. gitment ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨</h2><p>è¿™æ¬¡å¥½åƒæŒ‚äº†ä½¿ç”¨ä½œè€…æä¾›çš„jsçš„åšå®¢å…¨æŒ‚äº†ğŸ˜‚ã€‚ è§£å†³åŠæ³•å°±æ˜¯è‡ªå·±æ­å»ºæˆ–è€…ä½¿ç”¨åˆ«äººæ­å»ºçš„oauthæˆæƒæœåŠ¡äº†ã€‚ å¥½å§ï¼Œæ¢ä¸ªæˆæƒæœåŠ¡æ€»ç®—å¥½äº†ã€‚</p>
<h2 id="3-å‡çº§https"><a href="#3-å‡çº§https" class="headerlink" title="3. å‡çº§https"></a>3. å‡çº§https</h2><p>ç°åœ¨github-pageæä¾›å¼ºåˆ¶httpsã€‚å‡çº§ä¹‹åå‘ç°ä¹‹å‰å…¼å®¹çš„ä½¿ç”¨é¡µé¢urlåˆå§‹åŒ–çš„è¯„è®ºåˆä¸èƒ½ç”¨äº†ã€‚ ã„Ÿ( â–”, â–” )ã„<br>ä½†æ˜¯è¿˜å¾—ä¿®å˜›ã€‚åæ¥ä»”ç»†è§‚å¯Ÿäº†ä¸‹ï¼ŒåŸæ¥ä½œè€…æ˜¯ä½¿ç”¨<code>gitment</code>å’Œé¡µé¢jsä¸­è·å–çš„idæ¥åŒ¹é…å‡ºä¸€ä¸ªissueçš„ã€‚æ‰€ä»¥åªè¦å»githubä¿®æ”¹issue labelå°±å¯ä»¥äº†ã€‚æŠŠåŸæ¥å¾ˆé•¿çš„url labelæ”¹æˆç°åœ¨çš„çŸ­çš„ï¼Œæ¯”å¦‚åƒæˆ‘ä¸€æ ·ç”¨æ—¶é—´ã€‚ç„¶åé¡µé¢ä¸Šçš„å…¼å®¹çš„jsä¹Ÿå»æ‰å°±æå®šäº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> page_date = <span class="string">&#x27;&#123;&#123; page.date &#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">//var id = window.location.href;</span></span><br><span class="line"><span class="comment">//if(page_date &gt; &#x27;2018-04-31 00:00:00 +0000&#x27;)&#123;</span></span><br><span class="line"><span class="keyword">var</span> id = page_date;</span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="keyword">var</span> gitment = <span class="keyword">new</span> Gitment(&#123;</span><br><span class="line">    <span class="attr">id</span>: id, <span class="comment">// å¯é€‰ã€‚é»˜è®¤ä¸º location.href</span></span><br><span class="line">    <span class="attr">owner</span>: <span class="string">&#x27;heropoo&#x27;</span>,</span><br><span class="line">    <span class="attr">repo</span>: <span class="string">&#x27;heropoo.github.io&#x27;</span>,</span><br><span class="line">    <span class="attr">oauth</span>: &#123;</span><br><span class="line">        <span class="attr">client_id</span>: <span class="string">&#x27;cccc&#x27;</span>,</span><br><span class="line">        <span class="attr">client_secret</span>: <span class="string">&#x27;xxxx&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">gitment.render(<span class="string">&#x27;container&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œæå®Œæ”¶å·¥ã€‚</p>
]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>github-issue</tag>
        <tag>gitment</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…Jupyterç¬”è®°æœ¬</title>
    <url>/2018/11/02/jupyter/</url>
    <content><![CDATA[<p>å®‰è£…Jupyterç¬”è®°æœ¬ï¼Œåšä¸ªç¬”è®°</p>
<p>é€šè¿‡pipå®‰è£…</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo pip3 install jupyter</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºJupyteré»˜è®¤é…ç½®æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">jupyter notebook --generate-config</span><br></pre></td></tr></table></figure>
<p>ç”ŸæˆSHA1åŠ å¯†çš„å¯†é’¥ï¼Œå¦‚â€™sha1:XXXXXXâ€™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ipython</span><br><span class="line">--------------------------------------</span><br><span class="line">from notebook.auth import passwd</span><br><span class="line">passwd()</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim .jupyter/jupyter_notebook_config.py</span><br><span class="line">--------------------------------------</span><br><span class="line">c.NotebookApp.password = u<span class="string">&#x27;sha1:XXXXXX&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œjupyter</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„è¿è¡Œå‚æ•°</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">jupyter notebook --ip=0.0.0.0 --no-browser --allow-root</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ <a href="http://localhost:8888">http://localhost:8888</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>jupyter</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.7çš„JSONåŸºæœ¬æ“ä½œ</title>
    <url>/2018/11/18/mysql-json/</url>
    <content><![CDATA[<p>MySQLä»5.7ç‰ˆæœ¬å¼€å§‹å°±æ”¯æŒJSONæ ¼å¼çš„æ•°æ®ï¼Œæ“ä½œç”¨èµ·æ¥æŒºæ–¹ä¾¿çš„ã€‚</p>
<h3 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h3><p>åœ¨æ–°å»ºè¡¨æ—¶å­—æ®µç±»å‹å¯ä»¥ç›´æ¥è®¾ç½®ä¸ºjsonç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€å¼ è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE `test_user`(`id` INT PRIMARY KEY AUTO_INCREMENT, `name` VARCHAR(50) NOT NULL, `info` JSON);</span><br></pre></td></tr></table></figure>
<p>jsonç±»å‹å­—æ®µå¯ä»¥ä¸ºNULL</p>
<h3 id="æ’å…¥æ•°æ®ï¼š"><a href="#æ’å…¥æ•°æ®ï¼š" class="headerlink" title="æ’å…¥æ•°æ®ï¼š"></a>æ’å…¥æ•°æ®ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; INSERT INTO test_user(`name`, `info`) VALUES(&#x27;xiaoming&#x27;,&#x27;&#123;&quot;sex&quot;: 1, &quot;age&quot;: 18, &quot;nick_name&quot;: &quot;å°èŒ&quot;&#125;&#x27;);</span><br></pre></td></tr></table></figure>
<p>jsonç±»å‹çš„å­—æ®µå¿…é¡»æ—¶ä¸€ä¸ªæœ‰æ•ˆçš„jsonå­—ç¬¦ä¸²</p>
<p>å¯ä»¥ä½¿ç”¨JSON_OBJECT()å‡½æ•°æ„é€ jsonå¯¹è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; INSERT INTO test_user(`name`, `info`) VALUES(&#x27;xiaohua&#x27;, JSON_OBJECT(&quot;sex&quot;, 0, &quot;age&quot;, 17));</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨JSON_ARRAY()å‡½æ•°æ„é€ jsonæ•°ç»„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; INSERT INTO test_user(`name`, `info`) VALUES(&#x27;xiaozhang&#x27;, JSON_OBJECT(&quot;sex&quot;, 1, &quot;age&quot;, 19, &quot;tag&quot;, JSON_ARRAY(3,5,90)));</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æŸ¥çœ‹<code>test_user</code>è¡¨ä¸­çš„æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user;</span><br><span class="line">+----+-----------+--------------------------------------------+</span><br><span class="line">| id | name      | info                                       |</span><br><span class="line">+----+-----------+--------------------------------------------+</span><br><span class="line">|  1 | xiaoming  | &#123;&quot;age&quot;: 18, &quot;sex&quot;: 1, &quot;nick_name&quot;: &quot;å°èŒ&quot;&#125; |</span><br><span class="line">|  2 | xiaohua   | &#123;&quot;age&quot;: 17, &quot;sex&quot;: 0&#125;                      |</span><br><span class="line">|  3 | xiaozhang | &#123;&quot;age&quot;: 19, &quot;sex&quot;: 1, &quot;tag&quot;: [3, 5, 90]&#125;   |</span><br><span class="line">+----+-----------+--------------------------------------------+</span><br><span class="line">3 rows in set (0.04 sec)</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><p>è¡¨è¾¾å¼ï¼š å¯¹è±¡ä¸º<code>jsonåˆ—-&gt;&#39;$.é”®&#39;</code>, æ•°ç»„ä¸º<code>jsonåˆ—-&gt;&#39;$.é”®[index]&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, info-&gt;&#x27;$.nick_name&#x27;, info-&gt;&#x27;$.sex&#x27;, info-&gt;&#x27;$.tag[0]&#x27; from test_user;</span><br><span class="line">+-----------+---------------------+---------------+------------------+</span><br><span class="line">| name      | info-&gt;&#x27;$.nick_name&#x27; | info-&gt;&#x27;$.sex&#x27; | info-&gt;&#x27;$.tag[0]&#x27; |</span><br><span class="line">+-----------+---------------------+---------------+------------------+</span><br><span class="line">| xiaoming  | &quot;å°èŒ&quot;              | 1             | NULL             |</span><br><span class="line">| xiaohua   | NULL                | 0             | NULL             |</span><br><span class="line">| xiaozhang | NULL                | 1             | 3                |</span><br><span class="line">+-----------+---------------------+---------------+------------------+</span><br><span class="line">3 rows in set (0.04 sec)</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äºï¼šå¯¹è±¡ä¸º<code>JSON_EXTRACT(jsonåˆ— , &#39;$.é”®&#39;)</code>ï¼Œæ•°ç»„ä¸º<code>JSON_EXTRACT(jsonåˆ— , &#39;$.é”®[index]&#39;)</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, JSON_EXTRACT(info, &#x27;$.nick_name&#x27;), JSON_EXTRACT(info, &#x27;$.sex&#x27;), JSON_EXTRACT(info, &#x27;$.tag[0]&#x27;)  from test_user;</span><br><span class="line">+-----------+-----------------------------------+-----------------------------+--------------------------------+</span><br><span class="line">| name      | JSON_EXTRACT(info, &#x27;$.nick_name&#x27;) | JSON_EXTRACT(info, &#x27;$.sex&#x27;) | JSON_EXTRACT(info, &#x27;$.tag[0]&#x27;) |</span><br><span class="line">+-----------+-----------------------------------+-----------------------------+--------------------------------+</span><br><span class="line">| xiaoming  | &quot;å°èŒ&quot;                            | 1                           | NULL                           |</span><br><span class="line">| xiaohua   | NULL                              | 0                           | NULL                           |</span><br><span class="line">| xiaozhang | NULL                              | 1                           | 3                              |</span><br><span class="line">+-----------+-----------------------------------+-----------------------------+--------------------------------+</span><br><span class="line">3 rows in set (0.04 sec)</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡çœ‹åˆ°ä¸Šé¢<code>&quot;å°èŒ&quot;</code>æ˜¯å¸¦åŒå¼•å·çš„ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¯ä»¥ç”¨<code>JSON_UNQUOTE</code>å‡½æ•°å°†åŒå¼•å·å»æ‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, JSON_UNQUOTE(info-&gt;&#x27;$.nick_name&#x27;) from test_user where name=&#x27;xiaoming&#x27;;</span><br><span class="line">+----------+-----------------------------------+</span><br><span class="line">| name     | JSON_UNQUOTE(info-&gt;&#x27;$.nick_name&#x27;) |</span><br><span class="line">+----------+-----------------------------------+</span><br><span class="line">| xiaoming | å°èŒ                              |</span><br><span class="line">+----------+-----------------------------------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ“ä½œç¬¦<code>-&gt;&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, info-&gt;&gt;&#x27;$.nick_name&#x27; from test_user where name=&#x27;xiaoming&#x27;;</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| name     | info-&gt;&gt;&#x27;$.nick_name&#x27; |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| xiaoming | å°èŒ                 |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶å±æ€§ä¹Ÿå¯ä»¥ä½œä¸ºæŸ¥è¯¢æ¡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, info-&gt;&gt;&#x27;$.nick_name&#x27; from test_user where info-&gt;&#x27;$.nick_name&#x27;=&#x27;å°èŒ&#x27;;</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| name     | info-&gt;&gt;&#x27;$.nick_name&#x27; |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| xiaoming | å°èŒ                 |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯ä»¥é€šè¿‡è™šæ‹Ÿåˆ—å¯¹JSONç±»å‹çš„æŒ‡å®šå±æ€§è¿›è¡Œå¿«é€ŸæŸ¥è¯¢ã€‚</p>
<p>åˆ›å»ºè™šæ‹Ÿåˆ—:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE `test_user` ADD `nick_name` VARCHAR(50) GENERATED ALWAYS AS (info-&gt;&gt;&#x27;$.nick_name&#x27;) VIRTUAL;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ç”¨æ“ä½œç¬¦<code>-&gt;&gt;</code></p>
<p>ä½¿ç”¨æ—¶å’Œæ™®é€šç±»å‹çš„åˆ—æŸ¥è¯¢æ˜¯ä¸€æ ·:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name,nick_name from test_user where nick_name=&#x27;å°èŒ&#x27;;</span><br><span class="line">+----------+-----------+</span><br><span class="line">| name     | nick_name |</span><br><span class="line">+----------+-----------+</span><br><span class="line">| xiaoming | å°èŒ      |</span><br><span class="line">+----------+-----------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><p>ä½¿ç”¨<code>JSON_INSERT()</code>æ’å…¥æ–°å€¼ï¼Œä½†ä¸ä¼šè¦†ç›–å·²ç»å­˜åœ¨çš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info = JSON_INSERT(info, &#x27;$.sex&#x27;, 1, &#x27;$.nick_name&#x27;, &#x27;å°èŠ±&#x27;) where id=2;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id=2;</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">| id | name    | info                                       | nick_name |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">|  2 | xiaohua | &#123;&quot;age&quot;: 17, &quot;sex&quot;: 0, &quot;nick_name&quot;: &quot;å°èŠ±&quot;&#125; | å°èŠ±      |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>JSON_SET()</code>æ’å…¥æ–°å€¼ï¼Œå¹¶è¦†ç›–å·²ç»å­˜åœ¨çš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info = JSON_SET(info, &#x27;$.sex&#x27;, 0, &#x27;$.nick_name&#x27;, &#x27;å°å¼ &#x27;) where id=3;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id=3;</span><br><span class="line">+----+-----------+---------------------------------------------------------------+-----------+</span><br><span class="line">| id | name      | info                                                          | nick_name |</span><br><span class="line">+----+-----------+---------------------------------------------------------------+-----------+</span><br><span class="line">|  3 | xiaozhang | &#123;&quot;age&quot;: 19, &quot;sex&quot;: 1, &quot;tag&quot;: [3, 5, 90], &quot;nick_name&quot;: &quot;å°å¼ &quot;&#125; | å°å¼       |</span><br><span class="line">+----+-----------+---------------------------------------------------------------+-----------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>JSON_REPLACE()</code>åªæ›¿æ¢å­˜åœ¨çš„å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info = JSON_REPLACE(info, &#x27;$.sex&#x27;, 1, &#x27;$.tag&#x27;, &#x27;[1,2,3]&#x27;) where id=2;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id=2;</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">| id | name    | info                                       | nick_name |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">|  2 | xiaohua | &#123;&quot;age&quot;: 17, &quot;sex&quot;: 1, &quot;nick_name&quot;: &quot;å°èŠ±&quot;&#125; | å°èŠ±      |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°tagæ²¡æœ‰æ›´æ–°è¿›å»</p>
<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><p>ä½¿ç”¨<code>JSON_REMOVE()</code>åˆ é™¤JSONå…ƒç´ </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info = JSON_REMOVE(info, &#x27;$.sex&#x27;, &#x27;$.tag&#x27;) where id=1;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id=1;</span><br><span class="line">+----+----------+----------------------------------+-----------+</span><br><span class="line">| id | name     | info                             | nick_name |</span><br><span class="line">+----+----------+----------------------------------+-----------+</span><br><span class="line">|  1 | xiaoming | &#123;&quot;age&quot;: 18, &quot;nick_name&quot;: &quot;å°èŒ&quot;&#125; | å°èŒ      |</span><br><span class="line">+----+----------+----------------------------------+-----------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<p>æœ€åä»MySQLçš„å®˜æ–¹ç½‘ç«™æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼š<a href="http://dev.mysql.com/doc/refman/5.7/en/json.html">http://dev.mysql.com/doc/refman/5.7/en/json.html</a></p>
<p>ğŸ˜</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>JSON</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»SSHç§é’¥ä¸­é‡æ–°ç”Ÿæˆå…¬é’¥</title>
    <url>/2018/11/19/get-ssh-public-key-from-private-key/</url>
    <content><![CDATA[<p>ä»SSHç§é’¥ä¸­é‡æ–°ç”Ÿæˆå…¬é’¥</p>
<p>å‡å¦‚æˆ‘ä»¬çš„ç§é’¥æ˜¯<code>id_rsa</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -y -f id_rsa</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDdqNYfRhP/4Y1Kwr5/ZfRPbQkDEKQ9sLpGYex2bzXsPIXZmpgI4yUkLkQRCyvrMoZQKOcabb+GgnrYJvPR1rO/CVI9bfUw+MD1OFvnJUI2deATTeMj2hlY/IDSS1q3AG1ZEztFLizTiJqZvkjx/WPXR/b7ZIVV5DRIeaUMCfEjNIRD+spcJ5ALBuwGPO+4irAXIxgTxbYMDD2ASnpr6v7oSzc0N5ZhZ7rV1dk6hA/RowqYO7DwIvZtOAc55sv6pSUYG3RUJhnkzcmE5VTbyTMKB6O738np6DEw5soWdL1ITPgLE+uJcTt8tcOmPkBXv+45A4TuJ5ksONil8xhfVYG3</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç›´æ¥é‡å®šå‘åˆ°æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -y -f id_rsa &gt; id_rsa.pub</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºPHP Composer ç‰ˆæœ¬å·å‰ç½®~ä¸^ç¬¦å·çš„åŒºåˆ«(è½¬)</title>
    <url>/2018/12/29/php-composer-version/</url>
    <content><![CDATA[<p><code>~</code>å’Œ<code>^</code>çš„æ„æ€å¾ˆæ¥è¿‘ï¼Œåœ¨<code>x.y</code>çš„æƒ…å†µä¸‹æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä»£è¡¨<code>x.y &lt;= ç‰ˆæœ¬å· &lt; (x+1).0</code>ã€‚ä½†æ˜¯åœ¨ç‰ˆæœ¬å·æ˜¯<code>x.y.z</code>çš„æƒ…å†µä¸‹æœ‰åŒºåˆ«ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li><p><code>~1.2.3</code> ä»£è¡¨ <code>1.2.3 &lt;= ç‰ˆæœ¬å· &lt; 1.3.0</code></p>
</li>
<li><p><code>^1.2.3</code> ä»£è¡¨ <code>1.2.3 &lt;= ç‰ˆæœ¬å· &lt; 2.0.0</code></p>
</li>
</ul>
<p>åŸæ–‡é“¾æ¥ï¼š <a href="https://www.cnblogs.com/hcpzhe/p/7909651.html">https://www.cnblogs.com/hcpzhe/p/7909651.html</a></p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPå¤šè¿›ç¨‹ä¹‹pcntlæ‰©å±•çš„ä½¿ç”¨</title>
    <url>/2019/01/02/php-pcntl/</url>
    <content><![CDATA[<p>PHPå®ç°å¤šè¿›ç¨‹çš„æ¨¡å—æ˜¯pcntlï¼Œè€Œä¸”åªæœ‰åœ¨linuxä¸‹æ‰ä½¿ç”¨è¿™ä¸ªæ‹“å±•ï¼Œä¸è¿‡ç°åœ¨æœåŠ¡å™¨éƒ½åŸºæœ¬ä½¿ç”¨linuxï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ç”¨èµ·æ¥çš„ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å¯ä»¥ç›´æ¥ä½¿ç”¨<code>pecl install pcntl</code>ï¼Œæˆ–è€…å»<code>https://pecl.php.net/</code>ä¸‹è½½æºç åŒ…æ‰‹åŠ¨ç¼–è¯‘å®‰è£…ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å…ˆä¸¾ä¸ªå®˜æ–¹çš„æ —å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$pid</span> = pcntl_fork();</span><br><span class="line"><span class="comment">//çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä¼šæ‰§è¡Œä¸‹é¢ä»£ç </span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$pid</span> == -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//é”™è¯¯å¤„ç†ï¼šåˆ›å»ºå­è¿›ç¨‹å¤±è´¥æ—¶è¿”å›-1.</span></span><br><span class="line">     <span class="keyword">die</span>(<span class="string">&#x27;could not fork&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$pid</span>) &#123;</span><br><span class="line">     <span class="comment">//çˆ¶è¿›ç¨‹ä¼šå¾—åˆ°å­è¿›ç¨‹å·ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘</span></span><br><span class="line">     pcntl_wait(<span class="variable">$status</span>); <span class="comment">//ç­‰å¾…å­è¿›ç¨‹ä¸­æ–­ï¼Œé˜²æ­¢å­è¿›ç¨‹æˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">//å­è¿›ç¨‹å¾—åˆ°çš„$pidä¸º0, æ‰€ä»¥è¿™é‡Œæ˜¯å­è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åˆ°çš„å‡½æ•°:</p>
<ul>
<li><p><a href="https://secure.php.net/manual/zh/function.pcntl-fork.php">pcntl_fork</a>åœ¨å½“å‰è¿›ç¨‹å½“å‰ä½ç½®äº§ç”Ÿåˆ†æ”¯ï¼ˆå­è¿›ç¨‹ï¼‰ã€‚forkæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ éƒ½ä»forkçš„ä½ç½®å¼€å§‹å‘ä¸‹ç»§ç»­æ‰§è¡Œï¼Œä¸åŒçš„æ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°çš„forkè¿”å›å€¼ä¸ºå­è¿›ç¨‹ å·ï¼Œè€Œå­è¿›ç¨‹å¾—åˆ°çš„æ˜¯0ã€‚</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/function.pcntl-wait.php">pcntl_wait</a> ç­‰å¾…æˆ–è¿”å›forkçš„å­è¿›ç¨‹çŠ¶æ€ã€‚è¿™ä¸ªå‡½æ•°ä¼šæŒ‚èµ·å½“å‰è¿›ç¨‹çš„æ‰§è¡Œç›´åˆ°ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºæˆ–æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·è¦æ±‚ä¸­æ–­å½“å‰è¿›ç¨‹æˆ–è°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªå­è¿›ç¨‹åœ¨è°ƒç”¨æ­¤å‡½æ•°æ—¶å·²ç»é€€å‡ºï¼ˆä¿—ç§°åƒµå°¸è¿›ç¨‹ï¼‰ï¼Œæ­¤å‡½æ•°ç«‹åˆ»è¿”å›ã€‚å­è¿›ç¨‹ä½¿ç”¨çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºå°†è¢«é‡Šæ”¾ã€‚</p>
</li>
</ul>
<p>å†æ¥ä¸ªç»å…¸æ —å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$children</span> = []; <span class="comment">//å®šä¹‰ä¸€ä¸ªæ•°ç»„ç”¨æ¥å­˜å‚¨å­è¿›ç¨‹çš„pid</span></span><br><span class="line"><span class="variable">$m</span> = <span class="number">10</span>;    <span class="comment">//fork 10æ¬¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$x</span> = <span class="number">0</span>; <span class="variable">$x</span> &lt; <span class="variable">$m</span>; <span class="variable">$x</span>++) &#123;</span><br><span class="line">    <span class="variable">$pid</span> = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$pid</span> == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;could not fork &#x27;</span>.<span class="variable">$x</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$pid</span>) &#123;    <span class="comment">//çˆ¶è¿›ç¨‹æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line">        <span class="variable">$children</span>[] = <span class="variable">$pid</span>;</span><br><span class="line">        printf(<span class="string">&quot;Parent get child %d &#x27;s pid: %d\n&quot;</span>, <span class="variable">$x</span>, <span class="variable">$pid</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    <span class="comment">//å­è¿›ç¨‹æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line">        <span class="variable">$my_pid</span> = posix_getpid();    <span class="comment">//å­è¿›ç¨‹è·å–è‡ªå·±çš„pid</span></span><br><span class="line">        <span class="comment">//å­è¿›ç¨‹å¾—åˆ°çš„$pidä¸º0, æ‰€ä»¥è¿™é‡Œæ˜¯å­è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘ã€‚</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Child <span class="subst">$my_pid</span> running...\n&quot;</span>;</span><br><span class="line">        sleep(<span class="number">10</span>);        <span class="comment">//å­è¿›ç¨‹å¹²ç‚¹å•¥ è¿™é‡Œæ˜¯ç¡10ç§’</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;...Child <span class="subst">$my_pid</span> done\n&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);        <span class="comment">//å­è¿›ç¨‹æ‰§è¡Œç»“æŸexit</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(count(<span class="variable">$children</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$children</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$pid</span>) &#123;</span><br><span class="line">        <span class="variable">$res</span> = pcntl_waitpid(<span class="variable">$pid</span>, <span class="variable">$status</span>, WNOHANG);    <span class="comment">//è·å–è¿”å›æŒ‡å®špidçš„è¿”å›çŠ¶æ€åŠ äº†ç¬¬äºŒä¸ªå‚æ•°éé˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$res</span> == -<span class="number">1</span> || <span class="variable">$res</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Parent get child <span class="subst">$pid</span> &#x27;s status: <span class="subst">$status</span>\n&quot;</span>;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="variable">$children</span>[<span class="variable">$key</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1</span>);        <span class="comment">//æ¯ä¸€ç§’å»è½®è¯¢æ²¡æœ‰é€€å‡ºçš„å­è¿›ç¨‹çŠ¶æ€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€”- æœ€åæ›´æ–°äº 2019-03-27 19:04:55</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>pcntl</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨çš„å® å„¿AlpineLinuxçš„åŸºæœ¬ä½¿ç”¨</title>
    <url>/2019/01/17/alpinelinux/</url>
    <content><![CDATA[<p>ç°åœ¨dockerçš„å®¹å™¨æŠ€æœ¯å¾ˆæµè¡Œï¼Œå¯¹äºæˆ‘ä»¬è¿™ç§æ•´å¤©è¢«å„ç§ä¸‡æ¶çš„å¼€å‘ç¯å¢ƒå‘çš„å¼€å‘æ¥è¯´æ˜¯ä¸ªè§£æ”¾ã€‚ä½†æ˜¯å½“æˆ‘ä»¬åœ¨æ‹‰å–dockeré•œåƒçš„æ—¶å€™ï¼Œä¼šå‘ç°æ™®éåŸºäºdebianæˆ–è€…ubuntuçš„é•œåƒéƒ½æ˜¯ä½“ç§¯å¾ˆå¤§ï¼ŒåŠ¨è¾„å‡ åæˆ–è€…ä¸Šç™¾å…†ã€‚å½“ç„¶äº†dockeré•œåƒåœ¨æ„å»ºçš„æ—¶å€™ä¼šåˆ é™¤æ—­ä¸œæ— ç”¨çš„ä¸œè¥¿å¹¶ä¸”ä½¿ç”¨ç²¾ç®€ç³»ç»Ÿæ¨¡æ¿ã€‚å°½ç®¡è¿™æ ·åšè¿˜æ˜¯å¾ˆå¤§ï¼Œèµ·ç ä¹Ÿå¾—æœ‰ä¸ªå‡ åå…†å§ã€‚æ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªæœ¬èº«ä½“ç§¯å°±å°çš„æ“ä½œç³»ç»ŸåšåŸºç¡€æ¨¡æ¿æ¥æ„å»ºæ‰æ˜¯å…³é”®ã€‚AlpineLinuxæ˜¯ä¸€ä¸ªä½¿ç”¨busyboxçš„linuxæ“ä½œç³»ç»Ÿï¼Œè€Œä»–çš„ä½“ç§¯åªéœ€è¦4å…†å¤šã€‚æ‰€ä»¥å¯¹æˆ‘è¿™ç§å–œæ¬¢è½»é‡çº§çš„äººè¿˜è¯´ï¼Œè¿™çœŸæ˜¯å¥½ä¸œè¥¿å•Šï¼</p>
<p>å“ˆå“ˆ~åºŸè¯ä¸å¤šè¯´äº†ï¼Œè¯´è¯´è¿™ä¸ªç³»ç»Ÿçš„åŸºæœ¬ä½¿ç”¨å§</p>
<h2 id="è½¯ä»¶åŒ…ç®¡ç†"><a href="#è½¯ä»¶åŒ…ç®¡ç†" class="headerlink" title="è½¯ä»¶åŒ…ç®¡ç†"></a>è½¯ä»¶åŒ…ç®¡ç†</h2><p>æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apk update</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ„Ÿè§‰ç½‘é€Ÿå¾ˆæ…¢ï¼Œé‚£å¯ä»¥å…ˆæ¢ä¸ªä¸­å›½çš„æº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ä¸­ç§‘å¤§çš„æº é€Ÿåº¦æ æ çš„</span><br><span class="line">sed -i &#x27;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#x27; /etc/apk/repositories</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬ä»¥å®‰è£…nginxä¸ºä¾‹</p>
<p>å®‰è£…è½¯ä»¶åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apk add nginx</span><br></pre></td></tr></table></figure>

<p>å®‰è£…è½¯ä»¶åŒ…åˆ°æœ€æ–°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apk add --update nginx</span><br></pre></td></tr></table></figure>

<p>æŸ¥æ‰¾è½¯ä»¶åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apk search nginx </span><br></pre></td></tr></table></figure>

<p>å¸è½½è½¯ä»¶åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apk del nginx</span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡ç®¡ç†"><a href="#æœåŠ¡ç®¡ç†" class="headerlink" title="æœåŠ¡ç®¡ç†"></a>æœåŠ¡ç®¡ç†</h2><p>å¯åŠ¨Nginx</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/init.d/nginx start</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ nginxåˆ°å¯åŠ¨æœåŠ¡ä¸­ï¼Œä¸‹æ¬¡å¼€æœºè‡ªåŠ¨è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rc-update add nginx</span><br></pre></td></tr></table></figure>

<p>æŠŠnginxä»å¯åŠ¨æœåŠ¡ä¸­ç§»é™¤ï¼Œä¸‹æ¬¡å¼€æœºä¸ä¼šè‡ªåŠ¨è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rc-update del nginx</span><br></pre></td></tr></table></figure>

<h2 id="ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…"><a href="#ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…" class="headerlink" title="ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…"></a>ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…</h2><pre><code>telnet  =&gt;  busybox-extras</code></pre>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>AlpineLinux</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨Rediså®ç°PHPå¼‚æ­¥é˜Ÿåˆ—</title>
    <url>/2019/03/29/php-queue/</url>
    <content><![CDATA[<p>æœ€è¿‘é¡¹ç›®ä¸­ç”¨åˆ°å¥½å¤šç”¨å¼‚æ­¥é˜Ÿåˆ—å¤„ç†çš„åå°ä»»åŠ¡ï¼Œæœ‰äº›å¿ƒå¾—ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p>
<p>ä¸‹é¢å¼•ç”¨ç™¾åº¦ç™¾ç§‘çš„å¯¹<a href="https://baike.baidu.com/item/%E9%98%9F%E5%88%97/14580481">é˜Ÿåˆ—</a>çš„è§£é‡Šï¼š</p>
<blockquote>
<p>é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§è¡¨ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒåªå…è®¸åœ¨è¡¨çš„å‰ç«¯ï¼ˆfrontï¼‰è¿›è¡Œåˆ é™¤æ“ä½œï¼Œè€Œåœ¨è¡¨çš„åç«¯ï¼ˆrearï¼‰è¿›è¡Œæ’å…¥æ“ä½œï¼Œå’Œæ ˆä¸€æ ·ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ç§æ“ä½œå—é™åˆ¶çš„çº¿æ€§è¡¨ã€‚è¿›è¡Œæ’å…¥æ“ä½œçš„ç«¯ç§°ä¸ºé˜Ÿå°¾ï¼Œè¿›è¡Œåˆ é™¤æ“ä½œçš„ç«¯ç§°ä¸ºé˜Ÿå¤´ã€‚<br>ç®€å•ç‚¹è®²å°±æ˜¯ï¼šå…ˆè¿›å…ˆå‡º</p>
</blockquote>
<p>è¦å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªèº«æœåŠ¡å™¨èµ„æºï¼Œå¯é€‰æ•°æ®åº“æˆ–è€…redisæˆ–è€…å…¶ä»–æ›´é«˜çº§çš„é˜Ÿåˆ—èµ„æºæ¥å®ç°ã€‚</p>
<p>ç®€å•å®ç°ï¼Œå¤§æ¦‚ä»£ç æ˜¯è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$items</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;items[<span class="variable">$key</span>]) <span class="keyword">or</span> <span class="keyword">$this</span>-&gt;items[<span class="variable">$key</span>] = [];</span><br><span class="line">        <span class="keyword">return</span> array_push(<span class="keyword">$this</span>-&gt;items[<span class="variable">$key</span>], <span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     * return mixed $value æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pop</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;items[<span class="variable">$key</span>]) <span class="keyword">or</span> <span class="keyword">$this</span>-&gt;items[<span class="variable">$key</span>] = [];</span><br><span class="line">        <span class="keyword">return</span> array_shift(<span class="keyword">$this</span>-&gt;items[<span class="variable">$key</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$queue</span> = <span class="keyword">new</span> Queue();</span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$queue</span>-&gt;pop(<span class="string">&#x27;list_1&#x27;</span>));    <span class="comment">//è¾“å‡º NULL</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$queue</span>-&gt;push(<span class="string">&#x27;list_1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="variable">$queue</span>-&gt;push(<span class="string">&#x27;list_1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="variable">$queue</span>-&gt;push(<span class="string">&#x27;list_1&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$queue</span>-&gt;pop(<span class="string">&#x27;list_1&#x27;</span>));    <span class="comment">//è¾“å‡º string(1) &quot;1&quot;</span></span><br><span class="line">var_dump(<span class="variable">$queue</span>-&gt;pop(<span class="string">&#x27;list_1&#x27;</span>));    <span class="comment">//è¾“å‡º string(1) &quot;2&quot;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªç›´æ¥å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„é˜Ÿåˆ—ï¼Œåªèƒ½åœ¨ä¸€ä¸ªphpç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå­˜å‚¨çš„æ–¹å¼æ”¹æˆåˆ«çš„ï¼Œä¾‹å¦‚æ•°æ®åº“æˆ–è€…redisä»€ä¹ˆçš„ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨redisï¼Œç”¨åˆ°redisçš„æœ‰åºåˆ—è¡¨ï¼ˆlistï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisQueue</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$client</span>;  <span class="comment">//è¿™é‡Œä½¿ç”¨äº†predisè¿™ä¸ªåº“è¿æ¥redis</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">\Predis\Client <span class="variable">$client</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;client = <span class="variable">$client</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;rpush(<span class="variable">$key</span>, <span class="variable">$value</span>);  <span class="comment">//ä»å³è¾¹å…¥é˜Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed $value æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pop</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;lpop(<span class="variable">$key</span>);   <span class="comment">//ä»å·¦è¾¹å–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­æµ‹è¯•ä¸‹ã€‚</p>
<p>å½“ç„¶äº†ï¼Œè¿˜æœ‰å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„é˜Ÿåˆ—è¦å»¶æ—¶å‡ºé˜Ÿï¼Œæˆ‘ä»¬å°±è¦ä½¿ç”¨redisçš„å¦å¤–ä¸¤ç§æ•°æ®ç±»å‹ï¼šæœ‰åºé›†åˆzsetå’Œå“ˆå¸Œhlist</p>
<p>æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisQueue</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$client</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">\Predis\Client <span class="variable">$client</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;client = <span class="variable">$client</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $delay å»¶è¿Ÿå¤šå°‘ç§’</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed $value æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$delay</span> = <span class="literal">null</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(is_null(<span class="variable">$delay</span>))&#123;    <span class="comment">//ä¸ä½¿ç”¨å»¶è¿Ÿçš„æ—¶å€™è¿˜æ˜¯ä½¿ç”¨ä»¥å‰çš„rpushå…¥é˜Ÿ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;rpush(<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$time</span> = time() + <span class="variable">$delay</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$time</span> &gt; time())&#123;     <span class="comment">//è¿˜æœªåˆ°è¯¥å…¥é˜Ÿçš„æ—¶é—´æ—¶</span></span><br><span class="line">            <span class="variable">$hash_key</span> = md5(<span class="keyword">$this</span>-&gt;randString(<span class="number">16</span>).<span class="string">&#x27;_&#x27;</span>.time().<span class="string">&#x27;_&#x27;</span>.<span class="variable">$value</span>);       <span class="comment">//ç”Ÿæˆä¸€ä¸ªå”¯ä¸€key</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;transaction(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$tx</span></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$key</span>, <span class="variable">$time</span>, <span class="variable">$hash_key</span>, <span class="variable">$value</span></span>)</span>&#123;   <span class="comment">//ä½¿ç”¨reidsäº‹åŠ¡</span></span><br><span class="line">                <span class="comment">/** <span class="doctag">@var</span> \Predis\Client $tx */</span></span><br><span class="line">                <span class="variable">$tx</span>-&gt;zadd(<span class="variable">$key</span>.<span class="string">&#x27;:zset&#x27;</span>, [   </span><br><span class="line">                    <span class="variable">$hash_key</span>=&gt;<span class="variable">$time</span>    <span class="comment">//è¿™é‡Œä»¥ç”Ÿæˆçš„å”¯ä¸€keyåš å¯¹è±¡member ä»¥timeåšåˆ†æ•°score</span></span><br><span class="line">                ]);</span><br><span class="line">                <span class="variable">$tx</span>-&gt;hset(<span class="variable">$key</span>.<span class="string">&#x27;:hlist&#x27;</span>, <span class="variable">$hash_key</span>, <span class="variable">$value</span>);    <span class="comment">//å¹¶ä¸”ä¿å­˜å”¯ä¸€keyå’Œå€¼çš„æ˜ å°„</span></span><br><span class="line">                <span class="variable">$tx</span>-&gt;expire(<span class="variable">$key</span>.<span class="string">&#x27;:zset&#x27;</span>, <span class="number">7</span>*<span class="number">86400</span>);     <span class="comment">//æœ‰æ•ˆæœŸ7å¤©</span></span><br><span class="line">                <span class="variable">$tx</span>-&gt;expire(<span class="variable">$key</span>.<span class="string">&#x27;:hlist&#x27;</span>, <span class="number">7</span>*<span class="number">86400</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">receive</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;getLock(<span class="variable">$key</span>.<span class="string">&#x27;:lock&#x27;</span>))&#123;   <span class="comment">//ä½¿ç”¨é”ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">            <span class="variable">$keys</span> = <span class="keyword">$this</span>-&gt;client-&gt;zrangebyscore(<span class="variable">$key</span>.<span class="string">&#x27;:zset&#x27;</span>,<span class="number">0</span>, time());   <span class="comment">//æŒ‰å½“å‰æ—¶é—´å–åˆ†æ•°å°äºç­‰äºå½“å‰æ—¶é—´çš„é›†åˆå…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$keys</span>)) &#123;</span><br><span class="line">                <span class="variable">$message_datas</span> = <span class="keyword">$this</span>-&gt;client-&gt;hmget(<span class="variable">$key</span>.<span class="string">&#x27;:hlist&#x27;</span>, <span class="variable">$keys</span>);    <span class="comment">//é€šè¿‡è¿™äº›keyæ‹¿åˆ°å€¼</span></span><br><span class="line">                <span class="keyword">$this</span>-&gt;client-&gt;transaction(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$tx</span></span>) <span class="keyword">use</span> (<span class="params"><span class="variable">$key</span>, <span class="variable">$keys</span>, <span class="variable">$message_datas</span></span>)</span>&#123; <span class="comment">//ç»§ç»­ä½¿ç”¨redisäº‹åŠ¡ä¿è¯æ•°æ®å®Œæ•´</span></span><br><span class="line">                    <span class="comment">/** <span class="doctag">@var</span> \Predis\Client $tx */</span></span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$message_datas</span> <span class="keyword">as</span> <span class="variable">$i</span> =&gt; <span class="variable">$message_data</span>)&#123;</span><br><span class="line">                        <span class="variable">$tx</span>-&gt;rpush(<span class="variable">$key</span>, <span class="variable">$message_data</span>); <span class="comment">//è¿™æ—¶å€™æ‰æ˜¯çœŸæ­£çš„å…¥é˜Ÿ</span></span><br><span class="line">                        <span class="variable">$hash_key</span> = <span class="variable">$keys</span>[<span class="variable">$i</span>];</span><br><span class="line">                        <span class="variable">$tx</span>-&gt;hdel(<span class="variable">$key</span>.<span class="string">&#x27;:hlist&#x27;</span>, <span class="variable">$hash_key</span>);    <span class="comment">//ä»hashåˆ—è¡¨åˆ é™¤å…ƒç´ </span></span><br><span class="line">                        <span class="variable">$tx</span>-&gt;zrem(<span class="variable">$key</span>.<span class="string">&#x27;:zset&#x27;</span>, <span class="variable">$hash_key</span>); <span class="comment">//ä»é›†åˆåˆ é™¤å…ƒç´ </span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;releaseLock(<span class="variable">$key</span>.<span class="string">&#x27;:lock&#x27;</span>);<span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;lpop(<span class="variable">$key</span>); <span class="comment">//å‡ºé˜Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getLock</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;client-&gt;incr(<span class="variable">$key</span>) != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="variable">$ret</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$ttl</span> = <span class="keyword">$this</span>-&gt;client-&gt;ttl(<span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ttl</span> == -<span class="number">1</span>) &#123;    <span class="comment">//forever</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;client-&gt;expire(<span class="variable">$key</span>, <span class="number">60</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">releaseLock</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;client-&gt;del(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">randString</span>(<span class="params"><span class="variable">$length</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$str</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$strPol</span> = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line">        <span class="variable">$max</span> = strlen(<span class="variable">$strPol</span>) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span> .= <span class="variable">$strPol</span>[mt_rand(<span class="number">0</span>, <span class="variable">$max</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦çœ‹ä¸Šé¢å…¥é˜Ÿï¼ˆpushï¼‰å’Œå‡ºé˜Ÿï¼ˆreceiveï¼‰æ–¹æ³•ï¼Œæˆ‘ä»£ç å†™äº†è¯¦ç»†çš„æ³¨é‡Šã€‚</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Queue</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>ç©è½¬ElasticSearchå…¨æ–‡æœç´¢</title>
    <url>/2019/04/09/elasticsearch/</url>
    <content><![CDATA[<p>ç©è½¬ElasticSearchå…¨æ–‡æœç´¢ï¼Œåšä¸ªç¬”è®°ã€‚</p>
<h2 id="è¿è¡ŒElasticSearchæœåŠ¡"><a href="#è¿è¡ŒElasticSearchæœåŠ¡" class="headerlink" title="è¿è¡ŒElasticSearchæœåŠ¡"></a>è¿è¡ŒElasticSearchæœåŠ¡</h2><p>ä¸ºäº†çœå»ç¹æ‚çš„å®‰è£…ï¼Œè·³è¿‡ä¸‡æ¶çš„ç¯å¢ƒï¼Œæˆ‘ä»¬ä½¿ç”¨Dockerå®¹å™¨æ¥è·‘ElasticSearchçš„æœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨å®˜æ–¹çš„<code>elasticsearch:5.6.16-alpine</code>ä½œä¸ºåŸºç¡€é•œåƒï¼Œå¦å¤–æ·»åŠ ä¸€ä¸ªä¸­æ–‡åˆ†è¯æ’ä»¶<code>elasticsearch-ik</code></p>
<p>æˆ‘ä»¬çš„Dockerfileå†…å®¹å¦‚ä¸‹ï¼Œå¾ˆç®€å•ï¼Œåªéœ€ä¸¤è¡Œå“Ÿï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM elasticsearch:5.6.16-alpine</span><br><span class="line">RUN elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.6.16/elasticsearch-analysis-ik-5.6.16.zip</span><br></pre></td></tr></table></figure>

<p>æ„å»ºé•œåƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker build -t heropoo/elasticsearch-ik .</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå®¹å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; heropoo/elasticsearch-ik</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºElasticSearchæä¾›äº†REST APIï¼Œæˆ‘ä»¬ç›´æ¥å¯ä»¥ç”¨æµè§ˆå™¨è®¿é—® <a href="http://localhost:9200">http://localhost:9200</a> çœ‹çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸ã€‚</p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>Elastic æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå…è®¸å¤šå°æœåŠ¡å™¨ååŒå·¥ä½œï¼Œæ¯å°æœåŠ¡å™¨å¯ä»¥è¿è¡Œå¤šä¸ª Elastic å®ä¾‹ã€‚å•ä¸ª Elastic å®ä¾‹ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ã€‚ä¸€ç»„èŠ‚ç‚¹æ„æˆä¸€ä¸ªé›†ç¾¤ï¼ˆclusterï¼‰ã€‚</p>
<h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h3><p>Elastic ä¼šç´¢å¼•æ‰€æœ‰å­—æ®µï¼Œç»è¿‡å¤„ç†åå†™å…¥ä¸€ä¸ªåå‘ç´¢å¼•ã€‚æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥æŸ¥æ‰¾è¯¥ç´¢å¼•ã€‚æ‰€ä»¥ï¼ŒElastic æ•°æ®ç®¡ç†çš„é¡¶å±‚å•ä½å°±å«åš Indexï¼ˆç´¢å¼•ï¼‰ã€‚</p>
<p>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ Index</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X GET &#x27;http://localhost:9200/_cat/indices?v&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p>Index é‡Œé¢å•æ¡çš„è®°å½•ç§°ä¸º Documentï¼ˆæ–‡æ¡£ï¼‰ã€‚è®¸å¤šæ¡ Document æ„æˆäº†ä¸€ä¸ª Indexã€‚Document ä½¿ç”¨ JSON æ ¼å¼è¡¨ç¤ºã€‚<br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;å¼ ä¸‰&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;æ•°æ®åº“ç®¡ç†&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒä¸€ä¸ª Index é‡Œé¢çš„ Documentï¼Œä¸è¦æ±‚æœ‰ç›¸åŒçš„å­—æ®µç»“æ„ï¼Œä½†æ˜¯æœ€å¥½ä¿æŒç›¸åŒï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æœç´¢æ•ˆç‡ã€‚</p>
<h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3><p>ä¸åŒçš„ Type åº”è¯¥æœ‰ç›¸ä¼¼çš„å­—æ®µç»“æ„ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œidå­—æ®µä¸èƒ½åœ¨è¿™ä¸ªç»„æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨å¦ä¸€ä¸ªç»„æ˜¯æ•°å€¼ã€‚è¿™æ˜¯ä¸å…³ç³»å‹æ•°æ®åº“çš„è¡¨çš„ä¸€ä¸ªåŒºåˆ«ã€‚æ€§è´¨å®Œå…¨ä¸åŒçš„æ•°æ®ï¼ˆæ¯”å¦‚productså’Œlogsï¼‰åº”è¯¥å­˜æˆä¸¤ä¸ª Indexï¼Œè€Œä¸æ˜¯ä¸€ä¸ª Index é‡Œé¢çš„ä¸¤ä¸ª Typeï¼ˆè™½ç„¶å¯ä»¥åšåˆ°ï¼‰ã€‚</p>
<p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åˆ—å‡ºæ¯ä¸ª Index æ‰€åŒ…å«çš„ Type</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl &#x27;localhost:9200/_mapping?pretty=true&#x27;</span><br></pre></td></tr></table></figure>
<p>prettyå‚æ•°æ˜¯ä¼˜åŒ–æ˜¾ç¤ºç»“æœæ˜“äºæŸ¥çœ‹</p>
<h2 id="Indexæ“ä½œ"><a href="#Indexæ“ä½œ" class="headerlink" title="Indexæ“ä½œ"></a>Indexæ“ä½œ</h2><h3 id="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰-Index"><a href="#æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰-Index" class="headerlink" title="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ Index"></a>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ Index</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X GET &#x27;http://localhost:9200/_cat/indices?v&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å»ºIndex"><a href="#æ–°å»ºIndex" class="headerlink" title="æ–°å»ºIndex"></a>æ–°å»ºIndex</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#x27;http://localhost:9200/weather&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤Index"><a href="#åˆ é™¤Index" class="headerlink" title="åˆ é™¤Index"></a>åˆ é™¤Index</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X DELETE &#x27;http://localhost:9200/weather&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å»ºä¸€ä¸ª-Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ"><a href="#æ–°å»ºä¸€ä¸ª-Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ" class="headerlink" title="æ–°å»ºä¸€ä¸ª Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ"></a>æ–°å»ºä¸€ä¸ª Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#x27;localhost:9200/accounts&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;person&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;user&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;title&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;desc&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ªåç§°ä¸ºaccountsçš„ Indexï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåç§°ä¸ºpersonçš„ Typeã€‚personæœ‰ä¸‰ä¸ªå­—æ®µ userã€titleã€desc è¿™ä¸‰ä¸ªå­—æ®µéƒ½æ˜¯ä¸­æ–‡ï¼Œè€Œä¸”ç±»å‹éƒ½æ˜¯æ–‡æœ¬ï¼ˆtextï¼‰ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸­æ–‡åˆ†è¯å™¨ï¼Œä¸èƒ½ä½¿ç”¨é»˜è®¤çš„è‹±æ–‡åˆ†è¯å™¨ã€‚</p>
<h2 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h2><h3 id="æ–°å¢è®°å½•"><a href="#æ–°å¢è®°å½•" class="headerlink" title="æ–°å¢è®°å½•"></a>æ–°å¢è®°å½•</h3><p>å‘æŒ‡å®šçš„ /Index/Type å‘é€ PUT è¯·æ±‚ï¼Œå°±å¯ä»¥åœ¨ Index é‡Œé¢æ–°å¢ä¸€æ¡è®°å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#x27;localhost:9200/accounts/person/1&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;å¼ ä¸‰&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;æ•°æ®åº“ç®¡ç†&quot;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>æ–°å¢è®°å½•çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®š Idï¼Œè¿™æ—¶è¦æ”¹æˆ POST è¯·æ±‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X POST &#x27;localhost:9200/accounts/person&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;æå››&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;è½¯ä»¶å·¥ç¨‹å¸ˆ&quot;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>å…¶å®PUTå°±æ˜¯å­˜åœ¨æ—¶ä¿®æ”¹ï¼Œä¸å­˜åœ¨æ—¶åˆ›å»ºã€‚</p>
<h3 id="æŸ¥çœ‹è®°å½•"><a href="#æŸ¥çœ‹è®°å½•" class="headerlink" title="æŸ¥çœ‹è®°å½•"></a>æŸ¥çœ‹è®°å½•</h3><p>å‘/Index/Type/Idå‘å‡º GET è¯·æ±‚ï¼Œå°±å¯ä»¥æŸ¥çœ‹è¿™æ¡è®°å½•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl &#x27;localhost:9200/accounts/person/1?pretty=true&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤è®°å½•"><a href="#åˆ é™¤è®°å½•" class="headerlink" title="åˆ é™¤è®°å½•"></a>åˆ é™¤è®°å½•</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X DELETE &#x27;localhost:9200/accounts/person/1&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h3><p>å‚è€ƒä¸Šé¢åˆ›å»ºæ“ä½œï¼Œç”¨PUTæ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#x27;localhost:9200/accounts/person/1&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;å¼ ä¸‰1&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ1&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;æ•°æ®åº“ç®¡ç†1&quot;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®æŸ¥è¯¢"><a href="#æ•°æ®æŸ¥è¯¢" class="headerlink" title="æ•°æ®æŸ¥è¯¢"></a>æ•°æ®æŸ¥è¯¢</h2><h3 id="è¿”å›æ‰€æœ‰è®°å½•"><a href="#è¿”å›æ‰€æœ‰è®°å½•" class="headerlink" title="è¿”å›æ‰€æœ‰è®°å½•"></a>è¿”å›æ‰€æœ‰è®°å½•</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl &#x27;localhost:9200/accounts/person/_search&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="å…¨æ–‡æœç´¢"><a href="#å…¨æ–‡æœç´¢" class="headerlink" title="å…¨æ–‡æœç´¢"></a>å…¨æ–‡æœç´¢</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl &#x27;localhost:9200/accounts/person/_search&#x27;  -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;æ•°æ®åº“&quot; &#125;&#125;</span><br><span class="line">&#125;&#x27; </span><br></pre></td></tr></table></figure>

<h3 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h3><p>å¦‚æœæœ‰å¤šä¸ªæœç´¢å…³é”®å­—ï¼Œ Elastic è®¤ä¸ºå®ƒä»¬æ˜¯orå…³ç³»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl &#x27;localhost:9200/accounts/person/_search&#x27;  -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;è½¯ä»¶ ç³»ç»Ÿ&quot; &#125;&#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æ‰§è¡Œå¤šä¸ªå…³é”®è¯çš„andæœç´¢ï¼Œå¿…é¡»ä½¿ç”¨å¸ƒå°”æŸ¥è¯¢</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl &#x27;localhost:9200/accounts/person/_search&#x27;  -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;desc&quot;: &quot;è½¯ä»¶&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;desc&quot;: &quot;ç³»ç»Ÿ&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>æå®š~</p>
<p>å‚è€ƒï¼š<a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html">http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a></p>
]]></content>
      <categories>
        <category>æœç´¢å¼•æ“</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Docker</tag>
        <tag>å…¨æ–‡æœç´¢</tag>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨nginx webé…ç½®</title>
    <url>/2019/05/22/nginx-web-conf/</url>
    <content><![CDATA[<p>å¸¸ç”¨nginxå¯¹äºwebé¡¹ç›®é…ç½®æ•´ç†ï¼Œåšä¸ªç¬”è®°ã€‚</p>
<h2 id="php-webé¡¹ç›®é…ç½®"><a href="#php-webé¡¹ç›®é…ç½®" class="headerlink" title="php webé¡¹ç›®é…ç½®"></a>php webé¡¹ç›®é…ç½®</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line"></span><br><span class="line">  # è®¾ç½®ä¸Šä¼ æœ€å¤§ä¸º5MB</span><br><span class="line">  client_max_body_size 5m;</span><br><span class="line"></span><br><span class="line">  root /srv/www/wechat/public;</span><br><span class="line"></span><br><span class="line">  index index.html index.php;</span><br><span class="line"></span><br><span class="line">  server_name example.com;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    try_files $uri $uri/ =404;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # æ”¯æŒphp</span><br><span class="line">  location ~ \.php$ &#123;</span><br><span class="line">    # Check that the PHP script exists before passing it</span><br><span class="line">    try_files $fastcgi_script_name =404;</span><br><span class="line"></span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line"></span><br><span class="line">    # With php-fpm (or other unix sockets):</span><br><span class="line">    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;</span><br><span class="line">    #  # With php-cgi (or other tcp sockets):</span><br><span class="line">    #  fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">  # concurs with nginx&#x27;s one</span><br><span class="line">  #</span><br><span class="line">  location ~ /\.ht &#123;</span><br><span class="line">    deny all;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="php-webé¡¹ç›®é…ç½®-æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£"><a href="#php-webé¡¹ç›®é…ç½®-æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£" class="headerlink" title="php webé¡¹ç›®é…ç½® æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£"></a>php webé¡¹ç›®é…ç½® æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  location / &#123;</span><br><span class="line">    # First attempt to serve request as file, then</span><br><span class="line">    # as directory, then fall back to displaying a 404.</span><br><span class="line">    #try_files $uri $uri/ =404;  # æ³¨é‡Šä¸Šé¢è¿™å¥ï¼Œä½¿ç”¨ä¸‹é¢è¿™å¥</span><br><span class="line">    try_files $uri $uri/ /index.php?$query_string;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="php-webé¡¹ç›®é…ç½®-æ”¯æŒThinkPHP"><a href="#php-webé¡¹ç›®é…ç½®-æ”¯æŒThinkPHP" class="headerlink" title="php webé¡¹ç›®é…ç½® æ”¯æŒThinkPHP"></a>php webé¡¹ç›®é…ç½® æ”¯æŒThinkPHP</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  location ~ \.php$ &#123;</span><br><span class="line">    # regex to split $uri to $fastcgi_script_name and $fastcgi_path</span><br><span class="line">    fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line"></span><br><span class="line">    # Check that the PHP script exists before passing it</span><br><span class="line">    try_files $fastcgi_script_name =404;</span><br><span class="line"></span><br><span class="line">    # Bypass the fact that try_files resets $fastcgi_path_info</span><br><span class="line">    # see: http://trac.nginx.org/nginx/ticket/321</span><br><span class="line">    set $path_info $fastcgi_path_info;</span><br><span class="line">    fastcgi_param PATH_INFO $path_info;   # ThinkPHPä¾èµ–PATH_INFOè¿™ä¸ªç¯å¢ƒå˜é‡</span><br><span class="line"></span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line"></span><br><span class="line">    # With php-fpm (or other unix sockets):</span><br><span class="line">    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;</span><br><span class="line">    #  # With php-cgi (or other tcp sockets):</span><br><span class="line">    #  fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="php-webé¡¹ç›®é…ç½®-ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶"><a href="#php-webé¡¹ç›®é…ç½®-ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶" class="headerlink" title="php webé¡¹ç›®é…ç½® ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶"></a>php webé¡¹ç›®é…ç½® ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  # è¿™ä¸ªå—locationè¦æ”¾åœ¨ location ~ \.php$ ä¹‹å‰</span><br><span class="line">  location ~ ^/uploads/.*\.php$ &#123;     # æ‰€æœ‰/uploadsæ–‡ä»¶ç›®å½•ä¸‹çš„.phpæ–‡ä»¶éƒ½è¢«ç¦æ­¢è®¿é—®</span><br><span class="line">    #deny all;  # è¿”å›403</span><br><span class="line">    return 404; #è¿”å›404</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºå¤§æ–‡ä»¶ä¸Šä¼ </title>
    <url>/2019/05/23/upload-large-file/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨åšè§†é¢‘ä¸Šä¼ ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ‡ç‰‡ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œåšä¸ªç¬”è®°ã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ul>
<li>ä½¿ç”¨jsè¯»å–formè¡¨å•ä¸­é€‰æ‹©çš„fileï¼Œè®¡ç®—æ–‡ä»¶md5å€¼ï¼Œå¹¶ä¸Šä¼ md5å€¼åˆ°æœåŠ¡ç«¯ï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ä¸Šä¼ è¿‡ï¼ˆç±»ä¼¼ç§’ä¼ åŠŸèƒ½ï¼‰</li>
<li>è‹¥æ–‡ä»¶æœªä¸Šä¼ è¿‡ï¼ŒæŒ‰ç…§å…¶å¤§å°åˆ‡æˆ1MBå¤§å°çš„å—ï¼Œå°äº1MBçš„ä¸ç”¨åˆ‡</li>
<li>ç”¨ajaxå¼‚æ­¥æäº¤åˆ‡å¥½çš„å—ä¸Šä¼ è‡³æœåŠ¡ç«¯ï¼ˆä¸€ä¸ªå—ä¸€ä¸ªè¯·æ±‚ï¼Œä¸é˜»å¡ï¼Œå¤šçº¿ç¨‹ï¼‰</li>
<li>å½“ä¸Šä¼ å®Œæˆæ‰€æœ‰åˆ‡å—ï¼Œå‘èµ·ä¸€ä¸ªåˆå¹¶æ–‡ä»¶çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿›è¡Œå‰é¢ä¸Šä¼ çš„æ–‡ä»¶å—çš„åˆå¹¶ï¼Œåˆå¹¶å®Œæˆå³ä¸Šä¼ å®Œæˆã€‚</li>
</ul>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>jsè®¡ç®—æ–‡ä»¶md5ä½¿ç”¨<a href="https://www.npmjs.com/package/spark-md5">spark-md5.js</a>,æ®è¯´è¿™ä¸ªåº“ä½¿ç”¨çš„æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„md5ç®—æ³•ã€‚</p>
<p>jså¯¹æ–‡ä»¶åˆ‡ç‰‡å¹¶ä½¿ç”¨ajaxä¸Šä¼ åˆ‡ç‰‡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">let</span> size = file.size; <span class="comment">//è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="keyword">const</span> shardSize = <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// å—å¤§å°1MB</span></span><br><span class="line"><span class="keyword">let</span> shardCount = <span class="built_in">Math</span>.ceil(size/shardSize); <span class="comment">//å¯åˆ‡æˆçš„å—æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; shardCount; i++)&#123;</span><br><span class="line">  <span class="keyword">let</span> start = i * shardSize,</span><br><span class="line">      end = <span class="built_in">Math</span>.min(size, start + shardSize);</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> FormData();</span><br><span class="line">  form.append(<span class="string">&#x27;file&#x27;</span>, file.slice(start, end));  <span class="comment">//ç”¨sliceæ–¹æ³•åˆ‡ç‰‡</span></span><br><span class="line">  form.append(<span class="string">&#x27;size&#x27;</span>, end - start);</span><br><span class="line">  form.append(<span class="string">&#x27;name&#x27;</span>, name);</span><br><span class="line">  form.append(<span class="string">&#x27;total&#x27;</span>, shardCount);</span><br><span class="line">  form.append(<span class="string">&#x27;md5&#x27;</span>, file_md5); <span class="comment">//æ–‡ä»¶md5å€¼</span></span><br><span class="line">  form.append(<span class="string">&#x27;index&#x27;</span>, i);  <span class="comment">//ç¬¬å‡ å—</span></span><br><span class="line"></span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;upload.php?type=shard&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: form,</span><br><span class="line">    <span class="comment">// async: false,     //æ˜¯å¦å¼‚æ­¥ä¸Šä¼ ï¼Œé»˜è®¤true</span></span><br><span class="line">    <span class="attr">processData</span>: <span class="literal">false</span>, <span class="comment">//å¾ˆé‡è¦ï¼Œå‘Šè¯‰jqueryä¸è¦å¯¹formè¿›è¡Œå¤„ç†</span></span><br><span class="line">    <span class="attr">contentType</span>: <span class="literal">false</span>, <span class="comment">//å¾ˆé‡è¦ï¼ŒæŒ‡å®šä¸ºfalseæ‰èƒ½å½¢æˆæ­£ç¡®çš„Content-Type</span></span><br><span class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æˆåŠŸå›è°ƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>phpç«¯ä¿å­˜åˆ‡ç‰‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$path</span> = <span class="keyword">__DIR__</span> . <span class="string">&#x27;/uploads&#x27;</span>;</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$total</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;total&#x27;</span>];</span><br><span class="line"><span class="variable">$index</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;index&#x27;</span>];</span><br><span class="line"><span class="variable">$size</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line"><span class="variable">$dst_file</span> = <span class="variable">$path</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$index</span>;  <span class="comment">// åˆ‡ç‰‡æ–‡ä»¶å­˜å‚¨çš„æ–‡ä»¶å </span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> json_encode([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">400</span>, <span class="string">&#x27;msg&#x27;</span>=&gt;<span class="variable">$file</span>[<span class="string">&quot;error&quot;</span>]]);<span class="keyword">die</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$res</span> = move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$dst_file</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$res</span>) &#123;</span><br><span class="line">        file_put_contents(<span class="variable">$dst_file</span> . <span class="string">&#x27;.info&#x27;</span>, <span class="variable">$size</span>);  <span class="comment">// åˆ‡ç‰‡ä¸Šä¼ æˆåŠŸï¼Œå†™ä¸€ä¸ªä¿å­˜å…¶å¤§å°çš„æ–‡ä»¶ï¼Œåç»­åˆå¹¶æ˜¯æ ¡éªŒæ–‡ä»¶ç”¨çš„åˆ°</span></span><br><span class="line">        <span class="keyword">echo</span> json_encode([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">200</span>, <span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;shard ok&#x27;</span>]);<span class="keyword">die</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> json_encode([<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">400</span>, <span class="string">&#x27;msg&#x27;</span>=&gt;<span class="string">&#x27;shard move_uploaded_file error&#x27;</span>]);<span class="keyword">die</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>phpç«¯åˆå¹¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeFile</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$total</span>, &amp;<span class="variable">$msg</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ ¡éªŒåˆ‡ç‰‡æ–‡ä»¶æ˜¯å¦éƒ½ä¸Šä¼ å®Œæˆï¼Œæ˜¯å¦å®Œæ•´</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$total</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">        <span class="keyword">if</span> (!file_exists(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span> . <span class="string">&#x27;.info&#x27;</span>) || !file_exists(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span>)) &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;shard error <span class="subst">$i</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (filesize(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span>) != file_get_contents(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span> . <span class="string">&#x27;.info&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;shard size error <span class="subst">$i</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @unlink(<span class="variable">$name</span>);</span><br><span class="line">    <span class="keyword">if</span> (file_exists(<span class="variable">$name</span> . <span class="string">&#x27;.lock&#x27;</span>)) &#123;   <span class="comment">//åŠ é” é˜²æ­¢æœ‰å…¶ä»–è¿›ç¨‹å†™æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶æŸå</span></span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;on lock&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    touch(<span class="variable">$name</span> . <span class="string">&#x27;.lock&#x27;</span>);</span><br><span class="line">    <span class="variable">$file</span> = fopen(<span class="variable">$name</span>, <span class="string">&#x27;a+&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$total</span>; <span class="variable">$i</span>++) &#123;   <span class="comment">//æŒ‰åˆ‡ç‰‡é¡ºåºå†™å…¥æ–‡ä»¶</span></span><br><span class="line">        <span class="variable">$shardFile</span> = fopen(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="variable">$shardData</span> = fread(<span class="variable">$shardFile</span>, filesize(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span>));</span><br><span class="line">        fwrite(<span class="variable">$file</span>, <span class="variable">$shardData</span>);</span><br><span class="line">        fclose(<span class="variable">$shardFile</span>);</span><br><span class="line">        unlink(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span>); </span><br><span class="line">        unlink(<span class="variable">$name</span> . <span class="string">&#x27;-&#x27;</span> . <span class="variable">$total</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$i</span> . <span class="string">&#x27;.info&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(<span class="variable">$file</span>);</span><br><span class="line">    unlink(<span class="variable">$name</span> . <span class="string">&#x27;.lock&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä¹Ÿå†™å¥½äº†ä¸€ä¸ªdemoï¼Œ<a href="https://github.com/heropoo/just-code/tree/master/upload-large-file">ä¼ é€é—¨</a></p>
<p>ä¸‹é¢æ˜¯è¿™ä¸ªdemoçš„æ•ˆæœå›¾ï¼š</p>
<p><img src="/assets/images/WX20190523-103939.png" alt="pic-0"><br><img src="/assets/images/WX20190523-104043.png" alt="pic-1"></p>
<p>è¿™ä¸ªdemoæœ‰äº›æ–¹é¢è¿˜ä¸å¤Ÿå®Œå–„ï¼Œåç»­æŒç»­å®Œå–„å§ï½</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>JavaScript</tag>
        <tag>HTML5</tag>
        <tag>AJAX</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨ç½‘é¡µä¸Šä½¿ç”¨MathJaxæ¸²æŸ“LaTexæ ¼å¼æ•°å­¦å…¬å¼</title>
    <url>/2019/05/27/math-jax/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨çœ‹ä¸€äº›æœºå™¨å­¦ä¹ ç®—æ³•çš„ä¸œè¥¿ï¼Œç”¨åˆ°å¥½å¤šæ•°å­¦å…¬å¼ï¼Œå‘ç°æœ‰ä¸ªå¾ˆå¼ºå¤§çš„jsåº“å¯ä»¥å®Œç¾çš„æ¸²æŸ“LaTexæ ¼å¼æ•°å­¦å…¬å¼ï¼Œå€¼å¾—æ¨èä¸‹ã€‚</p>
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<h2 id="ä½¿ç”¨æ–¹æ³•ï¼š"><a href="#ä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a>ä½¿ç”¨æ–¹æ³•ï¼š</h2><p>åœ¨ä½ çš„htmlæ¨¡ç‰ˆä¸­å¼•å…¥è¿™ä¸ªjs</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>å†™å‡ ä¸ªå…¬å¼æµ‹è¯•ä¸‹ï¼š</p>
<p>è´¨èƒ½æ–¹ç¨‹æ˜¯$$E=mc^2$$</p>
<p>ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$E=mc^2$$</span><br></pre></td></tr></table></figure>

<p>k-meansç®—æ³•çš„ä»£ä»·å‡½æ•°:<br>$$J(c,\mu )=\sum_{i=1}^{k}\left | x^{(i)}-\mu _{c^{(i)}} \right |^{2}$$</p>
<p>ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$J(c,\mu )=\sum_&#123;i=1&#125;^&#123;k&#125;\left \| x^&#123;(i)&#125;-\mu _&#123;c^&#123;(i)&#125;&#125; \right \|^&#123;2&#125;$$</span><br></pre></td></tr></table></figure>

<p>æ„Ÿå—æ•ˆæœè¿˜å¯ä»¥ğŸ˜‰ğŸ˜›ğŸ˜›</p>
<p>å†é™„é€ä¸€ä¸ªåœ¨çº¿çš„å…¬å¼ç¼–è¾‘å™¨<a href="https://www.codecogs.com/latex/eqneditor.php">https://www.codecogs.com/latex/eqneditor.php</a></p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ•°å­¦</tag>
        <tag>MathJax</tag>
        <tag>LaTex</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè½¯è¿æ¥å’Œç¡¬é“¾æ¥</title>
    <url>/2019/05/29/linux-symbolic-link/</url>
    <content><![CDATA[<p>Linuxè½¯è¿æ¥å’Œç¡¬é“¾æ¥ï¼Œä¸€ä¸ªç»å¸¸å‚»å‚»åˆ†ä¸æ¸…æ¥šçš„æ¦‚å¿µï¼Œç°åœ¨æˆ‘ä»¬ä»”ç»†ç†ä¸€ç†ã€‚</p>
<h3 id="1-Linuxé“¾æ¥æ¦‚å¿µ"><a href="#1-Linuxé“¾æ¥æ¦‚å¿µ" class="headerlink" title="1.Linuxé“¾æ¥æ¦‚å¿µ"></a>1.Linuxé“¾æ¥æ¦‚å¿µ</h3><p>Linuxé“¾æ¥åˆ†ä¸¤ç§ï¼Œä¸€ç§è¢«ç§°ä¸ºç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰ï¼Œå¦ä¸€ç§è¢«ç§°ä¸ºç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œlnå‘½ä»¤äº§ç”Ÿç¡¬é“¾æ¥ã€‚</p>
<ul>
<li>ã€ç¡¬è¿æ¥ã€‘</li>
</ul>
<p>ç¡¬è¿æ¥æŒ‡é€šè¿‡ç´¢å¼•èŠ‚ç‚¹æ¥è¿›è¡Œè¿æ¥ã€‚åœ¨Linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜åœ¨ç£ç›˜åˆ†åŒºä¸­çš„æ–‡ä»¶ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹éƒ½ç»™å®ƒåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹å·(Inode Index)ã€‚åœ¨Linuxä¸­ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹æ˜¯å­˜åœ¨çš„ã€‚ä¸€èˆ¬è¿™ç§è¿æ¥å°±æ˜¯ç¡¬è¿æ¥ã€‚ç¡¬è¿æ¥çš„ä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªæœ‰æ•ˆè·¯å¾„åï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å»ºç«‹ç¡¬è¿æ¥åˆ°é‡è¦æ–‡ä»¶ï¼Œä»¥é˜²æ­¢â€œè¯¯åˆ â€çš„åŠŸèƒ½ã€‚å…¶åŸå› å¦‚ä¸Šæ‰€è¿°ï¼Œå› ä¸ºå¯¹åº”è¯¥ç›®å½•çš„ç´¢å¼•èŠ‚ç‚¹æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¿æ¥ã€‚åªåˆ é™¤ä¸€ä¸ªè¿æ¥å¹¶ä¸å½±å“ç´¢å¼•èŠ‚ç‚¹æœ¬èº«å’Œå…¶å®ƒçš„è¿æ¥ï¼Œåªæœ‰å½“æœ€åä¸€ä¸ªè¿æ¥è¢«åˆ é™¤åï¼Œæ–‡ä»¶çš„æ•°æ®å—åŠç›®å½•çš„è¿æ¥æ‰ä¼šè¢«é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡ä»¶çœŸæ­£åˆ é™¤çš„æ¡ä»¶æ˜¯ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ç¡¬è¿æ¥æ–‡ä»¶å‡è¢«åˆ é™¤ã€‚</p>
<ul>
<li>ã€è½¯è¿æ¥ã€‘</li>
</ul>
<p>å¦å¤–ä¸€ç§è¿æ¥ç§°ä¹‹ä¸ºç¬¦å·è¿æ¥ï¼ˆSymbolic Linkï¼‰ï¼Œä¹Ÿå«è½¯è¿æ¥ã€‚è½¯é“¾æ¥æ–‡ä»¶æœ‰ç±»ä¼¼äºWindowsçš„å¿«æ·æ–¹å¼ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ã€‚åœ¨ç¬¦å·è¿æ¥ä¸­ï¼Œæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«çš„æœ‰å¦ä¸€æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ã€‚</p>
<h3 id="2-é€šè¿‡å®éªŒåŠ æ·±ç†è§£"><a href="#2-é€šè¿‡å®éªŒåŠ æ·±ç†è§£" class="headerlink" title="2.é€šè¿‡å®éªŒåŠ æ·±ç†è§£"></a>2.é€šè¿‡å®éªŒåŠ æ·±ç†è§£</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@Linux]$ touch f1 <span class="comment">#åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶f1</span></span><br><span class="line">[root@Linux]$ ln f1 f2 <span class="comment">#åˆ›å»ºf1çš„ä¸€ä¸ªç¡¬è¿æ¥æ–‡ä»¶f2</span></span><br><span class="line">[root@Linux]$ ln -s f1 f3 <span class="comment">#åˆ›å»ºf1çš„ä¸€ä¸ªç¬¦å·è¿æ¥æ–‡ä»¶f3</span></span><br><span class="line">[root@Linux]$ ls -li <span class="comment"># -iå‚æ•°æ˜¾ç¤ºæ–‡ä»¶çš„inodeèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">total 0</span><br><span class="line">9797648 -rw-r--r-- 2 root root 0 Apr 21 08:11 f1</span><br><span class="line">9797648 -rw-r--r-- 2 root root 0 Apr 21 08:11 f2</span><br><span class="line">9797649 lrwxrwxrwx 1 root root 2 Apr 21 08:11 f3 -&gt; f1</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œç¡¬è¿æ¥æ–‡ä»¶f2ä¸åŸæ–‡ä»¶f1çš„inodeèŠ‚ç‚¹ç›¸åŒï¼Œå‡ä¸º9797648ï¼Œç„¶è€Œç¬¦å·è¿æ¥æ–‡ä»¶çš„inodeèŠ‚ç‚¹ä¸åŒã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@Linux]$ <span class="built_in">echo</span> <span class="string">&quot;I am f1 file&quot;</span> &gt;&gt;f1</span><br><span class="line">[root@Linux]$ cat f1</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ cat f2</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ cat f3</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ rm -f f1</span><br><span class="line">[root@Linux]$ cat f2</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ cat f3</span><br><span class="line">cat: f3: No such file or directory</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„æµ‹è¯•å¯ä»¥çœ‹å‡ºï¼šå½“åˆ é™¤åŸå§‹æ–‡ä»¶f1åï¼Œç¡¬è¿æ¥f2ä¸å—å½±å“ï¼Œä½†æ˜¯ç¬¦å·è¿æ¥f1æ–‡ä»¶æ— æ•ˆã€‚</p>
<h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3.æ€»ç»“"></a>3.æ€»ç»“</h3><p>ä¾æ­¤æ‚¨å¯ä»¥åšä¸€äº›ç›¸å…³çš„æµ‹è¯•ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å…¨éƒ¨ç»“è®ºï¼š</p>
<ul>
<li><p>1).åˆ é™¤ç¬¦å·è¿æ¥f3,å¯¹f1,f2æ— å½±å“ï¼›</p>
</li>
<li><p>2).åˆ é™¤ç¡¬è¿æ¥f2ï¼Œå¯¹f1,f3ä¹Ÿæ— å½±å“ï¼›</p>
</li>
<li><p>3).åˆ é™¤åŸæ–‡ä»¶f1ï¼Œå¯¹ç¡¬è¿æ¥f2æ²¡æœ‰å½±å“ï¼Œå¯¼è‡´ç¬¦å·è¿æ¥f3å¤±æ•ˆï¼›</p>
</li>
<li><p>4).åŒæ—¶åˆ é™¤åŸæ–‡ä»¶f1,ç¡¬è¿æ¥f2ï¼Œæ•´ä¸ªæ–‡ä»¶ä¼šçœŸæ­£çš„è¢«åˆ é™¤ã€‚</p>
</li>
</ul>
<p>æœ¬æ–‡æ‘˜è‡ªäº’è”ç½‘ï¼Œä¾µåˆ ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLæƒé™ç®¡ç†</title>
    <url>/2019/06/10/mysql-user/</url>
    <content><![CDATA[<p>MySQLä¸­çš„è´¦å·ä¸æƒé™ç®¡ç†</p>
<h3 id="æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†"><a href="#æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†" class="headerlink" title="æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†"></a>æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†</h3><p>MySQLæƒé™ç³»ç»Ÿé€šè¿‡ä¸‹é¢ä¸¤ä¸ªé˜¶æ®µè¿›è¡Œè®¤è¯ï¼š</p>
<ol>
<li>å¯¹è¿æ¥çš„ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ï¼Œåˆæ³•çš„ç”¨æˆ·é€šè¿‡è®¤è¯ã€ä¸åˆæ³•çš„ç”¨æˆ·æ‹’ç»è¿æ¥ã€‚</li>
<li>å¯¹é€šè¿‡è®¤è¯çš„åˆæ³•ç”¨æˆ·èµ‹äºˆç›¸åº”çš„æƒé™ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™äº›æƒé™èŒƒå›´å†…å¯¹æ•°æ®åº“åšç›¸åº”çš„æ“ä½œã€‚</li>
</ol>
<p>å¯¹äºèº«ä»½ï¼ŒMySQLæ˜¯é€šè¿‡<code>IPåœ°å€</code>å’Œ<code>ç”¨æˆ·å</code>è”åˆè¿›è¡Œç¡®è®¤çš„ï¼Œä¾‹å¦‚MySQLå®‰è£…é»˜è®¤åˆ›å»ºçš„ç”¨æˆ·<code>root@localhost</code>è¡¨ç¤ºç”¨æˆ·rootåªèƒ½ä»æœ¬åœ°ï¼ˆlocalhostï¼‰è¿›è¡Œè¿æ¥æ‰å¯ä»¥é€šè¿‡è®¤è¯ï¼Œæ­¤ç”¨æˆ·ä»å…¶ä»–ä»»ä½•ä¸»æœºå¯¹æ•°æ®åº“è¿›è¡Œçš„è¿æ¥éƒ½å°†è¢«æ‹’ç»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ ·çš„ä¸€ä¸ªç”¨æˆ·åï¼Œå¦‚æœæ¥è‡ªä¸åŒçš„IPåœ°å€ï¼Œåˆ™MySQLå°†å…¶è§†ä¸ºä¸åŒçš„ç”¨æˆ·ã€‚</p>
<p>MySQLçš„æƒé™è¡¨åœ¨æ•°æ®åº“å¯åŠ¨åœ°æ—¶å€™å°±è½½å…¥å†…å­˜ï¼Œå½“ç”¨æˆ·é€šè¿‡èº«ä»½è®¤è¯åï¼Œå°±åœ¨å†…å­˜ä¸­è¿›è¡Œç›¸åº”æƒé™çš„å­˜å–ï¼Œè¿™æ ·ï¼Œæ­¤ç”¨æˆ·å°±å¯ä»¥åœ¨æ•°æ®åº“ä¸­åšæƒé™èŒƒå›´å†…çš„å„ç§æ“ä½œäº†ã€‚</p>
<h3 id="æƒé™è¡¨"><a href="#æƒé™è¡¨" class="headerlink" title="æƒé™è¡¨"></a>æƒé™è¡¨</h3><p>ç³»ç»Ÿä¼šç”¨åˆ°åå«â€œmysqlâ€æ•°æ®åº“ï¼ˆå®‰è£…MySQLæ—¶è¢«åˆ›å»ºï¼‰ä¸­userè¡¨ä½œä¸ºæƒé™è¡¨</p>
<p>æˆ‘ä»¬çœ‹çœ‹userè¡¨çš„ç»“æ„ï¼ˆæ³¨ï¼šæœ¬æ–‡ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯MySQL5.7.25ç‰ˆæœ¬ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; desc user;</span><br><span class="line">+------------------------+-----------------------------------+------+-----+-----------------------+-------+</span><br><span class="line">| Field                  | Type                              | Null | Key | Default               | Extra |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+-----------------------+-------+</span><br><span class="line">| Host                   | char(60)                          | NO   | PRI |                       |       |</span><br><span class="line">| User                   | char(32)                          | NO   | PRI |                       |       |</span><br><span class="line">| Select_priv            | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Insert_priv            | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Update_priv            | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Delete_priv            | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_priv            | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Drop_priv              | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Reload_priv            | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Shutdown_priv          | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Process_priv           | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| File_priv              | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Grant_priv             | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| References_priv        | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Index_priv             | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Alter_priv             | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Show_db_priv           | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Super_priv             | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_tmp_table_priv  | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Lock_tables_priv       | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Execute_priv           | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Repl_slave_priv        | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Repl_client_priv       | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_view_priv       | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Show_view_priv         | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_routine_priv    | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Alter_routine_priv     | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_user_priv       | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Event_priv             | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Trigger_priv           | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_tablespace_priv | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| ssl_type               | enum(&#x27;&#x27;,&#x27;ANY&#x27;,&#x27;X509&#x27;,&#x27;SPECIFIED&#x27;) | NO   |     |                       |       |</span><br><span class="line">| ssl_cipher             | blob                              | NO   |     | NULL                  |       |</span><br><span class="line">| x509_issuer            | blob                              | NO   |     | NULL                  |       |</span><br><span class="line">| x509_subject           | blob                              | NO   |     | NULL                  |       |</span><br><span class="line">| max_questions          | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| max_updates            | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| max_connections        | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| max_user_connections   | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| plugin                 | char(64)                          | NO   |     | mysql_native_password |       |</span><br><span class="line">| authentication_string  | text                              | YES  |     | NULL                  |       |</span><br><span class="line">| password_expired       | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">| password_last_changed  | timestamp                         | YES  |     | NULL                  |       |</span><br><span class="line">| password_lifetime      | smallint(5) unsigned              | YES  |     | NULL                  |       |</span><br><span class="line">| account_locked         | enum(&#x27;N&#x27;,&#x27;Y&#x27;)                     | NO   |     | N                     |       |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+-----------------------+-------+</span><br><span class="line">45 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>å½“ç”¨æˆ·è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼Œæƒé™è¡¨çš„å­˜å–è¿‡ç¨‹æœ‰ä»¥ä¸‹ç°ä¸ªé˜¶æ®µã€‚</p>
<ul>
<li>å…ˆä»userè¡¨ä¸­çš„<code>Host</code>ã€<code>User</code>ã€<code>authentication_string</code>(å¯†ç )ã€<code>password_expired</code>å’Œ<code>password_lifetime</code>è¿™å‡ ä¸ªå­—æ®µä¸­åˆ¤æ–­è¿æ¥çš„IPã€ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦å­˜åœ¨äºè¡¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™é€šè¿‡èº«ä»½éªŒè¯ï¼Œå¦åˆ™æ‹’ç»è¿æ¥ã€‚</li>
<li>å¦‚æœéªŒè¯é€šè¿‡ï¼Œå†é€šè¿‡ä»¥<code>_priv</code>ç»“å°¾çš„é‚£äº›æšä¸¾å­—æ®µï¼ˆè¿™äº›éƒ½æ˜¯ç”¨æˆ·çš„æƒé™å¼€å…³ï¼ˆY/Nï¼‰ï¼‰å¾—åˆ°ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ã€‚</li>
</ul>
<h3 id="è´¦å·ç®¡ç†"><a href="#è´¦å·ç®¡ç†" class="headerlink" title="è´¦å·ç®¡ç†"></a>è´¦å·ç®¡ç†</h3><p>è´¦å·ç®¡ç†ä¸»è¦åŒ…æ‹¬è´¦å·çš„åˆ›å»ºã€æƒé™æ›´æ”¹å’Œè´¦å·çš„åˆ é™¤ã€‚ç”¨æˆ·è¿æ¥æ•°æ®åº“çš„ç¬¬ä¸€æ­¥éƒ½ä»è´¦å·åˆ›å»ºå¼€å§‹ã€‚</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç”¨æ¥åˆ›å»ºè´¦å·ï¼šä½¿ç”¨<code>GRANT</code>è¯­æ³•åˆ›å»ºæˆ–è€…ç›´æ¥æ“ä½œæˆæƒè¡¨ï¼Œä½†æ›´æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå› ä¸ºæ“ä½œç®€å•ï¼Œå‡ºé”™å‡ ç‡æ›´å°‘ã€‚</p>
<p>æˆ‘ä»¬ç”¨å‡ ä¸ªä¾‹å­æ¥è¯´æ˜å§ï¼š</p>
<ol>
<li><p>åˆ›å»ºç”¨æˆ·</p>
<p> åˆ›å»ºç”¨æˆ·tomï¼Œæƒé™ä¸ºå¯ä»¥åœ¨æ‰€æœ‰æ•°æ®åº“ä¸Šæ‰§è¡Œæ‰€æœ‰æƒé™ï¼Œåªèƒ½ä»æœ¬åœ°è¿›è¡Œè¿æ¥ã€‚</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO tom@localhost IDENTIFIED BY &#x27;tompassword&#x27; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>
<p> å¦‚æœä½ æ‰§è¡Œè¿™ä¸ªè¯­å¥ç¢°åˆ°ä»¥ä¸‹é”™è¯¯ï¼š<code>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</code>ã€‚è¿™ä¸ªæ˜¯å¯†ç ç­–ç•¥çš„é—®é¢˜ï¼Œè¯·è®¾ç½®æ¯”è¾ƒå¤æ‚çš„å¯†ç ï¼Œæˆ–è€…ä¿®æ”¹å¯†ç ç­–ç•¥ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†è¯´äº†ã€‚</p>
<p> GRANTå‘½ä»¤è¯´æ˜ï¼š</p>
<blockquote>
<p><code>ALL PRIVILEGES</code>æ˜¯è¡¨ç¤ºæ‰€æœ‰æƒé™ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨selectã€updateç­‰æƒé™ã€‚</p>
</blockquote>
<blockquote>
<p><code>ON</code>ç”¨æ¥æŒ‡å®šæƒé™é’ˆå¯¹å“ªäº›åº“å’Œè¡¨ï¼Œæ ¼å¼æ˜¯<code>æ•°æ®åº“å.è¡¨å</code>ï¼Œè¿™é‡Œ<code>*.*</code>è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“å’Œæ‰€æœ‰è¡¨ã€‚</p>
</blockquote>
<blockquote>
<p><code>TO</code> è¡¨ç¤ºå°†æƒé™èµ‹äºˆæŸä¸ªç”¨æˆ·ã€‚<code>tom@localhost</code>ï¼Œè¡¨ç¤º<code>tom</code>ç”¨æˆ·ï¼Œ<code>@</code>åé¢æ¥é™åˆ¶çš„ä¸»æœºï¼Œå¯ä»¥æ˜¯<code>IP</code>ã€<code>IPæ®µ</code>ã€<code>åŸŸå</code>ä»¥åŠ<code>%</code>ï¼Œ<code>%</code>è¡¨ç¤ºä»»ä½•åœ°æ–¹ã€‚æ³¨æ„ï¼šè¿™é‡Œ%æœ‰çš„ç‰ˆæœ¬ä¸åŒ…æ‹¬æœ¬åœ°ï¼Œä»¥å‰ç¢°åˆ°è¿‡ç»™æŸä¸ªç”¨æˆ·è®¾ç½®äº†%å…è®¸ä»»ä½•åœ°æ–¹ç™»å½•ï¼Œä½†æ˜¯åœ¨æœ¬åœ°ç™»å½•ä¸äº†ï¼Œè¿™ä¸ªå’Œç‰ˆæœ¬æœ‰å…³ç³»ï¼Œé‡åˆ°è¿™ä¸ªé—®é¢˜å†åŠ ä¸€ä¸ªlocalhostçš„ç”¨æˆ·å°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<blockquote>
<p><code>IDENTIFIED BY</code> æŒ‡å®šç”¨æˆ·çš„ç™»å½•å¯†ç ï¼Œ è¿™é‡Œ<code>&#39;tompassword&#39;</code>å°±æ˜¯ç”¨æˆ·tomçš„å¯†ç ã€‚</p>
</blockquote>
<blockquote>
<p><code>WITH GRANT OPTION</code> è¿™ä¸ªé€‰é¡¹è¡¨ç¤ºè¯¥ç”¨æˆ·å¯ä»¥å°†è‡ªå·±æ‹¥æœ‰çš„æƒé™æˆæƒç»™åˆ«äººã€‚æ³¨æ„ï¼šç»å¸¸æœ‰äººåœ¨åˆ›å»ºæ“ä½œç”¨æˆ·çš„æ—¶å€™ä¸æŒ‡å®šWITH GRANT OPTIONé€‰é¡¹å¯¼è‡´åæ¥è¯¥ç”¨æˆ·ä¸èƒ½ä½¿ç”¨GRANTå‘½ä»¤åˆ›å»ºç”¨æˆ·æˆ–è€…ç»™å…¶å®ƒç”¨æˆ·æˆæƒã€‚</p>
</blockquote>
<p> å¤‡æ³¨ï¼šå¯ä»¥ä½¿ç”¨<code>GRANT</code>é‡å¤ç»™ç”¨æˆ·æ·»åŠ æƒé™ï¼Œæƒé™å åŠ ï¼Œæ¯”å¦‚ä½ å…ˆç»™ç”¨æˆ·æ·»åŠ ä¸€ä¸ªselectæƒé™ï¼Œç„¶ååˆç»™ç”¨æˆ·æ·»åŠ ä¸€ä¸ªinsertæƒé™ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å°±åŒæ—¶æ‹¥æœ‰äº†selectå’Œinsertæƒé™ã€‚</p>
<p> ä½¿ç”¨<code>GRANT</code>æ“ä½œç”¨æˆ·æƒé™ä¹‹åï¼Œå†ä½¿ç”¨<code>FLUSH PRIVILEGES</code>å‘½ä»¤æ¥åˆ·æ–°æƒé™ä½¿å…¶ç«‹å³ç”Ÿæ•ˆ</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ç”¨æˆ·çš„æƒé™</p>
<p> ç›´æ¥ä½¿ç”¨<code>SHOW GRANTS</code>é»˜è®¤æŸ¥çœ‹<code>root@localhost</code>çš„æƒé™</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW GRANTS;</span><br><span class="line">+---------------------------------------------------------------------+</span><br><span class="line">| Grants for root@localhost                                           |</span><br><span class="line">+---------------------------------------------------------------------+</span><br><span class="line">| GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;localhost&#x27; WITH GRANT OPTION |</span><br><span class="line">| GRANT PROXY ON &#x27;&#x27;@&#x27;&#x27; TO &#x27;root&#x27;@&#x27;localhost&#x27; WITH GRANT OPTION        |</span><br><span class="line">+---------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p> æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æƒé™</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW GRANTS FOR tom@localhost;</span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line">| Grants for tom@localhost                                           |</span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line">| GRANT ALL PRIVILEGES ON *.* TO &#x27;tom&#x27;@&#x27;localhost&#x27; WITH GRANT OPTION |</span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ”¶å›æƒé™</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; REVOKE DELETE ON *.* FROM &#x27;tom&#x27;@&#x27;localhost&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹ç”¨æˆ·è´¦æˆ·é‡å‘½å</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; RENAME USER tom@localhost to jerry@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ é™¤ç”¨æˆ·</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; DROP USER jerry@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹å’Œé‡ç½®å¯†ç </p>
<ul>
<li><p>ç”¨<code>SET PASSWORD</code>å‘½ä»¤ä¿®æ”¹å¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET PASSWORD FOR root@localhost = PASSWORD(&#x27;123456&#x27;);</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç›´æ¥ä¿®æ”¹userè¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE user SET authentication_string=PASSWORD(&#x27;123456root&#x27;) WHERE user=&#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 1</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨æœªç™»å½•mysqlçš„æƒ…å†µä¸‹ç”¨mysqladminå‘½ä»¤ä¿®æ”¹å¯†ç </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mysqladmin -uroot -p123456root password 123321</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ä¸¢å¤±rootå¯†ç çš„æ—¶å€™<br>å…³é—­mysqlæœåŠ¡ï¼ˆæ ¹æ®ä½ è‡ªå·±çš„æ“ä½œç³»ç»Ÿè‡ªè¡Œå…³é—­ï¼‰ï¼Œç„¶åè·³è¿‡æƒé™è®¤è¯å¯åŠ¨mysqlæœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mysqld_safe --skip-grant-tables &amp;   </span><br></pre></td></tr></table></figure>

<p>æ— å¯†ç ç™»é™†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ mysql -uroot</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ä¹‹åä½¿ç”¨ä¸Šé¢ç›´æ¥ä¿®æ”¹userè¡¨çš„æ–¹æ³•ä¿®æ”¹rootç”¨æˆ·çš„å¯†ç </p>
<p>æœ€åæ€æ‰<code>mysqld_safe</code>å’Œ<code>mysqld</code>çš„è¿›ç¨‹</p>
<p>é‡æ–°å¯åŠ¨mysqlæœåŠ¡ï¼Œç”¨æ–°çš„å¯†ç ç™»é™†å§ã€‚</p>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜³å…‰æ˜åªšï¼Œæ—¶å…‰é™å¥½</title>
    <url>/2019/06/14/good-morning/</url>
    <content><![CDATA[<p>èµ·äº†ä¸ªè€æ—©ï¼Œå»ç»ƒè½¦ï¼Œæœ¬æ¥ç¡ä¸å¥½ï¼Œè¿˜æœ‰ç‚¹æƒ…ç»ªï¼Œåœ¨ä¸‹è½¦è¿‡æ¡¥æ—¶çªç„¶å‘ç°æ—©ä¸Šçš„é˜³å…‰æ ¼å¤–çš„å¥½ã€‚</p>
<p><img src="/assets/images/20190619210216.jpg" alt="example-pic"></p>
<p><img src="/assets/images/20190619210339.jpg" alt="example-pic"></p>
<p><img src="/assets/images/20190619210745.jpg" alt="example-pic"></p>
]]></content>
      <categories>
        <category>å²æœˆé™å¥½</category>
      </categories>
      <tags>
        <tag>å²æœˆé™å¥½</tag>
      </tags>
  </entry>
  <entry>
    <title>SSHä½¿ç”¨å¯†ç è‡ªåŠ¨ç™»å½•è„šæœ¬</title>
    <url>/2019/08/28/ssh-autologin/</url>
    <content><![CDATA[<p>åˆ†äº«ä¸€ä¸ªsshä½¿ç”¨å¯†ç ç™»å½•çš„è„šæœ¬</p>
<p>å†™ä¸ªè„šæœ¬<code>autologin.sh</code>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> host [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> password [lindex <span class="variable">$argv</span> 2]</span><br><span class="line"><span class="built_in">set</span> timeout -1</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$host</span></span><br><span class="line">expect <span class="string">&quot;password:*&quot;</span></span><br><span class="line">send <span class="string">&quot;<span class="variable">$password</span>\r&quot;</span></span><br><span class="line">interact</span><br><span class="line">expect eof</span><br></pre></td></tr></table></figure>

<p>å¹¶ç»™è¿™ä¸ªè„šæœ¬å¯æ‰§è¡Œæƒé™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chmod +x ./autologin.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨æ–¹æ³•ï¼š<br>å‡å¦‚å¹³æ—¶ä½¿ç”¨<code>ssh root@127.0.0.1</code>,ç„¶åè¾“å…¥å¯†ç <code>123456</code>ç™»å½•</li>
</ul>
<p>ç°åœ¨ç”¨è¿™ä¸ªè„šæœ¬å°±æ˜¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./autologin.sh root 127.0.0.1 123456</span><br></pre></td></tr></table></figure>

<p>æŒºæ–¹ä¾¿çš„å§ï½</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨å‘½ä»¤æ“ä½œVirtualBox</title>
    <url>/2019/12/17/virtual-box-manager/</url>
    <content><![CDATA[<p>æœ€è¿‘ä¸€æ—¶å¤´è„‘å‘çƒ­æ‰¾äº†æœ¬æ±‡ç¼–çš„ä¹¦åœ¨å•ƒï¼Œä¹¦ä¸­æ˜¯ä½¿ç”¨æ‰‹åŠ¨æ“ä½œ<code>VirtualBox</code>æŒ‚è½½ç¡¬ç›˜è°ƒè¯•çš„ä¸å¤ªæ–¹ä¾¿ï¼Œé‚ä½¿ç”¨å‘½ä»¤æèµ·ï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚</p>
<p>VirtualBoxæ˜¯ä¸ªå…è´¹çš„è™šæ‹Ÿæœºè½¯ä»¶ï¼Œä¸è®ºlinuxã€winã€macä¸‹éƒ½å¯ä»¥ç›´æ¥å®‰è£…ä½¿ç”¨ã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒä½¿ç”¨å‘½ä»¤æ§åˆ¶ï¼Œæ„Ÿè§‰è¿™ä¸€ç‚¹ç»™äº†å¼€å‘è€…æ— é™çš„æƒ³è±¡ç©ºé—´å’Œåˆ›é€ åŠ›ã€‚</p>
<p>è€Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ä¸€ä¸ª<code>VBoxManage</code>å‘½ä»¤å®Œæˆçš„ã€‚ç°åœ¨æ•´ç†ä¸€ä¸‹ï¼š</p>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code>learnAsm</code>çš„è™šæ‹Ÿæœºä¸ºä¾‹ï¼Œå±•ç¤ºä¸‹åŸºæœ¬çš„æ“ä½œã€‚</p>
<h2 id="åˆ›å»ºè™šæ‹Ÿæœº"><a href="#åˆ›å»ºè™šæ‹Ÿæœº" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿæœº"></a>åˆ›å»ºè™šæ‹Ÿæœº</h2><p>åˆ›å»ºå¹¶æ³¨å†Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage createvm --name learnAsm --register </span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤è™šæ‹Ÿæœº"><a href="#åˆ é™¤è™šæ‹Ÿæœº" class="headerlink" title="åˆ é™¤è™šæ‹Ÿæœº"></a>åˆ é™¤è™šæ‹Ÿæœº</h2><p>ï¼ˆï¼ï¼ï¼ä¼šåˆ é™¤æ‰€æœ‰è™šæ‹Ÿç¡¬ç›˜ï¼Œè°¨æ…æ“ä½œï¼ï¼ï¼ï¼‰</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage unregistervm --delete learnAsm</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨å†Œè™šæ‹Ÿæœº"><a href="#æ³¨å†Œè™šæ‹Ÿæœº" class="headerlink" title="æ³¨å†Œè™šæ‹Ÿæœº"></a>æ³¨å†Œè™šæ‹Ÿæœº</h2><p>å‡å¦‚ä½ æ³¨é”€äº†ï¼Œæˆ–è€…ä»åˆ«äººé‚£é‡Œå¤åˆ¶æ¥çš„è™šæ‹Ÿæœºæ–‡ä»¶ï¼Œå¯ä»¥é‡æ–°æ³¨å†Œå®ƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage registervm &lt;your vms path&gt;/learnAsm.vbox</span><br></pre></td></tr></table></figure>

<h2 id="ä»…æ³¨é”€è™šæ‹Ÿæœº"><a href="#ä»…æ³¨é”€è™šæ‹Ÿæœº" class="headerlink" title="ä»…æ³¨é”€è™šæ‹Ÿæœº"></a>ä»…æ³¨é”€è™šæ‹Ÿæœº</h2><p>æ³¨é”€ä¹‹åVirtualBoxåˆ—è¡¨ä¸­æ˜¾ç¤ºäº†</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage unregistervm learnAsm</span><br></pre></td></tr></table></figure>

<h2 id="åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº"><a href="#åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº" class="headerlink" title="åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº"></a>åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage list vms</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu-64"><a href="#è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu-64" class="headerlink" title="è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu_64"></a>è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu_64</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm --ostype Ubuntu_64</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®å†…å­˜å¤§å°1G"><a href="#è®¾ç½®å†…å­˜å¤§å°1G" class="headerlink" title="è®¾ç½®å†…å­˜å¤§å°1G"></a>è®¾ç½®å†…å­˜å¤§å°1G</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm --memory 1024 <span class="comment">#å•ä½MB</span></span><br></pre></td></tr></table></figure>

<h2 id="å»ºç«‹è™šæ‹Ÿç£ç›˜"><a href="#å»ºç«‹è™šæ‹Ÿç£ç›˜" class="headerlink" title="å»ºç«‹è™šæ‹Ÿç£ç›˜"></a>å»ºç«‹è™šæ‹Ÿç£ç›˜</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage createmedium --filename HDD10G.vdi --size 10000 <span class="comment">#å•ä½MB</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA"><a href="#åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA" class="headerlink" title="åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA"></a>åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage storagectl learnAsm --name IDE --add ide --controller PIIX4 --bootable on</span><br><span class="line">VBoxManage storagectl learnAsm --name SATA --add sata --controller IntelAhci --bootable on</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»é™¤</span></span><br><span class="line">VBoxManage storagectl learnAsm --name IDE --remove</span><br><span class="line">VBoxManage storagectl learnAsm --name SATA --remove</span><br></pre></td></tr></table></figure>

<h2 id="å…³è”è™šæ‹Ÿæœºç£ç›˜"><a href="#å…³è”è™šæ‹Ÿæœºç£ç›˜" class="headerlink" title="å…³è”è™šæ‹Ÿæœºç£ç›˜"></a>å…³è”è™šæ‹Ÿæœºç£ç›˜</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage storageattach learnAsm --storagectl SATA --port 0 --device 0 --<span class="built_in">type</span> hdd --medium HDD10G.vdi</span><br><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 0 --device 0 --<span class="built_in">type</span> hdd --medium HDD10G.vdi</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é™¤å…³è”</span></span><br><span class="line">VBoxManage storageattach learnAsm --storagectl SATA --port 0 --device 0 --<span class="built_in">type</span> hdd --medium none</span><br><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 0 --device 0 --<span class="built_in">type</span> hdd --medium none</span><br></pre></td></tr></table></figure>

<h2 id="å¢åŠ å…‰é©±"><a href="#å¢åŠ å…‰é©±" class="headerlink" title="å¢åŠ å…‰é©±"></a>å¢åŠ å…‰é©±</h2><p>å…³è”å…‰ç›˜é•œåƒæ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 1 --device 0 --<span class="built_in">type</span> dvddrive --medium ubuntu.iso</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é™¤å…³è”ï¼š</span></span><br><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 1 --device 0 --<span class="built_in">type</span> dvddrive --medium none</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰"><a href="#è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰" class="headerlink" title="è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰"></a>è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm  --ioapic on</span><br><span class="line">VBoxManage modifyvm learnAsm --cpus 4</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®CPUè¿è¡Œå³°å€¼"><a href="#è®¾ç½®CPUè¿è¡Œå³°å€¼" class="headerlink" title="è®¾ç½®CPUè¿è¡Œå³°å€¼"></a>è®¾ç½®CPUè¿è¡Œå³°å€¼</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm --cpuexecutioncap 80</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯"><a href="#æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯"></a>æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage -v</span><br><span class="line">VBoxManage list vms  <span class="comment">#åˆ—å‡ºè™šæ‹Ÿæœº</span></span><br><span class="line">VBoxManage list runningvms  <span class="comment">#åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœº</span></span><br><span class="line">VBoxManage showvminfo learnAsm <span class="comment">#æ˜¾ç¤ºè™šæ‹ŸæœºlearnAsmçš„ä¿¡æ¯</span></span><br><span class="line">VBoxManage list hdds <span class="comment">#åˆ—å‡ºç¡¬ç›˜</span></span><br><span class="line">VBoxManage list dvds <span class="comment">#åˆ—å‡ºdvd</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨è™šæ‹Ÿæœº"><a href="#å¯åŠ¨è™šæ‹Ÿæœº" class="headerlink" title="å¯åŠ¨è™šæ‹Ÿæœº"></a>å¯åŠ¨è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage startvm learnAsm --<span class="built_in">type</span> headless <span class="comment">#--type headlesså‚æ•°æ˜¯æ— çª—å£é™é»˜å¯åŠ¨</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº"><a href="#ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº" class="headerlink" title="ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº"></a>ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage controlvm learnAsm savestate</span><br></pre></td></tr></table></figure>

<h2 id="æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€"><a href="#æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€" class="headerlink" title="æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€"></a>æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage discardstate learnAsm</span><br></pre></td></tr></table></figure>

<h2 id="æ–­ç”µå…³é—­è™šæ‹Ÿæœº"><a href="#æ–­ç”µå…³é—­è™šæ‹Ÿæœº" class="headerlink" title="æ–­ç”µå…³é—­è™šæ‹Ÿæœº"></a>æ–­ç”µå…³é—­è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage controlvm learnAsm poweroff</span><br></pre></td></tr></table></figure>

<h2 id="æ­£å¸¸å…³æœº-ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€"><a href="#æ­£å¸¸å…³æœº-ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€" class="headerlink" title="æ­£å¸¸å…³æœº[ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€]"></a>æ­£å¸¸å…³æœº[ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€]</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage controlvm learnAsm acpipowerbutton</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨çš„å¤§æ¦‚å°±è¿™äº›å§ã€‚</p>
<p>æˆ‘æ˜¯é…åˆMakefileä½¿ç”¨çš„ï¼Œè¿™é‡Œé™„ä¸Šï¼Œå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">ASM_FILE=c05_mbr.asm</span><br><span class="line">DIST_PATH=.</span><br><span class="line">VHD_FILE=<span class="variable">$(DIST_PATH)</span>/boot.vhd</span><br><span class="line">VM_NAME=learn-asm</span><br><span class="line"></span><br><span class="line"><span class="variable">$(VHD_FILE)</span>: mbr.bin</span><br><span class="line">	-rm <span class="variable">$(VHD_FILE)</span></span><br><span class="line">	VBoxManage convertfromraw mbr.bin <span class="variable">$(VHD_FILE)</span> --format VHD --variant Fixed</span><br><span class="line"></span><br><span class="line"><span class="section">mbr.bin: <span class="variable">$(ASM_FILE)</span></span></span><br><span class="line">	nasm -f bin <span class="variable">$(ASM_FILE)</span> -o mbr.bin -l mbr.list</span><br><span class="line"></span><br><span class="line"><span class="section">run: <span class="variable">$(VHD_FILE)</span> change-vm-vhd</span></span><br><span class="line">	VBoxManage startvm <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line"><span class="section">stop:</span></span><br><span class="line">	-VBoxManage controlvm <span class="variable">$(VM_NAME)</span> savestate</span><br><span class="line">	-VBoxManage discardstate <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line"><span class="section">create-vm: <span class="variable">$(VHD_FILE)</span></span></span><br><span class="line">	VBoxManage createvm --name <span class="variable">$(VM_NAME)</span> --register</span><br><span class="line">	VBoxManage modifyvm <span class="variable">$(VM_NAME)</span> --memory 64</span><br><span class="line">	VBoxManage storagectl <span class="variable">$(VM_NAME)</span> --name SATA --add sata --controller IntelAhci --bootable on</span><br><span class="line"></span><br><span class="line"><span class="section">change-vm-vhd: <span class="variable">$(VHD_FILE)</span></span></span><br><span class="line">	cp <span class="variable">$(VHD_FILE)</span> <span class="variable">$(VHD_FILE)</span>.bk</span><br><span class="line">	-VBoxManage discardstate <span class="variable">$(VM_NAME)</span></span><br><span class="line">	-VBoxManage storageattach <span class="variable">$(VM_NAME)</span> --storagectl SATA --port 0 --device 0 --type hdd --medium none</span><br><span class="line">	-VBoxManage closemedium disk <span class="variable">$(VHD_FILE)</span> --delete <span class="comment"># å› ä¸ºç¡¬ç›˜æ˜¯é‡æ–°åˆ é™¤åˆ›å»ºçš„ï¼Œuuidä¹Ÿå˜äº†ï¼Œç›´æ¥æŒ‚è½½æ— æ³•å¯åŠ¨ã€‚æ‰€ä»¥è¿™é‡Œå…ˆåˆ é™¤ï¼Œå†æŒ‚è½½ã€‚</span></span><br><span class="line">	mv <span class="variable">$(VHD_FILE)</span>.bk <span class="variable">$(VHD_FILE)</span></span><br><span class="line">	VBoxManage storageattach <span class="variable">$(VM_NAME)</span> --storagectl SATA --port 0 --device 0 --type hdd --medium <span class="variable">$(VHD_FILE)</span></span><br><span class="line"></span><br><span class="line"><span class="section">unregister-vm:</span></span><br><span class="line">	-VBoxManage unregistervm <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line"><span class="section">delete-vm:</span></span><br><span class="line">	-VBoxManage unregistervm --delete <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line">clean :</span><br><span class="line">	-rm -rf *.vhd *.bin *.list</span><br></pre></td></tr></table></figure>


<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://www.jianshu.com/p/a2d4840341fb">https://www.jianshu.com/p/a2d4840341fb</a></li>
<li><a href="https://www.virtualbox.org/manual/">https://www.virtualbox.org/manual/</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>è™šæ‹ŸåŒ–</tag>
        <tag>VirtualBox</tag>
      </tags>
  </entry>
  <entry>
    <title>èŠä¸€èŠphpçš„åºåˆ—åŒ–</title>
    <url>/2020/03/31/php-serialize/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨é¡¹ç›®ç§ç»å¸¸ç”¨<code>redis</code>ç¼“å­˜æ•°æ®åºåˆ—åŒ–çš„æ•°æ®ï¼Œæœ‰ç‚¹å¿ƒå¾—ï¼Œæˆ‘ä»¬ç°åœ¨èŠä¸€èŠphpçš„åºåˆ—åŒ–æ“ä½œ</p>
<p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ˜¯ä¸€å¯¹å­¦åˆ—åŒ–å‡½æ•°<code>serialize</code>å’Œ<code>unserialize</code>ã€‚å¸¸ç”¨çš„æ“ä½œå¾ˆç®€å•ï¼Œå°±æ˜¯ï¼š</p>
<ol>
<li><p>ä½¿ç”¨<code>serialize</code>åºåˆ—åŒ–æˆ‘ä»¬çš„å˜é‡ä½¿å…¶å˜æˆå­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$data</span> = [<span class="string">&#x27;id&#x27;</span>=&gt;<span class="number">1</span>, <span class="string">&#x27;name&#x27;</span>=&gt;<span class="string">&#x27;xiaoming&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>=&gt;<span class="number">1</span>];</span><br><span class="line"><span class="variable">$dataString</span> = serialize(<span class="variable">$data</span>);</span><br><span class="line"><span class="comment">// echo $dataString</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™äº›å­—ç¬¦ä¸²å¯ä»¥ç¦»çº¿ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…ä¸€äº›ç¼“å­˜ä»‹è´¨ä¸­ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example</span></span><br><span class="line"><span class="variable">$redis</span>-&gt;set(<span class="string">&#x27;test_user1&#x27;</span>, <span class="variable">$dataString</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ä½¿ç”¨çš„æ—¶å€™ä»ä¸Šé¢çš„ä¸€äº›ä»‹è´¨ä¸­å–å‡ºå­—ç¬¦ä¸²ï¼Œç„¶åè°ƒç”¨<code>unserialize</code>ååºåˆ—åŒ–åˆ°å˜é‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$dataString</span> = <span class="variable">$redis</span>-&gt;get(<span class="string">&#x27;test_user1&#x27;</span>);</span><br><span class="line"><span class="variable">$data</span> = unserialize(<span class="variable">$dataString</span>);</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>æˆ‘ä»¬å†çœ‹çœ‹phpå„ç§æ•°æ®ç±»å‹åºåˆ—åŒ–ä¹‹åçš„ç»“æœå¦‚ä½•ï¼š</p>
<ol>
<li><p>æ•´å‹int</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º i:1;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ®ç‚¹å‹float</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="number">1.1</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º d:1.1;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¸ƒå°”bool</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º b:1;</span></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º b:0;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç©ºå€¼null</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º n:1;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å­—ç¬¦ä¸²string</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º s:1:&quot;1&quot;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ•°ç»„array</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize([]); <span class="comment">//ç©ºæ•°ç»„</span></span><br><span class="line"><span class="comment">// è¾“å‡º a:0:&#123;&#125;</span></span><br><span class="line"><span class="keyword">echo</span> serialize([<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// è¾“å‡º a:1:&#123;i:0;i:1;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹è±¡object</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º O:1:&quot;A&quot;:0:&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> B();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º O:1:&quot;B&quot;:1:&#123;s:4:&quot;name&quot;;N;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="built_in">stdClass</span>();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º O:8:&quot;stdClass&quot;:0:&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$d</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$d</span>);</span><br><span class="line"><span class="comment">// è¾“å‡ºæŠ¥é”™ PHP Warning:  Uncaught Exception: Serialization of &#x27;Closure&#x27; is not allowed</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>èµ„æºresource</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$f</span> = fopen(<span class="string">&quot;/tmp/t.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);  <span class="comment">//å‡å¦‚æ–‡ä»¶/tmp/t.txtå­˜åœ¨</span></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$f</span>);</span><br><span class="line">fclose(<span class="variable">$f</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º todo</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹æ¥phpçš„serializeå‡½æ•°æ— æ³•åºåˆ—åŒ–ä¸€ä¸ªåŒ¿åå‡½æ•°</p>
<p>ï¼ˆæœªå®Œå¾…ç»­ï¼‰</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>åºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>VSCodeç©è½¬è¿œç¨‹å¼€å‘ä¹‹Dockerå®¹å™¨</title>
    <url>/2020/04/13/vscode-remote-container/</url>
    <content><![CDATA[<p>å‰äº›æ—¥å­è¯•äº†ä¸‹vscodeé…åˆdockerå®¹å™¨å¼€å‘ï¼Œä½“éªŒç‰¹åˆ«ä¸é”™ï¼Œæ¯”æ•²dockerå‘½ä»¤èˆ’çˆ½å¤šäº†ã€‚åœ¨è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚</p>
<h2 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h2><p>é¦–å…ˆä½ çš„æœºå™¨ä¸Šå®‰è£…å¥½dockerå’Œvscodeä¸¤ä¸ªåŸºæœ¬è½¯ä»¶å¹¶å¯åŠ¨å®ƒä¿©ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼è¿›å…¥ä¸»é¢˜ï¼š</p>
<p>åœ¨vscodeçš„æ‰©å±•æ ä¸­æœç´¢ï¼šRemoteæˆ–è€…Containersï¼Œæ‰¾åˆ°<code>Remote - Containers</code>è¿™ä¸ªæ’ä»¶ï¼Œå¹¶ä¸”å®‰è£…å¥½ï¼Œå¦‚å›¾ï¼š<br><img src="/assets/images/20200413221730.png" alt="install"></p>
<h2 id="é¡¹ç›®é…ç½®æ„å»º"><a href="#é¡¹ç›®é…ç½®æ„å»º" class="headerlink" title="é¡¹ç›®é…ç½®æ„å»º"></a>é¡¹ç›®é…ç½®æ„å»º</h2><p>è¿™é‡Œæ‹¿ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€phpæ¥åšä¸ªç¤ºèŒƒï¼Œä½¿ç”¨gitæ‹‰å–å¾®è½¯å®˜æ–¹æä¾›çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/microsoft/vscode-remote-try-php.git</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨vscodeæ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ .devcontainer</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Dockerfile</span><br><span class="line">â”‚Â Â  â””â”€â”€ devcontainer.json</span><br><span class="line">â”œâ”€â”€ .vscode</span><br><span class="line">â”‚Â Â  â””â”€â”€ launch.json</span><br><span class="line">â””â”€â”€ index.php</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç†Ÿæ‚‰çš„<code>Dockerfile</code>ï¼Œ å¤§æ¦‚çœ‹çœ‹å®ƒçš„å†…å®¹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> php:<span class="number">7</span>-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># Avoid warnings by switching to noninteractive</span></span><br><span class="line"><span class="keyword">ENV</span> DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line"><span class="comment"># This Dockerfile adds a non-root user with sudo access. Use the &quot;remoteUser&quot;</span></span><br><span class="line"><span class="comment"># property in devcontainer.json to use it. On Linux, the container user&#x27;s GID/UIDs</span></span><br><span class="line"><span class="comment"># will be updated to match your local UID/GID (when using the dockerFile property).</span></span><br><span class="line"><span class="comment"># See https://aka.ms/vscode-remote/containers/non-root-user for details.</span></span><br><span class="line"><span class="keyword">ARG</span> USERNAME=vscode  <span class="comment"># vscodeç”¨æˆ·</span></span><br><span class="line"><span class="keyword">ARG</span> USER_UID=<span class="number">1000</span></span><br><span class="line"><span class="keyword">ARG</span> USER_GID=$USER_UID</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">&#x27;s/security.debian.org/mirrors.aliyun.com/g&#x27;</span> /etc/apt/sources.list \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">&#x27;s/deb.debian.org/mirrors.aliyun.com/g&#x27;</span> /etc/apt/sources.list </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure apt and install packages</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get -y install --no-install-recommends apt-utils dialog 2&gt;&amp;1 \</span></span><br><span class="line"><span class="bash">    <span class="comment">#</span></span></span><br><span class="line">    <span class="comment"># install git iproute2, procps, lsb-release (useful for CLI installs)</span></span><br><span class="line">    &amp;&amp; apt-get -y install git openssh-client less iproute2 procps iproute2 lsb-release \</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Install xdebug  å®‰è£…äº†xdebug</span></span><br><span class="line">    &amp;&amp; yes | pecl install xdebug \</span><br><span class="line">    &amp;&amp; echo <span class="string">&quot;zend_extension=$(find /usr/local/lib/php/extensions/ -name xdebug.so)&quot;</span> &gt; /usr/local/etc/php/conf.d/xdebug.ini \</span><br><span class="line">    &amp;&amp; echo <span class="string">&quot;xdebug.remote_enable=on&quot;</span> &gt;&gt; /usr/local/etc/php/conf.d/xdebug.ini \</span><br><span class="line">    &amp;&amp; echo <span class="string">&quot;xdebug.remote_autostart=on&quot;</span> &gt;&gt; /usr/local/etc/php/conf.d/xdebug.ini \</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Create a non-root user to use if preferred - see https://aka.ms/vscode-remote/containers/non-root-user.</span></span><br><span class="line">    &amp;&amp; groupadd --gid $USER_GID $USERNAME \</span><br><span class="line">    &amp;&amp; useradd -s /bin/bash --uid $USER_UID --gid $USER_GID -m $USERNAME \</span><br><span class="line">    <span class="comment"># [Optional] Add sudo support for the non-root user</span></span><br><span class="line">    &amp;&amp; apt-get install -y sudo \</span><br><span class="line">    &amp;&amp; echo $USERNAME ALL=\(root\) NOPASSWD:ALL &gt; /etc/sudoers.d/$USERNAME\   <span class="comment"># æŠŠvscodeè¿™ä¸ªç”¨æˆ·æˆæƒsodo</span></span><br><span class="line">    &amp;&amp; chmod <span class="number">0440</span> /etc/sudoers.d/$USERNAME \</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Clean up</span></span><br><span class="line">    &amp;&amp; apt-get autoremove -y \</span><br><span class="line">    &amp;&amp; apt-get clean -y \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch back to dialog for any ad-hoc use of apt-get</span></span><br><span class="line"><span class="keyword">ENV</span> DEBIAN_FRONTEND=dialog</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªåŸºäº<code>php:7-cli</code>çš„phpç¯å¢ƒå¹¶ä¸”è£…äº†<code>xdebug</code>æ‰©å±•ï¼Œå†æ·»åŠ äº†ä¸€ä¸ªåå«<code>vscode</code>çš„ç”¨æˆ·å¹¶æˆæƒsudoã€‚</p>
<p>è€ƒè™‘åˆ°æˆ‘ä»¬çš„ç½‘ç»œé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨aliyunçš„é•œåƒåœ°å€æ¥åŠ é€Ÿæ„å»ºã€‚åœ¨ä¸Šé¢çš„Dockerfileä¸­åŠ äº†ä¸¤è¡Œï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">&#x27;s/security.debian.org/mirrors.aliyun.com/g&#x27;</span> /etc/apt/sources.list \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">&#x27;s/deb.debian.org/mirrors.aliyun.com/g&#x27;</span> /etc/apt/sources.list </span></span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>å®Œäº‹å…·å¤‡ï¼Œå¼€å§‹è¿è¡Œå®ƒï¼š<br>æŒ‰<code>F1</code>ç„¶åé€‰æ‹©<code>Remote-Containers: Open Repository in Container</code>ã€‚æˆ–è€…ç‚¹å·¦ä¸‹è§’çš„å›¾æ ‡ï¼š<br><img src="/assets/images/20200413224822.png" alt="icon"></p>
<p>å› ä¸ºæ›´æ¢äº†æºï¼Œå‡ åˆ†é’Ÿæ—¶é—´å°±æ„å»ºå¥½ã€‚</p>
<p>è¿è¡ŒæˆåŠŸä¹‹åï¼Œä½ å¯ä»¥å‘ç°ï¼Œå¼€å‘æµç¨‹å’Œæœ¬åœ°å¼€å‘å‡ ä¹ä¸€æ‘¸ä¸€æ ·ã€‚æˆ‘ä»¬æ‰“å¼€vscodeä¸‹çš„terminalç»ˆç«¯ï¼Œå¯ä»¥çœ‹åˆ°å‘½ä»¤æç¤ºç¬¦ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vscode@0d2acb021651:/workspaces/vscode-remote-try-php$ </span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªvscodeç”¨æˆ·å°±æ˜¯ä¹‹å‰Dockerfileä¸­å®šä¹‰çš„ç”¨æˆ·ã€‚</p>
<p>æ¥ä¸‹æ¥å°±å®Œå…¨å½“æœ¬åœ°å¼€å‘å§ã€‚</p>
<h2 id="æ·»åŠ ç«¯å£"><a href="#æ·»åŠ ç«¯å£" class="headerlink" title="æ·»åŠ ç«¯å£"></a>æ·»åŠ ç«¯å£</h2><p>æˆ‘ä»¬phpå¼€å‘ï¼Œå¤§å¤šæ˜¯webå¼€å‘ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢æ‰“å¼€çš„ç»ˆç«¯ä¸­å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php -S 0.0.0.0:8080</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™éœ€è¦æ˜ å°„ä¸€ä¸ªç«¯å£åˆ°æœ¬åœ°ï¼š<br>æŒ‰<code>F1</code>ç„¶åé€‰æ‹©<code>Forward a port</code>ï¼Œæ¯”å¦‚ä¹Ÿè¾“å…¥8080ã€‚åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€127.0.0.1:8080å°±å¯ä»¥è®¿é—®æˆ‘ä»¬çš„webæœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™è®©å®ƒè‡ªåŠ¨æ˜ å°„ç«¯å£ï¼Œæˆ‘ä»¬åœ¨<code>devcontainer.json</code>æ–‡ä»¶ä¸­åŠ å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// An array port numbers to forward</span><br><span class="line">&quot;forwardPorts&quot;: [8080],</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯ç‰¹åˆ«çš„æ–¹ä¾¿~ğŸ˜ğŸ˜ğŸ˜</p>
<p>æœ€åæƒ³è¯´çš„æ˜¯ï¼šè™½ç„¶ç°åœ¨vscodeä¸‹å¼€å‘phpè¿˜ä¸å¦‚phpstormæ¥çš„çˆ½å¿«ï¼Œä½†æ˜¯è¿™ç§å¼€å‘æ¨¡å¼ç¡®å®å·²ç»è¶…è¿‡äº†phpstormã€‚ä½“éªŒå¥½ï¼Œç®€å•è¿˜æœ‰ä¾‹å­ï¼Œæ–‡æ¡£ä¹Ÿé½å…¨ã€‚å…¶ä»–è¯­è¨€çš„ä¾‹å­ä¹Ÿéƒ½æœ‰ï¼Œå¤§å®¶å¯è‡ªå·±å°è¯•ä¸‹ã€‚</p>
<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers</a></li>
<li><a href="https://code.visualstudio.com/remote-tutorials/containers/getting-started">https://code.visualstudio.com/remote-tutorials/containers/getting-started</a></li>
</ul>
]]></content>
      <categories>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>å®¹å™¨</tag>
        <tag>Docker</tag>
        <tag>vscode</tag>
        <tag>IDE</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè¿›ç¨‹ç®¡ç†å‘½ä»¤ps</title>
    <url>/2020/04/16/linux-ps/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><code>Linux</code>ä¸­çš„<code>ps</code>å‘½ä»¤æ˜¯<code>Process Status</code>çš„ç¼©å†™ã€‚<code>ps</code>å‘½ä»¤ç”¨æ¥åˆ—å‡ºç³»ç»Ÿä¸­å½“å‰è¿è¡Œçš„é‚£äº›è¿›ç¨‹ã€‚<code>ps</code>å‘½ä»¤åˆ—å‡ºçš„æ˜¯å½“å‰é‚£äº›è¿›ç¨‹çš„å¿«ç…§ï¼Œå°±æ˜¯æ‰§è¡Œ<code>ps</code>å‘½ä»¤çš„é‚£ä¸ªæ—¶åˆ»çš„é‚£äº›è¿›ç¨‹ï¼Œå¦‚æœæƒ³è¦åŠ¨æ€çš„æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>top</code>å‘½ä»¤ã€‚</p>
<p>è¦å¯¹è¿›ç¨‹è¿›è¡Œç›‘æµ‹å’Œæ§åˆ¶ï¼Œé¦–å…ˆå¿…é¡»è¦äº†è§£å½“å‰è¿›ç¨‹çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯éœ€è¦æŸ¥çœ‹å½“å‰è¿›ç¨‹ï¼Œè€Œ<code>ps</code>å‘½ä»¤å°±æ˜¯æœ€åŸºæœ¬åŒæ—¶ä¹Ÿæ˜¯éå¸¸å¼ºå¤§çš„è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ã€‚ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥ç¡®å®šæœ‰å“ªäº›è¿›ç¨‹æ­£åœ¨è¿è¡Œå’Œè¿è¡Œçš„çŠ¶æ€ã€è¿›ç¨‹æ˜¯å¦ç»“æŸã€è¿›ç¨‹æœ‰æ²¡æœ‰åƒµæ­»ã€å“ªäº›è¿›ç¨‹å ç”¨äº†è¿‡å¤šçš„èµ„æºç­‰ç­‰ã€‚æ€»ä¹‹å¤§éƒ¨åˆ†ä¿¡æ¯éƒ½æ˜¯å¯ä»¥é€šè¿‡æ‰§è¡Œè¯¥å‘½ä»¤å¾—åˆ°çš„ã€‚</p>
<p><code>ps</code>ä¸ºæˆ‘ä»¬æä¾›äº†è¿›ç¨‹çš„ä¸€æ¬¡æ€§çš„æŸ¥çœ‹ï¼Œå®ƒæ‰€æä¾›çš„æŸ¥çœ‹ç»“æœå¹¶ä¸åŠ¨æ€è¿ç»­çš„ï¼›å¦‚æœæƒ³å¯¹è¿›ç¨‹æ—¶é—´ç›‘æ§ï¼Œåº”è¯¥ç”¨ <code>top</code>å·¥å…·ã€‚</p>
<p><code>kill</code>å‘½ä»¤ç”¨äºæ€æ­»è¿›ç¨‹ã€‚</p>
<h2 id="linuxä¸Šè¿›ç¨‹æœ‰5ç§çŠ¶æ€"><a href="#linuxä¸Šè¿›ç¨‹æœ‰5ç§çŠ¶æ€" class="headerlink" title="linuxä¸Šè¿›ç¨‹æœ‰5ç§çŠ¶æ€:"></a>linuxä¸Šè¿›ç¨‹æœ‰5ç§çŠ¶æ€:</h2><ul>
<li>1.è¿è¡Œ(æ­£åœ¨è¿è¡Œæˆ–åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…) </li>
<li>2.ä¸­æ–­(ä¼‘çœ ä¸­, å—é˜», åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å½¢æˆæˆ–æ¥å—åˆ°ä¿¡å·) </li>
<li>3.ä¸å¯ä¸­æ–­(æ”¶åˆ°ä¿¡å·ä¸å”¤é†’å’Œä¸å¯è¿è¡Œ, è¿›ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°æœ‰ä¸­æ–­å‘ç”Ÿ) </li>
<li>4.åƒµæ­»(è¿›ç¨‹å·²ç»ˆæ­¢, ä½†è¿›ç¨‹æè¿°ç¬¦å­˜åœ¨, ç›´åˆ°çˆ¶è¿›ç¨‹è°ƒç”¨<code>wait4()</code>ç³»ç»Ÿè°ƒç”¨åé‡Šæ”¾) </li>
<li>5.åœæ­¢(è¿›ç¨‹æ”¶åˆ°<code>SIGSTOP</code>, <code>SIGSTP</code>, <code>SIGTIN</code>, <code>SIGTOU</code>ä¿¡å·ååœæ­¢è¿è¡Œè¿è¡Œ) </li>
</ul>
<h2 id="pså·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç "><a href="#pså·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç " class="headerlink" title="pså·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç :"></a>pså·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç :</h2><ul>
<li><code>D</code>ä¸å¯ä¸­æ–­<code>uninterruptible sleep (usually IO)</code> </li>
<li><code>R</code>è¿è¡Œ<code>runnable (on run queue)</code> </li>
<li><code>S</code>ä¸­æ–­<code>sleeping</code> </li>
<li><code>T</code>åœæ­¢<code>traced or stopped</code> </li>
<li><code>Z</code>åƒµæ­»<code>a defunct (â€zombieâ€) process</code> </li>
</ul>
<h2 id="å‘½ä»¤æ ¼å¼ï¼š"><a href="#å‘½ä»¤æ ¼å¼ï¼š" class="headerlink" title="å‘½ä»¤æ ¼å¼ï¼š"></a>å‘½ä»¤æ ¼å¼ï¼š</h2><blockquote>
<p>ps[å‚æ•°]</p>
</blockquote>
<h2 id="å‘½ä»¤åŠŸèƒ½ï¼š"><a href="#å‘½ä»¤åŠŸèƒ½ï¼š" class="headerlink" title="å‘½ä»¤åŠŸèƒ½ï¼š"></a>å‘½ä»¤åŠŸèƒ½ï¼š</h2><p>ç”¨æ¥æ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„çŠ¶æ€</p>
<h2 id="å‘½ä»¤å‚æ•°ï¼š"><a href="#å‘½ä»¤å‚æ•°ï¼š" class="headerlink" title="å‘½ä»¤å‚æ•°ï¼š"></a>å‘½ä»¤å‚æ•°ï¼š</h2><ul>
<li><code>a</code> æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</li>
<li><code>-a</code> æ˜¾ç¤ºåŒä¸€ç»ˆç«¯ä¸‹çš„æ‰€æœ‰ç¨‹åº</li>
<li><code>-A</code> æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</li>
<li><code>c</code> æ˜¾ç¤ºè¿›ç¨‹çš„çœŸå®åç§°</li>
<li><code>-N</code> åå‘é€‰æ‹©</li>
<li><code>-e</code> ç­‰äºâ€œ-Aâ€</li>
<li><code>e</code> æ˜¾ç¤ºç¯å¢ƒå˜é‡</li>
<li><code>f</code> æ˜¾ç¤ºç¨‹åºé—´çš„å…³ç³»</li>
<li><code>-H</code> æ˜¾ç¤ºæ ‘çŠ¶ç»“æ„</li>
<li><code>r</code> æ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„è¿›ç¨‹</li>
<li><code>T</code> æ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„æ‰€æœ‰ç¨‹åº</li>
<li><code>u</code> æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹</li>
<li><code>-au</code> æ˜¾ç¤ºè¾ƒè¯¦ç»†çš„ä¿¡æ¯</li>
<li><code>-aux</code> æ˜¾ç¤ºæ‰€æœ‰åŒ…å«å…¶ä»–ä½¿ç”¨è€…çš„è¡Œç¨‹ </li>
<li><code>-C &lt;å‘½ä»¤&gt;</code> åˆ—å‡ºæŒ‡å®šå‘½ä»¤çš„çŠ¶å†µ</li>
<li><code>-p &lt;PID&gt;</code> åˆ—å‡ºæŒ‡å®šPIDçš„çŠ¶å†µ</li>
<li><code>--lines&lt;è¡Œæ•°&gt;</code> æ¯é¡µæ˜¾ç¤ºçš„è¡Œæ•°</li>
<li><code>--width&lt;å­—ç¬¦æ•°&gt;</code> æ¯é¡µæ˜¾ç¤ºçš„å­—ç¬¦æ•°</li>
</ul>
<h2 id="ä½¿ç”¨å®ä¾‹ï¼š"><a href="#ä½¿ç”¨å®ä¾‹ï¼š" class="headerlink" title="ä½¿ç”¨å®ä¾‹ï¼š"></a>ä½¿ç”¨å®ä¾‹ï¼š</h2><h3 id="å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯"><a href="#å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯"></a>å®ä¾‹1ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -A</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps -A</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">    1 pts/0    00:00:00 bash</span><br><span class="line">   11 pts/1    00:00:00 bash</span><br><span class="line">   23 pts/1    00:00:00 ps</span><br><span class="line">  â€¦â€¦çœç•¥éƒ¨åˆ†ç»“æœ</span><br></pre></td></tr></table></figure>

<h3 id="å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯"><a href="#å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯" class="headerlink" title="å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯"></a>å®ä¾‹2ï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·ä¿¡æ¯</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -u root</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps -u root</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">    1 pts/0    00:00:00 bash</span><br><span class="line">   11 pts/1    00:00:00 bash</span><br><span class="line">   24 pts/1    00:00:00 ps</span><br></pre></td></tr></table></figure>

<ul>
<li>å®ä¾‹3ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼Œè¿åŒå‘½ä»¤è¡Œ</li>
</ul>
<p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -ef</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 15:16 pts/0    00:00:00 bash</span><br><span class="line">root        11     0  0 15:16 pts/1    00:00:00 bash</span><br><span class="line">root      4759    11  0 15:27 pts/1    00:00:00 php test.php</span><br><span class="line">root      4762    11  0 15:28 pts/1    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<h3 id="å®ä¾‹4ï¼š-ps-ä¸grep-å¸¸ç”¨ç»„åˆç”¨æ³•ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹"><a href="#å®ä¾‹4ï¼š-ps-ä¸grep-å¸¸ç”¨ç»„åˆç”¨æ³•ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹" class="headerlink" title="å®ä¾‹4ï¼š ps ä¸grep å¸¸ç”¨ç»„åˆç”¨æ³•ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹"></a>å®ä¾‹4ï¼š ps ä¸grep å¸¸ç”¨ç»„åˆç”¨æ³•ï¼ŒæŸ¥æ‰¾ç‰¹å®šè¿›ç¨‹</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -ef|grep ssh</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps -ef |grep php</span><br><span class="line">root      4759    11  0 15:27 pts/1    00:00:00 php test.php</span><br><span class="line">root      4764    11  0 15:29 pts/1    00:00:00 grep --color=auto php</span><br></pre></td></tr></table></figure>

<h3 id="å®ä¾‹5ï¼šå°†ç›®å‰å±äºæ‚¨è‡ªå·±è¿™æ¬¡ç™»å…¥çš„-PID-ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥"><a href="#å®ä¾‹5ï¼šå°†ç›®å‰å±äºæ‚¨è‡ªå·±è¿™æ¬¡ç™»å…¥çš„-PID-ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥" class="headerlink" title="å®ä¾‹5ï¼šå°†ç›®å‰å±äºæ‚¨è‡ªå·±è¿™æ¬¡ç™»å…¥çš„ PID ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥"></a>å®ä¾‹5ï¼šå°†ç›®å‰å±äºæ‚¨è‡ªå·±è¿™æ¬¡ç™»å…¥çš„ PID ä¸ç›¸å…³ä¿¡æ¯åˆ—ç¤ºå‡ºæ¥</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -l</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps -l</span><br><span class="line">F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 S     0    11     0  0  80   0 -  4627 -      pts/1    00:00:00 bash</span><br><span class="line">4 S     0  4759    11  0  80   0 - 33443 -      pts/1    00:00:00 php</span><br><span class="line">0 R     0  4765    11  0  80   0 -  6487 -      pts/1    00:00:00 ps</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<p>å„ç›¸å…³ä¿¡æ¯çš„æ„ä¹‰ï¼š</p>
<ul>
<li><code>F</code> ä»£è¡¨è¿™ä¸ªç¨‹åºçš„æ——æ ‡ (flag)ï¼Œ <code>4</code> ä»£è¡¨ä½¿ç”¨è€…ä¸º<code>super user</code></li>
<li><code>S</code> ä»£è¡¨è¿™ä¸ªç¨‹åºçš„çŠ¶æ€ (STAT)ï¼Œå…³äºå„ <code>STAT</code> çš„æ„ä¹‰å°†åœ¨å†…æ–‡ä»‹ç»</li>
<li><code>UID</code> ç¨‹åºè¢«è¯¥ UID æ‰€æ‹¥æœ‰</li>
<li><code>PID</code> å°±æ˜¯è¿™ä¸ªç¨‹åºçš„ ID </li>
<li><code>PPID</code> åˆ™æ˜¯å…¶ä¸Šçº§çˆ¶ç¨‹åºçš„ID</li>
<li><code>C</code> CPU ä½¿ç”¨çš„èµ„æºç™¾åˆ†æ¯”</li>
<li><code>PRI</code> è¿™ä¸ªæ˜¯ <code>Priority</code> (ä¼˜å…ˆæ‰§è¡Œåº) çš„ç¼©å†™ï¼Œè¯¦ç»†åé¢ä»‹ç»</li>
<li><code>NI</code> è¿™ä¸ªæ˜¯ <code>Nice</code> å€¼ï¼Œåœ¨ä¸‹ä¸€å°èŠ‚æˆ‘ä»¬ä¼šæŒç»­ä»‹ç»</li>
<li><code>ADDR</code> è¿™ä¸ªæ˜¯<code>kernel function</code>ï¼ŒæŒ‡å‡ºè¯¥ç¨‹åºåœ¨å†…å­˜çš„é‚£ä¸ªéƒ¨åˆ†ã€‚å¦‚æœæ˜¯ä¸ª<code>running</code>çš„ç¨‹åºï¼Œä¸€èˆ¬å°±æ˜¯â€-â€œ</li>
<li><code>SZ</code> ä½¿ç”¨æ‰çš„å†…å­˜å¤§å°</li>
<li><code>WCHAN</code> ç›®å‰è¿™ä¸ªç¨‹åºæ˜¯å¦æ­£åœ¨è¿ä½œå½“ä¸­ï¼Œè‹¥ä¸º <code>-</code> è¡¨ç¤ºæ­£åœ¨è¿ä½œ</li>
<li><code>TTY</code> ç™»å…¥è€…çš„ç»ˆç«¯æœºä½ç½®</li>
<li><code>TIME</code> ä½¿ç”¨æ‰çš„ <code>CPU</code> æ—¶é—´ã€‚</li>
<li><code>CMD</code> æ‰€ä¸‹è¾¾çš„æŒ‡ä»¤ä¸ºä½•</li>
</ul>
<p>åœ¨é¢„è®¾çš„æƒ…å†µä¸‹ï¼Œ <code>ps</code> ä»…ä¼šåˆ—å‡ºä¸ç›®å‰æ‰€åœ¨çš„ <code>bash shell</code> æœ‰å…³çš„ <code>PID</code> è€Œå·²ï¼Œæ‰€ä»¥ï¼Œ å½“æˆ‘ä½¿ç”¨ <code>ps -l</code> çš„æ—¶å€™ï¼Œåªæœ‰ä¸‰ä¸ª PIDã€‚</p>
<h3 id="å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜å½“ä¸­çš„ç¨‹åº"><a href="#å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜å½“ä¸­çš„ç¨‹åº" class="headerlink" title="å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜å½“ä¸­çš„ç¨‹åº"></a>å®ä¾‹6ï¼šåˆ—å‡ºç›®å‰æ‰€æœ‰çš„æ­£åœ¨å†…å­˜å½“ä¸­çš„ç¨‹åº</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps aux</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.1  18508  2612 pts/0    Ss+  15:16   0:00 bash</span><br><span class="line">root        11  0.0  0.1  18508  3216 pts/1    Ss   15:16   0:00 bash</span><br><span class="line">root      4759  0.0  0.7 133772 14652 pts/1    S    15:27   0:00 php test.php</span><br><span class="line">root      4766  0.0  0.1  34404  2836 pts/1    R+   15:35   0:00 ps aux</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<ul>
<li><p><code>USER</code>ï¼šè¯¥ process å±äºé‚£ä¸ªä½¿ç”¨è€…è´¦å·çš„</p>
</li>
<li><p><code>PID</code> ï¼šè¯¥ process çš„ID</p>
</li>
<li><p><code>%CPU</code>ï¼šè¯¥ process ä½¿ç”¨æ‰çš„ CPU èµ„æºç™¾åˆ†æ¯”</p>
</li>
<li><p><code>%MEM</code>ï¼šè¯¥ process æ‰€å ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”</p>
</li>
<li><p><code>VSZ</code> ï¼šè¯¥ process ä½¿ç”¨æ‰çš„è™šæ‹Ÿå†…å­˜é‡ (Kbytes)</p>
</li>
<li><p><code>RSS</code> ï¼šè¯¥ process å ç”¨çš„å›ºå®šçš„å†…å­˜é‡ (Kbytes)</p>
</li>
<li><p><code>TTY</code> ï¼šè¯¥ process æ˜¯åœ¨é‚£ä¸ªç»ˆç«¯æœºä¸Šé¢è¿ä½œï¼Œè‹¥ä¸ç»ˆç«¯æœºæ— å…³ï¼Œåˆ™æ˜¾ç¤º ?ï¼Œå¦å¤–ï¼Œ tty1-tty6 æ˜¯æœ¬æœºä¸Šé¢çš„ç™»å…¥è€…ç¨‹åºï¼Œè‹¥ä¸º pts/0 ç­‰ç­‰çš„ï¼Œåˆ™è¡¨ç¤ºä¸ºç”±ç½‘ç»œè¿æ¥è¿›ä¸»æœºçš„ç¨‹åºã€‚</p>
</li>
<li><p><code>STAT</code>ï¼šè¯¥ç¨‹åºç›®å‰çš„çŠ¶æ€ï¼Œä¸»è¦çš„çŠ¶æ€æœ‰</p>
<ul>
<li><code>R</code> ï¼šè¯¥ç¨‹åºç›®å‰æ­£åœ¨è¿ä½œï¼Œæˆ–è€…æ˜¯å¯è¢«è¿ä½œ</li>
<li><code>S</code> ï¼šè¯¥ç¨‹åºç›®å‰æ­£åœ¨ç¡çœ å½“ä¸­ (å¯è¯´æ˜¯ idle çŠ¶æ€)ï¼Œä½†å¯è¢«æŸäº›è®¯å· (signal) å”¤é†’ã€‚</li>
<li><code>T</code> ï¼šè¯¥ç¨‹åºç›®å‰æ­£åœ¨ä¾¦æµ‹æˆ–è€…æ˜¯åœæ­¢äº†</li>
<li><code>Z</code> ï¼šè¯¥ç¨‹åºåº”è¯¥å·²ç»ç»ˆæ­¢ï¼Œä½†æ˜¯å…¶çˆ¶ç¨‹åºå´æ— æ³•æ­£å¸¸çš„ç»ˆæ­¢ä»–ï¼Œé€ æˆ zombie (ç–†å°¸) ç¨‹åºçš„çŠ¶æ€</li>
</ul>
</li>
<li><p><code>START</code>ï¼šè¯¥ process è¢«è§¦å‘å¯åŠ¨çš„æ—¶é—´</p>
</li>
<li><p><code>TIME</code> ï¼šè¯¥ process å®é™…ä½¿ç”¨ CPU è¿ä½œçš„æ—¶é—´</p>
</li>
<li><p><code>COMMAND</code>ï¼šè¯¥ç¨‹åºçš„å®é™…æŒ‡ä»¤</p>
</li>
</ul>
<h3 id="å®ä¾‹7ï¼šåˆ—å‡ºç±»ä¼¼ç¨‹åºæ ‘çš„ç¨‹åºæ˜¾ç¤º"><a href="#å®ä¾‹7ï¼šåˆ—å‡ºç±»ä¼¼ç¨‹åºæ ‘çš„ç¨‹åºæ˜¾ç¤º" class="headerlink" title="å®ä¾‹7ï¼šåˆ—å‡ºç±»ä¼¼ç¨‹åºæ ‘çš„ç¨‹åºæ˜¾ç¤º"></a>å®ä¾‹7ï¼šåˆ—å‡ºç±»ä¼¼ç¨‹åºæ ‘çš„ç¨‹åºæ˜¾ç¤º</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -axjf</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps -axjf</span><br><span class="line"> PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND</span><br><span class="line">    0    11    11    11 pts/1     4767 Ss       0   0:00 bash</span><br><span class="line">   11  4759  4759    11 pts/1     4767 S        0   0:00  \_ php test.php</span><br><span class="line">   11  4767  4767    11 pts/1     4767 R+       0   0:00  \_ ps -axjf</span><br><span class="line">    0     1     1     1 pts/0        1 Ss+      0   0:00 bash</span><br></pre></td></tr></table></figure>

<h3 id="å®ä¾‹8ï¼šæ‰¾å‡ºä¸-cron-ä¸-syslog-è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„-PID-å·ç "><a href="#å®ä¾‹8ï¼šæ‰¾å‡ºä¸-cron-ä¸-syslog-è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„-PID-å·ç " class="headerlink" title="å®ä¾‹8ï¼šæ‰¾å‡ºä¸ cron ä¸ syslog è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„ PID å·ç "></a>å®ä¾‹8ï¼šæ‰¾å‡ºä¸ cron ä¸ syslog è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„ PID å·ç </h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps aux | egrep &#x27;(php|test)&#x27;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps aux | egrep &#x27;(php|test)&#x27;</span><br><span class="line">root      4759  0.0  0.7 133772 14652 pts/1    S    15:27   0:00 php test.php</span><br><span class="line">root      4773  0.0  0.0  11464   992 pts/1    S+   15:41   0:00 grep -E --color=auto (php|test)</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–å®ä¾‹ï¼š"><a href="#å…¶ä»–å®ä¾‹ï¼š" class="headerlink" title="å…¶ä»–å®ä¾‹ï¼š"></a>å…¶ä»–å®ä¾‹ï¼š</h3><p>1.å¯ä»¥ç”¨ <code>|</code> ç®¡é“å’Œ <code>more</code> è¿æ¥èµ·æ¥åˆ†é¡µæŸ¥çœ‹</p>
<p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -aux |more</span><br></pre></td></tr></table></figure>

<p>2.è¾“å‡ºæŒ‡å®šçš„å­—æ®µ</p>
<p>å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps -o pid,ppid,pgrp,session,tpgid,comm</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@c210f4addccc:~# ps -o pid,ppid,pgrp,session,tpgid,comm</span><br><span class="line">  PID  PPID  PGRP  SESS TPGID COMMAND</span><br><span class="line">   11     0    11    11  4774 bash</span><br><span class="line"> 4759    11  4759    11  4774 php</span><br><span class="line"> 4774    11  4774    11  4774 ps</span><br></pre></td></tr></table></figure>


<p>å‚è€ƒ </p>
<ul>
<li><a href="https://www.cnblogs.com/peida/archive/2012/12/19/2824418.html">https://www.cnblogs.com/peida/archive/2012/12/19/2824418.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>è¿›ç¨‹ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP7.4æ–°ç‰¹æ€§FFIåˆä½“éªŒ</title>
    <url>/2020/04/20/php-ffi/</url>
    <content><![CDATA[<p>PHP7.4æ­£å¼ç‰ˆå‘å¸ƒå·²ç»å¥½ä¹…äº†ï¼Œè€Œä¸»æ‰“çš„æ–°ç‰¹æ€§æ˜¯FFIï¼Œä»Šå¤©æˆ‘ä¹Ÿæ¥ä½“éªŒä¸€æŠŠğŸ˜</p>
<p>FFIæä¾›äº†é«˜çº§è¯­è¨€ç›´æ¥çš„äº’ç›¸è°ƒç”¨ï¼Œè€Œå¯¹äºPHPæ¥è¯´ï¼ŒFFIè®©æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„è°ƒç”¨Cè¯­è¨€å†™çš„å„ç§åº“ã€‚</p>
<p>åˆšå¥½ï¼Œæœ‰ä¸ªå°éœ€æ±‚éœ€è¦è°ƒç”¨cä»£ç æ¥è·å–å‘½ä»¤è¡Œçª—å£çš„å¤§å°ï¼ˆè¡Œæ•°å’Œåˆ—æ•°ï¼‰ã€‚æˆ‘ä»¬çš„cä»£ç æ˜¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// filename cli_size.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡å‡½æ•° ioctl() è·å¾—ç»ˆç«¯ç•Œé¢çš„å‚æ•°</span></span><br><span class="line"><span class="comment"> * @see https://blog.csdn.net/weixin_42205987/article/details/82080615</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">struct winsize <span class="title">get_size</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">winsize</span> <span class="title">size</span>;</span></span><br><span class="line">    ioctl(STDIN_FILENO, TIOCGWINSZ, &amp;size);</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">short</span> <span class="title">get_cli_rows</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">winsize</span> <span class="title">size</span>;</span></span><br><span class="line">    ioctl(STDIN_FILENO, TIOCGWINSZ, &amp;size);</span><br><span class="line">    <span class="keyword">return</span> size.ws_row;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">short</span> <span class="title">get_cli_cols</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">winsize</span> <span class="title">size</span>;</span></span><br><span class="line">    ioctl(STDIN_FILENO, TIOCGWINSZ, &amp;size);</span><br><span class="line">    <span class="keyword">return</span> size.ws_col;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å…ˆæŠŠä¸Šé¢çš„cä»£ç ç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“<code>libcli_size.so</code>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gcc -O2 -fPIC -shared -g cli_size.c -o libcli_size.so</span><br></pre></td></tr></table></figure>

<p>å¼€å§‹å†™æˆ‘ä»¬çš„phpä»£ç ï¼š</p>
<p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨<code>FFI::cdef()</code>å‡½æ•°å£°æ˜æˆ‘ä»¬è¦è°ƒç”¨çš„è¿™ä¸ªåº“ä¸­çš„å‡½æ•°ä»¥åŠä½¿ç”¨åˆ°çš„æ•°æ®ç±»å‹ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨è¿™é‡Œè¦è°ƒç”¨çš„ä¸‰ä¸ªå‡½æ•°<code>get_cli_rows</code>ï¼ˆè·å–è¡Œæ•°ï¼‰ã€ <code>get_cli_cols</code>ï¼ˆè·å–åˆ—æ•°ï¼‰ã€ <code>get_size</code>ï¼ˆè·å–æ‰€æœ‰ä¿¡æ¯ï¼‰ï¼Œæˆ‘ä»¬æŠŠä»–ä»¬çš„å£°æ˜ä½œä¸º<code>FFI::cdef()</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚çœ‹åˆ°ä¸‹é¢çš„ä»£ç å¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå°±æ˜¯cè¯­è¨€çš„å‡½æ•°å£°æ˜ã€‚<br>è¿™é‡Œ<code>get_size</code>æ–¹æ³•è¿”å›æ˜¯ä¸€ä¸ªç»“æ„ä½“<code>struct winsize</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦æŠŠè¿™ä¸ªç»“æ„ä½“çš„å£°æ˜ä¹Ÿå†™ä¸Šã€‚</p>
<p><code>FFI::cdef()</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„åº“æ–‡ä»¶åäº†ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//filename cli_size.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ffi</span> = FFI::cdef(<span class="string">&lt;&lt;&lt;CTYPE</span></span><br><span class="line"><span class="string">struct winsize &#123;</span></span><br><span class="line"><span class="string">	unsigned short  ws_row;         /* rows, in characters */</span></span><br><span class="line"><span class="string">	unsigned short  ws_col;         /* columns, in characters */</span></span><br><span class="line"><span class="string">	unsigned short  ws_xpixel;      /* horizontal size, pixels */</span></span><br><span class="line"><span class="string">	unsigned short  ws_ypixel;      /* vertical size, pixels */</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">unsigned short get_cli_rows(); </span></span><br><span class="line"><span class="string">unsigned short get_cli_cols(); </span></span><br><span class="line"><span class="string">struct winsize get_size();</span></span><br><span class="line"><span class="string">CTYPE</span>, <span class="string">&#x27;libcli_size.so&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//ç»§ç»­ä¸Šé¢çš„ä»£ç </span></span><br><span class="line">var_dump(<span class="variable">$ffi</span>-&gt;get_cli_rows());</span><br><span class="line">var_dump(<span class="variable">$ffi</span>-&gt;get_cli_cols());</span><br><span class="line">var_dump(<span class="variable">$ffi</span>-&gt;get_size());</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œå®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php cli_size.php</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int(36)     // get_cli_rows()çš„ç»“æœ</span><br><span class="line">int(150)    // get_cli_cols()çš„ç»“æœ</span><br><span class="line">object(FFI\CData:struct winsize)#2 (4) &#123;    // get_size()çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯winsizeç»“æ„ä½“ï¼Œ</span><br><span class="line">  [&quot;ws_row&quot;]=&gt;</span><br><span class="line">  int(36)</span><br><span class="line">  [&quot;ws_col&quot;]=&gt;</span><br><span class="line">  int(150)</span><br><span class="line">  [&quot;ws_xpixel&quot;]=&gt;</span><br><span class="line">  int(1200)</span><br><span class="line">  [&quot;ws_ypixel&quot;]=&gt;</span><br><span class="line">  int(684)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢å¯ä»¥çœ‹å‡ºcè¯­è¨€è¿”å›çš„<code>unsigned short</code>ç±»å‹åœ¨è¿™é‡Œå˜æˆäº†phpçš„<code>int</code>, ç»“æ„ä½“<code>struct winsize</code>å˜æˆäº†ä¸€ä¸ª<code>FFI\CData</code>å¯¹è±¡ã€‚</p>
<p>é‚£æˆ‘ä»¬æ€ä¹ˆä»ç»“æ„ä½“å¯¹è±¡ä¸­å–æŸä¸€ä¸ªå±æ€§å€¼å‘¢ï¼Ÿ</p>
<p>å°±æŒ‰æ™®é€šå¯¹è±¡æ“ä½œå°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç»§ç»­ä¸Šé¢çš„ä»£ç </span></span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$ffi</span>-&gt;get_size()-&gt;ws_row);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int(36)</span><br></pre></td></tr></table></figure>

<p>å¯¹äºå…¶ä»–çš„cè¯­è¨€ç±»å‹ï¼ŒPHPå®˜æ–¹æ–‡æ¡£ä¸Šéƒ½æœ‰å¯¹åº”çš„phpç±»å‹è¯´æ˜ï¼Œå¤§å®¶å¯ä»¥<a href="https://www.php.net/manual/zh/class.ffi-cdata.php">å»çœ‹çœ‹</a>ã€‚</p>
<p>ä»¥ä¸Šç¤ºä¾‹ä»£ç éƒ½åœ¨<a href="https://github.com/heropoo/just-code/tree/master/php-ffi/cli_size">è¿™é‡Œ</a></p>
<p>å¥½äº†ï¼Œæ–°çš„ç¼–ç¨‹ä½“éªŒï¼Œå¥½ä¸é”™å§~ğŸ˜ğŸ˜ğŸ˜</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://www.php.net/manual/zh/ffi.cdef.php">https://www.php.net/manual/zh/ffi.cdef.php</a></li>
<li><a href="https://www.php.net/manual/zh/class.ffi-cdata.php">https://www.php.net/manual/zh/class.ffi-cdata.php</a></li>
</ul>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>FFI</tag>
      </tags>
  </entry>
  <entry>
    <title>phpå†·çŸ¥è¯† - ä»å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨ä¸­è·å–é€‰é¡¹</title>
    <url>/2020/04/20/php-getopt/</url>
    <content><![CDATA[<p>åˆ†äº«ä¸€ä¸ªphpçš„å†·çŸ¥è¯† - ä»å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨ä¸­è·å–é€‰é¡¹</p>
<p>ç”¨åˆ°çš„å‡½æ•°æ˜¯<code>getopt</code></p>
<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å‡½æ•°ç­¾åæ˜¯è¿™æ ·çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">getopt ( <span class="keyword">string</span> <span class="variable">$options</span> [, <span class="keyword">array</span> <span class="variable">$longopts</span> [, <span class="keyword">int</span> &amp;<span class="variable">$optind</span> ]] ) : <span class="keyword">array</span>|<span class="keyword">bool</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>è§£æä¼ å…¥è„šæœ¬çš„é€‰é¡¹ï¼ŒæˆåŠŸè¿”å›æ•°ç»„ï¼Œè§£æå¤±è´¥è¿”å›false</p>
<h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><ul>
<li><p><code>options</code> è¯¥å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¼šè¢«å½“åšé€‰é¡¹å­—ç¬¦ï¼ŒåŒ¹é…ä¼ å…¥è„šæœ¬çš„é€‰é¡¹ä»¥å•ä¸ªè¿å­—ç¬¦(-)å¼€å¤´ã€‚ æ¯”å¦‚ï¼Œä¸€ä¸ªé€‰é¡¹å­—ç¬¦ä¸² â€œxâ€ è¯†åˆ«äº†ä¸€ä¸ªé€‰é¡¹ -xã€‚ åªå…è®¸ a-zã€A-Z å’Œ 0-9ã€‚</p>
</li>
<li><p><code>longopts</code> é€‰é¡¹æ•°ç»„ã€‚æ­¤æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä¼šè¢«ä½œä¸ºé€‰é¡¹å­—ç¬¦ä¸²ï¼ŒåŒ¹é…äº†ä»¥ä¸¤ä¸ªè¿å­—ç¬¦(â€“)ä¼ å…¥åˆ°è„šæœ¬çš„é€‰é¡¹ã€‚ ä¾‹å¦‚ï¼Œé•¿é€‰é¡¹å…ƒç´  â€œoptâ€ è¯†åˆ«äº†ä¸€ä¸ªé€‰é¡¹ â€“optã€‚</p>
</li>
<li><p><code>optind</code> å¦‚æœå­˜åœ¨<code>optind</code>å‚æ•°ï¼Œåˆ™å‚æ•°è§£æåœæ­¢çš„ç´¢å¼•å°†è¢«å†™å…¥æ­¤å˜é‡ã€‚</p>
</li>
</ul>
<h3 id="å‚æ•°å€¼"><a href="#å‚æ•°å€¼" class="headerlink" title="å‚æ•°å€¼"></a>å‚æ•°å€¼</h3><p><code>options</code> å¯èƒ½åŒ…å«äº†ä»¥ä¸‹å…ƒç´ ï¼š</p>
<ul>
<li>å•ç‹¬çš„å­—ç¬¦ï¼ˆä¸æ¥å—å€¼ï¼‰</li>
<li>åé¢è·Ÿéšå†’å·çš„å­—ç¬¦ï¼ˆæ­¤é€‰é¡¹éœ€è¦å€¼ï¼‰</li>
<li>åé¢è·Ÿéšä¸¤ä¸ªå†’å·çš„å­—ç¬¦ï¼ˆæ­¤é€‰é¡¹çš„å€¼å¯é€‰ï¼‰</li>
</ul>
<p><code>options</code> å’Œ <code>longopts</code> çš„æ ¼å¼å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„ä¸åŒä¹‹å¤„æ˜¯ <code>longopts</code> éœ€è¦æ˜¯é€‰é¡¹çš„æ•°ç»„ï¼ˆæ¯ä¸ªå…ƒç´ ä¸ºä¸€ä¸ªé€‰é¡¹ï¼‰ï¼Œè€Œ <code>options</code> éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ¯ä¸ªå­—ç¬¦æ˜¯ä¸ªé€‰é¡¹ï¼‰ã€‚</p>
<h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜å§</p>
<h3 id="1-åŸºæœ¬ç”¨æ³•"><a href="#1-åŸºæœ¬ç”¨æ³•" class="headerlink" title="1. åŸºæœ¬ç”¨æ³•"></a>1. åŸºæœ¬ç”¨æ³•</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Script 1.php</span></span><br><span class="line"><span class="variable">$options</span> = getopt(<span class="string">&quot;h:p:d&quot;</span>);</span><br><span class="line">var_dump(<span class="variable">$options</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤è¡Œä¸‹æµ‹è¯•çœ‹çœ‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php 1.php -h 127.0.0.1 -p 8000 -d</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">array(3) &#123;</span><br><span class="line">  [&quot;h&quot;]=&gt;</span><br><span class="line">  string(9) &quot;127.0.0.1&quot;</span><br><span class="line">  [&quot;p&quot;]=&gt;</span><br><span class="line">  string(4) &quot;8000&quot;</span><br><span class="line">  [&quot;d&quot;]=&gt;</span><br><span class="line">  bool(false)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€‰é¡¹å‚æ•°ä¹Ÿå¯ä»¥ä¸­é—´ä¸è¦ç©ºæ ¼</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php 1.php -h 127.0.0.1 -p 8000 -d</span><br></pre></td></tr></table></figure>

<p>php5.3ä¹‹åè¿˜å¯ä»¥ä½¿ç”¨ â€œ=â€ ä½œä¸º å‚æ•°å’Œå€¼çš„åˆ†éš”ç¬¦</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php 1.php -h=127.0.0.1 -p=8000 -d</span><br></pre></td></tr></table></figure>

<h3 id="2-å¼•å…¥é•¿é€‰é¡¹"><a href="#2-å¼•å…¥é•¿é€‰é¡¹" class="headerlink" title="2. å¼•å…¥é•¿é€‰é¡¹"></a>2. å¼•å…¥é•¿é€‰é¡¹</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Script 2.php</span></span><br><span class="line"><span class="variable">$shortopts</span>  = <span class="string">&quot;&quot;</span>;       <span class="comment">// çŸ­é€‰é¡¹ ç”¨å­—æ¯å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="variable">$shortopts</span> .= <span class="string">&quot;h:&quot;</span>;     <span class="comment">// å¿…é€‰é€‰é¡¹ å­—æ¯åé¢ä¸€ä¸ªå†’å·</span></span><br><span class="line"><span class="variable">$shortopts</span> .= <span class="string">&quot;p::&quot;</span>;    <span class="comment">// å¯é€‰é€‰é¡¹ å­—æ¯åé¢ä¸¤ä¸ªå†’å·</span></span><br><span class="line"><span class="variable">$shortopts</span> .= <span class="string">&quot;vd&quot;</span>;     <span class="comment">// æ— éœ€å€¼çš„é€‰é¡¹ å­—æ¯åé¢æ²¡æœ‰å†’å·</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$longopts</span>  = <span class="keyword">array</span>(     <span class="comment">// é•¿é€‰é¡¹ ç”¨å•è¯çš„æ•°ç»„</span></span><br><span class="line">    <span class="string">&quot;host:&quot;</span>,            <span class="comment">// å¿…é€‰é€‰é¡¹ å•è¯åé¢ä¸€ä¸ªå†’å·</span></span><br><span class="line">    <span class="string">&quot;port::&quot;</span>,           <span class="comment">// å¯é€‰é€‰é¡¹ å•è¯åé¢ä¸¤ä¸ªå†’å·</span></span><br><span class="line">    <span class="string">&quot;version&quot;</span>,          <span class="comment">// æ— éœ€å€¼çš„é€‰é¡¹ å•è¯åé¢æ²¡æœ‰å†’å·</span></span><br><span class="line">    <span class="string">&quot;debug&quot;</span>,            <span class="comment">// æ— éœ€å€¼çš„é€‰é¡¹ å•è¯åé¢æ²¡æœ‰å†’å·</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$options</span> = getopt(<span class="variable">$shortopts</span>, <span class="variable">$longopts</span>);</span><br><span class="line">var_dump(<span class="variable">$options</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php 2.php -h127.0.0.1 -p8000 -d --host=127.0.0.1 --port=8000 --version --debug</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">array(7) &#123;</span><br><span class="line">  [&quot;h&quot;]=&gt;</span><br><span class="line">  string(9) &quot;127.0.0.1&quot;</span><br><span class="line">  [&quot;p&quot;]=&gt;</span><br><span class="line">  string(4) &quot;8000&quot;</span><br><span class="line">  [&quot;d&quot;]=&gt;</span><br><span class="line">  bool(false)</span><br><span class="line">  [&quot;host&quot;]=&gt;</span><br><span class="line">  string(9) &quot;127.0.0.1&quot;</span><br><span class="line">  [&quot;port&quot;]=&gt;</span><br><span class="line">  string(4) &quot;8000&quot;</span><br><span class="line">  [&quot;version&quot;]=&gt;</span><br><span class="line">  bool(false)</span><br><span class="line">  [&quot;debug&quot;]=&gt;</span><br><span class="line">  bool(false)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-åŒä¸€é€‰é¡¹å¯ä»¥ä¼ é€’å¤šæ¬¡"><a href="#3-åŒä¸€é€‰é¡¹å¯ä»¥ä¼ é€’å¤šæ¬¡" class="headerlink" title="3. åŒä¸€é€‰é¡¹å¯ä»¥ä¼ é€’å¤šæ¬¡"></a>3. åŒä¸€é€‰é¡¹å¯ä»¥ä¼ é€’å¤šæ¬¡</h3><p>è¿è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php 2.php -d -d --version --debug --port=123 --port=234</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">array(4) &#123;</span><br><span class="line">  [&quot;d&quot;]=&gt;</span><br><span class="line">  array(2) &#123;     // å¤šä¸ªé€‰é¡¹å‚æ•°å€¼ä»¥æ•°ç»„å‘ˆç°</span><br><span class="line">    [0]=&gt;</span><br><span class="line">    bool(false)</span><br><span class="line">    [1]=&gt;</span><br><span class="line">    bool(false)</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;version&quot;]=&gt;</span><br><span class="line">  bool(false)</span><br><span class="line">  [&quot;debug&quot;]=&gt;</span><br><span class="line">  bool(false)</span><br><span class="line">  [&quot;port&quot;]=&gt;</span><br><span class="line">  array(2) &#123;</span><br><span class="line">    [0]=&gt;</span><br><span class="line">    string(3) &quot;123&quot;</span><br><span class="line">    [1]=&gt;</span><br><span class="line">    string(3) &quot;234&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-ä½¿ç”¨-optind"><a href="#4-ä½¿ç”¨-optind" class="headerlink" title="4. ä½¿ç”¨ optind"></a>4. ä½¿ç”¨ optind</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Script 3.php</span></span><br><span class="line"><span class="variable">$optind</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$opts</span> = getopt(<span class="string">&#x27;a:b:&#x27;</span>, [], <span class="variable">$optind</span>);</span><br><span class="line">var_dump(<span class="variable">$argv</span>);</span><br><span class="line">var_dump(<span class="variable">$optind</span>);</span><br><span class="line"><span class="variable">$pos_args</span> = array_slice(<span class="variable">$argv</span>, <span class="variable">$optind</span>);  <span class="comment">// ä»æ•°ç»„ä¸­å–å‡ºä¸€æ®µ</span></span><br><span class="line">var_dump(<span class="variable">$pos_args</span>);</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php 3.php -a 1 -b 2 -- <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">array(7) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(7) &quot;cli.php&quot;</span><br><span class="line">  [1]=&gt;</span><br><span class="line">  string(2) &quot;-a&quot;</span><br><span class="line">  [2]=&gt;</span><br><span class="line">  string(1) &quot;1&quot;</span><br><span class="line">  [3]=&gt;</span><br><span class="line">  string(2) &quot;-b&quot;</span><br><span class="line">  [4]=&gt;</span><br><span class="line">  string(1) &quot;2&quot;</span><br><span class="line">  [5]=&gt;</span><br><span class="line">  string(2) &quot;--&quot;</span><br><span class="line">  [6]=&gt;</span><br><span class="line">  string(4) &quot;test&quot;</span><br><span class="line">&#125;</span><br><span class="line">int(6)      // $optind = 6</span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(4) &quot;test&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ä»¥åå°±å¯ä»¥å†™å‡ºæ¼‚äº®ä¼˜é›…çš„cliç¨‹åºäº†ğŸ˜ğŸ˜ğŸ˜</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://www.php.net/manual/zh/function.getopt.php">https://www.php.net/manual/zh/function.getopt.php</a></li>
</ul>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>å‘½ä»¤è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPè§£æheaderå¤´éƒ¨ä¿¡æ¯</title>
    <url>/2020/04/22/php-parse-header/</url>
    <content><![CDATA[<p>ç°åœ¨å†™æ¥å£ç»å¸¸ä¼šä½¿ç”¨headeræ¥ä¼ é€’ä¸€äº›éªŒè¯ä¿¡æ¯ï¼Œæˆ‘ä»¬ç”¨å„ç§phpæ¡†æ¶å¯ä»¥è½»æ¾çš„è·å–åˆ°ï¼Œä½†æ˜¯å®ƒåº•å±‚æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿæˆ‘ä»¬ä»Šå¤©æ¥èŠä¸€èŠã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨phpä¸­è·å–<code>get</code>å‚æ•°ï¼ˆQuery String Parametersï¼‰å¯ä»¥ä½¿ç”¨<code>$_GET</code>å…¨å±€å˜é‡ï¼Œè·å–<code>post</code>å‚æ•°ä½¿ç”¨<code>$_POST</code>å…¨å±€å˜é‡ã€‚ä½†æ˜¯æˆ‘ä»¬æƒ³è¦è·å–<code>header</code>ï¼Œå¥½åƒå´æ²¡æœ‰ä¸€ä¸ªç±»ä¼¼<code>$_HEADER</code>çš„å…¨å±€å˜é‡æ¥ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚é‚£æˆ‘ä»¬æƒ³è¦è·å–åˆ°<code>header</code>ä¿¡æ¯è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¹Ÿä¸å–å…³å­äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä»<code>$_SERVER</code>è¿™ä¸ªå…¨å±€å˜é‡ä¸­è·å–åˆ°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¿›è¡Œè¿™ä¸ªæ“ä½œï¼š</p>
<p>æˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„phpæ–‡ä»¶æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// header.php</span></span><br><span class="line"></span><br><span class="line">var_dump(<span class="variable">$_SERVER</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘çš„è®¿é—®åœ°å€æ˜¯ï¼š <a href="http://localhost/header.php">http://localhost/header.php</a></p>
<p>æˆ‘ä»¬ä½¿ç”¨<code>postman</code>å·¥å…·æˆ–è€…<code>curl</code>å‘½ä»¤è¯·æ±‚ä¸‹è¿™ä¸ªåœ°å€ï¼Œå¹¶åŠ å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªå¤´ <code>token: 123456</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">&quot;token: 123456&quot;</span> http://localhost/header.php</span><br></pre></td></tr></table></figure>

<p>åœ¨è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€é¡¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ... çœç•¥äº†å¥½å¤š</span><br><span class="line"></span><br><span class="line">[&quot;HTTP_TOKEN&quot;]=&gt;</span><br><span class="line">string(6) &quot;123456&quot;</span><br><span class="line"></span><br><span class="line">// ... çœç•¥äº†å¥½å¤š</span><br></pre></td></tr></table></figure>

<p>è€Œè¿™ä¸ª<code>HTTP_TOKEN</code>å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¼ å…¥çš„å°å†™<code>token</code>ï¼Œ åœ¨è¿™é‡Œä¹Ÿè½¬æ¢æˆäº†å¤§å†™ã€‚</p>
<p>æˆ‘ä»¬å†è¯•ä¸€ä¸ªï¼Œè¿™æ¬¡æˆ‘ä»¬ä¼ é€’ä¸¤ä¸ª<code>header</code>ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">&quot;test_token: 654321&quot;</span> -H <span class="string">&quot;token: 123456&quot;</span> http://localhost/header.php</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•å‘ç°ï¼Œæˆ‘ä»¬åœ¨è¾“å‡ºä¸­åªæ‰¾åˆ°äº†<code>HTTP_TOKEN</code>ï¼Œå´æ²¡æœ‰æ‰¾åˆ°æˆ‘ä»¬é¢„æƒ³çš„<code>HTTP_TEST_TOKEN</code>ã€‚ä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬æŠŠä¸‹åˆ’çº¿<code>_</code>æ¢æˆè¿å­—ç¬¦<code>-</code>è¯•è¯•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -H &quot;test-token: 654321&quot; -H &quot;token: 123456&quot; http://localhost/header.php</span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹è¾“å‡ºï¼Œè¿™ä¸‹ä¸¤ä¸ª<code>header</code>éƒ½æ‰¾åˆ°äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ... çœç•¥äº†å¥½å¤š</span><br><span class="line"></span><br><span class="line">[&quot;HTTP_TEST_TOKEN&quot;]=&gt;</span><br><span class="line">string(6) &quot;654321&quot;</span><br><span class="line">[&quot;HTTP_TOKEN&quot;]=&gt;</span><br><span class="line">string(6) &quot;123456&quot;</span><br><span class="line"></span><br><span class="line">// ... çœç•¥äº†å¥½å¤š</span><br></pre></td></tr></table></figure>

<p>ç»¼ä¸Šæ‰€è¿°ï¼šä¼ é€’<code>header</code>çš„é”®å€¼ï¼Œåªèƒ½æ˜¯å•ä¸ªè¯æˆ–è€…ä»¥ä¸­åˆ’çº¿<code>-</code>è¿æ¥çš„è¯ã€‚ä¸ç„¶phpä¼šå¿½ç•¥ã€‚</p>
<p>å¥½äº†æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåªè¦æŠŠ<code>$_SERVER</code>ä¸­çš„ä»¥<code>HTTP_</code>å¼€å¤´çš„ä¸‹æ ‡éƒ½æå–å‡ºæ¥ç„¶åè½¬æ¢æˆé¦–å­—æ¯å¤§å†™çš„æ ¼å¼å°±å¥½äº†ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse_headers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$headers</span> = [];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_SERVER</span> <span class="keyword">as</span> <span class="variable">$name</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (substr(<span class="variable">$name</span>, <span class="number">0</span>, <span class="number">5</span>) == <span class="string">&#x27;HTTP_&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$headers</span>[str_replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;-&#x27;</span>, ucwords(strtolower(str_replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27; &#x27;</span>, substr(<span class="variable">$name</span>, <span class="number">5</span>)))))] = <span class="variable">$value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$headers</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$headers</span> = parse_headers();</span><br><span class="line">var_dump(<span class="variable">$headers</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">array(5) &#123;</span><br><span class="line">  [&quot;Host&quot;]=&gt;</span><br><span class="line">  string(9) &quot;localhost&quot;</span><br><span class="line">  [&quot;User-Agent&quot;]=&gt;</span><br><span class="line">  string(11) &quot;curl/7.65.3&quot;</span><br><span class="line">  [&quot;Accept&quot;]=&gt;</span><br><span class="line">  string(3) &quot;*/*&quot;</span><br><span class="line">  [&quot;X-Token&quot;]=&gt;</span><br><span class="line">  string(6) &quot;654321&quot;</span><br><span class="line">  [&quot;Token&quot;]=&gt;</span><br><span class="line">  string(6) &quot;123456&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œæœ‰æ¨¡æœ‰æ ·ï¼Œå®Œç¾ï¼âœŒğŸ¤“ğŸ˜</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>RedisåŠ é”çš„å‡ ç§å®ç°</title>
    <url>/2020/04/24/redis-lock/</url>
    <content><![CDATA[<p>æˆ‘ä»¬ç»å¸¸åœ¨å·¥ä½œä¸­ä¼šç¢°åˆ°ä¸€äº›é‡å¤è¯·æ±‚ã€å¹¶å‘ç­‰é—®é¢˜ï¼Œè€Œç»™èµ„æºåŠ é”æ˜¯ä¸€ç§ä¸é”™çš„æ‰‹æ®µã€‚æˆ‘ä»¬ä»Šå¤©å°±æ•´ç†ä¸‹ä½¿ç”¨<code>redis</code>ä½œä¸ºåˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°ã€‚</p>
<p><code>redis</code>å¯ä»¥ç”¨äºå‡ ä¸ªå‘½ä»¤æ˜¯ï¼š<code>INCR</code>ã€<code>SETNX</code>å’Œ<code>SET</code>ã€‚</p>
<h2 id="1-ä½¿ç”¨INCRåŠ é”"><a href="#1-ä½¿ç”¨INCRåŠ é”" class="headerlink" title="1. ä½¿ç”¨INCRåŠ é”"></a>1. ä½¿ç”¨<code>INCR</code>åŠ é”</h2><p>è¿™ç§åŠ é”çš„æ€è·¯æ˜¯ï¼Œ <code>key</code> ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ <code>key</code> çš„å€¼ä¼šå…ˆè¢«åˆå§‹åŒ–ä¸º 0 ï¼Œç„¶åå†æ‰§è¡Œ <code>INCR</code> æ“ä½œè¿›è¡ŒåŠ ä¸€ã€‚ç„¶åå…¶å®ƒç”¨æˆ·åœ¨æ‰§è¡Œ <code>INCR</code> æ“ä½œè¿›è¡ŒåŠ ä¸€æ—¶ï¼Œå¦‚æœè¿”å›çš„æ•°å¤§äº <code>1</code> ï¼Œè¯´æ˜è¿™ä¸ªé”æ­£åœ¨è¢«ä½¿ç”¨å½“ä¸­ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">  1ã€ å®¢æˆ·ç«¯Aè¯·æ±‚æœåŠ¡å™¨è·å–keyçš„å€¼ä¸º1è¡¨ç¤ºè·å–äº†é”</span></span><br><span class="line"><span class="comment">  2ã€ å®¢æˆ·ç«¯Bä¹Ÿå»è¯·æ±‚æœåŠ¡å™¨è·å–keyçš„å€¼ä¸º2è¡¨ç¤ºè·å–é”å¤±è´¥</span></span><br><span class="line"><span class="comment">  3ã€ å®¢æˆ·ç«¯Aæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</span></span><br><span class="line"><span class="comment">  4ã€ å®¢æˆ·ç«¯Båœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ååœ¨å»è¯·æ±‚çš„æ—¶å€™è·å–keyçš„å€¼ä¸º1è¡¨ç¤ºè·å–é”æˆåŠŸ</span></span><br><span class="line"><span class="comment">  5ã€ å®¢æˆ·ç«¯Bæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$redis</span>-&gt;incr(<span class="variable">$key</span>);  <span class="comment">// è‡ªå¢1</span></span><br><span class="line"><span class="variable">$redis</span>-&gt;expire(<span class="variable">$key</span>, <span class="variable">$ttl</span>); <span class="comment">// è®¾ç½®é”çš„æœ‰æ•ˆæœŸ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span> == <span class="number">1</span>)&#123;  </span><br><span class="line">    <span class="comment">// è·å–èµ„æºæˆåŠŸ</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// èµ„æºè¢«å…¶ä»–è¯·æ±‚å ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-ä½¿ç”¨SETNXåŠ é”"><a href="#2-ä½¿ç”¨SETNXåŠ é”" class="headerlink" title="2. ä½¿ç”¨SETNXåŠ é”"></a>2. ä½¿ç”¨<code>SETNX</code>åŠ é”</h2><p>è¿™ç§åŠ é”çš„æ€è·¯æ˜¯ï¼Œå¦‚æœ <code>key</code> ä¸å­˜åœ¨ï¼Œå°† <code>key</code> è®¾ç½®ä¸º <code>value</code>ï¼Œå¦‚æœ <code>key</code> å·²å­˜åœ¨ï¼Œåˆ™ <code>SETNX</code> ä¸åšä»»ä½•åŠ¨ä½œã€‚ </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> 1ã€ å®¢æˆ·ç«¯Aè¯·æ±‚æœåŠ¡å™¨è®¾ç½®keyçš„å€¼ï¼Œå¦‚æœè®¾ç½®æˆåŠŸå°±è¡¨ç¤ºåŠ é”æˆåŠŸ</span></span><br><span class="line"><span class="comment"> 2ã€ å®¢æˆ·ç«¯Bä¹Ÿå»è¯·æ±‚æœåŠ¡å™¨è®¾ç½®keyçš„å€¼ï¼Œå¦‚æœè¿”å›å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä»£è¡¨åŠ é”å¤±è´¥</span></span><br><span class="line"><span class="comment"> 3ã€ å®¢æˆ·ç«¯Aæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</span></span><br><span class="line"><span class="comment"> 4ã€ å®¢æˆ·ç«¯Båœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ååœ¨å»è¯·æ±‚è®¾ç½®keyçš„å€¼ï¼Œè®¾ç½®æˆåŠŸ</span></span><br><span class="line"><span class="comment"> 5ã€ å®¢æˆ·ç«¯Bæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$redis</span>-&gt;setNX(<span class="variable">$key</span>, <span class="variable">$value</span>); <span class="comment">// å½“keyä¸å­˜åœ¨æ—¶è®¾ç½®key=value</span></span><br><span class="line"><span class="variable">$redis</span>-&gt;expire(<span class="variable">$key</span>, <span class="variable">$ttl</span>); <span class="comment">// è®¾ç½®é”çš„æœ‰æ•ˆæœŸ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span>)&#123;  </span><br><span class="line">    <span class="comment">// è·å–èµ„æºæˆåŠŸ</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// èµ„æºè¢«å…¶ä»–è¯·æ±‚å ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä¸¤ç§æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¼šå‘ç°ï¼Œéƒ½éœ€è¦è®¾ç½® <code>key</code> è¿‡æœŸæ—¶é—´ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾ç½®<code>key</code>è¿‡æœŸæ—¶é—´å‘¢ï¼Ÿå¦‚æœè¯·æ±‚æ‰§è¡Œå› ä¸ºæŸäº›åŸå› æ„å¤–é€€å‡ºäº†ï¼Œå¯¼è‡´åˆ›å»ºäº†é”ä½†æ˜¯æ²¡æœ‰åˆ é™¤é”ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°†ä¸€ç›´å­˜åœ¨ï¼ˆredisä¸è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æ˜¯æ°¸ä¹…çš„ï¼‰ï¼Œä»¥è‡³äºä¸€ç›´å¤„äºåŠ é”çŠ¶æ€ã€‚äºæ˜¯ä¹æˆ‘ä»¬éœ€è¦ç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´ä»¥é˜²ä¸æµ‹ã€‚</p>
<p>ä½†æ˜¯å€ŸåŠ© <code>Expire</code> æ¥è®¾ç½®å°±ä¸æ˜¯åŸå­æ€§æ“ä½œäº†ã€‚æ‰€ä»¥è¿˜å¯ä»¥é€šè¿‡<code>redis</code>äº‹åŠ¡æ¥ç¡®ä¿åŸå­æ€§ã€‚é‚£ä¸Šé¢çš„ä»£ç å°±è¦ä¼˜åŒ–æˆï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç§æ–¹å¼çš„åŠ é”</span></span><br><span class="line"><span class="variable">$redis</span>-&gt;multi();    <span class="comment">// æ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹</span></span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$redis</span>-&gt;incr(<span class="variable">$key</span>);  </span><br><span class="line"><span class="variable">$redis</span>-&gt;expire(<span class="variable">$key</span>, <span class="variable">$ttl</span>);</span><br><span class="line"><span class="variable">$redis</span>-&gt;exec();   <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span> == <span class="number">1</span>)&#123;  </span><br><span class="line">    <span class="comment">// è·å–èµ„æºæˆåŠŸ</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// èµ„æºè¢«å…¶ä»–è¯·æ±‚å ç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§æ–¹å¼çš„åŠ é”</span></span><br><span class="line"><span class="variable">$redis</span>-&gt;multi();    <span class="comment">// æ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹</span></span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$redis</span>-&gt;setNX(<span class="variable">$key</span>, <span class="variable">$value</span>); </span><br><span class="line"><span class="variable">$redis</span>-&gt;expire(<span class="variable">$key</span>, <span class="variable">$ttl</span>); </span><br><span class="line"><span class="variable">$redis</span>-&gt;exec();   <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span>)&#123;  </span><br><span class="line">    <span class="comment">// è·å–èµ„æºæˆåŠŸ</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// èµ„æºè¢«å…¶ä»–è¯·æ±‚å ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç¹çã€‚å¥½åœ¨<code>redis</code>å®˜æ–¹ä»ç‰ˆæœ¬ 2.6.12 å¼€å§‹ <code>SET</code> å‘½ä»¤æœ¬èº«å·²ç»åŒ…å«äº†è®¾ç½®è¿‡æœŸæ—¶é—´çš„åŠŸèƒ½ã€‚</p>
<h2 id="3-ä½¿ç”¨SETåŠ é”"><a href="#3-ä½¿ç”¨SETåŠ é”" class="headerlink" title="3. ä½¿ç”¨SETåŠ é”"></a>3. ä½¿ç”¨<code>SET</code>åŠ é”</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> 1ã€ å®¢æˆ·ç«¯Aè¯·æ±‚æœåŠ¡å™¨è®¾ç½®keyçš„å€¼ï¼Œå¦‚æœè®¾ç½®æˆåŠŸå°±è¡¨ç¤ºåŠ é”æˆåŠŸ</span></span><br><span class="line"><span class="comment"> 2ã€ å®¢æˆ·ç«¯Bä¹Ÿå»è¯·æ±‚æœåŠ¡å™¨è®¾ç½®keyçš„å€¼ï¼Œå¦‚æœè¿”å›å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä»£è¡¨åŠ é”å¤±è´¥</span></span><br><span class="line"><span class="comment"> 3ã€ å®¢æˆ·ç«¯Aæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</span></span><br><span class="line"><span class="comment"> 4ã€ å®¢æˆ·ç«¯Båœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ååœ¨å»è¯·æ±‚è®¾ç½®keyçš„å€¼ï¼Œè®¾ç½®æˆåŠŸ</span></span><br><span class="line"><span class="comment"> 5ã€ å®¢æˆ·ç«¯Bæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</span></span><br><span class="line"><span class="comment">**/</span>    </span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$redis</span>-&gt;set(<span class="variable">$key</span>, <span class="variable">$value</span>, [<span class="string">&#x27;nx&#x27;</span>, <span class="string">&#x27;ex&#x27;</span> =&gt; <span class="variable">$ttl</span>]);  <span class="comment">//nxä»£è¡¨å½“keyä¸å­˜åœ¨æ—¶è®¾ç½® exä»£è¡¨è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$res</span>)&#123;  </span><br><span class="line">    <span class="comment">// è·å–èµ„æºæˆåŠŸ</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// èµ„æºè¢«å…¶ä»–è¯·æ±‚å ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-å…¶ä»–é—®é¢˜"><a href="#4-å…¶ä»–é—®é¢˜" class="headerlink" title="4. å…¶ä»–é—®é¢˜"></a>4. å…¶ä»–é—®é¢˜</h2><p>è™½ç„¶ä¸Šé¢ä¸€æ­¥å·²ç»æ»¡è¶³äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ˜¯è¿˜æ˜¯è¦è€ƒè™‘å…¶å®ƒé—®é¢˜ï¼Ÿ</p>
<ul>
<li>1ã€ rediså‘ç°é”å¤±è´¥äº†è¦æ€ä¹ˆåŠï¼Ÿä¸­æ–­è¯·æ±‚è¿˜æ˜¯å¾ªç¯è¯·æ±‚ï¼Ÿ</li>
<li>2ã€ å¾ªç¯è¯·æ±‚çš„è¯ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè·å–äº†é”ï¼Œå…¶å®ƒçš„åœ¨å»è·å–é”çš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯å®¹æ˜“å‘ç”ŸæŠ¢é”çš„å¯èƒ½ï¼Ÿ</li>
<li>3ã€ é”æå‰è¿‡æœŸåï¼Œå®¢æˆ·ç«¯Aè¿˜æ²¡æ‰§è¡Œå®Œï¼Œç„¶åå®¢æˆ·ç«¯Bè·å–åˆ°äº†é”ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯Aæ‰§è¡Œå®Œäº†ï¼Œä¼šä¸ä¼šåœ¨åˆ é”çš„æ—¶å€™æŠŠBçš„é”ç»™åˆ æ‰ï¼Ÿ</li>
</ul>
<h2 id="5-è§£å†³åŠæ³•"><a href="#5-è§£å†³åŠæ³•" class="headerlink" title="5. è§£å†³åŠæ³•"></a>5. è§£å†³åŠæ³•</h2><ul>
<li>é’ˆå¯¹é—®é¢˜1ï¼šä½¿ç”¨å¾ªç¯è¯·æ±‚ï¼Œå¾ªç¯è¯·æ±‚å»è·å–é”</li>
<li>é’ˆå¯¹é—®é¢˜2ï¼šé’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œåœ¨å¾ªç¯è¯·æ±‚è·å–é”çš„æ—¶å€™ï¼ŒåŠ å…¥ç¡çœ åŠŸèƒ½ï¼Œç­‰å¾…å‡ æ¯«ç§’åœ¨æ‰§è¡Œå¾ªç¯</li>
<li>é’ˆå¯¹é—®é¢˜3ï¼šåœ¨åŠ é”çš„æ—¶å€™å­˜å…¥çš„keyæ˜¯éšæœºçš„ã€‚è¿™æ ·çš„è¯ï¼Œæ¯æ¬¡åœ¨åˆ é™¤keyçš„æ—¶å€™åˆ¤æ–­ä¸‹å­˜å…¥çš„keyé‡Œçš„valueå’Œè‡ªå·±å­˜çš„æ˜¯å¦ä¸€æ ·<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;  <span class="comment">//é’ˆå¯¹é—®é¢˜1ï¼Œä½¿ç”¨å¾ªç¯</span></span><br><span class="line">    <span class="variable">$timeout</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable">$roomid</span> = <span class="number">10001</span>;</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&#x27;room_lock&#x27;</span>;</span><br><span class="line">    <span class="variable">$value</span> = <span class="string">&#x27;room_&#x27;</span>.<span class="variable">$roomid</span>;  <span class="comment">//åˆ†é…ä¸€ä¸ªéšæœºçš„å€¼é’ˆå¯¹é—®é¢˜3</span></span><br><span class="line">    <span class="variable">$isLock</span> = <span class="variable">$redis</span>-&gt;set(<span class="variable">$key</span>, <span class="variable">$value</span>, <span class="string">&#x27;ex&#x27;</span>, <span class="variable">$timeout</span>, <span class="string">&#x27;nx&#x27;</span>);<span class="comment">//ex ç§’</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$isLock</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$redis</span>-&gt;get(<span class="variable">$key</span>) == <span class="variable">$value</span>) &#123;  <span class="comment">//é˜²æ­¢æå‰è¿‡æœŸï¼Œè¯¯åˆ å…¶å®ƒè¯·æ±‚åˆ›å»ºçš„é”</span></span><br><span class="line">            <span class="comment">//æ‰§è¡Œå†…éƒ¨ä»£ç </span></span><br><span class="line">            <span class="variable">$redos</span>-&gt;del(<span class="variable">$key</span>);</span><br><span class="line">            <span class="keyword">continue</span>;<span class="comment">//æ‰§è¡ŒæˆåŠŸåˆ é™¤keyå¹¶è·³å‡ºå¾ªç¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        usleep(<span class="number">5000</span>); <span class="comment">//ç¡çœ ï¼Œé™ä½æŠ¢é”é¢‘ç‡ï¼Œç¼“è§£rediså‹åŠ›ï¼Œé’ˆå¯¹é—®é¢˜2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span>(!<span class="variable">$isLock</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul>
<li><a href="http://ukagaka.github.io/php/2017/09/21/redisLock.html">http://ukagaka.github.io/php/2017/09/21/redisLock.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Redis</tag>
        <tag>ç¼“å­˜</tag>
      </tags>
  </entry>
  <entry>
    <title>phpå†·çŸ¥è¯† - è¾“å‡ºæ§åˆ¶å‡½æ•°</title>
    <url>/2020/04/29/php-func-ob/</url>
    <content><![CDATA[<p>å¤§å®¶åœ¨å·¥ä½œä¸­åº”è¯¥ä¹Ÿç”¨è¿‡<code>ob_start()</code>ã€<code>ob_clean()</code>ã€<code>ob_get_contents()</code>ç­‰è¿™ç±»çš„è¾“å‡ºæ§åˆ¶å‡½æ•°ï¼Œæˆ‘ä»¬ä»Šå¤©å°±æ¥è¯¦ç»†èŠèŠå®ƒä»¬ã€‚</p>
<h2 id="å¸¸ç”¨çš„å‡½æ•°æœ‰è¿™äº›ï¼š"><a href="#å¸¸ç”¨çš„å‡½æ•°æœ‰è¿™äº›ï¼š" class="headerlink" title="å¸¸ç”¨çš„å‡½æ•°æœ‰è¿™äº›ï¼š"></a>å¸¸ç”¨çš„å‡½æ•°æœ‰è¿™äº›ï¼š</h2><ul>
<li>ob_start â€” æ‰“å¼€è¾“å‡ºæ§åˆ¶ç¼“å†²</li>
<li>ob_clean â€” æ¸…ç©ºï¼ˆæ“¦æ‰ï¼‰è¾“å‡ºç¼“å†²åŒº</li>
<li>ob_end_clean â€” æ¸…ç©ºï¼ˆæ“¦é™¤ï¼‰ç¼“å†²åŒºå¹¶å…³é—­è¾“å‡ºç¼“å†²</li>
<li>ob_get_clean â€” å¾—åˆ°å½“å‰ç¼“å†²åŒºçš„å†…å®¹å¹¶åˆ é™¤å½“å‰è¾“å‡ºç¼“ã€‚</li>
<li>ob_get_contents â€” è¿”å›è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹</li>
<li>ob_end_flush â€” å†²åˆ·å‡ºï¼ˆé€å‡ºï¼‰è¾“å‡ºç¼“å†²åŒºå†…å®¹å¹¶å…³é—­ç¼“å†²</li>
<li>ob_flush â€” å†²åˆ·å‡ºï¼ˆé€å‡ºï¼‰è¾“å‡ºç¼“å†²åŒºä¸­çš„å†…å®¹</li>
<li>ob_get_flush â€” åˆ·å‡ºï¼ˆé€å‡ºï¼‰ç¼“å†²åŒºå†…å®¹ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›å†…å®¹ï¼Œå¹¶å…³é—­è¾“å‡ºç¼“å†²åŒºã€‚</li>
<li>flush â€” åˆ·æ–°è¾“å‡ºç¼“å†²</li>
<li>ob_get_length â€” è¿”å›è¾“å‡ºç¼“å†²åŒºå†…å®¹çš„é•¿åº¦</li>
<li>ob_get_level â€” è¿”å›è¾“å‡ºç¼“å†²æœºåˆ¶çš„åµŒå¥—çº§åˆ«</li>
<li>ob_get_status â€” å¾—åˆ°æ‰€æœ‰è¾“å‡ºç¼“å†²åŒºçš„çŠ¶æ€</li>
</ul>
<h2 id="æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ï¼š"><a href="#æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ï¼š" class="headerlink" title="æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ï¼š"></a>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ï¼š</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é»˜è®¤çš„ç¼“å†²çº§åˆ«æ˜¯0ï¼Œob_start()ä¹‹ååŠ ä¸€</span></span><br><span class="line"><span class="keyword">if</span> (ob_get_level() == <span class="number">0</span>) ob_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">10</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt; Line to show.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    ob_flush();</span><br><span class="line">    flush();</span><br><span class="line">    sleep(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Done.&quot;</span>;</span><br><span class="line"></span><br><span class="line">ob_end_flush();</span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨è¿è¡Œå®ƒï¼Œå‘ç°æ¯ä¸¤ç§’è¾“å‡ºä¸€è¡Œã€‚</p>
<p>(æœªå®Œå¾…ç»­)</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>è¾“å‡ºæ§åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå¸¸ç”¨iptablesé…ç½®</title>
    <url>/2020/04/30/iptables/</url>
    <content><![CDATA[<p>åˆ†äº«Linuxå¸¸ç”¨iptablesé…ç½®</p>
<h2 id="æŸ¥çœ‹è§„åˆ™"><a href="#æŸ¥çœ‹è§„åˆ™" class="headerlink" title="æŸ¥çœ‹è§„åˆ™"></a>æŸ¥çœ‹è§„åˆ™</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -L -n -v </span><br></pre></td></tr></table></figure>

<h2 id="æ¸…é™¤é¢„è®¾è¡¨filterä¸­çš„æ‰€æœ‰è§„åˆ™é“¾çš„è§„åˆ™"><a href="#æ¸…é™¤é¢„è®¾è¡¨filterä¸­çš„æ‰€æœ‰è§„åˆ™é“¾çš„è§„åˆ™" class="headerlink" title="æ¸…é™¤é¢„è®¾è¡¨filterä¸­çš„æ‰€æœ‰è§„åˆ™é“¾çš„è§„åˆ™"></a>æ¸…é™¤é¢„è®¾è¡¨filterä¸­çš„æ‰€æœ‰è§„åˆ™é“¾çš„è§„åˆ™</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -F</span><br></pre></td></tr></table></figure>

<h2 id="æ¸…é™¤é¢„è®¾è¡¨filterä¸­ä½¿ç”¨è€…è‡ªå®šé“¾ä¸­çš„è§„åˆ™"><a href="#æ¸…é™¤é¢„è®¾è¡¨filterä¸­ä½¿ç”¨è€…è‡ªå®šé“¾ä¸­çš„è§„åˆ™" class="headerlink" title="æ¸…é™¤é¢„è®¾è¡¨filterä¸­ä½¿ç”¨è€…è‡ªå®šé“¾ä¸­çš„è§„åˆ™"></a>æ¸…é™¤é¢„è®¾è¡¨filterä¸­ä½¿ç”¨è€…è‡ªå®šé“¾ä¸­çš„è§„åˆ™</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -X</span><br></pre></td></tr></table></figure>

<h2 id="è®¡æ•°å™¨æ¸…é›¶"><a href="#è®¡æ•°å™¨æ¸…é›¶" class="headerlink" title="è®¡æ•°å™¨æ¸…é›¶"></a>è®¡æ•°å™¨æ¸…é›¶</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -Z</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸æœ¬æœºå›ç¯ç½‘å¡é€šä¿¡ï¼Œåœ¨INPUTé“¾"><a href="#å…è®¸æœ¬æœºå›ç¯ç½‘å¡é€šä¿¡ï¼Œåœ¨INPUTé“¾" class="headerlink" title="å…è®¸æœ¬æœºå›ç¯ç½‘å¡é€šä¿¡ï¼Œåœ¨INPUTé“¾"></a>å…è®¸æœ¬æœºå›ç¯ç½‘å¡é€šä¿¡ï¼Œåœ¨INPUTé“¾</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -i lo -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="æ¥å—å·²ç»å»ºç«‹è¿æ¥çš„TCPè¿æ¥ï¼ˆçŠ¶æ€é˜²ç«å¢™èƒ½è¯†åˆ«TCPæˆ–è€…UDPä¼šè¯éçŠ¶æ€é˜²ç«å¢™åªèƒ½æ ¹æ®ç«¯å£è¯†åˆ«ï¼Œä¸èƒ½è¯†åˆ«ä¼šè¯ï¼‰"><a href="#æ¥å—å·²ç»å»ºç«‹è¿æ¥çš„TCPè¿æ¥ï¼ˆçŠ¶æ€é˜²ç«å¢™èƒ½è¯†åˆ«TCPæˆ–è€…UDPä¼šè¯éçŠ¶æ€é˜²ç«å¢™åªèƒ½æ ¹æ®ç«¯å£è¯†åˆ«ï¼Œä¸èƒ½è¯†åˆ«ä¼šè¯ï¼‰" class="headerlink" title="æ¥å—å·²ç»å»ºç«‹è¿æ¥çš„TCPè¿æ¥ï¼ˆçŠ¶æ€é˜²ç«å¢™èƒ½è¯†åˆ«TCPæˆ–è€…UDPä¼šè¯éçŠ¶æ€é˜²ç«å¢™åªèƒ½æ ¹æ®ç«¯å£è¯†åˆ«ï¼Œä¸èƒ½è¯†åˆ«ä¼šè¯ï¼‰"></a>æ¥å—å·²ç»å»ºç«‹è¿æ¥çš„TCPè¿æ¥ï¼ˆçŠ¶æ€é˜²ç«å¢™èƒ½è¯†åˆ«TCPæˆ–è€…UDPä¼šè¯éçŠ¶æ€é˜²ç«å¢™åªèƒ½æ ¹æ®ç«¯å£è¯†åˆ«ï¼Œä¸èƒ½è¯†åˆ«ä¼šè¯ï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -m state --state RELATED,ESTABLISHED  -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸ping"><a href="#å…è®¸ping" class="headerlink" title="å…è®¸ping"></a>å…è®¸ping</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -p icmp --icmp-type any -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸web"><a href="#å…è®¸web" class="headerlink" title="å…è®¸web"></a>å…è®¸web</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸SSH"><a href="#å…è®¸SSH" class="headerlink" title="å…è®¸SSH"></a>å…è®¸SSH</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸mysql"><a href="#å…è®¸mysql" class="headerlink" title="å…è®¸mysql"></a>å…è®¸mysql</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -p tcp --dport 3306 -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸svnserve"><a href="#å…è®¸svnserve" class="headerlink" title="å…è®¸svnserve"></a>å…è®¸svnserve</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -p tcp --dport 3690 -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸192-168-8-11è®¿é—®9000ç«¯å£-php-fpm"><a href="#å…è®¸192-168-8-11è®¿é—®9000ç«¯å£-php-fpm" class="headerlink" title="å…è®¸192.168.8.11è®¿é—®9000ç«¯å£(php-fpm)"></a>å…è®¸192.168.8.11è®¿é—®9000ç«¯å£(php-fpm)</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -p tcp -s 192.168.8.11 --dport 9000 -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="å…è®¸192-168-8-0ç½‘æ®µ"><a href="#å…è®¸192-168-8-0ç½‘æ®µ" class="headerlink" title="å…è®¸192.168.8.0ç½‘æ®µ"></a>å…è®¸192.168.8.0ç½‘æ®µ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -A INPUT -p tcp -s 192.168.8.0/24 -j ACCEPT</span><br></pre></td></tr></table></figure>

<h2 id="æœ€åé»˜è®¤è§„åˆ™è®¾ç½®ä¸ºæ‹’ç»æ‰€æœ‰"><a href="#æœ€åé»˜è®¤è§„åˆ™è®¾ç½®ä¸ºæ‹’ç»æ‰€æœ‰" class="headerlink" title="æœ€åé»˜è®¤è§„åˆ™è®¾ç½®ä¸ºæ‹’ç»æ‰€æœ‰"></a>æœ€åé»˜è®¤è§„åˆ™è®¾ç½®ä¸ºæ‹’ç»æ‰€æœ‰</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/sbin/iptables -P INPUT DROP</span><br></pre></td></tr></table></figure>

<h2 id="é‡å¯ååˆé»˜è®¤é‡æ–°åŠ è½½-etc-sysconfig-iptablesé˜²ç«å¢™é…ç½®æ–‡ä»¶"><a href="#é‡å¯ååˆé»˜è®¤é‡æ–°åŠ è½½-etc-sysconfig-iptablesé˜²ç«å¢™é…ç½®æ–‡ä»¶" class="headerlink" title="é‡å¯ååˆé»˜è®¤é‡æ–°åŠ è½½/etc/sysconfig/iptablesé˜²ç«å¢™é…ç½®æ–‡ä»¶"></a>é‡å¯ååˆé»˜è®¤é‡æ–°åŠ è½½/etc/sysconfig/iptablesé˜²ç«å¢™é…ç½®æ–‡ä»¶</h2><ul>
<li>1.å¦‚æœæƒ³æŠŠå½“å‰æ·»åŠ çš„è§„åˆ™åœ¨é‡å¯åä»èƒ½ä½¿ç”¨ï¼Œå¯ä»¥å…ˆé€šè¿‡<code>/sbin/service iptables save</code>å°†å½“å‰è§„åˆ™ä¿å­˜è‡³é…ç½®æ–‡ä»¶ä¸­ï¼Œè¯¥æ“ä½œå°†æ‰§è¡Œ<code>iptables</code>åˆå§‹åŒ–è„šæœ¬ï¼Œè„šæœ¬è¿è¡Œ<code>/sbin/iptables-save</code>ç¨‹åºå¹¶æ›´æ–°å½“å‰çš„<code>iptables</code>ï¼ŒåŸæ¥çš„é…ç½®æ–‡ä»¶ä¿å­˜ä¸º<code>iptables.save</code>ã€‚</li>
<li>2.ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¿å­˜çš„é…ç½®æ–‡ä»¶<code>iptables-save &gt; é…ç½®æ–‡ä»¶å</code>ï¼Œå¦‚æœæƒ³æ¢å¤æŸä¸ªé…ç½®åˆ™æ‰§è¡Œ<code>iptables-restore &lt; é…ç½®æ–‡ä»¶å</code></li>
<li>3.å¯¹äºåº”ç”¨<code>iptables</code>è§„åˆ™åï¼Œæƒ³è¦æ¢å¤æœ¬æœºé»˜è®¤çš„è§„åˆ™ï¼Œæ‰§è¡Œ<code>service iptables restart</code> ï¼Œé‡æ–°åŠ è½½<code>/etc/sysconfig/iptables</code> æ–‡ä»¶ã€‚ï¼ˆæ­¤æ—¶è²Œä¼¼<code>iptables-restore &lt; /etc/sysconfig/iptables</code> ä¸èµ·ä½œç”¨ï¼‰</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title>æ€ä¹ˆæŸ¥çœ‹gitä»“åº“å½“å‰çš„åˆ†æ”¯ã€æœ€åä¸€æ¬¡commitIdã€tagç­‰</title>
    <url>/2020/05/06/git-log-tag-more/</url>
    <content><![CDATA[<p>æœ€è¿‘æƒ³æŠŠé¡¹ç›®çš„gitä»“åº“ç‰ˆæœ¬ä½œä¸ºé¡¹ç›®ç‰ˆæœ¬æ¥ä½¿ç”¨ï¼Œå°±ç ”ç©¶äº†ä¸‹ï¼Œåšç‚¹ç¬”è®°ã€‚</p>
<h2 id="æŸ¥çœ‹å½“å‰åˆ†æ”¯åç§°"><a href="#æŸ¥çœ‹å½“å‰åˆ†æ”¯åç§°" class="headerlink" title="æŸ¥çœ‹å½“å‰åˆ†æ”¯åç§°"></a>æŸ¥çœ‹å½“å‰åˆ†æ”¯åç§°</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git symbolic-ref --short -q HEAD</span><br><span class="line"><span class="comment"># è¾“å‡º master</span></span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹å½“å‰æœ€åä¸€æ¬¡æäº¤çš„commit-id"><a href="#æŸ¥çœ‹å½“å‰æœ€åä¸€æ¬¡æäº¤çš„commit-id" class="headerlink" title="æŸ¥çœ‹å½“å‰æœ€åä¸€æ¬¡æäº¤çš„commit_id"></a>æŸ¥çœ‹å½“å‰æœ€åä¸€æ¬¡æäº¤çš„commit_id</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> -1 --pretty=format:%H <span class="comment"># å®Œæ•´çš„</span></span><br><span class="line"><span class="comment"># è¾“å‡º 7b6b2803d2b7135b239d062847816e55a810371e</span></span><br><span class="line">git <span class="built_in">log</span> -1 --pretty=format:%h <span class="comment"># å‰7ä½</span></span><br><span class="line"><span class="comment"># è¾“å‡º 7b6b280</span></span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤çš„æ—¶é—´"><a href="#æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤çš„æ—¶é—´" class="headerlink" title="æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤çš„æ—¶é—´"></a>æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤çš„æ—¶é—´</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> -1 --format=<span class="string">&quot;%ct&quot;</span></span><br><span class="line">è¾“å‡º 1588759297</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¾“å‡ºæ˜¯unixæ—¶é—´æˆ³ï¼Œéœ€è¦è‡ªå·±è½¬æ¢ä¸‹ï¼Œå¦‚æœåœ¨shellä¸­å¯ä»¥è¿™ä¹ˆå†™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">commit_ts=`git <span class="built_in">log</span> -1 --format=<span class="string">&quot;%ct&quot;</span>`</span><br><span class="line">sys=`uname`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$sys</span> = <span class="string">&quot;Darwin&quot;</span> ] </span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  commit_time=`date -r<span class="variable">$&#123;commit_ts&#125;</span> +<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>`</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  commit_time=`date -d @<span class="variable">$&#123;commit_ts&#125;</span> +<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>`</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$commit_time</span></span><br></pre></td></tr></table></figure>

<p>MacOSå’ŒLinuxæœ‰å·®åˆ«ï¼Œåšä¸ªç³»ç»Ÿåˆ¤æ–­</p>
<h2 id="æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤å¯¹åº”çš„tag"><a href="#æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤å¯¹åº”çš„tag" class="headerlink" title="æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤å¯¹åº”çš„tag"></a>æŸ¥çœ‹æœ€åä¸€æ¬¡æäº¤å¯¹åº”çš„tag</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> -1 --decorate=short --oneline|grep -Eo <span class="string">&#x27;tag: (.*)[,)]+&#x27;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|sed <span class="string">&#x27;s/)//g&#x27;</span>|sed <span class="string">&#x27;s/,//g&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨<code>git log -1 --decorate=short --oneline</code>ï¼Œè¾“å‡º</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">e4df105 (HEAD -&gt; develop, tag: v0.1.1, origin/develop) æµ‹è¯•æäº¤</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨grepæ­£åˆ™è¡¨è¾¾å¼é…åˆawkã€sedæå–å‡ºäº†<code>v0.1.1</code></p>
<p>å¥½äº†ï¼Œå°±è¿™äº›å§ï½</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•æ­£ç¡®çš„ä½¿phpè¿›ç¨‹ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œ</title>
    <url>/2020/05/12/php-daemon/</url>
    <content><![CDATA[<p>å®ˆæŠ¤è¿›ç¨‹æ˜¯ä¸€ä¸ªåœ¨åå°è¿è¡Œå¹¶ä¸”ä¸å—ä»»ä½•ç»ˆç«¯æ§åˆ¶çš„è¿›ç¨‹ã€‚ å…³äºå®ˆæŠ¤è¿›ç¨‹çš„è¯¦ç»†è§£é‡Šå¯ä»¥çœ‹çœ‹<a href="https://baike.baidu.com/item/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B">ç™¾åº¦ç™¾ç§‘</a>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹phpçš„è„šæœ¬ç¨‹åºæ€ä¹ˆä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨åå°ã€‚</p>
<p>åœ¨Linuxä¸­ , å¤§æ¦‚æœ‰ä¸‰ç§æ–¹å¼å®ç°è„šæœ¬åå°åŒ– :</p>
<ul>
<li>1.åœ¨å‘½ä»¤åæ·»åŠ ä¸€ä¸ª<code>&amp;</code>ç¬¦å·ï¼Œæ¯”å¦‚ <code>php task.php &amp;</code>ã€‚è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹åœ¨äºï¼šå¦‚æœç»ˆç«¯å…³é—­ï¼Œæ— è®ºæ˜¯æ­£å¸¸å…³é—­è¿˜æ˜¯éæ­£å¸¸å…³é—­ï¼Œè¿™ä¸ªphpè¿›ç¨‹éƒ½ä¼šéšç€ç»ˆç«¯å…³é—­è€Œå…³é—­ï¼›å…¶æ¬¡æ˜¯ä»£ç ä¸­å¦‚æœæœ‰<code>echo</code>æˆ–è€…<code>var_dump()</code>ä¹‹ç±»çš„è¾“å‡ºæ–‡æœ¬ï¼Œä¼šè¢«è¾“å‡ºåˆ°å½“å‰çš„ç»ˆç«¯çª—å£ä¸­ã€‚</li>
<li>2.ä½¿ç”¨<code>nohup</code>å‘½ä»¤ï¼Œæ¯”å¦‚<code>nohup php task.php &amp;</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»£ç ä¸­<code>echo</code>æˆ–è€…<code>var_dump</code>ä¹‹ç±»è¾“å‡ºçš„æ–‡æœ¬ä¼šè¢«è¾“å‡ºåˆ°phpä»£ç åŒçº§ç›®å½•çš„<code>nohup.out</code>æ–‡ä»¶ä¸­ã€‚å¦‚æœä½ å…³é—­ç»ˆç«¯ï¼Œè¯¥è¿›ç¨‹ä¸ä¼šè¢«å…³é—­ï¼Œä¾ç„¶ä¼šåœ¨åå°æŒç»­è¿è¡Œã€‚ä½†æ˜¯å¦‚æœç»ˆç«¯é‡åˆ°å¼‚å¸¸é€€å‡ºæˆ–è€…ç»ˆæ­¢ï¼Œè¯¥phpè¿›ç¨‹ä¹Ÿä¼šéšå³é€€å‡ºã€‚æœ¬è´¨ä¸Š ä¹Ÿå¹¶éç¨³å®šå¯é çš„å®ˆæŠ¤è¿›ç¨‹æ–¹æ¡ˆ ã€‚</li>
<li>3.ä½¿ç”¨<code>fork</code>å’Œ<code>setsid</code>ï¼Œè¿™ä¸ªæ–¹æ¡ˆåœ¨ä¸Šé¢<a href="https://baike.baidu.com/item/%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B">ç™¾åº¦ç™¾ç§‘</a>ä¸­ä¹Ÿæœ‰è¯¦ç»†ä»‹ç»ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥phpä»£ç æ¥æ¼”ç¤ºï¼š<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// deamon.php</span></span><br><span class="line"></span><br><span class="line">umask(<span class="number">0</span>); <span class="comment">//æŠŠæ–‡ä»¶æ©ç æ¸…0 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€æ¬¡fork  </span></span><br><span class="line"><span class="variable">$pid</span> = pcntl_fork();</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$pid</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27; forkå‡ºé”™ &#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$pid</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27; çˆ¶è¿›ç¨‹é€€å‡º &#x27;</span>); <span class="comment">// çˆ¶è¿›ç¨‹é€€å‡º,å­è¿›ç¨‹å˜æˆå­¤å„¿è¿›ç¨‹è¢«1å·è¿›ç¨‹æ”¶å…»ï¼Œè¿›ç¨‹è„±ç¦»ç»ˆç«¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å½“å‰å­è¿›ç¨‹æå‡ä¼šä¼šè¯ç»„ç»„é•¿ è¿™æ˜¯è‡³å…³é‡è¦çš„ä¸€æ­¥ </span></span><br><span class="line"><span class="keyword">if</span> (!posix_setsid()) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27; setsid å‡ºé”™ &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿®æ”¹å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œç”±äºå­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œä¿®æ”¹å·¥ä½œç›®å½•ä»¥é‡Šæ”¾å¯¹çˆ¶è¿›ç¨‹å·¥ä½œç›®å½•çš„å ç”¨ã€‚</span></span><br><span class="line">chdir(<span class="string">&#x27;/tmp&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// äºŒæ¬¡fork</span></span><br><span class="line"><span class="comment">// é€šè¿‡ä¸Šä¸€æ­¥ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¼šè¯ç»„é•¿ï¼Œè¿›ç¨‹ç»„é•¿ï¼Œä¸”è„±ç¦»äº†ç»ˆç«¯ï¼Œä½†æ˜¯ä¼šè¯ç»„é•¿å¯ä»¥ç”³è¯·é‡æ–°æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œä¸ºäº†é¿å…</span></span><br><span class="line"><span class="comment">// è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å†æ¬¡åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶é€€å‡ºå½“å‰è¿›ç¨‹ï¼Œè¿™æ ·è¿è¡Œçš„è¿›ç¨‹å°±ä¸å†æ˜¯ä¼šè¯ç»„é•¿ã€‚</span></span><br><span class="line"><span class="variable">$pid</span> = pcntl_fork();</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$pid</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27; fork å‡ºé”™ &#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$pid</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&#x27; çˆ¶è¿›ç¨‹é€€å‡º &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”±äºå®ˆæŠ¤è¿›ç¨‹ç”¨ä¸åˆ°æ ‡å‡†è¾“å…¥è¾“å‡ºï¼Œå…³é—­æ ‡å‡†è¾“å…¥ï¼Œè¾“å‡ºï¼Œé”™è¯¯è¾“å‡ºæè¿°ç¬¦</span></span><br><span class="line">fclose(STDIN);</span><br><span class="line">fclose(STDOUT);</span><br><span class="line">fclose(STDERR);</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœŸæ­£çš„é€»è¾‘ä»£ç ä»¬ ä¸‹é¢ä»…ä»…å†™ä¸ªå¾ªç¯ä»¥ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt;= <span class="number">100</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    file_put_contents(<span class="string">&#x27;daemon.log&#x27;</span>, <span class="variable">$i</span>, FILE_APPEND);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>è¿è¡Œçœ‹çœ‹æ•ˆæœå§</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php deamon.php</span><br><span class="line">tail -f daemon.log</span><br></pre></td></tr></table></figure>

<p>å¦å¤–è¿˜æœ‰ä¸€ç§è¿è¡Œè„šæœ¬çš„æ–¹å¼ä¹Ÿå€¼å¾—ä¸€æï¼šåˆ©ç”¨ <code>screen</code> / <code>tmux</code> ç­‰è½¯ä»¶ï¼Œå°†è„šæœ¬è¿è¡Œåœ¨å¯ä»¥åœ¨ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯ä¹‹ä¸Šã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://github.com/elarity/advanced-php/blob/master/1.%20php%E8%BF%9B%E7%A8%8Bdaemon%E5%8C%96%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%81%9A%E6%B3%95.md">https://github.com/elarity/advanced-php/blob/master/1.%20php%E8%BF%9B%E7%A8%8Bdaemon%E5%8C%96%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%81%9A%E6%B3%95.md</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2019/10/tmux.html">Tmux ä½¿ç”¨æ•™ç¨‹ é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></li>
<li><a href="https://www.vpser.net/manage/screen.html">SSHè¿œç¨‹ä¼šè¯ç®¡ç†å·¥å…· - screenä½¿ç”¨æ•™ç¨‹</a></li>
</ul>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>å®ˆæŠ¤è¿›ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Apache abè¿›è¡Œå‹åŠ›æµ‹è¯•</title>
    <url>/2020/05/13/apache-ab/</url>
    <content><![CDATA[<p>Apacheçš„<code>ab</code>å‘½ä»¤æ¨¡æ‹Ÿå¤šçº¿ç¨‹å¹¶å‘è¯·æ±‚ï¼Œæµ‹è¯•æœåŠ¡å™¨è´Ÿè½½å‹åŠ›ï¼Œä¹Ÿå¯ä»¥æµ‹è¯•nginxã€lighthttpã€IISç­‰å…¶å®ƒWebæœåŠ¡å™¨çš„å‹åŠ›ã€‚</p>
<h2 id="abçš„å‚æ•°è¯´æ˜"><a href="#abçš„å‚æ•°è¯´æ˜" class="headerlink" title="abçš„å‚æ•°è¯´æ˜"></a>abçš„å‚æ•°è¯´æ˜</h2><blockquote>
<p>-n  éœ€è¦æ‰§è¡Œçš„è¯·æ±‚æ¬¡æ•°</p>
</blockquote>
<blockquote>
<p>-c  å¹¶å‘çš„æ•°é‡</p>
</blockquote>
<blockquote>
<p>-t   ç­‰å¾…è¿”å›çš„æœ€é•¿æ—¶é—´</p>
</blockquote>
<blockquote>
<p>-b  TCPæ”¶å‘ç¼“å†²åŒºçš„å¤§å°ï¼Œå•ä½ï¼ˆbyteï¼‰</p>
</blockquote>
<blockquote>
<p>-p ä½¿ç”¨post (åŒæ—¶éœ€è¦å®šä¹‰-Tå‚æ•°)</p>
</blockquote>
<blockquote>
<p>-u ä½¿ç”¨put (åŒæ—¶éœ€è¦å®šä¹‰-Tå‚æ•°)</p>
</blockquote>
<blockquote>
<p>-T content-type, ä¾‹å¦‚application/x-www-form-urlencoded, é»˜è®¤ä¸ºtext/plain</p>
</blockquote>
<blockquote>
<p>-w æŠŠç»“æœæ‰“å°åœ¨htmlçš„è¡¨æ ¼é‡Œ</p>
</blockquote>
<blockquote>
<p>-x  è¡¨æ ¼çš„å±æ€§</p>
</blockquote>
<blockquote>
<p>-y  trè¡Œå±æ€§</p>
</blockquote>
<blockquote>
<p>-z  tdåˆ—å±æ€§</p>
</blockquote>
<blockquote>
<p>-C è®¾ç½®cookie ä¾‹å¦‚Apach=1234</p>
</blockquote>
<blockquote>
<p>-H headerè¡Œï¼Œ ä¾‹å¦‚Accept-Encoding:gzip</p>
</blockquote>
<blockquote>
<p>-k æ˜¯å¦æ ‡ç¤ºä½HTTP Keep Alive</p>
</blockquote>
<h2 id="å¸¸ç”¨ä¾‹å­"><a href="#å¸¸ç”¨ä¾‹å­" class="headerlink" title="å¸¸ç”¨ä¾‹å­"></a>å¸¸ç”¨ä¾‹å­</h2><h3 id="æ¨¡æ‹Ÿ100ä¸ªå¹¶å‘ç”¨æˆ·ï¼Œå¯¹ä¸€ä¸ªé¡µé¢å‘é€1000æ¬¡è¯·æ±‚"><a href="#æ¨¡æ‹Ÿ100ä¸ªå¹¶å‘ç”¨æˆ·ï¼Œå¯¹ä¸€ä¸ªé¡µé¢å‘é€1000æ¬¡è¯·æ±‚" class="headerlink" title="æ¨¡æ‹Ÿ100ä¸ªå¹¶å‘ç”¨æˆ·ï¼Œå¯¹ä¸€ä¸ªé¡µé¢å‘é€1000æ¬¡è¯·æ±‚"></a>æ¨¡æ‹Ÿ100ä¸ªå¹¶å‘ç”¨æˆ·ï¼Œå¯¹ä¸€ä¸ªé¡µé¢å‘é€1000æ¬¡è¯·æ±‚</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ab -n 1000 -c 100 http://localhost/</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­-nä»£è¡¨è¯·æ±‚æ•°ï¼Œ-cä»£è¡¨å¹¶å‘æ•°</p>
<h3 id="åœ¨60ç§’å†…å‘è¯·æ±‚ï¼Œä¸€æ¬¡100ä¸ªè¯·æ±‚ã€‚"><a href="#åœ¨60ç§’å†…å‘è¯·æ±‚ï¼Œä¸€æ¬¡100ä¸ªè¯·æ±‚ã€‚" class="headerlink" title="åœ¨60ç§’å†…å‘è¯·æ±‚ï¼Œä¸€æ¬¡100ä¸ªè¯·æ±‚ã€‚"></a>åœ¨60ç§’å†…å‘è¯·æ±‚ï¼Œä¸€æ¬¡100ä¸ªè¯·æ±‚ã€‚</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ab -t 60 -c 100 http://localhost/ </span><br></pre></td></tr></table></figure>

<h2 id="è¿”å›ç»“æœï¼š"><a href="#è¿”å›ç»“æœï¼š" class="headerlink" title="è¿”å›ç»“æœï¼š"></a>è¿”å›ç»“æœï¼š</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking localhost (be patient)</span><br><span class="line">Completed 100 requests</span><br><span class="line">Completed 200 requests</span><br><span class="line">Completed 300 requests</span><br><span class="line">Completed 400 requests</span><br><span class="line">Completed 500 requests</span><br><span class="line">Completed 600 requests</span><br><span class="line">Completed 700 requests</span><br><span class="line">Completed 800 requests</span><br><span class="line">Completed 900 requests</span><br><span class="line">Completed 1000 requests</span><br><span class="line">Finished 1000 requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        Apache/2.4.18  ##apacheç‰ˆæœ¬ </span><br><span class="line">Server Hostname:        localhost  ##è¯·æ±‚çš„åŸŸå</span><br><span class="line">Server Port:            80   ##è¯·æ±‚ç«¯å£</span><br><span class="line"></span><br><span class="line">Document Path:          /    ##è¯·æ±‚çš„path</span><br><span class="line">Document Length:        1195 bytes  ##é¡µé¢å†…å®¹å¤§å°</span><br><span class="line"></span><br><span class="line">Concurrency Level:      100  ##å¹¶å‘æ•° </span><br><span class="line">Time taken for tests:   2.338 seconds  ##å…±ä½¿ç”¨äº†å¤šå°‘æ—¶é—´</span><br><span class="line">Complete requests:      1000  ##å®Œæˆçš„è¯·æ±‚æ•° </span><br><span class="line">Failed requests:        0  ##å¤±è´¥çš„è¯·æ±‚</span><br><span class="line">Total transferred:      1388000 bytes  ##æ€»å…±ä¼ è¾“å­—èŠ‚æ•°ï¼ŒåŒ…å«httpçš„å¤´ä¿¡æ¯ç­‰</span><br><span class="line">HTML transferred:       1195000 bytes  ##htmlå­—èŠ‚æ•°ï¼Œå®é™…çš„é¡µé¢ä¼ é€’å­—èŠ‚æ•°</span><br><span class="line">Requests per second:    427.78 [#/sec] (mean)  ##æ¯ç§’å¤šå°‘è¯·æ±‚ï¼Œè¿™ä¸ªæ˜¯éå¸¸é‡è¦çš„å‚æ•°æ•°å€¼ï¼ŒæœåŠ¡å™¨çš„ååé‡ </span><br><span class="line">Time per request:       233.767 [ms] (mean)  ##ç”¨æˆ·å¹³å‡è¯·æ±‚ç­‰å¾…æ—¶é—´ </span><br><span class="line">Time per request:       2.338 [ms] (mean, across all concurrent requests)  ##æœåŠ¡å™¨å¹³å‡å¤„ç†æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨ååé‡çš„å€’æ•°</span><br><span class="line">Transfer rate:          579.84 [Kbytes/sec] received  ##æ¯ç§’è·å–çš„æ•°æ®é•¿åº¦</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0    0   0.4      0       5</span><br><span class="line">Processing:    61  221  49.6    221     389</span><br><span class="line">Waiting:       61  220  49.8    221     389</span><br><span class="line">Total:         62  221  49.6    222     389</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%    222    ## 50%çš„è¯·æ±‚åœ¨222mså†…è¿”å›</span><br><span class="line">  66%    240</span><br><span class="line">  75%    252</span><br><span class="line">  80%    261</span><br><span class="line">  90%    280</span><br><span class="line">  95%    302</span><br><span class="line">  98%    326</span><br><span class="line">  99%    347</span><br><span class="line"> 100%    389 (longest request)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å‹åŠ›æµ‹è¯•</category>
      </categories>
      <tags>
        <tag>å‹åŠ›æµ‹è¯•</tag>
        <tag>ab</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°å½•ä¸€æ¬¡MySQLè‡ªåŠ¨åœæœºçš„é—®é¢˜å¤„ç†</title>
    <url>/2020/05/31/mysqld-broken/</url>
    <content><![CDATA[<p>æœ€è¿‘å¸®åˆ«äººåšçš„ä¸€ä¸ªé¡¹ç›®æœºå™¨ä¸Šé¢è·‘MySQLè€æ˜¯éš”ä¸€æ®µæ—¶é—´å°±è‡ªåŠ¨åœäº†ã€‚åˆšå¼€å§‹ä»¥ä¸ºæ˜¯ä»¥å¤–åœæ­¢ï¼Œä¹Ÿæ²¡æ³¨æ„ï¼Œå°±æ‰‹åŠ¨å†å¯åŠ¨ã€‚å¯æ˜¯è¿‡äº†æ²¡ä¸¤å¤©åˆåœæ­¢äº†ã€‚</p>
<p>åæ¥ä»”ç»†æŸ¥äº†æŸ¥<code>mysqld</code>çš„æ—¥å¿—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2020-05-27T10:15:12.569342Z 0 [System] [MY-010116] [Server] /usr/libexec/mysqld (mysqld 8.0.17) starting as process 19493</span><br><span class="line">2020-05-27T10:15:14.448256Z 0 [System] [MY-010229] [Server] Starting crash recovery...</span><br><span class="line">2020-05-27T10:15:14.475411Z 0 [System] [MY-010232] [Server] Crash recovery finished.</span><br><span class="line">2020-05-27T10:15:14.691345Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">2020-05-27T10:15:15.677386Z 0 [System] [MY-010931] [Server] /usr/libexec/mysqld: ready for connections. Version: &#x27;8.0.17&#x27;  socket: &#x27;/var/lib/mysql/mysql.sock&#x27;  port: 3306  Source distribution.</span><br><span class="line">2020-05-27T10:15:15.951210Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Socket: &#x27;/var/lib/mysql/mysqlx.sock&#x27; bind-address: &#x27;::&#x27; port: 33060</span><br><span class="line">2020-05-27T11:26:19.955004Z 0 [System] [MY-010116] [Server] /usr/libexec/mysqld (mysqld 8.0.17) starting as process 19757</span><br><span class="line">2020-05-27T11:26:20.181302Z 0 [ERROR] [MY-012681] [InnoDB] mmap(137363456 bytes) failed; errno 12</span><br><span class="line">2020-05-27T11:26:20.181360Z 1 [ERROR] [MY-012956] [InnoDB] Cannot allocate memory for the buffer pool</span><br><span class="line">2020-05-27T11:26:20.181379Z 1 [ERROR] [MY-012930] [InnoDB] Plugin initialization aborted with error Generic error.</span><br><span class="line">2020-05-27T11:26:20.181401Z 1 [ERROR] [MY-010334] [Server] Failed to initialize DD Storage Engine</span><br><span class="line">2020-05-27T11:26:20.181543Z 0 [ERROR] [MY-010020] [Server] Data Dictionary initialization failed.</span><br><span class="line">2020-05-27T11:26:20.183642Z 0 [ERROR] [MY-010119] [Server] Aborting</span><br><span class="line">2020-05-27T11:26:20.184163Z 0 [System] [MY-010910] [Server] /usr/libexec/mysqld: Shutdown complete (mysqld 8.0.17)  Source distribution.</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æ˜¾ç¤ºæ˜¯<code>Cannot allocate memory for the buffer pool</code>ï¼Œæ— æ³•åˆ†é…å†…å­˜ç»™ç¼“å­˜æ± ã€‚é©¬ä¸Šæƒ³åˆ°æ˜¯å†…å­˜ä¸è¶³ï¼Œè¿™å°æœºå™¨æ˜¯1GBçš„å†…å­˜ï¼Œè¿˜è·‘ç€ <code>Nginx</code> å’Œ <code>PHP-FPM</code> ã€‚</p>
<p>ä½¿ç”¨ <code>top</code> çœ‹äº†çœ‹ <code>mysqld</code> å ç”¨çš„å†…å­˜è¾¾åˆ°äº†48% ã€‚å†…å­˜å ç”¨è¿˜æ˜¯è›®é«˜çš„ã€‚</p>
<p>å½“ç„¶äº†å‡çº§æœºå™¨é…ç½®æ˜¯æ¯”è¾ƒå¥½çš„åŠæ³•ï¼Œä½†æ˜¯æ¯•ç«Ÿç»è´¹æœ‰é™ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆç»™å®ƒåŠ ä¸ª<code>swap</code>äº¤æ¢ç©ºé—´ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1M count=2048</span><br><span class="line">mkswap /swapfile</span><br><span class="line">swapon /swapfile</span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æˆ‘ä»¬åŠ äº†2GBçš„äº¤æ¢ç©ºé—´ç»™æœºå™¨ã€‚ç„¶åé‡å¯ <code>mysqld</code>ã€‚å†ä½¿ç”¨<code>top</code>çœ‹äº†çœ‹ï¼Œå‘ç°äº¤æ¢ç©ºé—´æ¸æ¸è¢«ä½¿ç”¨äº†ã€‚</p>
<p>ç¡äº†ä¸€è§‰èµ·æ¥ä¸€çœ‹ï¼Œ<code>mysqld</code>æœåŠ¡æ²¡æœ‰å†è‡ªåŠ¨åœæ­¢ï¼Œå†…å­˜å ç”¨å·²ç»ä¸‹é™åˆ°<code>22%</code>ï¼Œçœ‹äº†çœ‹é”™è¯¯æ—¥å¿—ï¼Œä¹Ÿæ˜¯ç©ºçš„ã€‚</p>
<p>å—¯ï¼Œçœ‹æ¥è¿˜ä¸é”™å˜›ã€‚å†è§‚å¯Ÿä¸ªå‡ å¤©çœ‹çœ‹ï¼Œæ²¡é—®é¢˜çš„è¯åº”è¯¥å°±å¥½äº†ğŸ˜ğŸ˜ğŸ˜ã€‚</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
</search>
