<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯(è½¬)</title>
    <url>/2017/08/13/%E5%80%9A%E6%A5%BC%E5%90%AC%E9%A3%8E%E9%9B%A8%EF%BC%8C%E6%B7%A1%E7%9C%8B%E6%B1%9F%E6%B9%96%E8%B7%AF/</url>
    <content><![CDATA[<p>å€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯ã€‚ä½†è§æ³ªç—•æ¹¿ï¼Œä¸çŸ¥å¿ƒæ¨è°ï¼é›ªæ— è¸ªï¼Œæƒ…äº¦æ— è¸ªï¼Œé›ªæ— å½¢ï¼Œæƒ…äº¦æ— å½¢ã€‚å†¬æ¥ï¼Œé›ªå€¾åŸï¼Œçˆ±æ¥æƒ…å€¾åŸã€‚å†¬è¿‡ï¼Œé›ªåŒ–æ°´ï¼Œçˆ±è¿‡æƒ…åŒ–æ³ªï¼</p>
<p>â€”â€”ã€Šé£äº‘ã€‹æ¢¦å†™ç»™é£çš„ä¿¡</p>
<p>æ²§æµ·æ¡‘ç”°ï¼Œå¤©è’åœ°è€ï¼Œä¸å¦‚æœ‰ä¸ªäººç‰µæˆ‘çš„æ‰‹ï¼Œä¸€èµ·çœ‹å¤•é˜³è€å»ã€‚æµ·æ¯çŸ³çƒ‚ï¼Œå¤©é•¿åœ°ä¹…ï¼Œä¸å¦‚æœ‰ä¸ªäººé™ªæˆ‘ï¼Œå€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯ã€‚</p>
<p>å‰å°˜å¾€äº‹ï¼Œéƒ½è®©ä»–éšé£è€Œé€äº†å§ã€‚çº¢å°˜æ»šæ»šï¼Œéƒ½ä»»ä»–æ¹®æ²¡åœ¨å†å²ä¸­å»å§ã€‚ç¡çƒŸå¼¥æ¼«ï¼Œéƒ½è®©ä»–æ¶ˆæ²‰åœ¨å°˜ä¸–é—´é‡Œå§ã€‚</p>
<p>æˆ‘ï¼Œæ„¿ä½œä¸–é—´ç´ å¿ƒäººï¼Œæœ¬ä¸æƒ³æ¶‰å°˜ä¸–å¤ªæ·±çš„æ°´è€Œè¿‡ï¼Œåªæ„¿ç‹¬åä¸€éš…ï¼Œéšä¸–äº‹æµè½¬ï¼Œæ·¡çœ‹çº¢å°˜çš„æ•…äº‹ï¼Œæƒ…æ„Ÿï¼Œæ¢¦æƒ³ï¼Œçç¢çš„ç”Ÿæ´»ã€‚</p>
<p>å¾®é£ï¼Œæ·¡æ·¡çš„ä»é™Œä¸Šå¹æ¥ï¼Œæ è¿‡çª—å‰ï¼Œæˆ‘å¬åˆ°äº†ä»–çš„å¹æ¯ï¼Œé‚£æ˜¯å²æœˆæ·±å¤„çš„æ„Ÿæ…¨ï¼Œä¼¼æ°´æµå¹´ï¼Œæˆ‘ä»¬åƒèŠ±å„¿ä¸€æ ·å„è‡ªæ•£è½åœ¨äº†å¤©æ¶¯ã€‚</p>
<p>æœ‹å‹è¯´ï¼Œæˆ‘æ€»åœ¨ç¢ç¢å¿µç€æ‚²ä¼¤ï¼Œæ¼”ç»ç€åŒæ ·å¿§ä¼¤çš„çˆ±æƒ…ï¼Œè½å¯çš„æ€ç»ªï¼Œå¯‚å¯¥çš„æƒ…æ„«ï¼Œæ·¡æ·¡çš„æƒ…ç¼˜ï¼Œæµ…æ·¡çš„æ€å¿µï¼Œç—´æ‹çš„æ·±æƒ…ï¼Œå¿ƒåŠ¨çš„å”¯ç¾ï¼Œå¿ƒç¢çš„æƒ…æ®‡â€¦â€¦</p>
<p>æˆ‘ï¼Œæ— æ³•å¿˜è®°è®©æˆ‘æœ€åˆå¿ƒåŠ¨çš„äººï¼Œå´æ˜¯é‚£ä»½æƒ…æ„«åœ¨å¿µå¿µä¸å¿˜çš„æ—¥å­é‡Œï¼Œæ·¡äº†ã€‚é‚£æ—¶ï¼Œæˆ‘ç›¸ä¿¡çš„ä¸€ç”Ÿåªçˆ±ä¸€ä¸ªäººçš„ä¿¡å¿µï¼Œä¹Ÿå½»åº•å´©æºƒåœ¨è¾¹ç¼˜äº†ã€‚</p>
<p>ä»æ­¤ï¼Œæˆ‘ä¸çŸ¥è¯¥æ€ä¹ˆç»§ç»­æˆ‘çš„çº¢å°˜æƒ…ç¼˜ï¼Œäººæ•£ï¼Œæƒ…æ·¡ï¼Œå¿ƒæ€§å¼€å§‹å˜å¾—è–„å‡‰ã€‚ç»†æ•°æµå¹´ï¼Œè½¬èº«ç¦»å¼€çš„æ—¥å­ï¼Œäº¦æ˜¯å¾ˆä¹…å¾ˆè¿œäº†ï¼Œè¿™äº›å¹´ï¼Œå¯‚å¯ä¸€ç›´æ±©æ±©æµæ·Œåœ¨å¿ƒæºªã€‚</p>
<p>ä¹Ÿè®¸ï¼Œæˆ‘çˆ±ä¸Šäº†ä¸€ä¸ªäººï¼Œå°±çˆ±ä¸Šäº†å¯‚å¯ï¼Œä¹Ÿçˆ±ä¸Šäº†æ–‡å­—ã€‚æœ‰äººè¯´ï¼Œçˆ±ä¸Šäº†æ–‡å­—çš„å­©å­ï¼Œè‹è€çš„æ¯”è¾ƒå¿«ã€‚å› ä¸ºå¿ƒçš„æ²§æ¡‘ã€‚æˆ‘æƒ³ï¼Œæˆ‘ä¾¿å¦‚æ˜¯æ‰€è¯´ã€‚</p>
<p>æ‰€ä»¥ï¼Œè€Œä»Šå€šæ¥¼å¬é£é›¨ï¼Œæ‚²æ¬¢ç¦»åˆæ€»æ— æƒ…ï¼Œä¸€ä»»é˜¶å‰ç‚¹æ»´åˆ°å¤©æ˜ã€‚æ·¡çœ‹æ±Ÿæ¹–è·¯ï¼Œäººæ¸æ¸è¿œå»ï¼Œæƒ…æ·¡æ·¡æ•£å»ï¼Œä½†è§æ³ªç—•æ¹¿ï¼Œä¸çŸ¥å¿ƒçˆ±è°ã€‚</p>
<p>çº¢é¢œæ˜“è€ï¼Œæƒ…ç¼˜æ˜“é†‰ï¼Œæµå…‰å®¹æ˜“æŠŠäººæŠ›ï¼Œæƒ¹äº†å¿ƒç»ªï¼ŒæŸ“äº†å°˜åŸƒã€‚è‰¯è¾°ç¾æ™¯å¥ˆä½•å¤©ï¼Œæ³ªæ°´å‡‰äº†å¿ƒï¼Œæ‰æ‡‚å¾—ï¼Œæœ€åçš„ç–¼çˆ±æ˜¯æ‰‹æ”¾å¼€ã€‚</p>
<p>æ¸©æš–ï¼Œåˆ¹é‚£èŠ³è²å°½ã€‚æ‚²ä¼¤ï¼Œæ³¨å…¥åŠä¸–å¯‚å¯ã€‚æˆ‘ï¼Œä¸è¿‡æ˜¯ä¸€ä¸ªå¹³å‡¡çš„äººï¼Œä¸€æ¯åˆä¸€æ¯çš„çº¢å°˜é…’ï¼Œè‡ªæ–Ÿè‡ªé¥®ï¼Œé†‰äº†è¿™ä¸€ç”Ÿï¼Œæ·¡äº†çº¢å°˜è·¯ã€‚</p>
<p>é’çƒŸè¢…è¢…ï¼Œé‚£æ˜¯å¿ƒä¸­æŒ¥ä¹‹ä¸å»çš„å¿§ä¼¤ã€‚æ·¡æ·¡æµäº‘ï¼Œé‚£æ˜¯å¿ƒä¸­æ— ä»¥è¨€è¯´çš„ä¼¤ç—›ã€‚é£è½»äº‘æ·¡ï¼ŒæŠ¹æ·¡æµå¹´ï¼Œé™å¬é›¨å£°ï¼Œæ´—å°½èŠ³åï¼Œæ„¿ä½ æˆ‘å®‰å¥½ã€‚</p>
<p>è½»è½»åœ°æ¨å¼€çª—ï¼Œæ²äººå¿ƒè„¾çš„èŠ±é¦™é£˜æ•£åœ¨é£é›¨ä¸­ï¼Œæ‰‘é¼»è€Œæ¥ã€‚æ¸©æš–ï¼Œä¾ç„¶åœ¨çœ¼å‰ï¼Œæ˜¯æˆ‘çš„å¿ƒå¤ªå¤šè´ªæ‹äº†ã€‚ä¸å¦‚æ³¡ä¸€æ¯èŒ¶ï¼Œå®‰äºä¸€ä»½æ·¡ç„¶ã€‚</p>
<p>ä¹Ÿè®¸ï¼Œçˆ±ä¸ä¸çˆ±ï¼Œéƒ½æ˜¯æ®‡ã€‚æ¯•ç«Ÿï¼Œæˆ‘æ€»è§‰å¾—ï¼Œçˆ±æ˜¯äººé—´æœ€ç¾çš„æƒ…æ„«ï¼Œå¿ƒåŠ¨çš„æœ¦èƒ§ï¼ŒæŠµå¾—è¿‡å¿ƒå–œçš„ç—´æ‹è‡ªé†‰ï¼Œå¿ƒç—›çš„é»¯ç„¶é”€é­‚ã€‚</p>
<p>å…¶å®ï¼Œä¸æ˜¯å°†ä»–å¿˜äº†ï¼Œä¹Ÿä¸æ˜¯è®²æ•…äº‹å¿˜äº†ï¼Œæ›´ä¸æ˜¯å°†æƒ…æ„Ÿå¿˜äº†ã€‚è™½ç„¶äº‘æ·¡é£è½»äº†ï¼Œå´ä¾ç„¶æ˜¯ï¼Œå¤šå°‘äº‹ï¼Œæ‰ä¸‹çœ‰å¤´ï¼Œå´ä¸Šå¿ƒé—´ã€‚åªæ˜¯ï¼Œé€‰æ‹©ä¸‰ç¼„å…¶å£ï¼Œä¸è¯´äº†ã€‚</p>
<p>æ‹ˆèŠ±ä¸€ç¬‘ï¼Œæ£ç¢äº†å¿ƒï¼Œå¯‚é™è½¬èº«ï¼Œå®‰ç„¶å®ˆå€™ä¸€ä¸ä¸€ç¼•çš„æƒ…æ„«ï¼Œå¦‚ç¡è²èˆ¬é™èººåœ¨çº¢å°˜çš„æµæ°´é‡Œï¼Œå³ä½¿ï¼Œé£é›¨ç©¿é€ä¸–äº‹ï¼Œäº¦æ³¢æ¾œä¸æƒŠã€‚</p>
<p>å¤å¤œå¾®å‡‰ï¼Œçª—å¤–é›¨æ½ºæ½ºï¼Œéšç€æ—‹å¾‹è½»è½»æµæ³»æŒ‡å°–çš„å¿§ä¼¤ï¼Œäººæ·¡æƒ…è¿œï¼Œé™é™åœ°åç€ï¼Œæƒ³ç€å¿ƒäº‹ï¼Œä»»çº¢å°˜çº·çº­ä¸€ä¸€åŒ–äº†è™šæ— ï¼Œæ•£äº†äº‘çƒŸï¼Œæµ…äº†é£æƒ…ã€‚</p>
<p>ææµ…å¿ƒæ€ï¼ŒæŸä¹‹é«˜é˜ï¼Œè½¬èº«ç¦»å¼€ã€‚å¦‚è²ç¦…å®šï¼Œæ½œå…¥çº¢å°˜ï¼Œå‡ºæ·¤æ³¥è€Œä¸æŸ“ã€‚å€šæ¥¼å¬é£é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯â€¦â€¦</p>
<p>ä½œè€…ï¼šè½å¶<br>é“¾æ¥ï¼š<a href="http://www.duwenzhang.com/wenzhang/xinqingriji/20140621/294982.html" target="_blank" rel="noopener">http://www.duwenzhang.com/wenzhang/xinqingriji/20140621/294982.html</a><br>ä¾†æºï¼šæ–‡ç« é˜…è¯»ç½‘</p>
]]></content>
      <categories>
        <category>å¬é£é›¨</category>
      </categories>
      <tags>
        <tag>å¬é£é›¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨PHPè¿›è¡ŒHTTPè®¤è¯</title>
    <url>/2017/08/21/%E7%94%A8PHP%E8%BF%9B%E8%A1%8CHTTP%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<p>PHPçš„HTTPè®¤è¯æœºåˆ¶ï¼Œå°±æ˜¯ç”¨<code>header()</code>å‡½æ•°æ¥å‘å®¢æˆ·ç«¯æµè§ˆå™¨å‘é€â€œAuthentication Requiredâ€ä¿¡æ¯ï¼Œä½¿å…¶å¼¹å‡ºä¸€ä¸ªç”¨æˆ·åï¼å¯†ç è¾“å…¥çª—å£ã€‚å½“ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç åï¼ŒåŒ…å«æœ‰URLçš„PHPè„šæœ¬å°†ä¼šåŠ ä¸Šé¢„å®šä¹‰å˜é‡<code>PHP_AUTH_USER</code>ï¼Œ<code>PHP_AUTH_PW</code>å’Œ<code>AUTH_TYPE</code>è¢«å†æ¬¡è°ƒç”¨ï¼Œè¿™ä¸‰ä¸ªå˜é‡åˆ†åˆ«è¢«è®¾å®šä¸ºç”¨æˆ·åï¼Œå¯†ç å’Œè®¤è¯ç±»å‹ã€‚é¢„å®šä¹‰å˜é‡ä¿å­˜åœ¨ <code>$_SERVER</code> æˆ–è€… <code>$HTTP_SERVER_VARS</code> æ•°ç»„ä¸­ã€‚æ”¯æŒâ€œBasicâ€å’Œâ€œDigestâ€ï¼ˆè‡ª PHP 5.1.0 èµ·ï¼‰è®¤è¯æ–¹æ³•ã€‚è¿™æ˜¯phpå®˜ç½‘çš„è§£é‡Šã€‚<br>å¤§å®¶çœ‹ç¤ºä¾‹ä½“ä¼šã€‚ğŸ˜</p>
<p>å‚è€ƒè¿æ¥ï¼š<a href="http://php.net/manual/zh/features.http-auth.php" target="_blank" rel="noopener">http://php.net/manual/zh/features.http-auth.php</a></p>
<h3 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_SERVER[<span class="string">'PHP_AUTH_USER'</span>])) &#123;</span><br><span class="line">    header(<span class="string">'WWW-Authenticate: Basic realm="My Realm"'</span>);</span><br><span class="line">    header(<span class="string">'HTTP/1.0 401 Unauthorized'</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'401 Unauthorized'</span>.<span class="string">'&lt;br&gt; &lt;button onclick="window.location.reload();"&gt;Login Again&lt;/button&gt;'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>($_SERVER[<span class="string">'PHP_AUTH_USER'</span>] !== <span class="string">'James Bond'</span> || $_SERVER[<span class="string">'PHP_AUTH_PW'</span>] !== <span class="string">'007'</span>)&#123;</span><br><span class="line">        header(<span class="string">'WWW-Authenticate: Basic realm="My Realm"'</span>);</span><br><span class="line">        header(<span class="string">'HTTP/1.0 401 Unauthorized'</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'401 Unauthorized'</span>.<span class="string">'&lt;br&gt; &lt;button onclick="window.location.reload();"&gt;Login Again&lt;/button&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‹é¢æ˜¯ä½ çš„ä¸šåŠ¡ä»£ç </span></span><br></pre></td></tr></table></figure>


<p><img src="/assets/images/20170821120459.png" alt="example-pic"></p>
<p>è¿™æ ·å°±ä¼šå¼¹å‡ºä¸€ä¸ªç™»é™†æ¡†ï¼Œè¾“å…¥ç”¨æˆ·åï¼š<code>James Bond</code> å¯†ç ï¼š<code>007</code> ç™»é™†å§ï¼</p>
<p>æˆåŠŸäº†æ²¡ï¼Œå“ˆå“ˆï¼Œå¤§å®¶è§‰å¾—æ˜¯ä¸æ˜¯å¾ˆå¥½ç©~</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªç®€å•çš„APIæˆæƒæµç¨‹</title>
    <url>/2017/08/16/%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84api%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<p>å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°ç»™ç¬¬ä¸‰æ–¹å¼€æ”¾æˆ‘ä»¬é¡¹ç›®APIçš„è¿™ç§åœºæ™¯ã€‚è¿™æ—¶æˆ‘ä»¬è¦ä¿è¯apiçš„å®‰å…¨ï¼Œå‚è€ƒ<code>è…¾è®¯å¹¿ç‚¹é€š</code>çš„apiè°ƒç”¨ã€‚ç°å°†phpçš„ä»£ç å®ç°æ•´ç†è¿™æ­¤ã€‚</p>
<p>æˆ‘ä»¬çš„ç®—æ³•å¾ˆç®€å•ï¼š</p>
<blockquote>
<ol>
<li>æŠŠè°ƒç”¨æ–¹è‡ªå·±çš„appid,secret_key,å½“å‰çš„æ—¶é—´æˆ³timeè¿æ¥èµ·æ¥ç”¨sha1æ–¹æ³•ç”Ÿæˆä¸€ä¸ªsign</li>
<li>æŠŠappid,time,signç”¨è‹±æ–‡é€—å·è¿æ¥å¹¶ç”¨base64æ‰“åŒ…å˜æˆä¸€ä¸ªå‚æ•°token</li>
</ol>
</blockquote>
<h3 id="APIçš„å‡ ä¸ªæ–¹æ³•"><a href="#APIçš„å‡ ä¸ªæ–¹æ³•" class="headerlink" title="APIçš„å‡ ä¸ªæ–¹æ³•"></a>APIçš„å‡ ä¸ªæ–¹æ³•</h3><p><code>api_functions.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $appid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $secret_key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int $time</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_token</span><span class="params">($appid, $secret_key, $time)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $sign = sha1($appid . $secret_key . $time);</span><br><span class="line">    <span class="keyword">return</span> base64_encode($appid . <span class="string">','</span> . $time . <span class="string">','</span> . $sign);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£åŒ…token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unpack_token</span><span class="params">($token)</span></span>&#123;</span><br><span class="line">    $params = base64_decode($token);</span><br><span class="line">    $params = explode(<span class="string">','</span>, $params);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'appid'</span>=&gt; <span class="keyword">isset</span>($params[<span class="number">0</span>]) ? $params[<span class="number">0</span>] : <span class="string">''</span>,</span><br><span class="line">        <span class="string">'time'</span>=&gt; <span class="keyword">isset</span>($params[<span class="number">1</span>]) ? $params[<span class="number">1</span>] : <span class="string">''</span>,</span><br><span class="line">        <span class="string">'sign'</span>=&gt; <span class="keyword">isset</span>($params[<span class="number">2</span>]) ? $params[<span class="number">2</span>] : <span class="string">''</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $url</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $data</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bool $is_post</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $header</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sub_curl</span><span class="params">($url, $data = array<span class="params">()</span>, $is_post = false, $header = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    <span class="keyword">if</span> (!$is_post &amp;&amp; !<span class="keyword">empty</span>($data)) &#123;</span><br><span class="line">        $url = $url . <span class="string">'?'</span> . http_build_query($data);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_POST, $is_post);</span><br><span class="line">    <span class="keyword">if</span> ($is_post) &#123;</span><br><span class="line">        curl_setopt($ch, CURLOPT_POSTFIELDS, $data);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">false</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="keyword">false</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, <span class="number">20</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($header)) &#123;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line">    &#125;</span><br><span class="line">    $info = curl_exec($ch);</span><br><span class="line">    $code = curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">    <span class="keyword">if</span>($code != <span class="number">200</span>)&#123;</span><br><span class="line"></span><br><span class="line">        echo_json($code, <span class="string">'apiè°ƒç”¨å‡ºé”™'</span>.$code);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_close($ch);</span><br><span class="line">    <span class="keyword">return</span> $info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> int $code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $msg</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> array $data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo_json</span><span class="params">($code, $msg = <span class="string">''</span>, $data = array<span class="params">()</span>)</span></span>&#123;</span><br><span class="line">    header(<span class="string">'Content-type:application/json'</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">'ret'</span> =&gt; $code, <span class="string">'msg'</span> =&gt; $msg, <span class="string">'data'</span> =&gt; $data));</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="APIæä¾›æ–¹"><a href="#APIæä¾›æ–¹" class="headerlink" title="APIæä¾›æ–¹"></a>APIæä¾›æ–¹</h3><p><code>api.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'api_functions.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆæƒçš„ä½¿ç”¨æ–¹åå• ç°ä¸ºæ¼”ç¤ºæ–¹ä¾¿ç›´æ¥ä½¿ç”¨æ•°ç»„</span></span><br><span class="line">$users = [</span><br><span class="line">    <span class="string">'user_001'</span>=&gt;[</span><br><span class="line">        <span class="string">'appid'</span>=&gt;<span class="string">'user_001'</span>,    <span class="comment">//ä½¿ç”¨æ–¹å¯¹äºæä¾›æ–¹apiçš„å”¯ä¸€id</span></span><br><span class="line">        <span class="string">'secret_key'</span>=&gt;<span class="string">'97bc847d4ea7dd9f035d41a657302f1c'</span>    <span class="comment">//å¯†é’¥ ä¹Ÿå”¯ä¸€</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'user_002'</span>=&gt;[</span><br><span class="line">        <span class="string">'appid'</span>=&gt;<span class="string">'user_002'</span>,</span><br><span class="line">        <span class="string">'secret_key'</span>=&gt;<span class="string">'c763b64a62186ae6831edd22063539c4'</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'user_003'</span>=&gt;[</span><br><span class="line">        <span class="string">'appid'</span>=&gt;<span class="string">'user_003'</span>,</span><br><span class="line">        <span class="string">'secret_key'</span>=&gt;<span class="string">'51a683bea5e5c138fd0342fb70e03c65'</span></span><br><span class="line">    ],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ£€éªŒç­¾å</span></span><br><span class="line">$token = <span class="keyword">isset</span>($_GET[<span class="string">'token'</span>]) ? trim($_GET[<span class="string">'token'</span>]) : <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($token))&#123;</span><br><span class="line">    echo_json(<span class="number">1000</span>, <span class="string">'token missed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£åŒ…token</span></span><br><span class="line">$token_params = unpack_token($token);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($token_params[<span class="string">'sign'</span>]))&#123;</span><br><span class="line">    echo_json(<span class="number">1001</span>, <span class="string">'sign error'</span>);  <span class="comment">//ç­¾åä¸ºç©ºæˆ–è€…é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($token_params[<span class="string">'appid'</span>]))&#123;</span><br><span class="line">    echo_json(<span class="number">1002</span>, <span class="string">'appid error'</span>);  <span class="comment">//appidä¸ºç©ºæˆ–è€…é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($token_params[<span class="string">'time'</span>]))&#123;</span><br><span class="line">    echo_json(<span class="number">1003</span>, <span class="string">'time error'</span>);  <span class="comment">//timeä¸ºç©ºæˆ–è€…é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(abs($token_params[<span class="string">'time'</span>] - time()) &gt; <span class="number">10</span> * <span class="number">60</span>)&#123;    <span class="comment">// api è°ƒç”¨æ—¶é—´é™åˆ¶å·¦å³æµ®åŠ¨10åˆ†é’Ÿ</span></span><br><span class="line">    echo_json(<span class="number">1004</span>, <span class="string">'time expired'</span>);  <span class="comment">// 10 minutes</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨appidå–ç”¨æˆ·</span></span><br><span class="line">$user = <span class="keyword">isset</span>($users[$token_params[<span class="string">'appid'</span>]]) ? $users[$token_params[<span class="string">'appid'</span>]] : [];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($user))&#123;</span><br><span class="line">    echo_json(<span class="number">1005</span>, <span class="string">'appid not exists'</span>);  <span class="comment">//è°ƒç”¨æ–¹ä¸å­˜åœ¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨è°ƒç”¨æ–¹å‚æ•°ç”Ÿæˆtoken</span></span><br><span class="line">$create_token = generate_token($user[<span class="string">'appid'</span>], $user[<span class="string">'secret_key'</span>], $token_params[<span class="string">'time'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($token !== $create_token)&#123;</span><br><span class="line">    echo_json(<span class="number">1006</span>, <span class="string">'token error'</span>);  <span class="comment">//tokené”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ°æ­¤ è°ƒç”¨æƒé™çš„éªŒè¯å°±okäº†</span></span><br><span class="line"></span><br><span class="line">$api = <span class="keyword">isset</span>($_GET[<span class="string">'api'</span>]) ? trim($_GET[<span class="string">'api'</span>]) : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥ä¸‹æ¥ä½ å¯ä»¥æœ‰å…¶ä»–å¯¹å…·ä½“æ¥å£çš„éªŒè¯...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line">echo_json(<span class="number">200</span>, <span class="string">'your request api '</span>.$api. <span class="string">' success!'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="APIè°ƒç”¨æ–¹"><a href="#APIè°ƒç”¨æ–¹" class="headerlink" title="APIè°ƒç”¨æ–¹"></a>APIè°ƒç”¨æ–¹</h3><p><code>use_api.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'api_functions.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡è®¾ä½¿ç”¨æ–¹æ˜¯ user_001 ä»–æ‹¥æœ‰è‡ªå·±çš„appidå’Œsecret_key</span></span><br><span class="line">$user = [</span><br><span class="line">    <span class="string">'appid'</span> =&gt; <span class="string">'user_001'</span>,    <span class="comment">//ä½¿ç”¨æ–¹å¯¹äºæä¾›æ–¹apiçš„å”¯ä¸€id</span></span><br><span class="line">    <span class="string">'secret_key'</span> =&gt; <span class="string">'97bc847d4ea7dd9f035d41a657302f1c'</span>    <span class="comment">//å¯†é’¥ ä¹Ÿå”¯ä¸€</span></span><br><span class="line"></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿæˆtoken</span></span><br><span class="line">$token = generate_token($user[<span class="string">'appid'</span>], $user[<span class="string">'secret_key'</span>], time());</span><br><span class="line"></span><br><span class="line"><span class="comment">//urlæ¢æˆä½ è‡ªå·±çš„æ¥å£url</span></span><br><span class="line">$url = <span class="string">'http://'</span> . $_SERVER[<span class="string">'HTTP_HOST'</span>] . dirname($_SERVER[<span class="string">'REQUEST_URI'</span>]);</span><br><span class="line"></span><br><span class="line">$url .= <span class="string">'/api.php?api=user_info'</span>; <span class="comment">//è°ƒç”¨user_infoçš„æ¥å£</span></span><br><span class="line">$url .= <span class="string">'&amp;token='</span> . $token;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $url;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;hr&gt;&lt;pre&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯·æ±‚æ¥å£</span></span><br><span class="line">$res = sub_curl($url);</span><br><span class="line"></span><br><span class="line">var_dump(json_decode($res, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è°ƒç”¨æˆåŠŸç»“æœ</span></span><br><span class="line"><span class="comment">array(3) &#123;</span></span><br><span class="line"><span class="comment">  ["ret"]=&gt;</span></span><br><span class="line"><span class="comment">  int(200)</span></span><br><span class="line"><span class="comment">  ["msg"]=&gt;</span></span><br><span class="line"><span class="comment">  string(35) "your request api user_info success!"</span></span><br><span class="line"><span class="comment">  ["data"]=&gt;</span></span><br><span class="line"><span class="comment">  array(0) &#123;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>API</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¹æœˆï¼ŒåŠ æ²¹ï¼</title>
    <url>/2017/09/06/%E4%B9%9D%E6%9C%88%EF%BC%8C%E5%8A%A0%E6%B2%B9/</url>
    <content><![CDATA[<p><img src="/assets/images/IMG_20170906_101345.png" alt="example-pic"></p>
<p>ä¸çŸ¥ä¸è§‰è¿™ä¸€å¹´å·²ç»è¿‡äº†å¤§åŠã€‚ä¹æœˆäº†ï¼ŒåŠ æ²¹ï¼</p>
]]></content>
      <categories>
        <category>å²æœˆé™å¥½</category>
      </categories>
      <tags>
        <tag>å²æœˆé™å¥½</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªç™¾åº¦åœ°å›¾çš„å¸¸ç”¨ä½¿ç”¨ç¤ºä¾‹</title>
    <url>/2017/09/07/%E4%B8%80%E4%B8%AA%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%B8%B8%E7%94%A8%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<p>ä»Šå¤©åœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº†ç™¾åº¦åœ°å›¾ï¼Œæ„Ÿè§‰ä¹Ÿæ˜¯ä¸ªåŸºæœ¬ç”¨æ³•çš„å¸¸ç”¨ç¤ºä¾‹ï¼Œåœ¨è¿™å’Œå¤§å®¶åˆ†äº«ä¸‹ğŸ˜</p>
<p>æ•ˆæœå¦‚å›¾ï¼š</p>
<p><img src="/assets/images/20170907200341.png" alt="example-pic"></p>
<p>å…ˆè¯´è¯´éœ€æ±‚å§ï¼š</p>
<blockquote>
<ol>
<li>æ‰“å¼€åœ°å›¾ï¼Œè‡ªåŠ¨<strong>å®šä½åˆ°å½“å‰æ‰€åœ¨ä½ç½®</strong>ï¼Œå¹¶åœ¨åœ°å›¾ä¸Šæ·»åŠ ä¸€ä¸ª<strong>å¯æ‹–æ‹½</strong>çš„æ ‡æ³¨ï¼ˆmarkerï¼‰ </li>
<li>ç”¨æˆ·å¯ä»¥æ‹–æ‹½æ ‡æ³¨é€‰æ‹©åœ°å›¾ä¸Šçš„ä½ç½®ï¼ŒåŒæ—¶æ ‡æ³¨çš„<strong>ç»çº¬åº¦</strong>æ˜¾ç¤ºåœ¨inputæ¡†ä¸­ï¼ˆå…¶å®è¿™ä¸ªæ˜¯ä¸ºäº†çœ‹æ•ˆæœï¼Œä¸€èˆ¬éƒ½ç”¨éšè—åŸŸï¼‰ï¼Œæ ‡æ³¨çš„<strong>å½“å‰åœ°å€</strong>æ˜¾ç¤ºåœ¨åœ°å€çš„è¾“å…¥æ¡†ä¸­</li>
<li>ç”¨æˆ·è¾“å…¥åœ°å€ä¹‹åè‡ªåŠ¨è°ƒç”¨ç™¾åº¦åœ°å›¾çš„APIï¼Œæ‰¾åˆ°è¾“å…¥åœ°å€å¯¹åº”åˆ°åœ°å›¾çš„ç‚¹å¹¶ç§»åŠ¨æ ‡æ³¨åˆ°æ­¤ã€‚å½“ç„¶ä¹ŸåŒ…æ‹¬æ˜¾ç¤ºç»çº¬åº¦ã€‚</li>
</ol>
</blockquote>
<p>HTMLé¡µé¢éƒ¨åˆ†æ˜¯è¿™æ ·å­ï¼Œä½¿ç”¨bootstrap3çš„æ ·å¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;div class="form"&gt;</span><br><span class="line">    &lt;div class="form-group"&gt;</span><br><span class="line">        &lt;label class="col-lg-2 col-sm-2 control-label"&gt;åœ°å€&lt;/label&gt;</span><br><span class="line">        &lt;div class="col-lg-10"&gt;</span><br><span class="line">            &lt;input type="text" class="form-control pwd-input" name="address" id="address" value="&lt;?php echo !empty($info['address']) ? $info['address'] : '';?&gt;" placeholder="è¯·è¾“å…¥åœ°å€"&gt;</span><br><span class="line">            &lt;p class="help-block"&gt;&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class="form-group"&gt;</span><br><span class="line">        &lt;label class="col-lg-2 col-sm-2 control-label"&gt;é€‰æ‹©ä½ç½®&lt;/label&gt;</span><br><span class="line">        &lt;div class="col-lg-10"&gt;</span><br><span class="line">            &lt;div class="clearfix"&gt;</span><br><span class="line">                &lt;label class="control-label pull-left" style="margin-right: 5px;"&gt;ç»åº¦&lt;/label&gt;&lt;input type="text" name="lng" id="lng" value="&lt;?php echo !empty($info['lng']) ? $info['lng'] : '';?&gt;" class="form-control pull-left" style="width: 120px;margin-right: 15px;"&gt;</span><br><span class="line">                &lt;label class="control-label pull-left" style="margin-right: 5px;"&gt;ç»´åº¦&lt;/label&gt;&lt;input type="text" name="lat" id="lat" value="&lt;?php echo !empty($info['lat']) ? $info['lat'] : '';?&gt;" class="form-control pull-left" style="width: 120px;"&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;br&gt;</span><br><span class="line">            &lt;div id=<span class="string">"l-map"</span> style=<span class="string">"width: 600px;height: 400px;"</span>&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ˜¯jsï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç»çº¬åº¦</span></span><br><span class="line"><span class="keyword">var</span> lat = <span class="string">'&lt;?php echo !empty($info['</span>lat<span class="string">']) ? $info['</span>lat<span class="string">'] : '</span><span class="string">';?&gt;'</span>;</span><br><span class="line"><span class="keyword">var</span> lng = <span class="string">'&lt;?php echo !empty($info['</span>lng<span class="string">']) ? $info['</span>lng<span class="string">'] : '</span><span class="string">';?&gt;'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™¾åº¦åœ°å›¾APIåŠŸèƒ½</span></span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> BMap.Map(<span class="string">"l-map"</span>);    <span class="comment">//newä¸ªåœ°å›¾å‡ºæ¥</span></span><br><span class="line"><span class="keyword">var</span> point;</span><br><span class="line"><span class="keyword">var</span> marker;</span><br><span class="line"><span class="keyword">if</span>(lat &amp;&amp; lng)&#123;</span><br><span class="line">    point = <span class="keyword">new</span> BMap.Point(lng,lat);    <span class="comment">//newä¸ªç‚¹</span></span><br><span class="line">    marker = <span class="keyword">new</span> BMap.Marker(point);    <span class="comment">//newä¸ªæ ‡æ³¨</span></span><br><span class="line">    marker.enableDragging();           <span class="comment">// å¯æ‹–æ‹½</span></span><br><span class="line">    map.addOverlay(marker);             <span class="comment">// å°†æ ‡æ³¨æ·»åŠ åˆ°åœ°å›¾ä¸­</span></span><br><span class="line">    getPosition(marker);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    point = <span class="keyword">new</span> BMap.Point(<span class="number">107.475903</span>, <span class="number">31.214995</span>);</span><br><span class="line">    <span class="comment">//map.addControl(new BMap.GeolocationControl());  //å®šä½</span></span><br><span class="line">    map.addControl(<span class="keyword">new</span> BMap.NavigationControl());  </span><br><span class="line">    <span class="keyword">var</span> geolocation = <span class="keyword">new</span> BMap.Geolocation();   <span class="comment">//è·å–å½“å‰ä½ç½®</span></span><br><span class="line">    geolocation.getCurrentPosition(<span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.getStatus() == BMAP_STATUS_SUCCESS)&#123;</span><br><span class="line">            marker = <span class="keyword">new</span> BMap.Marker(r.point);</span><br><span class="line">            marker.enableDragging();           <span class="comment">// å¯æ‹–æ‹½</span></span><br><span class="line">            map.addOverlay(marker);</span><br><span class="line">            map.panTo(r.point);</span><br><span class="line">            <span class="comment">//console.log('æ‚¨çš„ä½ç½®ï¼š'+r.point.lng+','+r.point.lat);</span></span><br><span class="line">            getPosition(marker);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            marker = <span class="keyword">new</span> BMap.Marker(point);</span><br><span class="line">            marker.enableDragging();           <span class="comment">// å¯æ‹–æ‹½</span></span><br><span class="line">            map.addOverlay(marker);             <span class="comment">// å°†æ ‡æ³¨æ·»åŠ åˆ°åœ°å›¾ä¸­</span></span><br><span class="line">            getPosition(marker);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,&#123;<span class="attr">enableHighAccuracy</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">map.centerAndZoom(point, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gc = <span class="keyword">new</span> BMap.Geocoder();<span class="comment">//åœ°å€è§£æç±»</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ°å€è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶æœç´¢è¾“å…¥çš„ä½ç½®</span></span><br><span class="line">$(<span class="string">"#address"</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> address = $(<span class="keyword">this</span>).val();</span><br><span class="line">    parseAddress(address, <span class="string">'ä¸Šæµ·å¸‚'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è§£æåœ°å€</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseAddress</span>(<span class="params">address, city</span>)</span>&#123;</span><br><span class="line">    gc.getPoint(address, <span class="function"><span class="keyword">function</span>(<span class="params">point</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(point);</span><br><span class="line">        <span class="keyword">if</span>(point)&#123;</span><br><span class="line">            <span class="comment">//æ”¾å¤§åœ°å›¾ ä¹‹å‰zoomæ˜¯12</span></span><br><span class="line">            map.setZoom(<span class="number">15</span>);</span><br><span class="line">            <span class="comment">// console.log(marker);</span></span><br><span class="line">            </span><br><span class="line">            $(<span class="string">"#lng"</span>).val(point.lng);</span><br><span class="line">            $(<span class="string">"#lat"</span>).val(point.lat);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ¥ä¸‹æ¥çš„æ“ä½œæƒ³æƒ³åº”è¯¥æ—¶ç§»åŠ¨æ ‡æ³¨åˆ°æ–°çš„ä½ç½®ï¼Œä½†æ˜¯å¥½åƒapiæ²¡è¿™ä¸­æ“ä½œï¼Œåªæœ‰å…ˆæŠŠæ ‡æ³¨ä»åœ°å›¾ä¸Šå–ä¸‹æ¥ æ¢ä¸ªä½ç½®å†æ”¾ä¸Šå»</span></span><br><span class="line">            <span class="keyword">var</span> allOverlay = map.getOverlays(); <span class="comment">//è·å–åœ°å›¾è¦†ç›–ç‰©</span></span><br><span class="line">            <span class="comment">//console.log(allOverlay);</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;allOverlay.length;i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> pos = allOverlay[i].getPosition();</span><br><span class="line">                <span class="comment">//åˆ é™¤æŒ‡å®šç»åº¦çš„è¦†ç›–ç‰©</span></span><br><span class="line">                <span class="keyword">if</span> (pos &amp;&amp; pos.lng == point.lng &amp;&amp; pos.lat == point.lat) &#123;</span><br><span class="line">                    map.removeOverlay(allOverlay[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//é‡è®¾æ ‡æ³¨çš„ä½ç½®</span></span><br><span class="line">            marker.setPosition(point);</span><br><span class="line">            <span class="comment">//æŠŠæ ‡æ³¨é‡æ–°æ”¾åˆ°åœ°å›¾ä¸Š</span></span><br><span class="line">            map.addOverlay(marker);</span><br><span class="line">            <span class="comment">//ç§»åŠ¨åœ°å›¾åˆ°æ–°ä½ç½®</span></span><br><span class="line">            map.panTo(point);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, city);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPosition</span>(<span class="params">marker</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//æ·»åŠ æ ‡è®°ç‚¹å‡»ç›‘å¬</span></span><br><span class="line">    marker.addEventListener(<span class="string">"mouseup"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        gc.getLocation(e.point, <span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</span><br><span class="line">            <span class="comment">//console.log("åœ°å›¾ä¸­å¿ƒç‚¹å˜æ›´ä¸ºï¼š" + rs.lng + ", " + rs.lat);</span></span><br><span class="line">            <span class="built_in">console</span>.log(rs.point.lat + <span class="string">','</span> + rs.point.lng);</span><br><span class="line">            $(<span class="string">"#lng"</span>).val(rs.point.lng);</span><br><span class="line">            $(<span class="string">"#lat"</span>).val(rs.point.lat);</span><br><span class="line">            $(<span class="string">"#address"</span>).val(rs.address);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®åŸºæœ¬çš„æ“ä½œè¿˜æŒºé¡ºåˆ©çš„ï¼Œåªæ˜¯åœ¨ä¸€ä¸ªåœ°æ–¹ç¢°åˆ°äº†å‘ï¼š<strong>ç§»åŠ¨æ ‡æ³¨</strong></p>
<p>æ€ä¹ˆç§»åŠ¨å‘¢ï¼Ÿç¿»äº†ç™¾åº¦APIæ²¡æ‰¾åˆ°ï¼Œæœ€åä¹Ÿæ˜¯é€šè¿‡æœç´ å¼•æ“æŸ¥æŸ¥æŸ¥ï¼Œæ‰æ‰¾åˆ°æ€è·¯ã€‚</p>
<p>åŸæ¥æ ‡æ³¨æ·»åŠ æ ‡æ³¨(marker)æ·»åŠ åˆ°åœ°å›¾ä¸Šæ˜¯å±äºè¦†ç›–ç‰©(Overlay)ã€‚æƒ³ç§»åŠ¨å°±æ¢ä¸ªæ€è·¯ï¼ŒæŠŠè¿™ä¸ªè¦†ç›–ç‰©ç§»é™¤ï¼Œç„¶åé‡æ–°ç»™æ ‡æ³¨èµ‹äºˆæ–°çš„ä½ç½®å±æ€§ï¼Œç„¶åé‡æ–°æ·»åŠ åˆ°åœ°å›¾ä¸Šã€‚</p>
<p>(ã€‚ãƒ»âˆ€ãƒ»)ãƒ è¿™ä¸‹æå®šå•¦~ èµ¶ç´§å…³æœºä¸‹ç­ï¼Œåº†ç¥ä¸€ä¸‹ ğŸ‰</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>ç™¾åº¦åœ°å›¾</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå·±å®ç°AJAXå¼‚æ­¥ä¸Šä¼ æ–‡ä»¶</title>
    <url>/2017/09/09/%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0AJAX%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p>åœ¨é¡¹ç›®ä¸­ç»å¸¸ç”¨åˆ°æ–‡ä»¶ä¸Šä¼ ï¼Œç„¶åå°±æ‰¾å„ç§å„æ ·çš„æ’ä»¶ã€‚ä½†ç”¨ç€ç”¨ç€æ€»ä¸æ˜¯å¾ˆå¤šåœ°æ–¹ä¸æ˜¯å¾ˆç§°æ‰‹ï¼Œéœ€è¦ä¿®ä¿®æ”¹æ”¹ã€‚æ‰€ä»¥ä»Šå¤©å¹²è„†è‡ªå·±å†™ä¸ªå§ã€‚</p>
<p>å…ˆè¯´è¯´å…·ä½“éœ€æ±‚ï¼š</p>
<blockquote>
<ol>
<li>ä¸Šä¼ æ–‡ä»¶åšåˆ°æ‰€è§æ‰€å¾—ï¼Œå°±æ˜¯é€‰æ‹©æ–‡ä»¶ä¹‹åèƒ½ç«‹é©¬çœ‹åˆ° </li>
<li>å¯ä»¥æ–¹ä¾¿ç”¨åœ¨ç”¨jså¼‚æ­¥æäº¤çš„è¡¨å•ä¸­</li>
</ol>
</blockquote>
<p>HTMLé¡µé¢éƒ¨åˆ†æ˜¯è¿™æ ·å­</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å›¾ç‰‡./images/add_img.pngå°±æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åŠ å· +  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">"cursor: pointer;"</span> <span class="attr">src</span>=<span class="string">"./images/add_img.png"</span> <span class="attr">alt</span>=<span class="string">"ç‚¹å‡»ä¸Šä¼ "</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">title</span>=<span class="string">"ç‚¹å‡»ä¸Šä¼ "</span> <span class="attr">class</span>=<span class="string">"upload-img"</span> <span class="attr">data-id</span>=<span class="string">"img"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"image"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"upload-img-input"</span> <span class="attr">data-id</span>=<span class="string">"img"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">"display: none"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">"image/gif,image/jpeg,image/jpg,image/png,image/bmp"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file_img"</span> <span class="attr">data-id</span>=<span class="string">"img"</span> <span class="attr">onchange</span>=<span class="string">"upload_image(this);"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨input:fileçš„acceptå±æ€§ä¸­å®šä¹‰å¯ä»¥ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼ï¼ˆMIME ç±»å‹ï¼‰åœ¨è¿™é‡Œæˆ‘ä»¬åˆ—å‡ºå¸¸ç”¨çš„å›¾ç‰‡ç±»å‹ï¼šimage/gif,image/jpeg,image/jpg,image/png,image/bmp</p>
<p>å…¶å®åœ¨è¿™å¤§å®¶ä¼šè¯´åç¼€æ˜¯<code>.jpg</code>å’Œ<code>.jpeg</code>çš„å›¾ç‰‡çš„mime typeä¸éƒ½æ˜¯<code>image/jpeg</code>å—ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦åŠ ä¸ª<code>image/jpg</code>?</p>
<p>æ²¡é”™ï¼Œæ˜¯è¿™æ ·å¦‚æœä½ åªå†™<code>image/jpeg</code>ç”¨è°·æ­Œæµè§ˆå™¨æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯åœ¨å¾®ä¿¡æµè§ˆå™¨ï¼ŒQQæµè§ˆå™¨ä¸­å°±ä¸è¡Œäº†ï¼Œåæ¥æ‰¾ä¸åˆ°é—®é¢˜ï¼Œå°è¯•äº†å¥½å¤šæ¬¡æ‰å‘ç°è¿™ä¸ªé—®é¢˜ã€‚æ²¡åŠæ³•ï¼Œå›½äº§æµè§ˆå™¨ä¸æŒ‰æ ‡å‡†é€ çš„åŸå›  â•®(â•¯â–½â•°)â•­</p>
<p>å…¶ä»–æ–‡ä»¶æ ¼å¼å¤§å®¶çœ‹è¿™é‡Œ  <a href="http://www.w3school.com.cn/media/media_mimeref.asp" target="_blank" rel="noopener">w3school</a> </p>
<p>é‡ç‚¹æ˜¯jsï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å‡»å›¾ç‰‡çš„æ—¶å€™ è§¦å‘éšè—çš„input:fileçš„ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">$(<span class="string">".upload-img"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id = $(<span class="keyword">this</span>).data(<span class="string">'id'</span>);</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">'file_'</span> + id);</span><br><span class="line">    file.click();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_image</span>(<span class="params">pic_file</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id = $(pic_file).data(<span class="string">'id'</span>);</span><br><span class="line">    <span class="keyword">var</span> input = $(<span class="string">"input.upload-img-input[data-id="</span>+id+<span class="string">"]"</span>);    <span class="comment">//æ‰¾åˆ°ç›¸åº”çš„éšè—åŸŸ</span></span><br><span class="line">    <span class="keyword">var</span> pic = $(<span class="string">"img.upload-img[data-id="</span>+id+<span class="string">"]"</span>);              <span class="comment">//æ‰¾åˆ°ç›¸åº”çš„é¢„è§ˆå›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> file = pic_file.files[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (file.size &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;   <span class="comment">//è®¾ç½®é™åˆ¶æ–‡ä»¶å¤§å° ä¸å¤§äº2MB</span></span><br><span class="line">        alert(<span class="string">'ä¸Šä¼ æ–‡ä»¶ä¸èƒ½å¤§äº2M!'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();    <span class="comment">//ä½¿ç”¨formDataå¯¹è±¡</span></span><br><span class="line">    fd.append(<span class="string">"pic_file"</span>, file);</span><br><span class="line">    <span class="comment">//fd.append("name", name);  //å¯ä»¥æ·»åŠ å…¶ä»–å­—æ®µï¼Œæ¯”å¦‚æœ‰äº›æ¡†ä¸ºäº†å®‰å…¨åŠ çš„csrf_token</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">    xhr.open(<span class="string">"POST"</span>, <span class="string">'upload_file.php'</span>);    <span class="comment">//è¿™é‡Œæ˜¯åç«¯å¤„ç†çš„åœ°å€</span></span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.status == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> obj = <span class="built_in">eval</span>(<span class="string">'('</span> + xhr.responseText + <span class="string">')'</span>);   <span class="comment">//æŠŠjsonå­—ç¬¦ä¸²è½¬æ¢æˆjså¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (obj.ret == <span class="number">200</span>) &#123;   <span class="comment">//ä¸Šä¼ æˆåŠŸ</span></span><br><span class="line">                <span class="keyword">var</span> pic_url = obj.data.url; <span class="comment">//æ˜¾ç¤ºé¢„è§ˆå›¾</span></span><br><span class="line">                input.val(pic_url);         <span class="comment">//æŠŠåœ°å€æ”¾åˆ°éšè—åŸŸ</span></span><br><span class="line">                pic.attr(<span class="string">'src'</span>, pic_url);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(obj.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(<span class="string">'ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨å€™å†è¯•'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.send(fd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æœåŠ¡ç«¯ä¸Šä¼ è¿”å›çš„jsonæ ¼å¼æ˜¯è¿™æ ·</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"ret"</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"ok"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">        <span class="attr">"url"</span>: <span class="string">"ä½ çš„å›¾ç‰‡urlåœ°å€"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>JavaScript</category>
        <category>HTML5</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>HTML5</tag>
        <tag>AJAX</tag>
      </tags>
  </entry>
  <entry>
    <title>EFIæ¨¡å¼ä¸‹å®‰è£…win10+Archlinux</title>
    <url>/2017/09/13/EFI%E6%A8%A1%E5%BC%8F%E4%B8%8B%E5%AE%89%E8%A3%85win10+Archlinux/</url>
    <content><![CDATA[<p>å°±æœ€è¿‘ä¸€æ¬¡å®‰è£…Archlinuxåšä¸€æ¬¡ç¬”è®°å§ã€‚åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆæ²¡äº‹å°±è£…archï¼Œå› ä¸ºä»–æ˜¯arch  ğŸ˜œ </p>
<p>Win10å®‰è£…å°±ç•¥è¿‡äº†ï¼Œæˆ‘çš„ç”µè„‘linuxè€æ¢ï¼Œwin10å§‹ç»ˆç¨³ç¨³çš„åœ¨é‚£èººç€ï¼Œä¸€åŠ¨ä¸åŠ¨ã€‚ã€‚ã€‚</p>
<p>å› ä¸ºwin10æ˜¯æå‰å®‰è£…å¥½çš„ï¼Œè€Œä»–æ˜¯ä½¿ç”¨EFIæ¨¡å¼å®‰è£…çš„ æˆ‘ä»¬åœ¨win10ä¸‹åœ¨ç¡¬ç›˜ä¸Šç»™å’‹archæŒªå‡ºç‚¹ç©ºé—´æ¥ï¼Œå‡ åä¸ªGBå°±è¡Œã€‚çœ‹ä½ ç¡¬ç›˜å¤§å°äº†å’Œå¿ƒæƒ…äº†ã€‚</p>
<h3 id="å¯åŠ¨liveCD"><a href="#å¯åŠ¨liveCD" class="headerlink" title="å¯åŠ¨liveCD"></a>å¯åŠ¨liveCD</h3><p>ç”¨åœ¨<a href="https://www.archlinux.org/download/" target="_blank" rel="noopener">å®˜ç½‘</a>æˆ–è€…<a href="http://mirrors.163.com/archlinux/iso/2017.09.01/" target="_blank" rel="noopener">163</a>æºä¸‹è½½æœ€æ–°çš„liveCDé•œåƒï¼ˆæ¯”å¦‚æœ€æ–°æ˜¯archlinux-2017.09.01-x86_64.isoï¼‰ï¼Œåˆ»å½•åˆ°uç›˜ï¼Œæˆ‘å–œæ¬¢ç”¨<a href="http://rufus.akeo.ie/" target="_blank" rel="noopener">rufs</a>ï¼Œè¿™ä¸ªä¸å¤§äº1Mçš„å°å·¥å…·å¾ˆç®€å•å¼ºå¤§æˆ‘å–œæ¬¢ã€‚ å½“ç„¶äº†ï¼Œç†Ÿæ‚‰linuxçš„åŒå­¦å¯ä»¥ç”¨<a href="https://wiki.archlinux.org/index.php/Core_utilities#dd" target="_blank" rel="noopener">dd</a>å‘½ä»¤ã€‚</p>
<p>æ’ä¸Šuç›˜ï¼Œé‡å¯åˆ°liveCDé‡Œé¢ã€‚é‡Œé¢ä¹Ÿæ˜¯ä¸ªæ²¡æ¡Œé¢çš„shellç³»ç»Ÿã€‚</p>
<h3 id="çœ‹Archlinux-wiki"><a href="#çœ‹Archlinux-wiki" class="headerlink" title="çœ‹Archlinux wiki"></a>çœ‹Archlinux wiki</h3><p>åœ¨å¼€å§‹ä¹‹å‰æœ€å¥½è¿˜æ˜¯çœ‹çœ‹<a href="https://wiki.archlinux.org/index.php/Installation_guide" target="_blank" rel="noopener">archçš„wiki</a>Installation guide(å®‰è£…æŒ‡å—)ï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œæœ€å¥½çœ‹è‹±æ–‡çš„ï¼Œä¸­æ–‡çš„ç¿»è¯‘æœ‰ç‚¹å»¶è¿Ÿã€‚</p>
<h3 id="è”ç½‘"><a href="#è”ç½‘" class="headerlink" title="è”ç½‘"></a>è”ç½‘</h3><p>å¦‚æœä½ æ˜¯æœ‰çº¿ç½‘ç»œï¼Œæ’ä¸Šç½‘çº¿ï¼Œå¯åŠ¨<a href="https://wiki.archlinux.org/index.php/Dhcpcd" target="_blank" rel="noopener">dhcpd</a>æœåŠ¡ï¼ˆä¹Ÿå°±æ˜¯åŠ¨æ€è·å–ipï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start dhcpcd</span><br></pre></td></tr></table></figure>
<p>æ— çº¿ç½‘ç»œç”¨wifi-menué“¾æ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wifi-menu</span><br></pre></td></tr></table></figure>
<p>çœ‹çœ‹é“¾æ¥æˆåŠŸäº†æ²¡ æŸ¥çœ‹ä¸‹ip</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æˆåŠŸï¼Œæˆ–è€…å…¶ä»–çš„è”ç½‘æ–¹å¼ï¼Œçœ‹çœ‹<a href="https://wiki.archlinux.org/index.php/Network_configuration" target="_blank" rel="noopener">archçš„wiki</a></p>
<p>å…¶å®è¯´åˆ°è¿™ï¼Œå†æ¬¡æé†’å¤§å®¶ï¼Œçœ‹<a href="https://wiki.archlinux.org/" target="_blank" rel="noopener">archçš„wiki</a></p>
<p>è¿ä¸Šç½‘ç»œäº†ï¼Œå¼€å·¥å§!</p>
<h3 id="åˆ†åŒºï¼š"><a href="#åˆ†åŒºï¼š" class="headerlink" title="åˆ†åŒºï¼š"></a>åˆ†åŒºï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fdisk &#x2F;dev&#x2F;sda</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥fdiskä¹‹åæŒ‰<code>p</code>ï¼Œçœ‹çœ‹ç°æœ‰åˆ†åŒºçš„æƒ…å†µ<br>è¿™æ˜¯æˆ‘çš„ç¡¬ç›˜åˆ†åŒºæƒ…å†µï¼Œç¡¬ç›˜æ ¼å¼<code>gpt</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;dev&#x2F;sda1        2048     923647    921600   450M Windows æ¢å¤ç¯å¢ƒ</span><br><span class="line">&#x2F;dev&#x2F;sda2      923648    1128447    204800   100M EFI ç³»ç»Ÿ</span><br><span class="line">&#x2F;dev&#x2F;sda3     1128448    1161215     32768    16M Microsoft ä¿ç•™</span><br><span class="line">&#x2F;dev&#x2F;sda4     1161216  209256750 208095535  99.2G Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line">&#x2F;dev&#x2F;sda5   209258496  210888703   1630208   796M Windows æ¢å¤ç¯å¢ƒ</span><br><span class="line">&#x2F;dev&#x2F;sda6   210890752  462559542 251668791   120G Microsoft åŸºæœ¬æ•°æ®</span><br></pre></td></tr></table></figure>
<p>å‡å¦‚æˆ‘çš„ç¡¬ç›˜ä¸­ç©ºé—²ç©ºé—´100GBï¼Œç”¨fdisk ç»™è¿™100GBåˆ†ä¸€åˆ†</p>
<p>æˆ‘çš„æ–¹æ¡ˆæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;dev&#x2F;sda7    &#x2F;boot           ext4    500MB    #bootå¯åŠ¨åˆ†åŒº 500MBå¤Ÿç”¨äº†</span><br><span class="line">&#x2F;dev&#x2F;sda8    swap                        8GB         #äº¤æ¢åˆ†åŒºï¼Œ æˆ‘çš„å†…å­˜ä¹Ÿ8GBï¼Œæˆ‘å°±åˆ†ä¸€æ ·å¤§å°äº†</span><br><span class="line">&#x2F;dev&#x2F;sda9    &#x2F;                   ext4                   #å‰©ä¸‹çš„å…¨ç»™ &#x2F; æ ¹åˆ†åŒº</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®è‡ªå·±çš„ç©ºé—´å¤§å°è‡ªè¡Œè°ƒæ•´ã€‚</p>
<p>æ ¼å¼åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkfs.ext4 &#x2F;dev&#x2F;sda7</span><br><span class="line">mkfs.ext4 &#x2F;dev&#x2F;sda9</span><br><span class="line">mkswap &#x2F;dev&#x2F;sda8</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…åŸºç¡€ç³»ç»Ÿ"><a href="#å®‰è£…åŸºç¡€ç³»ç»Ÿ" class="headerlink" title="å®‰è£…åŸºç¡€ç³»ç»Ÿ"></a>å®‰è£…åŸºç¡€ç³»ç»Ÿ</h3><p>æŒ‚è½½åˆ†åŒºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mount &#x2F;dev&#x2F;sda9 &#x2F;mnt</span><br><span class="line">mkdir &#x2F;mnt&#x2F;boot</span><br><span class="line">mount &#x2F;dev&#x2F;sda7 &#x2F;mnt&#x2F;boot</span><br><span class="line">mkdir &#x2F;mnt&#x2F;boot&#x2F;EFI</span><br><span class="line">mount &#x2F;dev&#x2F;sda2 &#x2F;mnt&#x2F;boot&#x2F;EFI          #è¿™ä¸ªEFIåˆ†åŒºåœ¨åˆ†åŒºæƒ…å†µé‡Œé¢èƒ½çœ‹åˆ°æˆ‘çš„æ˜¯sda2</span><br><span class="line">swapon &#x2F;dev&#x2F;sda8</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹æºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;pacman.d&#x2F;mirrorlist</span><br></pre></td></tr></table></figure>
<p>æŠŠ163ï¼Œustcè¿™å‡ ä¸ªæ¯”è¾ƒå¥½ä½¿çš„ä¸­å›½æºå¤åˆ¶åˆ°æ–‡ä»¶æœ€ä¸Šé¢ï¼Œåˆ°æ—¶å€™ä¸‹è½½å®‰è£…çš„æ—¶å€™è·‘çš„å¿«ä¸€ç‚¹</p>
<p>å¼€å§‹å®‰è£…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pacstrap -i &#x2F;mnt base vim dialog wpa_supplicant</span><br></pre></td></tr></table></figure>
<p>baseæ˜¯åŸºç¡€ç³»ç»Ÿï¼Œdialogæ˜¯ä¸Šé¢æåˆ°çš„é“¾æ¥æ— çº¿ç½‘çš„wifi-menuï¼Œwpa_supplicantä¹Ÿæ˜¯æ‰‹åŠ¨é“¾æ¥æ— çº¿ç½‘çš„åŒ…ï¼Œvim ä¸è§£é‡Š </p>
<p>å®‰è£…å®Œæˆä¹‹å</p>
<p>æŠŠåˆ†åŒºæŒ‚è½½æƒ…å†µå†™å…¥fstabä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">genfstab -U -p &#x2F;mnt &gt; &#x2F;mnt&#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure>

<p>chrootè¿›æ–°ç³»ç»Ÿï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">arch-chroot &#x2F;mnt &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<p>ä¸€äº›é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &#39;my-archlinux&#39; &gt; &#x2F;etc&#x2F;hostname     #è®¾ç½®ä¸»æœºåå­—</span><br><span class="line">ln -sf &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai   #è®¾ç½®æ—¶åŒº</span><br><span class="line">timedatectl set-timezone Asia&#x2F;Shanghai      #ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªè®¾ç½®æ—¶åŒº</span><br><span class="line">timedatectl set-ntp true        # è®¾ç½®æ—¶é—´ntpåŒæ­¥ç½‘ç»œæ—¶é—´</span><br><span class="line">vim &#x2F;etc&#x2F;locale.gen     # åŒºåŸŸè®¾ç½® å–æ¶ˆè‹±æ–‡ï¼ˆen_US.UTF-8ï¼‰å’Œä¸­æ–‡(zh_CN.UTF-8)çš„æ³¨é‡Š</span><br><span class="line">locale-gen      #ç”Ÿæˆè®¾ç½®åŒºåŸŸè®¾ç½®</span><br><span class="line">echo &quot;LANG&#x3D;en_US.UTF-8&quot; &gt; &#x2F;etc&#x2F;locale.conf #è®¾ç½®è¯­è¨€ï¼Œå› ä¸ºå…ˆå®‰è£…çš„æ˜¯æ²¡æ¡Œé¢çš„æ¨¡å¼ï¼Œå…ˆç”¨è‹±æ–‡ï¼Œä¸­æ–‡ä¼šæ˜¾ç¤ºæˆå°æ–¹å—</span><br></pre></td></tr></table></figure>
<p> åˆ›å»ºåˆå§‹å†…å­˜ç›˜<a href="https://wiki.archlinux.org/index.php/Mkinitcpio" target="_blank" rel="noopener">mkinitcpio</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkinitcpio -p linux</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®rootå¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure>
<p>è¿™æ­¥å¿˜äº†ï¼Œä½ å°±è¿›ä¸å»ç³»ç»Ÿäº†ï¼Œâ•®(â•¯â–½â•°)â•­</p>
<p>æå®šå¯åŠ¨é¡¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pacman -S grub efibootmgr       #å®‰è£…grub efibootmgrç®¡ç†å¯åŠ¨é¡¹</span><br><span class="line">grub-install --target&#x3D;x86_64-efi --efi-directory&#x3D;&#x2F;boot&#x2F;EFI --bootloader-id&#x3D;arch_grub --recheck</span><br><span class="line">pacman -S os-prober     #å®‰è£…è¿™ä¸ªåŒ…æ˜¯ä¸ºäº†è®©grub-mkconfigå‘ç°win10çš„å¯åŠ¨é¡¹</span><br><span class="line">grub-mkconfig -o &#x2F;boot&#x2F;grub&#x2F;grub.cfg   #æŠŠå¯åŠ¨é¡¹å†™åˆ°æ–‡ä»¶é…ç½®é‡Œ</span><br></pre></td></tr></table></figure>
<p>å¦‚æœwin10çš„å¯åŠ¨é¡¹æ²¡æœ‰è¢«å‘ç°ï¼Œä¸è¦ç€æ€¥ï¼Œåœ¨æ–°çš„ç³»ç»Ÿå®‰è£…é‡å¯ä¹‹åï¼Œé‡æ–°æ‰§è¡Œä¸Šé¢<code>grub-mkconfig</code>å‘½ä»¤å°±è¡Œäº†</p>
<p>é€€å‡ºæ–°ç³»ç»Ÿ,é‡å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exit        #é€€å‡º</span><br><span class="line">unmout -R &#x2F;mnt  #å–æ¶ˆæŒ‚è½½ç£ç›˜</span><br><span class="line">reboot   #é‡å¯</span><br></pre></td></tr></table></figure>

<p>å¥½äº†å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œé‡å¯ä¹‹åå°±èƒ½çœ‹åˆ°ä½ çš„æ–°ç³»ç»Ÿäº†  (ã€‚ãƒ»âˆ€ãƒ»)ãƒ </p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>EFI</tag>
        <tag>Archlinux</tag>
      </tags>
  </entry>
  <entry>
    <title>Win10å­ç³»ç»Ÿubuntuæ›´æ¢æº</title>
    <url>/2017/09/17/win10%E5%AD%90%E7%B3%BB%E7%BB%9Fubuntu%E6%9B%B4%E6%8D%A2%E6%BA%90/</url>
    <content><![CDATA[<p>ä½œä¸ºä¸€ä¸ªwindowsä¸‹é¢çš„å¼€å‘è€…ï¼Œä¹‹å‰å·¥ä½œä¸€ç›´ç”¨cygwinã€‚cygwinè™½ç„¶æ–¹ä¾¿ä½†æ˜¯å¾ˆå¤šæ—¶å€™å®‰è£…ä¸€äº›ä¸œè¥¿ï¼Œæ¯”å¦‚jekyll,æ˜¯å„ç§ä¾èµ–ä¸è¶³ï¼Œå¤ªç—›è‹¦äº†ã€‚å¥½åœ¨å¾®è½¯win10å‡ºäº†é’ˆå¯¹å¼€å‘è€…çš„linuxå­ç³»ç»Ÿï¼Œé‚£å°±å…ˆè¯•ç”¨ä¸€æ®µæ—¶é—´å§ã€‚</p>
<p>ç°åœ¨win10çš„linuxå­ç³»ç»Ÿå·²ç»æœ‰ubuntuå’Œopensuseä¸¤ä¸ªç‰ˆæœ¬äº†,åº”è¯¥åç»­è¿˜ä¼šæ¨å‡ºæ›´å¤šçš„linuxå‘è¡Œç‰ˆã€‚å¤§å®¶æŒ‰ä¸ªäººå–œå¥½å®‰è£…å§ã€‚</p>
<p>å®‰è£…è¿‡ç¨‹ï¼Œç½‘ä¸Šå¾ˆå¤šä¹Ÿä¸éš¾ï¼Œå°±ç•¥è¿‡äº†ï¼Œå¤§å®¶è‡ªè¡Œæœç´¢å§ã€‚</p>
<p>æˆ‘çš„linuxå­ç³»ç»Ÿç”¨çš„æ˜¯ubuntuï¼Œä½¿ç”¨èµ·æ¥ç®€å•æ–¹ä¾¿å•ŠğŸ˜</p>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œé¡ºæ‰‹å°±æ˜¯ä¸€ä¸ª <code>apt update</code>ï¼Œä½†æ˜¯é»˜è®¤çš„æºå¤ªæ…¢äº†ï¼Œæ²¡æ³•å¿ã€‚é‚£æˆ‘ä»¬å°±æ¢å›½å†…æºå§ã€‚</p>
<p>å›½å†…æœ‰å¥½å¤šæºï¼Œ<a href="http://mirrors.aliyun.com/" target="_blank" rel="noopener">é˜¿é‡Œäº‘</a>ï¼Œ<a href="http://mirrors.163.com/" target="_blank" rel="noopener">163</a>ï¼Œ<a href="http://mirrors.sohu.com/" target="_blank" rel="noopener">æœç‹</a>ï¼Œ<a href="http://mirrors.ustc.edu.cn/" target="_blank" rel="noopener">ä¸­ç§‘å¤§</a>ç­‰ç­‰ã€‚æˆ‘ä»¬å°±ä»¥é˜¿é‡Œäº‘åšä¸ªä¾‹å­å§ï¼š</p>
<p>æµè§ˆå™¨æ‰“å¼€ <a href="http://mirrors.aliyun.com/" target="_blank" rel="noopener">http://mirrors.aliyun.com/</a></p>
<p><img src="/assets/images/20170917191649.png" alt="example-pic"></p>
<p>æ‰¾åˆ°ubuntuçš„help </p>
<p><img src="/assets/images/20170917192021.png" alt="pic"></p>
<p>å‘ç°é‡Œé¢æœ€æ–°çš„æ˜¯ Quantal(12.10) çœ‹æ¥ä¸èƒ½ç›´æ¥å¤åˆ¶</p>
<p>åœ¨ä½ çš„å­ç³»ç»Ÿbashä¸­æ‰§è¡Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat /etc/apt/sources.list</span><br><span class="line">-------------------------</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ xenial main restricted universe multiverse</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu/ xenial-updates main restricted universe multiverse</span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ xenial-security main restricted universe multiverse</span><br><span class="line">-------------------------</span><br></pre></td></tr></table></figure>
<p>ç´¢æ€§æœ€æ–°ç‰ˆubuntu16.04ä»£å·å«xenial</p>
<p>é‚£ç›´æ¥æŠŠurlæ¢æ¢å°±è¡Œäº†</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bk     <span class="comment"># æ”¹é…ç½®æ–‡ä»¶ï¼Œå…ˆå¤‡ä»½æ˜¯ä¸ªå¥½ä¹ æƒ¯</span></span><br><span class="line">sudo vim /etc/apt/sources.list   <span class="comment"># æŠŠå†…å®¹æ¢æˆä¸‹é¢çš„å°±è¡Œäº†ï¼Œå…¶å®å°±æ˜¯urlå˜äº†</span></span><br><span class="line">-------------------------</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse</span><br><span class="line">-------------------------</span><br></pre></td></tr></table></figure>
<p>æå®šäº†ï¼Œæµ‹è¯•ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>
<p>æ²¡é—®é¢˜å°±å¯ä»¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Win10</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>MSYS2åˆä½“éªŒ</title>
    <url>/2017/09/22/MSYS2%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
    <content><![CDATA[<p>ä½œä¸ºä¸€åwindowsä¸‹é¢å¼€å‘è€…ï¼Œä¹‹å‰å·¥ä½œCygwinåšä¸ºè¾…åŠ©ã€‚å‰äº›å¤©çªç„¶å‘ç°äº†ä¸€ä¸ªå«MSYS2çš„å®¶ä¼™ã€‚</p>
<p>å‘ç°è¿™å®¶ä¼™è¿˜ä¸é”™ï¼Œè¿™æ˜¯<a href="https://baike.baidu.com/item/MSYS2" target="_blank" rel="noopener">ç™¾åº¦ç™¾ç§‘</a>çš„ä»‹ç»ï¼š</p>
<blockquote>
<p>MSYS2 ï¼ˆMinimal SYStem 2ï¼‰ æ˜¯ä¸€ä¸ªMSYSçš„ç‹¬ç«‹æ”¹å†™ç‰ˆæœ¬ï¼Œä¸»è¦ç”¨äº shell å‘½ä»¤è¡Œå¼€å‘ç¯å¢ƒã€‚åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªåœ¨Cygwin ï¼ˆPOSIX å…¼å®¹æ€§å±‚ï¼‰ å’Œ MinGW-w64ï¼ˆä»â€MinGW-ç”Ÿæˆâ€ï¼‰åŸºç¡€ä¸Šäº§ç”Ÿçš„ï¼Œè¿½æ±‚æ›´å¥½çš„äº’æ“ä½œæ€§çš„ Windows è½¯ä»¶ã€‚<br>MSYS2 æ˜¯MSYSçš„ä¸€ä¸ªå‡çº§ç‰ˆ,å‡†ç¡®çš„è¯´æ˜¯é›†æˆäº†pacman(æˆ‘å–œæ¬¢å«åƒè±†äºº)å’ŒMingw-w64çš„Cygwinå‡çº§ç‰ˆ, æä¾›äº†bash shellç­‰linuxç¯å¢ƒã€ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ï¼ˆgit/hgï¼‰å’ŒMinGW-w64 å·¥å…·é“¾ã€‚ä¸MSYSæœ€å¤§çš„åŒºåˆ«æ˜¯ç§»æ¤äº† Arch Linuxçš„è½¯ä»¶åŒ…ç®¡ç†ç³»ç»Ÿ Pacman(å…¶å®æ˜¯ä¸Cygwinçš„åŒºåˆ«)ã€‚</p>
</blockquote>
<p>çœ‹èµ·æ¥è¿˜ä¸é”™ï¼Œè¿™æ˜¯<a href="http://www.msys2.org/" target="_blank" rel="noopener">å®˜ç½‘</a></p>
<p>å®‰è£…å°±ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…ç¨‹åºå®‰è£…å°±å¯ä»¥äº†ã€‚</p>
<p>å®‰è£…ä¹‹åæ€¥åˆ‡åœ° <code>pacman -Sy</code> åˆ·æ–°è½¯ä»¶åŒ…æ•°æ®ï¼Œå®˜ç½‘çš„æºè¿˜æœ‰ç‚¹æ…¢ã€‚æ¢<a href="http://mirrors.ustc.edu.cn/" target="_blank" rel="noopener">ä¸­ç§‘å¤§</a>çš„æºå§ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/pacman.d</span><br><span class="line">ls</span><br><span class="line">-------------------</span><br><span class="line">gnupg mirrorlist.mingw32  mirrorlist.mingw64  mirrorlist.msys</span><br></pre></td></tr></table></figure>

<p>ä¸‰ä¸ª<code>mirrorlist</code>å¼€å¤´çš„æ–‡ä»¶å°±æ˜¯æºçš„é…ç½®æ–‡ä»¶</p>
<p>ç¼–è¾‘ /etc/pacman.d/mirrorlist.mingw32 ï¼Œåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Server &#x3D; http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;msys2&#x2F;mingw&#x2F;i686</span><br></pre></td></tr></table></figure>

<p>ç¼–è¾‘ /etc/pacman.d/mirrorlist.mingw64 ï¼Œåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Server &#x3D; http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;msys2&#x2F;mingw&#x2F;x86_64</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘ /etc/pacman.d/mirrorlist.msys ï¼Œåœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Server &#x3D; http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;msys2&#x2F;msys&#x2F;$arch</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œ <code>pacman -Sy</code> åˆ·æ–°è½¯ä»¶åŒ…æ•°æ®å³å¯ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œcygwinåˆ‡æ¢ç³»ç»Ÿç£ç›˜æ˜¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /cygdrive/d/   <span class="comment">#æ¯”å¦‚åˆ‡æ¢åˆ°dç›˜</span></span><br></pre></td></tr></table></figure>

<p>MYSYS2æ˜¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /d</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨windowsåŸç”Ÿå‘½ä»¤æ¯”å¦‚pingä¼šä¸­æ–‡ä¹±ç ï¼Œè¿™ä¹ˆè§£å†³ï¼š</p>
<p>æ–°å»º /bin/winï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="variable">$@</span> |iconv -f gbk -t utf-8</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/bin/win ping baidu.com</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Win10</tag>
        <tag>MSYS2</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­å»ºGitæœåŠ¡å™¨ã€ç¼–å†™è‡ªåŠ¨éƒ¨ç½²è„šæœ¬</title>
    <url>/2017/09/29/%E6%90%AD%E5%BB%BAGit%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%81%E7%BC%96%E5%86%99%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<p>ä»Šå¤©è¯•äº†ä¸‹åœ¨linuxæœåŠ¡å™¨ä¸Šæ­å»ºGitæœåŠ¡å™¨ï¼Œå¹¶ä¸”ç¼–å†™ä¸€ä¸ªç®€å•çš„è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ã€‚</p>
<p>ä¸»è¦å‚è€ƒ <a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137583770360579bc4b458f044ce7afed3df579123eca000" target="_blank" rel="noopener">å»–é›ªå³°-GITæ•™ç¨‹-æ­å»ºGitæœåŠ¡å™¨</a></p>
<p>ç°åœ¨å¼€å§‹å§ï¼</p>
<h3 id="åˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡"><a href="#åˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡"></a>åˆ›å»ºä¸€ä¸ª<code>git</code>ç”¨æˆ·ï¼Œç”¨æ¥è¿è¡Œ<code>git</code>æœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adduser git</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºè¯ä¹¦ç™»å½•"><a href="#åˆ›å»ºè¯ä¹¦ç™»å½•" class="headerlink" title="åˆ›å»ºè¯ä¹¦ç™»å½•"></a>åˆ›å»ºè¯ä¹¦ç™»å½•</h3><p>æ”¶é›†æ‰€æœ‰éœ€è¦ç™»å½•çš„ç”¨æˆ·çš„å…¬é’¥ï¼Œå°±æ˜¯ä»–ä»¬è‡ªå·±çš„<code>id_rsa.pub</code>æ–‡ä»¶ï¼ŒæŠŠæ‰€æœ‰å…¬é’¥å¯¼å…¥åˆ°<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶é‡Œï¼Œä¸€è¡Œä¸€ä¸ªã€‚</p>
<h3 id="åˆå§‹åŒ–Gitä»“åº“"><a href="#åˆå§‹åŒ–Gitä»“åº“" class="headerlink" title="åˆå§‹åŒ–Gitä»“åº“"></a>åˆå§‹åŒ–Gitä»“åº“</h3><p>å…ˆé€‰å®šä¸€ä¸ªç›®å½•ä½œä¸ºGitä»“åº“ï¼Œå‡å®šæ˜¯<code>/home/git/sample.git</code>ï¼Œåœ¨<code>/home/git</code>ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git init --bare sample.git</span><br></pre></td></tr></table></figure>
<p>Gitå°±ä¼šåˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œè£¸ä»“åº“æ²¡æœ‰å·¥ä½œåŒºï¼Œå› ä¸ºæœåŠ¡å™¨ä¸Šçš„Gitä»“åº“çº¯ç²¹æ˜¯ä¸ºäº†å…±äº«ï¼Œæ‰€ä»¥ä¸è®©ç”¨æˆ·ç›´æ¥ç™»å½•åˆ°æœåŠ¡å™¨ä¸Šå»æ”¹å·¥ä½œåŒºï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šçš„Gitä»“åº“é€šå¸¸éƒ½ä»¥<code>.git</code>ç»“å°¾ã€‚ç„¶åï¼ŒæŠŠowneræ”¹ä¸º<code>git</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chown -R git:git sample.git</span><br></pre></td></tr></table></figure>

<h3 id="ç¦ç”¨gitç”¨æˆ·shellç™»å½•"><a href="#ç¦ç”¨gitç”¨æˆ·shellç™»å½•" class="headerlink" title="ç¦ç”¨gitç”¨æˆ·shellç™»å½•"></a>ç¦ç”¨gitç”¨æˆ·shellç™»å½•</h3><p>é€šè¿‡ç¼–è¾‘<code>/etc/passwd</code>æ–‡ä»¶å®Œæˆï¼Œæ‰¾åˆ°ä½ çš„gitç”¨æˆ·çš„ä¸€è¡Œ,ä¾‹å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git:x:1001:1001:,,,:&#x2F;home&#x2F;git:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<p>æŠŠ<code>/bin/bash</code>æ”¹ä¸º<code>/usr/bin/git-shell</code>,ä¾‹å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git:x:1001:1001:,,,:&#x2F;home&#x2F;git:&#x2F;usr&#x2F;bin&#x2F;git-shell</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œgitç”¨æˆ·å¯ä»¥æ­£å¸¸é€šè¿‡sshä½¿ç”¨gitï¼Œä½†æ— æ³•ç™»å½•shellï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºgitç”¨æˆ·æŒ‡å®šçš„git-shellæ¯æ¬¡ä¸€ç™»å½•å°±è‡ªåŠ¨é€€å‡ºã€‚</p>
<h3 id="å…‹éš†è¿œç¨‹ä»“åº“"><a href="#å…‹éš†è¿œç¨‹ä»“åº“" class="headerlink" title="å…‹éš†è¿œç¨‹ä»“åº“"></a>å…‹éš†è¿œç¨‹ä»“åº“</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@server:sample.git</span><br></pre></td></tr></table></figure>
<p>serveræ˜¯ä½ çš„æœåŠ¡å™¨åŸŸåæˆ–ipåœ°å€</p>
<p>å¦‚æœgitä»“åº“å’Œwebç›®å½•åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸»æœºä¸Š:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> /home/git/sample.git</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸æ˜¯åœ¨gitç”¨æˆ·çš„å®¶ç›®å½•ä¸­åˆ›å»ºçš„,æ¯”å¦‚<code>/srv/gits/sample.git</code>ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@server:/srv/gits/sample.git</span><br></pre></td></tr></table></figure>

<p>å¦‚æœcloneæˆåŠŸï¼Œé‚£ä¹ˆä½ çš„gitæœåŠ¡å™¨å°±æ­å»ºæˆåŠŸäº†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼š</p>
<h3 id="è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬"><a href="#è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬" class="headerlink" title="è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬"></a>è‡ªåŠ¨åŒæ­¥é’©å­è„šæœ¬</h3><p>å› ä¸ºæˆ‘æ˜¯webç›®å½•å’Œgitæ˜¯åŒä¸€å°æœåŠ¡å™¨</p>
<p>ç¼–è¾‘ <code>/home/git/sample.git/hooks/post-receive</code>, <code>post-receive</code>å°±æ˜¯åœ¨gitæœåŠ¡å™¨æ”¶åˆ°ä»£ç æ¨é€å(<code>push</code>å®Œæˆä¹‹å)æ‰§è¡Œçš„è„šæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line"></span><br><span class="line">while read oldrev newrev refname</span><br><span class="line">do</span><br><span class="line">    branch&#x3D;$(git rev-parse --symbolic --abbrev-ref $refname)</span><br><span class="line">    if [ &quot;master&quot; &#x3D;&#x3D; &quot;$branch&quot; ]; then</span><br><span class="line">        # Do something</span><br><span class="line">        echo &quot;post-receive in branch master&quot; &gt;&gt; &#x2F;tmp&#x2F;git-sample.log</span><br><span class="line">        unset GIT_DIR</span><br><span class="line">        wwwPath&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;sample</span><br><span class="line">        cd $wwwPath &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;git pull origin master</span><br><span class="line">        exit 0</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>ä»è„šæœ¬å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨åˆ¤æ–­å½“å‰<code>push</code>çš„åˆ†æ”¯æ˜¯<code>master</code>æ—¶æ‰§è¡Œ<code>git pull origin master</code>æ“ä½œã€‚</p>
<p>ç»™æ‰§è¡Œæƒé™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chown -R git:git /home/git/sample.git/hooks/post-receive</span><br><span class="line">chmod +x /home/git/sample.git/hooks/post-receive</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ˜¯gitä»“åº“å’Œwebç›®å½•åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸»æœºä¸Š,è¿™é‡Œcloneä½¿ç”¨çš„æ˜¯:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> /home/git/sample.git</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºåŒæ­¥è„šæœ¬çš„æ‰§è¡Œç”¨æˆ·æ˜¯gitï¼Œæ‰€ä»¥è¦ä¿è¯é¡¹ç›®ç›®å½•è¦èµ‹äºˆgitå†™æƒé™ã€‚å®¹æ˜“å‡ºé—®é¢˜çš„ä¹Ÿæ˜¯æƒé™é—®é¢˜ã€‚</p>
<p>å¥½äº†ï¼Œè¯•è¯•å§~</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>DockeråŸºç¡€å‘½ä»¤</title>
    <url>/2017/10/26/Docker%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>æœ€è¿‘å¿™é‡Œå·é—²ç ”ç©¶äº†ä¸‹dockerè¿™ä¸ªå¾ˆç«çš„ä¸œä¸œã€‚åšç‚¹ç¬”è®°ğŸ˜</p>
<h3 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h3><p>åˆ—å‡ºé•œåƒåˆ—è¡¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>è·å–ä¸€ä¸ªæ–°çš„é•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker pull base/archlinux</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤é•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker rmi imageID</span><br></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾é•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker search php</span><br></pre></td></tr></table></figure>
<p>æ„å»º</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/Dockerfile</span><br><span class="line">docker build -t imageName ./</span><br></pre></td></tr></table></figure>

<h3 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run  base&#x2F;archlinux &#x2F;bin&#x2F;echo &quot;hello world&quot;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œäº¤äº’å¼çš„å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -i -t base/archlinux /bin/bash</span><br></pre></td></tr></table></figure>
<pre><code>* -t:åœ¨æ–°å®¹å™¨å†…æŒ‡å®šä¸€ä¸ªä¼ªç»ˆç«¯æˆ–ç»ˆç«¯ã€‚
* -i:å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥ (STDIN) è¿›è¡Œäº¤äº’ã€‚</code></pre><p>åˆ†é…ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -P php7.0-app    <span class="comment">#è‡ªåŠ¨åˆ†é…</span></span><br><span class="line">docker run -p 5000:80       <span class="comment">#å®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 5000 ç«¯å£ä¸Š</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker container ls <span class="comment">#æˆ–è€…</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker port containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ—¥å¿—</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker logs </span><br><span class="line">docker -f containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¿›ç¨‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker top containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹Dockerçš„åº•å±‚ä¿¡æ¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker inspect containerID/contaienrName</span><br></pre></td></tr></table></figure>

<p>åœæ­¢å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker stop containerID/contaienrName</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker start containerID/contaienrName</span><br></pre></td></tr></table></figure>
<p>æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker restart</code> å‘½ä»¤æ¥é‡å¯</p>
<p>æŸ¥çœ‹æœ€åä¸€æ¬¡åˆ›å»ºçš„å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker ps -l</span><br></pre></td></tr></table></figure>
<p>ç§»é™¤å®¹å™¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker rm containerID/contaienrName</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>è™šæ‹ŸåŒ–</tag>
        <tag>å®¹å™¨</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ç™¾åº¦UEditorè‡ªå®šä¹‰ä¸Šä¼ åœ°å€</title>
    <url>/2017/10/26/%E7%99%BE%E5%BA%A6ueditor%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%BC%A0%E5%9C%B0%E5%9D%80/</url>
    <content><![CDATA[<p>ä¹‹å‰æœ‰ä¸ªå°æœ‹å‹é—®æˆ‘ç™¾åº¦UEditoræ€ä¹ˆè‡ªå®šä¹‰æœåŠ¡ç«¯ä¸Šä¼ åœ°å€, æ­£å¥½ä¹Ÿç”¨è¿‡ï¼Œç°åœ¨åšä¸‹ç¬”è®°å§ã€‚</p>
<p>åœ¨ueå®ä¾‹åŒ–çš„æ—¶å€™ä½ æœåŠ¡ç«¯ä¸Šä¼ çš„è¯·æ±‚åœ°å€èµ‹å€¼ç»™<code>serverUrl</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ue;</span><br><span class="line">ue = UE.getEditor(<span class="string">'editor'</span>, &#123;</span><br><span class="line">    toolbars: [		<span class="comment">//è¿™ä¸ªæ˜¯å·¥å…·æ é…ç½®ï¼Œè‡ªå·±å®šä¹‰å’Œä»Šå¤©ä¸»é¢˜æ— å…³</span></span><br><span class="line">        [</span><br><span class="line">            <span class="string">'fullscreen'</span>, <span class="string">'source'</span>, <span class="string">'|'</span>, <span class="string">'undo'</span>, <span class="string">'redo'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'bold'</span>, <span class="string">'italic'</span>, <span class="string">'underline'</span>, <span class="string">'fontborder'</span>, <span class="string">'strikethrough'</span>, <span class="string">'superscript'</span>, <span class="string">'subscript'</span>, <span class="string">'removeformat'</span>, <span class="string">'formatmatch'</span>, <span class="string">'autotypeset'</span>, <span class="string">'blockquote'</span>, <span class="string">'pasteplain'</span>, <span class="string">'|'</span>, <span class="string">'forecolor'</span>, <span class="string">'backcolor'</span>, <span class="string">'insertorderedlist'</span>, <span class="string">'insertunorderedlist'</span>, <span class="string">'selectall'</span>, <span class="string">'cleardoc'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'rowspacingtop'</span>, <span class="string">'rowspacingbottom'</span>, <span class="string">'lineheight'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'customstyle'</span>, <span class="string">'paragraph'</span>, <span class="string">'fontfamily'</span>, <span class="string">'fontsize'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'directionalityltr'</span>, <span class="string">'directionalityrtl'</span>, <span class="string">'indent'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'justifyleft'</span>, <span class="string">'justifycenter'</span>, <span class="string">'justifyright'</span>, <span class="string">'justifyjustify'</span>, <span class="string">'|'</span>, <span class="string">'touppercase'</span>, <span class="string">'tolowercase'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'link'</span>, <span class="string">'unlink'</span>, <span class="string">'anchor'</span>, <span class="string">'|'</span>, <span class="string">'imagenone'</span>, <span class="string">'imageleft'</span>, <span class="string">'imageright'</span>, <span class="string">'imagecenter'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'simpleupload'</span>, <span class="string">'|'</span>, <span class="string">'pagebreak'</span>, <span class="string">'template'</span>, <span class="string">'background'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'horizontal'</span>, <span class="string">'date'</span>, <span class="string">'time'</span>, <span class="string">'spechars'</span>, <span class="string">'snapscreen'</span>, <span class="string">'wordimage'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'inserttable'</span>, <span class="string">'deletetable'</span>, <span class="string">'insertparagraphbeforetable'</span>, <span class="string">'insertrow'</span>, <span class="string">'deleterow'</span>, <span class="string">'insertcol'</span>, <span class="string">'deletecol'</span>, <span class="string">'mergecells'</span>, <span class="string">'mergeright'</span>, <span class="string">'mergedown'</span>, <span class="string">'splittocells'</span>, <span class="string">'splittorows'</span>, <span class="string">'splittocols'</span>, <span class="string">'charts'</span>, <span class="string">'|'</span>,</span><br><span class="line">            <span class="string">'preview'</span></span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    serverUrl: <span class="string">'http://your-server-address'</span>  <span class="comment">//è¿™é‡Œæ˜¯ä½ æœåŠ¡ç«¯ä¸Šä¼ çš„è¯·æ±‚åœ°å€</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢è‡ªå®šä¹‰äº†æœåŠ¡ç«¯åœ°å€ä¹‹åï¼Œæˆ‘ä»¬åˆ·æ–°é¡µé¢ï¼Œueå®ä¾‹åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è¯·æ±‚ä½ çš„åœ°å€å¹¶ä¸”å¸¦ç€queryå‚æ•°ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š<code>http://your-server-address?action=config</code>ã€‚è¿™æ˜¯ueå®ä¾‹åŒ–ä¼šè¯·æ±‚é…ç½®æ–‡ä»¶ï¼Œç®€å•ç‚¹ä½ å¯ä»¥ç›´æ¥è¿”å›ueæ’ä»¶æ–‡ä»¶å¤¹ä¸­<code>ueditor/1.4.3.3/php/config.json</code>çš„å†…å®¹å°±å¯ä»¥äº†ã€‚å½“ç„¶äº†å…·ä½“é…ç½®ä½ æ˜¯å¯ä»¥è‡ªå·±æŒ‰è‡ªå·±éœ€æ±‚æ”¹åŠ¨ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸Šä¼ å›¾ç‰‡ï¼Œéšä¾¿ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œä¼šå‘ç°ueçš„è¯·æ±‚åœ°å€æ˜¯<code>http://your-server-address?action=uploadimage</code>ã€‚è¿™æ ·æ˜¯ä¸æ˜¯æç„¶å¤§æ‚Ÿï¼š</p>
<blockquote>
<p>   actionå‚æ•°æ˜¯configï¼Œä½ å°±ç»™ä»–è¿”å›é…ç½®å†…å®¹;<br>   actionå‚æ•°æ˜¯uploadimageå°±æ˜¯å›¾ç‰‡ä¸Šä¼ ï¼Œä½ å°±ä¿å­˜å›¾ç‰‡æ–‡ä»¶ï¼Œè¿”å›æˆåŠŸæˆ–è€…å¤±è´¥çš„ç»“æœã€‚</p>
</blockquote>
<p>ä¸Šä¼ ç»“æœè¿”å›æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<p>å¤±è´¥çš„æƒ…å†µ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"state"</span>: <span class="string">"Failed"</span>,</span><br><span class="line">	<span class="attr">"msg"</span>: <span class="string">"error msg"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸçš„æƒ…å†µ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"state"</span>: <span class="string">"SUCCESS"</span>,</span><br><span class="line">	<span class="attr">"msg"</span>: <span class="string">"ok"</span>,</span><br><span class="line">	<span class="attr">"original"</span>: <span class="string">"aaa.jpg"</span>,	<span class="comment">//å›¾ç‰‡æºæ–‡ä»¶å</span></span><br><span class="line">	<span class="attr">"type"</span>: <span class="string">".jpg"</span>,		<span class="comment">//å›¾ç‰‡åç¼€</span></span><br><span class="line">	<span class="attr">"size"</span>: <span class="number">10240000</span>,	<span class="comment">//å›¾ç‰‡å¤§å°</span></span><br><span class="line">	<span class="attr">"title"</span>: <span class="string">"aaa"</span>,		<span class="comment">//å›¾ç‰‡imgæ ‡ç­¾ä¸Šçš„å±æ€§title</span></span><br><span class="line">	<span class="attr">"url"</span>: <span class="string">"/upload/fsf3r.jpg"</span>			<span class="comment">//å›¾ç‰‡ä¸Šä¼ ä¹‹åçš„url</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¥½äº†å°±è¿™æ ·</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>UEditor</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨dockerç©è½¬phpå¼€å‘ç¯å¢ƒ</title>
    <url>/2017/11/16/%E4%BD%BF%E7%94%A8docker%E7%8E%A9%E8%BD%ACphp%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
    <content><![CDATA[<p>è¿˜æ˜¯å¿™é‡Œå·é—²ç ”ç©¶äº†ä¸‹æ€ä¹ˆç”¨dockerè¿™ä¸ªä¸œä¸œæ¥æ•´phpå¼€å‘ã€‚åšç‚¹ç¬”è®°ğŸ˜</p>
<p>å…ˆçœ‹<code>Dockerfile</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä½¿ç”¨åŸºäºalpine linux çš„é•œåƒï¼Œä½“ç§¯å°ï¼Œä¸‹è½½å¿«</span><br><span class="line">FROM php:7.0-cli-alpine</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ä¸­ç§‘å¤§çš„æºåŠ å¿«ä¸‹è½½é€Ÿåº¦</span><br><span class="line">RUN sed -i &#39;s&#x2F;dl-cdn.alpinelinux.org&#x2F;mirrors.ustc.edu.cn&#x2F;g&#39; &#x2F;etc&#x2F;apk&#x2F;repositories</span><br><span class="line"></span><br><span class="line"># å®‰è£…ä¸‹åŸºæœ¬çš„phpæ‰©å±•</span><br><span class="line">RUN docker-php-ext-install pdo pdo_mysql mysqli</span><br></pre></td></tr></table></figure>

<h4 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker build -t heropoo/php-cli-alpine .  <span class="comment">#å…ˆåˆ‡æ¢åˆ°ä½ çš„Dockerfileç›®å½•</span></span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -it --rm --name php-cli-server -p 8080:80  -v //c/Users/ttt/www:/usr/src/www -w /usr/src/www php:7.0-cli-alpine php -S 0.0.0.0:80</span><br></pre></td></tr></table></figure>
<p>è¿™å¥å¥½é•¿å•Šï¼Œè§£é‡Šä¸‹å„ä¸ªå‚æ•°ï¼š</p>
<blockquote>
<p>-tåœ¨æ–°å®¹å™¨å†…æŒ‡å®šä¸€ä¸ªä¼ªç»ˆç«¯æˆ–ç»ˆç«¯</p>
<p>-i    å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥ (STDIN) </p>
<p>-p æ˜ å°„å®¿ä¸»æœºç«¯å£åˆ°å®¹å™¨çš„ç«¯å£ï¼Œä¸Šé¢å°±æ˜¯å®¿ä¸»æœºçš„8080åˆ°å®¹å™¨çš„80</p>
<p>-v æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨çš„ç›®å½•ï¼Œä¸Šé¢å°±æ˜¯å®¿ä¸»æœº/c/Users/ttt/wwwåˆ°å®¹å™¨/usr/src/www    </p>
<p>-w    è®¾ç½®å·¥ä½œç›®å½•</p>
<p>â€“rm å®¹å™¨è¿è¡Œå®Œä¹‹ååˆ é™¤</p>
<p>â€“name    ç»™å®¹å™¨åå­—</p>
<p>php -S 0.0.0.0:80 å°±æ˜¯ç”¨phpå†…ç½®çš„æœåŠ¡å™¨å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡äº†ï¼Œç®€å•ç‚¹æ¥ å“ˆå“ˆ </p>
</blockquote>
<p>æˆ‘ç³»ç»Ÿæ˜¯windowsï¼Œæˆ‘åœ¨æµè§ˆå™¨è®¿é—®dockerçš„webæœåŠ¡ï¼š<code>http://ip:8080</code>,ipæ˜¯ä½ çš„dockerçš„ip,å°±å¯ä»¥äº†ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆå¥½ç©ğŸ˜œ</p>
]]></content>
      <categories>
        <category>Docker</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>è™šæ‹ŸåŒ–</tag>
        <tag>å®¹å™¨</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>2018,æ–°å¹´å¿«ä¹ï¼</title>
    <url>/2018/01/01/2018-happy-new-year/</url>
    <content><![CDATA[<p><img src="/assets/images/20180101000832.png" alt="example-pic"></p>
<p>2018å¹´äº†ï¼Œæ–°å¹´å¿«ä¹ï¼</p>
<p>åŠ æ²¹ï¼</p>
]]></content>
      <categories>
        <category>å²æœˆé™å¥½</category>
      </categories>
      <tags>
        <tag>å²æœˆé™å¥½</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•´ç†å‡ ä¸ªå¸¸ç”¨çš„å›½å†…æºï¼ˆæŒç»­æ›´æ–°ï¼‰</title>
    <url>/2018/01/20/cn-mirrors/</url>
    <content><![CDATA[<p>æœ€åæ›´æ–°ï¼š2019-11-17</p>
<h3 id="Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶"><a href="#Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶" class="headerlink" title="Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶"></a>Linuxä»¥åŠä¸€äº›å¼€æºè½¯ä»¶</h3><p>ä¸€äº›ä¼ä¸šçš„ï¼š</p>
<ul>
<li>ç½‘æ˜“å¼€æºé•œåƒç«™ <a href="http://mirrors.163.com/" target="_blank" rel="noopener">http://mirrors.163.com/</a></li>
<li>æœç‹å¼€æºé•œåƒç«™ <a href="http://mirrors.sohu.com/" target="_blank" rel="noopener">http://mirrors.sohu.com/</a></li>
<li>é˜¿é‡Œäº‘æºé•œåƒç«™ <a href="http://mirrors.aliyun.com/" target="_blank" rel="noopener">http://mirrors.aliyun.com/</a></li>
<li>é¦–éƒ½åœ¨çº¿ <a href="http://mirrors.yun-idc.com/" target="_blank" rel="noopener">http://mirrors.yun-idc.com/</a></li>
</ul>
<p>å„å¤§é«˜æ ¡çš„ï¼š</p>
<ul>
<li>ä¸­ç§‘å¤§å¼€æºé•œåƒç«™ <a href="http://mirrors.ustc.edu.cn/" target="_blank" rel="noopener">http://mirrors.ustc.edu.cn/</a></li>
<li>æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ <a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/</a></li>
<li>åä¸­ç§‘æŠ€å¤§å­¦å¼€æºé•œåƒç«™ <a href="http://mirror.hust.edu.cn/" target="_blank" rel="noopener">http://mirror.hust.edu.cn/</a></li>
<li>æµ™æ±Ÿå¤§å­¦å¼€æºé•œåƒç«™ <a href="http://mirrors.zju.edu.cn/" target="_blank" rel="noopener">http://mirrors.zju.edu.cn/</a></li>
<li>ä¸œè½¯ä¿¡æ¯å­¦é™¢å¼€æºé•œåƒç«™ <a href="http://mirrors.neusoft.edu.cn/" target="_blank" rel="noopener">http://mirrors.neusoft.edu.cn/</a></li>
<li>åŒ—äº¬ç†å·¥å¤§å­¦å¼€æºè½¯ä»¶é•œåƒ <a href="http://mirror.bit.edu.cn/" target="_blank" rel="noopener">http://mirror.bit.edu.cn/</a></li>
<li>åŒ—äº¬äº¤é€šå¤§å­¦è‡ªç”±ä¸å¼€æºè½¯ä»¶é•œåƒç«™ <a href="https://mirror.bjtu.edu.cn/" target="_blank" rel="noopener">https://mirror.bjtu.edu.cn/</a></li>
<li>å…°å·å¤§å­¦å¼€æºç¤¾åŒºé•œåƒç«™ <a href="http://mirror.lzu.edu.cn/" target="_blank" rel="noopener">http://mirror.lzu.edu.cn/</a></li>
<li>ä¸Šæµ·äº¤é€šå¤§å­¦ <a href="http://ftp.sjtu.edu.cn/" target="_blank" rel="noopener">http://ftp.sjtu.edu.cn/</a></li>
<li>ä¸œåŒ—å¤§å­¦ <a href="http://mirror.neu.edu.cn/" target="_blank" rel="noopener">http://mirror.neu.edu.cn/</a></li>
</ul>
<h3 id="js-npm"><a href="#js-npm" class="headerlink" title="js npm"></a>js npm</h3><ul>
<li>æ·˜å®NPMé•œåƒ <a href="http://npm.taobao.org/" target="_blank" rel="noopener">http://npm.taobao.org/</a></li>
</ul>
<h3 id="php-composer"><a href="#php-composer" class="headerlink" title="php composer"></a>php composer</h3><ul>
<li>é˜¿é‡Œäº‘ï¼š<a href="https://developer.aliyun.com/composer" target="_blank" rel="noopener">https://developer.aliyun.com/composer</a></li>
<li>LaravelChinaç¤¾åŒºæä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://packagist.laravel-china.org" target="_blank" rel="noopener">https://packagist.laravel-china.org</a></li>
<li>å®‰ç•…ç½‘ç»œï¼š<a href="https://php.cnpkg.org/" target="_blank" rel="noopener">https://php.cnpkg.org/</a></li>
<li>Composerä¸­æ–‡ç½‘ï¼š <a href="https://pkg.phpcomposer.com/" target="_blank" rel="noopener">https://pkg.phpcomposer.com/</a></li>
</ul>
<h3 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h3><ul>
<li>ä¸­ç§‘å¤§ <a href="http://mirrors.ustc.edu.cn/help/rust-static.html" target="_blank" rel="noopener">Rust Toolchainåå‘ä»£ç†</a></li>
<li>ä¸­ç§‘å¤§ <a href="http://mirrors.ustc.edu.cn/help/crates.io-index.html" target="_blank" rel="noopener">Rust Crates æº</a></li>
</ul>
<h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><ul>
<li>é˜¿é‡Œäº‘Go Moduleä»£ç†ä»“åº“æœåŠ¡ <a href="https://mirrors.aliyun.com/goproxy/" target="_blank" rel="noopener">https://mirrors.aliyun.com/goproxy/</a></li>
</ul>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul>
<li>DaoCloud <a href="https://www.daocloud.io/mirror" target="_blank" rel="noopener">https://www.daocloud.io/mirror</a></li>
<li>é˜¿é‡Œäº‘ è¦æ³¨å†Œç‹¬ç«‹åˆ†é… <a href="https://yq.aliyun.com/articles/29941" target="_blank" rel="noopener">https://yq.aliyun.com/articles/29941</a></li>
</ul>
<p>å¤§æ¦‚å°±æ•´ç†è¿™ä¹ˆå¤šäº†ï¼Œè‡³äºå„ä¸ªé•œåƒçš„æ›´æ¢æ–¹æ³•å¤§å®¶æ ¹æ®è‡ªå·±çš„åº”ç”¨è‡ªè¡Œç™¾åº¦å§~</p>
]]></content>
      <categories>
        <category>èµ„æº</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>JavaScript</tag>
        <tag>Linux</tag>
        <tag>Docker</tag>
        <tag>Rust</tag>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚æœç¼–ç¨‹è¯­è¨€æ˜¯ä¸€ç§æ­¦å™¨(è½¬è‡ªäº’è”ç½‘)</title>
    <url>/2018/01/23/If-the-programming-language-is-a-weapon/</url>
    <content><![CDATA[<p>å¯¹ç¨‹åºå‘˜æ¥è¯´ï¼Œç¼–ç¨‹è¯­è¨€å°±æ˜¯æ­¦å™¨ï¼Œä½†æœ‰çš„æ­¦å™¨å¥½ç”¨ï¼Œæœ‰çš„æ­¦å™¨ä¸å¥½ç”¨ï¼Œæœ‰çš„æ­¦å™¨ç”šè‡³ä¼šæ€äº†è‡ªå·±</p>
<p><img src="/assets/images/uuaMZv.png" alt="pic"></p>
<p>Cè¯­è¨€æ˜¯M1å¼åŠ å…°å¾·æ­¥æªï¼Œå¾ˆè€ä½†å¯é ã€‚</p>
<p><img src="/assets/images/mE3eaiv.png" alt="pic"></p>
<p>C++æ˜¯åŒæˆªæ£ï¼ŒæŒ¥èˆèµ·æ¥å¾ˆå¼ºæ‚ï¼Œå¾ˆå¸å¼•äººï¼Œä½†éœ€è¦ä½ å¤šå¹´çš„ç£¨ç»ƒæ¥æŒæ¡ï¼Œå¾ˆå¤šäººå¸Œæœ›æ”¹ç”¨åˆ«çš„æ­¦å™¨ã€‚</p>
<p><img src="/assets/images/yuMVfu.png" alt="pic"></p>
<p>Perlè¯­è¨€æ˜¯ç‡ƒçƒ§å¼¹ï¼Œæ›¾ç»åœ¨æˆ˜åœºä¸Šå¾ˆæœ‰ç”¨ï¼Œä½†ç°åœ¨å¾ˆå°‘äººä½¿ç”¨å®ƒã€‚</p>
<p><img src="/assets/images/UvUNJz.png" alt="pic"></p>
<p>Javaæ˜¯M240é€šç”¨å¼¹å¤¹å¼è‡ªåŠ¨æœºæªï¼Œæœ‰æ—¶å®ƒçš„å¼¹å¤¹æ˜¯åœ†çš„ï¼Œä½†æœ‰æ—¶å€™ä¸æ˜¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œå½“ä½ å¼€ç«æ—¶ï¼Œä¼šé‡åˆ°NullPointerExceptioné—®é¢˜ï¼Œæªå°±ä¼šçˆ†ç‚¸ï¼Œä½ è¢«ç‚¸æ­»ã€‚</p>
<p><img src="/assets/images/veQb227.png" alt="pic"></p>
<p>Scalaæ˜¯M240é€šç”¨æœºæªçš„å˜ç§ï¼Œä½†å®ƒçš„ä½¿ç”¨æ‰‹å†Œæ˜¯ç”¨ä¸€ç§çœ‹ä¸æ‡‚çš„æ–¹è¨€å†™çš„ï¼Œå¾ˆå¤šäººæ€€ç–‘é‚£åªæ˜¯ä¸€äº›æ¢¦è¯ã€‚</p>
<p><img src="/assets/images/3yYZVj2.png" alt="pic"></p>
<p>JavaScriptæ˜¯ä¸€æŠŠå®å‰‘ï¼Œä½†æ²¡æœ‰å‰‘æŸ„ã€‚</p>
<p><img src="/assets/images/3qIb6rU.png" alt="pic"></p>
<p>Goè¯­è¨€æ˜¯ä¸€ç§è‡ªåˆ¶çš„â€if err != nilâ€å‘ä»¤æªï¼Œæ¯ä¸€æ¬¡å‘å°„åï¼Œä½ éƒ½å¿…é¡»è¦æ£€æŸ¥å®ƒæ˜¯å¦çœŸçš„å‘å°„äº†ã€‚</p>
<p><img src="/assets/images/AFZBvy2.png" alt="pic"></p>
<p>Rustè¯­è¨€æ˜¯ä¸€ç§3Dæ‰“å°å‡ºçš„æªã€‚å°†æ¥ä¹Ÿè®¸çœŸçš„èƒ½æ´¾ä¸Šç”¨åœºã€‚</p>
<p><img src="/assets/images/2URZfy.png" alt="pic"></p>
<p>bashæ˜¯ä¸€ä¸ªååˆ†ç¢æ‰‹çš„é”¤å­ï¼Œä½ æŠ¡èµ·å®ƒæ—¶ä¼šå‘ç°æ‰€æœ‰ä¸œè¥¿çœ‹èµ·æ¥éƒ½åƒé’‰å­ï¼Œå°¤å…¶æ˜¯ä½ çš„æŒ‡å¤´ã€‚</p>
<p><img src="/assets/images/v2U3qef.png" alt="pic"></p>
<p>Pythonæ˜¯ä¸€ç§â€v2/v3â€åŒç®¡æªï¼Œæ¯æ¬¡åªèƒ½ç”¨ä¸€ä¸ªç®¡å­å‘å°„ï¼Œä½ æ°¸è¿œä¸çŸ¥é“è¯¥ç”¨å“ªä¸ªç®¡å­å‘å°„å¥½ã€‚</p>
<p><img src="/assets/images/7VZvMn.png" alt="pic"></p>
<p>Rubyæ˜¯ä¸€æŠŠå¤–åµŒçº¢å®çŸ³çš„å®åˆ€ï¼Œäººä»¬ä½¿ç”¨å®ƒé€šå¸¸æ˜¯å› ä¸ºçœ‹èµ·æ¥å¾ˆç‚«ã€‚</p>
<p><img src="/assets/images/iUFzqi.png" alt="pic"></p>
<p>PHPæ˜¯æ°´ç®¡å­ï¼Œä½ é€šå¸¸ä¼šæŠŠå®ƒçš„ä¸€æ®µæ¥åˆ°æ±½è½¦çš„æ’æ°”ç®¡ï¼Œå¦ä¸€ç«¯æ’è¿›è½¦çª—é‡Œï¼Œç„¶åä½ åè¿›è½¦é‡Œï¼Œå¼€åŠ¨å¼•æ“ã€‚</p>
<p><img src="/assets/images/eAj6Nra.png" alt="pic"></p>
<p>Mathematicaæ˜¯ä¸€ç§åœ°çƒä½è½¨é“ç²’å­å¤§ç‚®ï¼Œå®ƒä¹Ÿè®¸èƒ½å¤Ÿå¹²å‡ºå¾ˆç¥å¥‡çš„äº‹æƒ…ï¼Œä½†åªæœ‰ä»˜å¾—èµ·è´¹ç”¨çš„äººæ‰èƒ½ä½¿ç”¨å®ƒã€‚</p>
<p><img src="/assets/images/7v6jei.png" alt="pic"></p>
<p>C#æ˜¯ä¸€ç§å¼ºæ‚çš„æ¿€å…‰å¤§ç‚®ï¼Œæ¶å­ä¸€å¤´é©´å­ä¸Šï¼Œå¦‚æœä»é©´å­ä¸Šå¸ä¸‹æ¥ï¼Œå®ƒå¥½åƒå°±å‘ä¸å‡ºæ¿€å…‰ã€‚</p>
<p><img src="/assets/images/jUR7be.png" alt="pic"></p>
<p>Prologè¯­è¨€æ˜¯ä¸€ç§äººå·¥æ™ºèƒ½æ­¦å™¨ï¼Œä½ å‘Šè¯‰å®ƒè¦åšä»€ä¹ˆï¼Œå®ƒä¼šç…§åšä¸è¯¯ï¼Œä½†ä¹‹åï¼Œå®ƒä¼šå¼„å‡ ä¸ªç»ˆç»“è€…å‡ºæ¥ï¼Œçƒ§æ‰ä½ çš„æˆ¿å­ã€‚</p>
<p><img src="/assets/images/bM3aaab.png" alt="pic"></p>
<p>Lispè¯­è¨€æ˜¯ä¸€æŠŠå‰ƒé¡»åˆ€ï¼Œæœ‰å¾ˆå¤šæ¬¾å¼ã€‚åªæœ‰å¯»æ±‚åˆºæ¿€å’Œå±é™©çš„äººæ‰ä¼šä½¿ç”¨å®ƒã€‚</p>
]]></content>
      <categories>
        <category>äº’è”ç½‘</category>
      </categories>
      <tags>
        <tag>äº’è”ç½‘</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustæ›´æ¢å›½å†…æº</title>
    <url>/2018/01/24/change-rust-mirrors/</url>
    <content><![CDATA[<p>ä»Šå¤©å­¦cargoè¿™èŠ‚ï¼Œ<code>cargo build</code>æ—¶å®‰è£…å¤–éƒ¨ä¾èµ–çœŸçš„æ…¢å•Šã€‚æœæ–­æ‰¾å›½å†…æº,æœæ–­åˆæ˜¯ustc(ä¸­ç§‘å¤§, emmmä»¥å‰åº”è¯¥åŠªåŠ›ä¸€ç‚¹è€ƒä¸­ç§‘å¤§<del>(ï¿£â–½ï¿£)</del>*)</p>
<p>æ•™ç¨‹å¼€å§‹ï¼š</p>
<p>è®¾ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static</span><br><span class="line"><span class="built_in">export</span> RUSTUP_UPDATE_ROOT=https://mirrors.ustc.edu.cn/rust-static/rustup</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç›´æ¥å†™å…¥<code>~/.bashrc</code></p>
<p>ä½¿ç”¨ustcuçš„æºä¸‹è½½å®‰è£…rust</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -sSf https://mirrors.ustc.edu.cn/rust-static/rustup.sh | sh</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘<code>~/.cargo/config</code>å†™å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[registry]</span><br><span class="line">index &#x3D; &quot;https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;crates.io-index&#x2F;&quot;</span><br><span class="line">[source.crates-io]</span><br><span class="line">registry &#x3D; &quot;https:&#x2F;&#x2F;github.com&#x2F;rust-lang&#x2F;crates.io-index&quot;</span><br><span class="line">replace-with &#x3D; &#39;ustc&#39;</span><br><span class="line">[source.ustc]</span><br><span class="line">registry &#x3D; &quot;https:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;crates.io-index&#x2F;&quot;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨cargoå®‰è£…å¤–éƒ¨ä¾èµ–æ˜¯ä¸æ˜¯è´¼æºœ~ğŸ˜‰</p>
]]></content>
      <categories>
        <category>Rust</category>
      </categories>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitçš„ä¸€äº›åŸºæœ¬æ“ä½œã€æŒç»­æ›´æ–°ã€‘</title>
    <url>/2018/03/31/git/</url>
    <content><![CDATA[<p>ç»å¸¸ç”¨gitï¼Œä½†å¥½å¤šå‘½ä»¤æ€»æ˜¯è®°ä¸ä½ï¼Œæ¯æ¬¡éƒ½ç™¾åº¦ã€‚ç°åœ¨æ•´ç†ä¸‹åšä¸ªç¬”è®°å§ã€‚</p>
<h3 id="åˆ†æ”¯æ“ä½œ"><a href="#åˆ†æ”¯æ“ä½œ" class="headerlink" title="åˆ†æ”¯æ“ä½œ"></a>åˆ†æ”¯æ“ä½œ</h3><ul>
<li><p>æŸ¥çœ‹åˆ†æ”¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git branch  <span class="comment">#åªæ˜¾ç¤ºæœ¬åœ°åˆ†æ”¯</span></span><br><span class="line">git branch -a <span class="comment">#æ˜¾ç¤ºæœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºåˆ†æ”¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git checkout -b branch_name</span><br><span class="line"><span class="comment">#å¦‚æœæœ‰ä¸€ä¸ªè¿œç¨‹åˆ†æ”¯remotes/origin/branch_name,é‚£ä¹ˆæ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°†ä¼šåˆ›å»ºæ–°çš„åä¸º`branch_name`æœ¬åœ°åˆ†æ”¯å¹¶ä¸”è·Ÿè¸ªåŒåçš„è¿œç¨‹åˆ†æ”¯remotes/origin/branch_name</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¨é€è¿œç¨‹åˆ†æ”¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push origin branch_name</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ é™¤åˆ†æ”¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git branch -d branch_name</span><br><span class="line"><span class="comment"># åˆ é™¤æœ¬åœ°åˆ†æ”¯åå¹¶åˆ é™¤è¿œç¨‹åˆ†æ”¯</span></span><br><span class="line">git push --delete origin branch_name</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="tag-æ ‡ç­¾æ“ä½œ"><a href="#tag-æ ‡ç­¾æ“ä½œ" class="headerlink" title="tag æ ‡ç­¾æ“ä½œ"></a>tag æ ‡ç­¾æ“ä½œ</h3><ul>
<li><p>æŸ¥çœ‹tagåˆ—è¡¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–°å¢tag</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git tag tag_name <span class="comment"># æ¯”å¦‚v1.0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¨é€æœ¬åœ°æŒ‡å®štagåˆ°è¿œç¨‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push origin tag_name</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¨é€å…¨éƒ¨æœ¬åœ°tagåˆ°è¿œç¨‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push --tags</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ é™¤tag</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git tag -d </span><br><span class="line"><span class="comment"># åˆ é™¤tagåå¹¶åˆ é™¤è¿œç¨‹tag</span></span><br><span class="line">git push --delete origin tag_name</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥"><a href="#githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥" class="headerlink" title="githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥"></a>githubä¸­forkçš„é¡¹ç›®ä¸åŸä½œè€…åŒæ­¥</h3><p>å‡å¦‚ä¸€ä¸ªé¡¹ç›®<code>Evil-S0ul/write-doc</code>åœ°å€: <a href="https://github.com/Evil-S0ul/write-doc" target="_blank" rel="noopener">https://github.com/Evil-S0ul/write-doc</a></p>
<p>æˆ‘forkä¹‹åçš„é¡¹ç›®æ˜¯<code>heropoo/write-doc</code>åœ°å€: <a href="https://github.com/heropoo/write-doc" target="_blank" rel="noopener">https://github.com/heropoo/write-doc</a></p>
<p>æ¥ä¸‹æ¥å¼€å§‹æ“ä½œï¼š</p>
<ol>
<li>åˆ‡æ¢åˆ°æˆ‘forkçš„é¡¹ç›®ç›®å½•é‡Œï¼Œç„¶åå¢åŠ æºä»“åº“åœ°å€åˆ°ä½ é¡¹ç›®çš„è¿œç¨‹åˆ†æ”¯ä¸­<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> write-doc</span><br><span class="line">git remote add Evil-S0ul https://github.com/Evil-S0ul/write-doc</span><br></pre></td></tr></table></figure></li>
<li>fetchåˆšæ·»åŠ çš„æºåˆ†æ”¯åˆ°æœ¬åœ°<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git fetch Evil-S0ul</span><br></pre></td></tr></table></figure></li>
<li>åˆå¹¶ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç <figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git merge Evil-S0ul/master</span><br></pre></td></tr></table></figure></li>
<li>æœ€åæŠŠåˆå¹¶åçš„ä»£ç pushåˆ°ä½ çš„Githubé¡¹ç›®ä¸Šå»å°±okå•¦<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag"><a href="#æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag" class="headerlink" title="æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag"></a>æ£€å‡ºè¿œç¨‹çš„æŸä¸ªåˆ†æ”¯æˆ–è€…tag</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git fetch</span><br><span class="line">git checkout branch_name</span><br><span class="line"><span class="comment">#æˆ–è€…</span></span><br><span class="line">git checkout tag_name</span><br></pre></td></tr></table></figure>

<h3 id="åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯"><a href="#åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯" class="headerlink" title="åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯"></a>åŒæ­¥ä¸”mergeå…¶ä»–è¿œç¨‹åˆ†æ”¯åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git pull origin other_branch_name</span><br></pre></td></tr></table></figure>

<h3 id="Gitæ— æ³•pullä»“åº“refusing-to-merge-unrelated-histories"><a href="#Gitæ— æ³•pullä»“åº“refusing-to-merge-unrelated-histories" class="headerlink" title="Gitæ— æ³•pullä»“åº“refusing to merge unrelated histories"></a>Gitæ— æ³•pullä»“åº“refusing to merge unrelated histories</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬çš„æœ¬åœ°ä»“åº“æ·»åŠ äº†ä¸€ä¸ªè¿œç¨‹ä»“åº“åœ°å€ï¼Œpullä»£ç æ—¶ä¼šæŠ¥<code>refusing to merge unrelated histories</code>çš„é”™ã€‚è§£å†³æ–¹æ³•æ˜¯åŠ ä¸€ä¸ªå‚æ•°<code>--allow-unrelated-histories</code>ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬çš„åˆ†æ”¯æ˜¯master</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git pull origin master --allow-unrelated-histories</span><br></pre></td></tr></table></figure>

<p>æœ€åæ›´æ–°ï¼š 2018-11-18 17:59:06</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨PHPå†™Gitçš„è‡ªåŠ¨éƒ¨ç½²webhookè„šæœ¬</title>
    <url>/2018/05/01/git-webhook/</url>
    <content><![CDATA[<p>ç°åœ¨å¼€å‘é¡¹ç›®å¤§å¤šä½¿ç”¨gitä½œä¸ºç‰ˆæœ¬æ§åˆ¶å™¨ï¼Œè€Œä¸”ç°åœ¨å¤§å¤šæ•°çš„ä»£ç æ‰˜ç®¡å¹³å°éƒ½æ”¯æŒè‡ªå®šä¹‰webhookè„šæœ¬ã€‚æ­£å¥½åˆ©ç”¨è¿™ä¸ªè„šæœ¬ï¼Œç»“åˆgitçš„workflowï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„åšåˆ°é¡¹ç›®ä»£ç çš„è‡ªåŠ¨å‘å¸ƒéƒ¨ç½²ã€‚</p>
<h3 id="æœ€ç®€å•çš„æµç¨‹"><a href="#æœ€ç®€å•çš„æµç¨‹" class="headerlink" title="æœ€ç®€å•çš„æµç¨‹"></a>æœ€ç®€å•çš„æµç¨‹</h3><p>æ¯”å¦‚ä½ çš„é¡¹ç›®æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œä¸€ä¸ªæ˜¯ä»£ç å·²ç»ç»è¿‡æµ‹è¯•å¯ç”¨äºéƒ¨ç½²åˆ°æœåŠ¡å™¨çš„masteråˆ†æ”¯ï¼Œä¸€ä¸ªç”¨äºå¼€å‘çš„devåˆ†æ”¯ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸Šçº¿çš„è¿‡ç¨‹å°±æ˜¯merge devçš„ä»£ç åˆ°masteråˆ†æ”¯ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªä»£ç pushè§¦å‘çš„webhookã€‚è¿™ä¸ªwebhookè„šæœ¬çš„ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯<code>git pull origin master</code>ã€‚</p>
<h3 id="æœ€ç®€å•çš„å®ç°"><a href="#æœ€ç®€å•çš„å®ç°" class="headerlink" title="æœ€ç®€å•çš„å®ç°"></a>æœ€ç®€å•çš„å®ç°</h3><ul>
<li>ç¼–å†™<code>webhook.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// todo åœ¨æ­¤å¯ä»¥å†™æ ¡éªŒæƒé™å¯†ç ä¹‹ç±»çš„ä»£ç </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$path = dirname(<span class="keyword">__DIR__</span>);</span><br><span class="line">$log_file = $path.<span class="string">'/runtime/logs/webhook-pull-error-output.log'</span>;	<span class="comment">//é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">$descriptorspec = <span class="keyword">array</span>(</span><br><span class="line">    <span class="number">0</span> =&gt; <span class="keyword">array</span>(<span class="string">"pipe"</span>, <span class="string">"r"</span>),  <span class="comment">// æ ‡å‡†è¾“å…¥ï¼Œå­è¿›ç¨‹ä»æ­¤ç®¡é“ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">"pipe"</span>, <span class="string">"w"</span>),  <span class="comment">// æ ‡å‡†è¾“å‡ºï¼Œå­è¿›ç¨‹å‘æ­¤ç®¡é“ä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">    <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">"file"</span>, $log_file, <span class="string">"a"</span>) <span class="comment">// æ ‡å‡†é”™è¯¯ï¼Œå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$cwd = $path;</span><br><span class="line">$env = <span class="keyword">array</span>(<span class="string">'PATH'</span> =&gt; $_SERVER[<span class="string">'PATH'</span>]);</span><br><span class="line"></span><br><span class="line">$process = proc_open(<span class="string">'sudo git pull origin master'</span>, $descriptorspec, $pipes, $cwd, $env);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line"><span class="keyword">if</span> (is_resource($process)) &#123;</span><br><span class="line">    <span class="comment">// $pipes ç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</span></span><br><span class="line">    <span class="comment">// 0 =&gt; å¯ä»¥å‘å­è¿›ç¨‹æ ‡å‡†è¾“å…¥å†™å…¥çš„å¥æŸ„</span></span><br><span class="line">    <span class="comment">// 1 =&gt; å¯ä»¥ä»å­è¿›ç¨‹æ ‡å‡†è¾“å‡ºè¯»å–çš„å¥æŸ„</span></span><br><span class="line">    <span class="comment">// é”™è¯¯è¾“å‡ºå°†è¢«è¿½åŠ åˆ°æ–‡ä»¶ /tmp/error-output.txt</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> stream_get_contents($pipes[<span class="number">1</span>]);</span><br><span class="line">    fclose($pipes[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡è®°ï¼šåœ¨è°ƒç”¨ proc_close ä¹‹å‰å…³é—­æ‰€æœ‰çš„ç®¡é“ä»¥é¿å…æ­»é”ã€‚</span></span><br><span class="line">    $return_value = proc_close($process);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> PHP_EOL.<span class="string">"command returned $return_value\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ·»åŠ phpè„šæœ¬çš„æ‰§è¡Œç”¨æˆ·sudoersä¸­</li>
</ul>
<p>æ¯”å¦‚ä½ ä½¿ç”¨nginx+php-fpmçš„æœåŠ¡å™¨æ¶æ„ï¼Œä½ çš„php-fpmçš„ç”¨æˆ·æ˜¯www-data</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">visudo</span><br><span class="line">--------------------------------</span><br><span class="line">...</span><br><span class="line"><span class="comment">#Defaults   !visiblepw   #æ³¨é‡Šæ‰è¿™å¥ è¿™å¥æ˜¯é™åˆ¶sudoåªèƒ½åœ¨å‘½ä»¤è¡Œæ‰§è¡Œçš„</span></span><br><span class="line">www-data ALL=(ALL:ALL) NOPASSWD: /usr/bin/git</span><br></pre></td></tr></table></figure>

<ul>
<li>pushä»£ç åˆ°masteråˆ†æ”¯æµ‹è¯•ä¸‹å§~ ç™»é™†æœåŠ¡å™¨çœ‹çœ‹ä»£ç æ˜¯ä¸æ˜¯å·²ç»åŒæ­¥å¥½äº†ã€€</li>
</ul>
]]></content>
      <categories>
        <category>Git</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Git</tag>
        <tag>Webhook</tag>
      </tags>
  </entry>
  <entry>
    <title>Composerå®˜æ–¹é•œåƒå¤ªæ…¢æˆ–è€…è¢«å¢™æ— æ³•ä½¿ç”¨æ—¶çš„å‡ ç§è§£å†³æ–¹æ¡ˆ</title>
    <url>/2018/08/02/composer-mirrors/</url>
    <content><![CDATA[<p>Composerå®˜æ–¹é•œåƒå¤ªæ…¢æˆ–è€…è¢«å¢™æ— æ³•ä½¿ç”¨æ—¶çš„å‡ ç§è§£å†³æ–¹æ¡ˆ</p>
<h3 id="ä½¿ç”¨ä»£ç†"><a href="#ä½¿ç”¨ä»£ç†" class="headerlink" title="ä½¿ç”¨ä»£ç†"></a>ä½¿ç”¨ä»£ç†</h3><p>è¢«å¢™ä½¿ç”¨å›½å¤–ä»£ç†ä¸Šç½‘ï¼Œæ€»æ˜¯ä¸€ç§è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•ã€‚å‡å¦‚ä½ ä½¿ç”¨shadowsocksä»£ç†ï¼Œå¼€å¯ä¹‹åé»˜è®¤çš„æœ¬åœ°ç«¯å£æ˜¯1080ã€‚åªè¦è®¾ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡<code>http_proxy</code>å’Œ<code>https_proxy</code>å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<p>Mac OS / Linux ç»ˆç«¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=127.0.0.1:1080</span><br><span class="line"><span class="built_in">export</span> https_proxy=127.0.0.1:1080</span><br></pre></td></tr></table></figure>
<p>windows cmdå‘½ä»¤è¡Œ</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> http_proxy=<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">1080</span></span><br><span class="line"><span class="built_in">set</span> https_proxy=<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">1080</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œæ„‰å¿«çš„ä¸‹è½½å„ç§åŒ…å§~</p>
<h3 id="ä½¿ç”¨å›½å†…é•œåƒåœ°å€"><a href="#ä½¿ç”¨å›½å†…é•œåƒåœ°å€" class="headerlink" title="ä½¿ç”¨å›½å†…é•œåƒåœ°å€"></a>ä½¿ç”¨å›½å†…é•œåƒåœ°å€</h3><blockquote>
<ul>
<li>é˜¿é‡Œäº‘æä¾›çš„é•œåƒåœ°å€(æ¨è)ï¼š<a href="https://developer.aliyun.com/composer" target="_blank" rel="noopener">https://developer.aliyun.com/composer</a></li>
<li>cnpkgæä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://php.cnpkg.org" target="_blank" rel="noopener">https://php.cnpkg.org</a></li>
<li>LaravelChinaç¤¾åŒºæä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://packagist.laravel-china.org" target="_blank" rel="noopener">https://packagist.laravel-china.org</a></li>
<li>Composerä¸­æ–‡ç½‘æä¾›çš„é•œåƒåœ°å€ï¼š <a href="https://packagist.phpcomposer.com" target="_blank" rel="noopener">https://packagist.phpcomposer.com</a></li>
</ul>
</blockquote>
<p>é•œåƒä½¿ç”¨æ–¹æ³•:</p>
<p>å…¨å±€é…ç½®ï¼ˆæ¨èï¼‰:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">composer config -g repo.packagist composer https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;composer&#x2F;</span><br></pre></td></tr></table></figure>

<p>å–æ¶ˆé•œåƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">composer config -g --unset repos.packagist</span><br></pre></td></tr></table></figure>

<p>åœ¨å•ç‹¬é¡¹ç›®ä¸­ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">composer config repo.packagist composer https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;composer&#x2F;</span><br></pre></td></tr></table></figure>

<p>åœ¨å•ç‹¬é¡¹ç›®ä¸­å–æ¶ˆé…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">composer config --unset repos.packagist</span><br></pre></td></tr></table></figure>

<p>â€”- æœ€åæ›´æ–°æ—¶é—´ï¼š 2020-03-25 10:02</p>
]]></content>
      <categories>
        <category>Composer</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Bingæœç´¢å¼•æ“åšç«™å†…æœç´¢</title>
    <url>/2018/09/15/bing-site-search/</url>
    <content><![CDATA[<p>å› ä¸ºè‡ªå·±çš„åšå®¢ç™¾åº¦æœªæ”¶å½•â•®(â•¯-â•°)â•­ï¼Œæœ¬æ¥ä¹‹å‰ç”¨çš„è°·æ­Œï¼Œä½†æ˜¯è°·æ­Œæ¯•ç«Ÿç¿»å¢™æ‰èƒ½ç”¨ã€‚å†³å®šè¿˜æ˜¯æ¢å¾®è½¯çš„Bingæœç´¢å¼•æ“æ¥åšç«™å†…æœç´¢å§ã€‚</p>
<p>å¤§æ¦‚æ˜¯è¿™æ ·çš„æ•ˆæœ<br><img src="/assets/images/20180916201818.png" alt="example-pic"></p>
<p>è§‚å¯Ÿäº†ä¸‹ï¼ŒBingæŒ‡å®šç«™ç‚¹æœç´¢å¾ˆç®€å•ï¼Œæ¯”å¦‚æœç´¢æ¡†è¾“å…¥å…³é”®å­—<code>git site:www.ioio.pw</code>æäº¤ä¹‹åçš„urlæ˜¯<code>https://bing.com/search?q=git+site%3Awww.ioio.pw</code></p>
<p>æ‰€ä»¥å¼€å§‹å†™ä¸ªç®€å•çš„formè¡¨å•å°±å¥½äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>bing search<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Bing Search<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"https://bing.com/search"</span> <span class="attr">id</span>=<span class="string">"searchForm"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"q"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"site"</span> <span class="attr">value</span>=<span class="string">"www.ioio.pw"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Search"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> searchForm = <span class="built_in">document</span>.getElementById(<span class="string">'searchForm'</span>);</span></span><br><span class="line"><span class="actionscript">	searchForm.onsubmit = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">var</span> url = <span class="keyword">this</span>.action;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">var</span> q = <span class="keyword">this</span>.children[<span class="string">'q'</span>].value;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">var</span> site = <span class="keyword">this</span>.children[<span class="string">'site'</span>].value;</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">var</span> url = url + <span class="string">'?q='</span>+q+<span class="string">' site:'</span>+ site;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">window</span>.open(url);</span></span><br><span class="line"><span class="actionscript">		<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">	&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œæå®š~</p>
]]></content>
      <categories>
        <category>æœç´¢å¼•æ“</category>
      </categories>
      <tags>
        <tag>æœç´¢å¼•æ“</tag>
        <tag>ç«™å†…æœç´¢</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerå®¹å™¨åŠ¨æ€æ·»åŠ ç«¯å£</title>
    <url>/2018/09/16/docker-container-port/</url>
    <content><![CDATA[<p>çªç„¶é‡åˆ°ä¸€ä¸ªé—®é¢˜æ€ä¹ˆç»™ä¸€ä¸ªå·²ç»åœ¨è¿è¡Œçš„dockerå®¹å™¨æ·»åŠ ç«¯å£ï¼Œæ‰¾äº†æ‰¾èµ„æ–™ï¼Œè®°ä¸ªç¬”è®°ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://blog.csdn.net/zuoshenglo/article/details/78402772" target="_blank" rel="noopener">æ€ä¹ˆç»™è¿è¡Œä¸­çš„dockerå®¹å™¨æ·»åŠ æ–°çš„ç«¯å£</a></li>
<li><a href="https://blog.csdn.net/wesleyflagon/article/details/78961990" target="_blank" rel="noopener">ä¿®æ”¹dockerå®¹å™¨ç«¯å£æ˜ å°„çš„æ–¹æ³•</a></li>
<li><a href="https://blog.csdn.net/xfks55/article/details/50148389" target="_blank" rel="noopener">iptableè§„åˆ™æŸ¥çœ‹ï¼Œæ·»åŠ ï¼Œåˆ é™¤å’Œä¿®æ”¹</a></li>
</ul>
<h2 id="æ–¹æ³•1-ä¿®æ”¹iptablesç«¯å£æ˜ å°„"><a href="#æ–¹æ³•1-ä¿®æ”¹iptablesç«¯å£æ˜ å°„" class="headerlink" title="æ–¹æ³•1 ä¿®æ”¹iptablesç«¯å£æ˜ å°„"></a>æ–¹æ³•1 ä¿®æ”¹iptablesç«¯å£æ˜ å°„</h2><blockquote>
<p>dockerçš„ç«¯å£æ˜ å°„å¹¶ä¸æ˜¯åœ¨dockeræŠ€æœ¯ä¸­å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡å®¿ä¸»æœºçš„iptablesæ¥å®ç°ã€‚é€šè¿‡æ§åˆ¶ç½‘æ¡¥æ¥åšç«¯å£æ˜ å°„ï¼Œç±»ä¼¼è·¯ç”±å™¨ä¸­è®¾ç½®è·¯ç”±ç«¯å£æ˜ å°„ã€‚</p>
</blockquote>
<p>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8080ç«¯å£ï¼Œå…ˆæŸ¥çœ‹iptablesåˆ°åº•è®¾ç½®äº†ä»€ä¹ˆè§„åˆ™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -vnL</span><br></pre></td></tr></table></figure>

<p>åœ¨ç»“æœä¸­æœ‰ä¸€æ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Chain DOCKER</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">RETURN     all  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0</span><br><span class="line">DNAT       tcp  --  0.0.0.0&#x2F;0            0.0.0.0&#x2F;0            tcp dpt:8080 to:172.17.0.3:80</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°dockeråˆ›å»ºäº†ä¸€ä¸ªåä¸ºDOKCERçš„è‡ªå®šä¹‰çš„é“¾æ¡Chainã€‚è€Œæˆ‘å¼€æ”¾80ç«¯å£çš„å®¹å™¨çš„ipæ˜¯172.17.0.3</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡inspectå‘½ä»¤æŸ¥çœ‹å®¹å™¨ip</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker inspect containerId |grep IPAddress</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æƒ³å†å¢åŠ ä¸€ä¸ªç«¯å£æ˜ å°„ï¼Œæ¯”å¦‚<code>8081-&gt;81</code>ï¼Œå°±åœ¨è¿™ä¸ªé“¾æ¡æ˜¯å†åŠ ä¸€æ¡è§„åˆ™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -A  DOCKER -p tcp --dport 8081 -j DNAT --to-destination 172.17.0.3:81</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåŠ é”™äº†æˆ–è€…æƒ³ä¿®æ”¹ï¼š</p>
<p>å…ˆæ˜¾ç¤ºè¡Œå·æŸ¥çœ‹</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -vnL DOCKER --line-number</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤è§„åˆ™3</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo iptables -t nat -D DOCKER 3</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ³•2-ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶"><a href="#æ–¹æ³•2-ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶" class="headerlink" title="æ–¹æ³•2 ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶"></a>æ–¹æ³•2 ä¿®æ”¹å®¹å™¨é…ç½®æ–‡ä»¶</h2><p>å®¹å™¨çš„é…ç½®æ–‡ä»¶<code>/var/lib/docker/containers/[containerId]</code>ç›®å½•ä¸‹ï¼Œ<code>hostconfig.json</code>å’Œ<code>config.v2.json</code><br>ä¿®æ”¹å¥½ä¹‹åï¼Œé‡å¯å®¹å™¨æœåŠ¡ã€‚</p>
<h2 id="æ–¹æ³•3-æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ"><a href="#æ–¹æ³•3-æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ" class="headerlink" title="æ–¹æ³•3 æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ"></a>æ–¹æ³•3 æŠŠè¿è¡Œä¸­çš„å®¹å™¨ç”Ÿæˆæ–°çš„é•œåƒï¼Œç„¶åè¿è¡Œæ–°çš„é•œåƒ</h2><ol>
<li><p>æäº¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ä¸ºé•œåƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker commit containerid heropoo/example</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œ<code>heropoo/example</code>é•œåƒå¹¶æ·»åŠ 8080æ˜ å°„å®¹å™¨80ç«¯å£</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -d -p 8000:80  heropoo/example /bin/sh</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>è¯•è¯•å§~ğŸ˜</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>è™šæ‹ŸåŒ–</tag>
        <tag>å®¹å™¨</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›—å°†è¡Œ(è½¬)</title>
    <url>/2018/09/18/%E7%9B%97%E5%B0%86%E8%A1%8C/</url>
    <content><![CDATA[<p>é‡å²è®°è½½:å®‹å¾½å®—äºŒåå¹´ï¼ˆ1120å¹´ï¼‰ï¼Œæœé‡åŠ¨è¡ï¼Œè¾¹ç–†ä¸ç¨³ã€‚æ—¶æœ‰ç›—è€…ï¼Œå–å®˜æµæ°‘ï¼Œå‡¡äº¬ä¸­è´ªå®˜ï¼Œæ— ä¸€å¹¸å…ï¼Œæ°‘å’¸æ•¬ä¹‹ï¼Œå´æ— äººçŸ¥å…¶çœŸé¢ç›®ã€‚ç„¶è‡ªå¾½å®—äºŒåä¸‰å¹´ï¼Œæ­¤ç›—æœªæ›¾å‡ºç°ï¼Œè‡³å¾½å®—äºŒåå…­å¹´ï¼Œæ­¤ç›—å…¥å—äº¬ç‹åºœï¼Œæœªå–å®ƒç‰©ï¼Œä»…ç›—èµ°ä¸€ç‰ç°ªï¼Œè‡ªæ­¤åŒ¿è¿¹â€¦â€¦</p>
<p>é‡å²è®°è½½:å®‹é’¦å®—å…ƒå¹´ï¼ˆ1126å¹´ï¼‰ï¼Œé‡‘å†›å°†é¢†å®Œé¢œå…‹å›¾ç‡å†›æ”»é™·å®‹éƒ½æ±´æ¢ï¼Œé’¦å®—è¢«ä¿˜ï¼Œæ°‘ä¸èŠç”Ÿã€‚1127å¹´ï¼Œå®‹é«˜å®—èµµæ„å»ºç«‹å—å®‹æ”¿æƒï¼Œæ—¶å®‹å†›ä¸é‡‘å†›äº¤æˆ˜ï¼Œä¸€å°å’ä¸€ç®­å°„æ€å®Œé¢œå…‹å›¾ï¼Œè€Œåå±¡ç«‹æˆ˜åŠŸï¼Œå®˜è‡³æŠ¤å›½å°†å†›ï¼Œç­å¸ˆå›æœåï¼Œå®‹ä¸»æ¬²å¯¹å…¶å¤§è¡Œå°èµï¼Œç„¶å…¶è‡ªè¾å®˜èŒï¼Œè‡ªæ­¤åŒ¿è¿¹â€¦â€¦</p>
<p>å…¬å…ƒ1137å¹´ï¼Œä¸€ç¬‘è½©å†…ï¼Œåº§æ— è™šå¸­ï¼Œå¸­å‰åä¸€ä¸­å¹´ç”·å­ï¼Œç›¸è²Œéå‡¡ï¼Œæ–‡å¢¨ä¸­é¢‡æœ‰æ­¦å°†é£é‡‡ï¼Œæœ‰å¬è€…å¸­ä¸‹æš—å¹:æ­¤ç­‰äººé—´ç¢ç‰éƒï¼Œå¤©åº”ä¹ä¸ç‚¹é…¥å¨˜ï¼Œå¥ˆä½•å¤©å…¬ä¸ä½œç¾å•Šâ€¦â€¦ï¼Œåªè§ç”·å­æ‰‹æ‰§é†’æœ¨ä¸€æ•²ï¼Œâ€œä»Šæ—¥æˆ‘ç»™è¯¸ä½è®²è®²é‚£ä½æ¶ˆå¤±å¤§ç›—çš„æ•…äº‹ã€‚è¯¸ä½éƒ½çŸ¥é“è¿™å¤§ç›—åœ¨åå¤šå¹´å‰åŠ«å¯Œæµè´«ï¼Œç™¾å§“è§†ä¹‹ä¸ºç¥æ˜ï¼Œè¯¸ä½å¯çŸ¥ä¸ºä½•è¿™å¤§ç›—æ¶ˆå¤±å‡ å¹´åï¼Œåˆäºå—äº¬ç‹åºœç›—å–ä¸€æ”¯ç‰ç°ªæ­¤åä¾¿å†æ— æ¶ˆæ¯â€¦â€¦â€</p>
<p>â€œæ²¡é”™ï¼Œæˆ‘å°±æ˜¯è¯´ä¹¦äººï¼Œä¹Ÿæ˜¯å¤§ç›—ï¼Œäº¦æ˜¯æŠ¤å›½å°†å†›ï¼ŒäºŒåå²ä¹‹å‰ï¼Œæˆ‘ä»å¸ˆå‚…é‚£é‡Œä¹ å¾—æ­¦è‰ºï¼Œå­¦æˆåå› å–œè‡ªåœ¨ç”Ÿæ´»ï¼Œå´çœ‹ä¸æƒ¯è´ªå®˜æ±¡åï¼Œç”±æ­¤å¼€å§‹äº†åŠ«è´ªæµè´«çš„ç”Ÿæ´»ï¼Œæœ¬ä»¥ä¸ºè‡ªå·±ä¸€ç”Ÿéƒ½ä¼šè¿™æ ·ä¸€ä¸ªäººæ¸¡è¿‡ï¼Œæ¸…é£æ˜æœˆã€è½æ—¥ä½™éœï¼Œå´ä¸æ›¾æƒ³å¥¹èµ°è¿›äº†æˆ‘çš„ç”Ÿæ´»ï¼Œé‚£æ—¥ï¼Œåœ¨ç›—å–åº·ç‹åºœçå®å¤œæ˜ç åï¼Œä¸ºèº²é¿è¿½æ•ï¼Œæˆ‘çºµé©¬é€ƒå‡ºåŸå¤–ï¼Œå´å› å‹’é©¬ä¸åŠï¼Œæ— æ„ä¸­è½»å¾®å¸¦èµ·è·¯è¾¹ä¸€å¥³å­çš„è£™è¾¹ï¼Œçœ‹å®˜å…µå¹¶æœªè¿½æ¥ï¼Œæˆ‘ä¸‹é©¬å‘å¥³å­é“æ­‰ï¼Œå´ä¸æƒ³åªæ­¤ä¸€çœ¼ï¼Œä¾¿æ˜¯ä¸€ç”Ÿï¼Œè‡ªè®¤è¿™ä¸–é—´æ²¡æœ‰ç›—ä¸åˆ°çš„ä¸œè¥¿çš„æˆ‘ï¼Œå´å¼€å§‹æ‹…å¿ƒç›—ä¸åˆ°å¥¹çš„å¿ƒï¼Œç„¶è€Œè‡ªå·±çš„å¿ƒå´å·²è¢«å¥¹å¸¦èµ°ï¼Œå› ä¸ºè¿™ä¸€çœ¼ï¼Œæˆ‘å¿½ç„¶æƒ³ä¸å†ä¸ºç›—ï¼Œå¨¶å…¶ä¸ºå¦»ã€‚è€å¤©å¾…æˆ‘ä¸è–„ï¼Œæˆ‘ç›—å¾—äº†å¥¹çš„å¿ƒï¼Œç„¶åæˆ‘æ¸¡è¿‡äº†æ­¤ç”Ÿæœ€å¿«ä¹çš„ä¸‰å¹´ï¼Œæˆ‘é™ªå¥¹åƒå··å­é‡Œçš„é‚£å®¶æ±¤é¢ã€è°ˆç¬‘ä¸­çª—å¤–ç™½é›ªçº·é£ï¼Œä¸æƒœç”¨å¤œæ˜ç åšå¼¹ç å¼¹å±±é›€â€¦â€¦å…¬å…ƒ1126å¹´ï¼Œæˆ‘å†³å®šå¨¶å¥¹ï¼Œå¬é—»å—äº¬ç‹åºœä¸­æœ‰ä¸€ç‰ç°ªï¼Œå¾—ä¹‹èµ äºˆå¿ƒçˆ±ä¹‹äººï¼Œå¯ä¸å…¶ç”Ÿç”Ÿä¸–ä¸–æ°¸ä¸åˆ†ç¦»ï¼Œæˆ‘å†³å®šå°†å®ƒå·æ¥é€ç»™å¥¹ï¼Œå’Œå¥¹è¯´å¥½è¿‡äº›æ—¥å­æˆ‘å°±ä¼šå›æ¥è¿å¨¶å¥¹ï¼Œä¹‹åå°±è¸ä¸Šäº†å»å—äº¬çš„è·¯ï¼Œåœ¨æˆ‘ç›—å¾—ç‰ç°ªè¿”é€”ä¸­ï¼Œå¬é—»é‡‘å†›æ”»é™·æ±´æ¢ï¼Œä¸€è·¯çƒ§æ€æŠ¢æ ï¼Œæ°‘ä¸èŠç”Ÿï¼Œæˆ‘æ…Œå¼ çš„å›åˆ°æ±´æ¢ï¼Œè·¯ä¸Šä¸åœçš„å®‰æ…°è‡ªå·±å¥¹ä¸€å®šæ²¡äº‹ï¼Œå´ä¸å¾—ä¸æ¥å—å¥¹å·²è¿‡ä¸–çš„ç°å®ï¼Œå¯èƒ½è´¼å°±æ˜¯è´¼å§ï¼Œä¸è®ºæˆ‘æ˜¯å¦åŠ«å¯Œæµè´«ï¼ŒæŠ¥åº”ç»ˆç©¶è¿˜æ˜¯æ¥äº†ï¼Œæˆ‘å¤±å»äº†æœ€å¿ƒçˆ±çš„äººï¼Œè‡ªæ­¤æˆ‘å¼ƒç›—ä»å†›ï¼Œå¸¦ç€å¯¹å¥¹çš„ç•™æ‹ï¼Œå°†ä¸€è…”æ¨æ„å…¨éƒ¨æ”¾åœ¨äº†é‡‘å†›èº«ä¸Šï¼Œå°†å£«ä»¬éƒ½è¯´æˆ‘åœ¨æˆ˜åœºå‹‡çŒ›å¼‚å¸¸ï¼Œå´ä¸çŸ¥æˆ‘å¿ƒä¸­æ»¡æ˜¯ä¸ºå¥¹æŠ¥ä»‡çš„æ€’æ„ä¸æ²¡æœ‰ç•™åœ¨å¥¹èº«è¾¹çš„æ‚”æ„ã€‚æœ€ç»ˆé‡‘å†›è´¥é€€ï¼Œæˆ‘å°„æ€äº†å®Œé¢œå…‹å›¾ï¼Œä¹Ÿå› æ­¤è¢«å°ä¸ºæŠ¤å›½å¤§å°†å†›ï¼Œæœå ‚ä¹‹ä¸Šï¼Œæˆ‘æ¨å´äº†èµèµï¼Œè¾æ‰äº†å®˜èŒï¼Œæ¥åˆ°äº†é‚£ä¸ªæœ‰ç€å¥¹çˆ±åƒçš„æ±¤é¢çš„å··å­ï¼Œå¼€äº†è¿™ä¸€ç¬‘è½©ï¼Œæˆä¸ºäº†ä¸€ä¸ªè®²å°½æ•…äº‹ï¼Œå´èµ°ä¸å‡ºè‡ªå·±æ•…äº‹çš„è¯´ä¹¦äººã€‚â€</p>
<p>â€œâ€¦â€¦åœ¨å¤§å°†å†›è¾å®˜ä¹‹åï¼Œä¾¿æ— äººçŸ¥æ™“å…¶å»å¤„ï¼Œå¾’ç•™è¿™ä¹ˆä¸€ä¸ªæ•…äº‹ï¼Œæˆ‘å¶ç„¶é—»å¾—ï¼Œè®²ä¸è¯¸ä½å¬ã€‚ä»Šæ—¥å°±è®²åˆ°è¿™é‡Œï¼Œå¤šè°¢è¯¸ä½æ§åœºã€‚â€ä¸€å£°é†’æœ¨ï¼Œä¼—äººè¿˜æœªä»å¤§ç›—çš„æ•…äº‹ä¸­å›è¿‡ç¥æ¥ï¼Œå´å‘ç°è¯´ä¹¦äººå·²ç„¶è½¬è¿›åå ‚ï¼Œä¼—äººèµ·èº«å››æ•£ï¼Œè¯´ä¹¦äººè½¬è¿›åå ‚å·²æ˜¯æ³ªæµæ»¡é¢ï¼Œçœ‹ç€åå ‚é™¢ä¸­çš„æ‡æ·æ ‘ï¼Œæ ‘ä¸ŠæŒ‚ç€é‚£åªæœªé€å‡ºçš„ç‰ç°ªâ€¦â€¦</p>
<p>ä½œè€…ï¼šä¸€ä¸ªäººçš„å…µè’é¦¬ä¹±<br>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/7aa6bfbb0df1" target="_blank" rel="noopener">https://www.jianshu.com/p/7aa6bfbb0df1</a><br>ä¾†æºï¼šç®€ä¹¦</p>
]]></content>
      <categories>
        <category>å¬é£é›¨</category>
      </categories>
      <tags>
        <tag>å¬é£é›¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºYii2æŸ¥è¯¢æ•°æ®å¯¹è±¡ActiveRecordçš„jsonåºåˆ—åŒ–é—®é¢˜</title>
    <url>/2018/10/16/yii2-activerecord-to-json/</url>
    <content><![CDATA[<p>ä»Šå¤©åœ¨ä½¿ç”¨<code>json_encode</code>å‡½æ•°åºåˆ—åŒ–Yii2æŸ¥è¯¢å¾—åˆ°çš„æ•°æ®æ¨¡å‹å¯¹è±¡ï¼ˆé€šå¸¸ç»§æ‰¿<code>ActiveRecord</code>ç±»ï¼‰æ—¶ï¼Œå‘ç°è¿”å›ç»“æœæ˜¯<code>{}</code>,è€Œä¸æ˜¯é¢„æœŸçš„æ•°æ®åº“å­—æ®µé”®å€¼å¯¹è¿™ç§å½¢å¼ï¼š<code>{&quot;name&quot;ï¼š &quot;xxx&quot;, &quot;sex&quot;: 1}</code></p>
<p>åæ¥èµ¶æ—¶é—´å°±ç›´æ¥åœ¨æ‰‹åŠ¨å¤„ç†äº†ä¸‹ï¼Œæ”¹åŠ¨äº†ä¸‹æ¨¡å‹å¯¹è±¡è®©å®ƒæ¥å…¥<code>JsonSerializable</code>æ¥å£ï¼Œå¹¶å®ç°å…¶æ¥å£æ–¹æ³•ï¼Œç±»ä¼¼è¿™æ ·ï¼›</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">ActiveRecord</span> <span class="keyword">implements</span> \<span class="title">JsonSerializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//... å…¶ä»–ä»£ç </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonSerialize</span> <span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;toArray();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå®Œç¾çš„è§£å†³äº†ã€‚ </p>
<p>ä½†æ˜¯åæ¥ä»£ç å†™å®Œäº†ï¼Œè§‰å¾—è¿™ä¸ªæ¡†æ¶åº”è¯¥æä¾›äº†è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•äº†å§ã€‚ç„¶åæ‰¾äº†æ‰¾ï¼Œæœç„¶æœ‰çš„ï¼š <code>\yii\helpers\BaseJson::encode($user)</code>ã€‚ç„¶åç¿»äº†ç¿»æºä»£ç ï¼Œéƒ¨åˆ†ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//from \yii\helpers\BaseJson::processData</span></span><br><span class="line"><span class="keyword">if</span> (is_object($data)) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($data <span class="keyword">instanceof</span> JsExpression) &#123;</span><br><span class="line">        $token = <span class="string">"!&#123;[$expPrefix="</span> . count($expressions) . <span class="string">']&#125;!'</span>;</span><br><span class="line">        $expressions[<span class="string">'"'</span> . $token . <span class="string">'"'</span>] = $data-&gt;expression;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $token;</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($data <span class="keyword">instanceof</span> \JsonSerializable) &#123;</span><br><span class="line">        $data = $data-&gt;jsonSerialize();</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($data <span class="keyword">instanceof</span> Arrayable) &#123; <span class="comment">// &lt;---here</span></span><br><span class="line">        $data = $data-&gt;toArray();</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($data <span class="keyword">instanceof</span> \SimpleXMLElement) &#123;</span><br><span class="line">        $data = (<span class="keyword">array</span>) $data;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $result = [];</span><br><span class="line">        <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $name =&gt; $value) &#123;</span><br><span class="line">            $result[$name] = $value;</span><br><span class="line">        &#125;</span><br><span class="line">        $data = $result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($data === []) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> \stdClass();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½œè€…åœ¨å¤„ç†æ•°æ®çš„æ—¶å€™åšäº†åˆ¤æ–­ï¼Œ<code>ActiveRecord</code>ç±»æ¥äº†<code>Arrayable</code>æ¥å£ï¼Œç„¶åä½œè€…ä¹Ÿæ˜¯ä½¿ç”¨<code>toArray()</code>æ–¹æ³•ã€‚ç„¶åæˆ‘è§‰å¾—æ”¾å¿ƒäº†ã€‚æˆ‘çš„æ”¹é€ ä¹Ÿæ²¡æœ‰é”™ã€‚å½“ç„¶äº†ä½¿ç”¨æ¡†æ¶æä¾›çš„æ–¹æ³•æ›´ç®€å•ç‚¹ã€‚</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Yii2</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿®å¤gitmentè¯„è®º</title>
    <url>/2018/10/27/fix-gitment/</url>
    <content><![CDATA[<p>æœ€è¿‘å‡ ä¸ªæœˆåšå®¢å¤–æŒ‚çš„gitmentè¯„è®ºè€æ˜¯æŒ‚ï¼Œä¹Ÿä¸€ç›´æ²¡æ—¶é—´ä¿®å¤ã€‚è¿™å‡ å¤©æƒ³åŠæ³•ä¿®å¥½äº†ã€‚å°±è¯´è¯´ä¿®å¤çš„è¿‡ç¨‹å§ã€‚</p>
<p>ä»æˆ‘å¼€å§‹ç”¨gitmentçš„è¯„è®ºç³»ç»Ÿï¼Œæ€»å…±å‡ºç°è¿‡ä¸¤æ¬¡é—®é¢˜ï¼š</p>
<h2 id="1-github-issue-labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶"><a href="#1-github-issue-labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶" class="headerlink" title="1. github-issue labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶"></a>1. github-issue labelçš„å­—ç¬¦é•¿åº¦é™åˆ¶</h2><p>è¿™æ¬¡å¯¼è‡´åŸæœ¬é»˜è®¤ä½¿ç”¨ç½‘é¡µurlåœ°å€åšlabelåˆå§‹åŒ–è¯„è®ºçš„æ–¹å¼æ— æ³•ä½¿ç”¨ï¼Œurlå¤ªé•¿äº†è¶…è¿‡äº†50ä¸ªå­—ç¬¦ã€‚è€Œä¹‹å‰å·²ç»åˆå§‹åŒ–å¥½çš„è¯„è®ºï¼ˆissueï¼‰ä¸æ”¶å½±å“ã€‚æ‰€ä»¥åæ¥æˆ‘æƒ³äº†ä¸ªåŠæ³•æ¥æ”¹ï¼Œå°±æ˜¯ç”¨æ—¶é—´æ¥åˆå§‹åŒ–ï¼Œå¹¶ä¸”å¯¹äºä¸ºäº†å…¼å®¹ä¹‹å‰çš„è¯„è®ºï¼ŒåŠ äº†æ—¶é—´åˆ¤æ–­ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> page_date = <span class="string">'&#123;&#123; page.date &#125;&#125;'</span>;</span><br><span class="line"><span class="keyword">var</span> id = <span class="built_in">window</span>.location.href;</span><br><span class="line"><span class="keyword">if</span>(page_date &gt; <span class="string">'2018-04-31 00:00:00 +0000'</span>)&#123;</span><br><span class="line">    id = page_date;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> gitment = <span class="keyword">new</span> Gitment(&#123;</span><br><span class="line">    id: id, <span class="comment">// å¯é€‰ã€‚é»˜è®¤ä¸º location.href</span></span><br><span class="line">    owner: <span class="string">'heropoo'</span>,</span><br><span class="line">    repo: <span class="string">'heropoo.github.io'</span>,</span><br><span class="line">    oauth: &#123;</span><br><span class="line">        client_id: <span class="string">'cccc'</span>,</span><br><span class="line">        client_secret: <span class="string">'xxxx'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">gitment.render(<span class="string">'container'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="2-gitment-ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨"><a href="#2-gitment-ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨" class="headerlink" title="2. gitment ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨"></a>2. gitment ä½œè€…æä¾›çš„oauthæˆæƒæœåŠ¡ä¸å¯ç”¨</h2><p>è¿™æ¬¡å¥½åƒæŒ‚äº†ä½¿ç”¨ä½œè€…æä¾›çš„jsçš„åšå®¢å…¨æŒ‚äº†ğŸ˜‚ã€‚ è§£å†³åŠæ³•å°±æ˜¯è‡ªå·±æ­å»ºæˆ–è€…ä½¿ç”¨åˆ«äººæ­å»ºçš„oauthæˆæƒæœåŠ¡äº†ã€‚ å¥½å§ï¼Œæ¢ä¸ªæˆæƒæœåŠ¡æ€»ç®—å¥½äº†ã€‚</p>
<h2 id="3-å‡çº§https"><a href="#3-å‡çº§https" class="headerlink" title="3. å‡çº§https"></a>3. å‡çº§https</h2><p>ç°åœ¨github-pageæä¾›å¼ºåˆ¶httpsã€‚å‡çº§ä¹‹åå‘ç°ä¹‹å‰å…¼å®¹çš„ä½¿ç”¨é¡µé¢urlåˆå§‹åŒ–çš„è¯„è®ºåˆä¸èƒ½ç”¨äº†ã€‚ ã„Ÿ( â–”, â–” )ã„<br>ä½†æ˜¯è¿˜å¾—ä¿®å˜›ã€‚åæ¥ä»”ç»†è§‚å¯Ÿäº†ä¸‹ï¼ŒåŸæ¥ä½œè€…æ˜¯ä½¿ç”¨<code>gitment</code>å’Œé¡µé¢jsä¸­è·å–çš„idæ¥åŒ¹é…å‡ºä¸€ä¸ªissueçš„ã€‚æ‰€ä»¥åªè¦å»githubä¿®æ”¹issue labelå°±å¯ä»¥äº†ã€‚æŠŠåŸæ¥å¾ˆé•¿çš„url labelæ”¹æˆç°åœ¨çš„çŸ­çš„ï¼Œæ¯”å¦‚åƒæˆ‘ä¸€æ ·ç”¨æ—¶é—´ã€‚ç„¶åé¡µé¢ä¸Šçš„å…¼å®¹çš„jsä¹Ÿå»æ‰å°±æå®šäº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> page_date = <span class="string">'&#123;&#123; page.date &#125;&#125;'</span>;</span><br><span class="line"><span class="comment">//var id = window.location.href;</span></span><br><span class="line"><span class="comment">//if(page_date &gt; '2018-04-31 00:00:00 +0000')&#123;</span></span><br><span class="line"><span class="keyword">var</span> id = page_date;</span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="keyword">var</span> gitment = <span class="keyword">new</span> Gitment(&#123;</span><br><span class="line">    id: id, <span class="comment">// å¯é€‰ã€‚é»˜è®¤ä¸º location.href</span></span><br><span class="line">    owner: <span class="string">'heropoo'</span>,</span><br><span class="line">    repo: <span class="string">'heropoo.github.io'</span>,</span><br><span class="line">    oauth: &#123;</span><br><span class="line">        client_id: <span class="string">'cccc'</span>,</span><br><span class="line">        client_secret: <span class="string">'xxxx'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">gitment.render(<span class="string">'container'</span>);</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œæå®Œæ”¶å·¥ã€‚</p>
]]></content>
      <categories>
        <category>github-issue</category>
      </categories>
      <tags>
        <tag>github-issue</tag>
        <tag>gitment</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…Jupyterç¬”è®°æœ¬</title>
    <url>/2018/11/02/jupyter/</url>
    <content><![CDATA[<p>å®‰è£…Jupyterç¬”è®°æœ¬ï¼Œåšä¸ªç¬”è®°</p>
<p>é€šè¿‡pipå®‰è£…</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo pip3 install jupyter</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºJupyteré»˜è®¤é…ç½®æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">jupyter notebook --generate-config</span><br></pre></td></tr></table></figure>
<p>ç”ŸæˆSHA1åŠ å¯†çš„å¯†é’¥ï¼Œå¦‚â€™sha1:XXXXXXâ€™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ipython</span><br><span class="line">--------------------------------------</span><br><span class="line">from notebook.auth import passwd</span><br><span class="line">passwd()</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim .jupyter/jupyter_notebook_config.py</span><br><span class="line">--------------------------------------</span><br><span class="line">c.NotebookApp.password = u<span class="string">'sha1:XXXXXX'</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œjupyter</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>

<p>å¯é€‰çš„è¿è¡Œå‚æ•°</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">jupyter notebook --ip=0.0.0.0 --no-browser --allow-root</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ <a href="http://localhost:8888" target="_blank" rel="noopener">http://localhost:8888</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>jupyter</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.7çš„JSONåŸºæœ¬æ“ä½œ</title>
    <url>/2018/11/18/mysql-json/</url>
    <content><![CDATA[<p>MySQLä»5.7ç‰ˆæœ¬å¼€å§‹å°±æ”¯æŒJSONæ ¼å¼çš„æ•°æ®ï¼Œæ“ä½œç”¨èµ·æ¥æŒºæ–¹ä¾¿çš„ã€‚</p>
<h3 id="å»ºè¡¨"><a href="#å»ºè¡¨" class="headerlink" title="å»ºè¡¨"></a>å»ºè¡¨</h3><p>åœ¨æ–°å»ºè¡¨æ—¶å­—æ®µç±»å‹å¯ä»¥ç›´æ¥è®¾ç½®ä¸ºjsonç±»å‹ï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ›å»ºä¸€å¼ è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE &#96;test_user&#96;(&#96;id&#96; INT PRIMARY KEY AUTO_INCREMENT, &#96;name&#96; VARCHAR(50) NOT NULL, &#96;info&#96; JSON);</span><br></pre></td></tr></table></figure>
<p>jsonç±»å‹å­—æ®µå¯ä»¥ä¸ºNULL</p>
<h3 id="æ’å…¥æ•°æ®ï¼š"><a href="#æ’å…¥æ•°æ®ï¼š" class="headerlink" title="æ’å…¥æ•°æ®ï¼š"></a>æ’å…¥æ•°æ®ï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; INSERT INTO test_user(&#96;name&#96;, &#96;info&#96;) VALUES(&#39;xiaoming&#39;,&#39;&#123;&quot;sex&quot;: 1, &quot;age&quot;: 18, &quot;nick_name&quot;: &quot;å°èŒ&quot;&#125;&#39;);</span><br></pre></td></tr></table></figure>
<p>jsonç±»å‹çš„å­—æ®µå¿…é¡»æ—¶ä¸€ä¸ªæœ‰æ•ˆçš„jsonå­—ç¬¦ä¸²</p>
<p>å¯ä»¥ä½¿ç”¨JSON_OBJECT()å‡½æ•°æ„é€ jsonå¯¹è±¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; INSERT INTO test_user(&#96;name&#96;, &#96;info&#96;) VALUES(&#39;xiaohua&#39;, JSON_OBJECT(&quot;sex&quot;, 0, &quot;age&quot;, 17));</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨JSON_ARRAY()å‡½æ•°æ„é€ jsonæ•°ç»„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; INSERT INTO test_user(&#96;name&#96;, &#96;info&#96;) VALUES(&#39;xiaozhang&#39;, JSON_OBJECT(&quot;sex&quot;, 1, &quot;age&quot;, 19, &quot;tag&quot;, JSON_ARRAY(3,5,90)));</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æŸ¥çœ‹<code>test_user</code>è¡¨ä¸­çš„æ•°æ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user;</span><br><span class="line">+----+-----------+--------------------------------------------+</span><br><span class="line">| id | name      | info                                       |</span><br><span class="line">+----+-----------+--------------------------------------------+</span><br><span class="line">|  1 | xiaoming  | &#123;&quot;age&quot;: 18, &quot;sex&quot;: 1, &quot;nick_name&quot;: &quot;å°èŒ&quot;&#125; |</span><br><span class="line">|  2 | xiaohua   | &#123;&quot;age&quot;: 17, &quot;sex&quot;: 0&#125;                      |</span><br><span class="line">|  3 | xiaozhang | &#123;&quot;age&quot;: 19, &quot;sex&quot;: 1, &quot;tag&quot;: [3, 5, 90]&#125;   |</span><br><span class="line">+----+-----------+--------------------------------------------+</span><br><span class="line">3 rows in set (0.04 sec)</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><p>è¡¨è¾¾å¼ï¼š å¯¹è±¡ä¸º<code>jsonåˆ—-&gt;&#39;$.é”®&#39;</code>, æ•°ç»„ä¸º<code>jsonåˆ—-&gt;&#39;$.é”®[index]&#39;</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, info-&gt;&#39;$.nick_name&#39;, info-&gt;&#39;$.sex&#39;, info-&gt;&#39;$.tag[0]&#39; from test_user;</span><br><span class="line">+-----------+---------------------+---------------+------------------+</span><br><span class="line">| name      | info-&gt;&#39;$.nick_name&#39; | info-&gt;&#39;$.sex&#39; | info-&gt;&#39;$.tag[0]&#39; |</span><br><span class="line">+-----------+---------------------+---------------+------------------+</span><br><span class="line">| xiaoming  | &quot;å°èŒ&quot;              | 1             | NULL             |</span><br><span class="line">| xiaohua   | NULL                | 0             | NULL             |</span><br><span class="line">| xiaozhang | NULL                | 1             | 3                |</span><br><span class="line">+-----------+---------------------+---------------+------------------+</span><br><span class="line">3 rows in set (0.04 sec)</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äºï¼šå¯¹è±¡ä¸º<code>JSON_EXTRACT(jsonåˆ— , &#39;$.é”®&#39;)</code>ï¼Œæ•°ç»„ä¸º<code>JSON_EXTRACT(jsonåˆ— , &#39;$.é”®[index]&#39;)</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, JSON_EXTRACT(info, &#39;$.nick_name&#39;), JSON_EXTRACT(info, &#39;$.sex&#39;), JSON_EXTRACT(info, &#39;$.tag[0]&#39;)  from test_user;</span><br><span class="line">+-----------+-----------------------------------+-----------------------------+--------------------------------+</span><br><span class="line">| name      | JSON_EXTRACT(info, &#39;$.nick_name&#39;) | JSON_EXTRACT(info, &#39;$.sex&#39;) | JSON_EXTRACT(info, &#39;$.tag[0]&#39;) |</span><br><span class="line">+-----------+-----------------------------------+-----------------------------+--------------------------------+</span><br><span class="line">| xiaoming  | &quot;å°èŒ&quot;                            | 1                           | NULL                           |</span><br><span class="line">| xiaohua   | NULL                              | 0                           | NULL                           |</span><br><span class="line">| xiaozhang | NULL                              | 1                           | 3                              |</span><br><span class="line">+-----------+-----------------------------------+-----------------------------+--------------------------------+</span><br><span class="line">3 rows in set (0.04 sec)</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡çœ‹åˆ°ä¸Šé¢<code>&quot;å°èŒ&quot;</code>æ˜¯å¸¦åŒå¼•å·çš„ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¯ä»¥ç”¨<code>JSON_UNQUOTE</code>å‡½æ•°å°†åŒå¼•å·å»æ‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, JSON_UNQUOTE(info-&gt;&#39;$.nick_name&#39;) from test_user where name&#x3D;&#39;xiaoming&#39;;</span><br><span class="line">+----------+-----------------------------------+</span><br><span class="line">| name     | JSON_UNQUOTE(info-&gt;&#39;$.nick_name&#39;) |</span><br><span class="line">+----------+-----------------------------------+</span><br><span class="line">| xiaoming | å°èŒ                              |</span><br><span class="line">+----------+-----------------------------------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ“ä½œç¬¦<code>-&gt;&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, info-&gt;&gt;&#39;$.nick_name&#39; from test_user where name&#x3D;&#39;xiaoming&#39;;</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| name     | info-&gt;&gt;&#39;$.nick_name&#39; |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| xiaoming | å°èŒ                 |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶å±æ€§ä¹Ÿå¯ä»¥ä½œä¸ºæŸ¥è¯¢æ¡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name, info-&gt;&gt;&#39;$.nick_name&#39; from test_user where info-&gt;&#39;$.nick_name&#39;&#x3D;&#39;å°èŒ&#39;;</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| name     | info-&gt;&gt;&#39;$.nick_name&#39; |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">| xiaoming | å°èŒ                 |</span><br><span class="line">+----------+----------------------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯ä»¥é€šè¿‡è™šæ‹Ÿåˆ—å¯¹JSONç±»å‹çš„æŒ‡å®šå±æ€§è¿›è¡Œå¿«é€ŸæŸ¥è¯¢ã€‚</p>
<p>åˆ›å»ºè™šæ‹Ÿåˆ—:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE &#96;test_user&#96; ADD &#96;nick_name&#96; VARCHAR(50) GENERATED ALWAYS AS (info-&gt;&gt;&#39;$.nick_name&#39;) VIRTUAL;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ç”¨æ“ä½œç¬¦<code>-&gt;&gt;</code></p>
<p>ä½¿ç”¨æ—¶å’Œæ™®é€šç±»å‹çš„åˆ—æŸ¥è¯¢æ˜¯ä¸€æ ·:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select name,nick_name from test_user where nick_name&#x3D;&#39;å°èŒ&#39;;</span><br><span class="line">+----------+-----------+</span><br><span class="line">| name     | nick_name |</span><br><span class="line">+----------+-----------+</span><br><span class="line">| xiaoming | å°èŒ      |</span><br><span class="line">+----------+-----------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><p>ä½¿ç”¨<code>JSON_INSERT()</code>æ’å…¥æ–°å€¼ï¼Œä½†ä¸ä¼šè¦†ç›–å·²ç»å­˜åœ¨çš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info &#x3D; JSON_INSERT(info, &#39;$.sex&#39;, 1, &#39;$.nick_name&#39;, &#39;å°èŠ±&#39;) where id&#x3D;2;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id&#x3D;2;</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">| id | name    | info                                       | nick_name |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">|  2 | xiaohua | &#123;&quot;age&quot;: 17, &quot;sex&quot;: 0, &quot;nick_name&quot;: &quot;å°èŠ±&quot;&#125; | å°èŠ±      |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>JSON_SET()</code>æ’å…¥æ–°å€¼ï¼Œå¹¶è¦†ç›–å·²ç»å­˜åœ¨çš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info &#x3D; JSON_SET(info, &#39;$.sex&#39;, 0, &#39;$.nick_name&#39;, &#39;å°å¼ &#39;) where id&#x3D;3;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id&#x3D;3;</span><br><span class="line">+----+-----------+---------------------------------------------------------------+-----------+</span><br><span class="line">| id | name      | info                                                          | nick_name |</span><br><span class="line">+----+-----------+---------------------------------------------------------------+-----------+</span><br><span class="line">|  3 | xiaozhang | &#123;&quot;age&quot;: 19, &quot;sex&quot;: 1, &quot;tag&quot;: [3, 5, 90], &quot;nick_name&quot;: &quot;å°å¼ &quot;&#125; | å°å¼       |</span><br><span class="line">+----+-----------+---------------------------------------------------------------+-----------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>JSON_REPLACE()</code>åªæ›¿æ¢å­˜åœ¨çš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info &#x3D; JSON_REPLACE(info, &#39;$.sex&#39;, 1, &#39;$.tag&#39;, &#39;[1,2,3]&#39;) where id&#x3D;2;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id&#x3D;2;</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">| id | name    | info                                       | nick_name |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">|  2 | xiaohua | &#123;&quot;age&quot;: 17, &quot;sex&quot;: 1, &quot;nick_name&quot;: &quot;å°èŠ±&quot;&#125; | å°èŠ±      |</span><br><span class="line">+----+---------+--------------------------------------------+-----------+</span><br><span class="line">1 row in set (0.06 sec)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°tagæ²¡æœ‰æ›´æ–°è¿›å»</p>
<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><p>ä½¿ç”¨<code>JSON_REMOVE()</code>åˆ é™¤JSONå…ƒç´ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE test_user SET info &#x3D; JSON_REMOVE(info, &#39;$.sex&#39;, &#39;$.tag&#39;) where id&#x3D;1;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸‹ç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test_user where id&#x3D;1;</span><br><span class="line">+----+----------+----------------------------------+-----------+</span><br><span class="line">| id | name     | info                             | nick_name |</span><br><span class="line">+----+----------+----------------------------------+-----------+</span><br><span class="line">|  1 | xiaoming | &#123;&quot;age&quot;: 18, &quot;nick_name&quot;: &quot;å°èŒ&quot;&#125; | å°èŒ      |</span><br><span class="line">+----+----------+----------------------------------+-----------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure>

<p>æœ€åä»MySQLçš„å®˜æ–¹ç½‘ç«™æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼š<a href="http://dev.mysql.com/doc/refman/5.7/en/json.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.7/en/json.html</a></p>
<p>ğŸ˜</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>JSON</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»SSHç§é’¥ä¸­é‡æ–°ç”Ÿæˆå…¬é’¥</title>
    <url>/2018/11/19/get-ssh-public-key-from-private-key/</url>
    <content><![CDATA[<p>ä»SSHç§é’¥ä¸­é‡æ–°ç”Ÿæˆå…¬é’¥</p>
<p>å‡å¦‚æˆ‘ä»¬çš„ç§é’¥æ˜¯<code>id_rsa</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -y -f id_rsa</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDdqNYfRhP/4Y1Kwr5/ZfRPbQkDEKQ9sLpGYex2bzXsPIXZmpgI4yUkLkQRCyvrMoZQKOcabb+GgnrYJvPR1rO/CVI9bfUw+MD1OFvnJUI2deATTeMj2hlY/IDSS1q3AG1ZEztFLizTiJqZvkjx/WPXR/b7ZIVV5DRIeaUMCfEjNIRD+spcJ5ALBuwGPO+4irAXIxgTxbYMDD2ASnpr6v7oSzc0N5ZhZ7rV1dk6hA/RowqYO7DwIvZtOAc55sv6pSUYG3RUJhnkzcmE5VTbyTMKB6O738np6DEw5soWdL1ITPgLE+uJcTt8tcOmPkBXv+45A4TuJ5ksONil8xhfVYG3</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç›´æ¥é‡å®šå‘åˆ°æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -y -f id_rsa &gt; id_rsa.pub</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SSH</category>
      </categories>
      <tags>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºPHP Composer ç‰ˆæœ¬å·å‰ç½®~ä¸^ç¬¦å·çš„åŒºåˆ«(è½¬)</title>
    <url>/2018/12/29/php-composer-version/</url>
    <content><![CDATA[<p><code>~</code>å’Œ<code>^</code>çš„æ„æ€å¾ˆæ¥è¿‘ï¼Œåœ¨<code>x.y</code>çš„æƒ…å†µä¸‹æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä»£è¡¨<code>x.y &lt;= ç‰ˆæœ¬å· &lt; (x+1).0</code>ã€‚ä½†æ˜¯åœ¨ç‰ˆæœ¬å·æ˜¯<code>x.y.z</code>çš„æƒ…å†µä¸‹æœ‰åŒºåˆ«ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li><p><code>~1.2.3</code> ä»£è¡¨ <code>1.2.3 &lt;= ç‰ˆæœ¬å· &lt; 1.3.0</code></p>
</li>
<li><p><code>^1.2.3</code> ä»£è¡¨ <code>1.2.3 &lt;= ç‰ˆæœ¬å· &lt; 2.0.0</code></p>
</li>
</ul>
<p>åŸæ–‡é“¾æ¥ï¼š <a href="https://www.cnblogs.com/hcpzhe/p/7909651.html" target="_blank" rel="noopener">https://www.cnblogs.com/hcpzhe/p/7909651.html</a></p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Composer</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPå¤šè¿›ç¨‹ä¹‹pcntlæ‰©å±•çš„ä½¿ç”¨</title>
    <url>/2019/01/02/php-pcntl/</url>
    <content><![CDATA[<p>PHPå®ç°å¤šè¿›ç¨‹çš„æ¨¡å—æ˜¯pcntlï¼Œè€Œä¸”åªæœ‰åœ¨linuxä¸‹æ‰ä½¿ç”¨è¿™ä¸ªæ‹“å±•ï¼Œä¸è¿‡ç°åœ¨æœåŠ¡å™¨éƒ½åŸºæœ¬ä½¿ç”¨linuxï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ç”¨èµ·æ¥çš„ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å¯ä»¥ç›´æ¥ä½¿ç”¨<code>pecl install pcntl</code>ï¼Œæˆ–è€…å»<code>https://pecl.php.net/</code>ä¸‹è½½æºç åŒ…æ‰‹åŠ¨ç¼–è¯‘å®‰è£…ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å…ˆä¸¾ä¸ªå®˜æ–¹çš„æ —å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$pid = pcntl_fork();</span><br><span class="line"><span class="comment">//çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä¼šæ‰§è¡Œä¸‹é¢ä»£ç </span></span><br><span class="line"><span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="comment">//é”™è¯¯å¤„ç†ï¼šåˆ›å»ºå­è¿›ç¨‹å¤±è´¥æ—¶è¿”å›-1.</span></span><br><span class="line">     <span class="keyword">die</span>(<span class="string">'could not fork'</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pid) &#123;</span><br><span class="line">     <span class="comment">//çˆ¶è¿›ç¨‹ä¼šå¾—åˆ°å­è¿›ç¨‹å·ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘</span></span><br><span class="line">     pcntl_wait($status); <span class="comment">//ç­‰å¾…å­è¿›ç¨‹ä¸­æ–­ï¼Œé˜²æ­¢å­è¿›ç¨‹æˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="comment">//å­è¿›ç¨‹å¾—åˆ°çš„$pidä¸º0, æ‰€ä»¥è¿™é‡Œæ˜¯å­è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åˆ°çš„å‡½æ•°:</p>
<ul>
<li><p><a href="https://secure.php.net/manual/zh/function.pcntl-fork.php" target="_blank" rel="noopener">pcntl_fork</a>åœ¨å½“å‰è¿›ç¨‹å½“å‰ä½ç½®äº§ç”Ÿåˆ†æ”¯ï¼ˆå­è¿›ç¨‹ï¼‰ã€‚forkæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ éƒ½ä»forkçš„ä½ç½®å¼€å§‹å‘ä¸‹ç»§ç»­æ‰§è¡Œï¼Œä¸åŒçš„æ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¾—åˆ°çš„forkè¿”å›å€¼ä¸ºå­è¿›ç¨‹ å·ï¼Œè€Œå­è¿›ç¨‹å¾—åˆ°çš„æ˜¯0ã€‚</p>
</li>
<li><p><a href="https://secure.php.net/manual/zh/function.pcntl-wait.php" target="_blank" rel="noopener">pcntl_wait</a> ç­‰å¾…æˆ–è¿”å›forkçš„å­è¿›ç¨‹çŠ¶æ€ã€‚è¿™ä¸ªå‡½æ•°ä¼šæŒ‚èµ·å½“å‰è¿›ç¨‹çš„æ‰§è¡Œç›´åˆ°ä¸€ä¸ªå­è¿›ç¨‹é€€å‡ºæˆ–æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·è¦æ±‚ä¸­æ–­å½“å‰è¿›ç¨‹æˆ–è°ƒç”¨ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªå­è¿›ç¨‹åœ¨è°ƒç”¨æ­¤å‡½æ•°æ—¶å·²ç»é€€å‡ºï¼ˆä¿—ç§°åƒµå°¸è¿›ç¨‹ï¼‰ï¼Œæ­¤å‡½æ•°ç«‹åˆ»è¿”å›ã€‚å­è¿›ç¨‹ä½¿ç”¨çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºå°†è¢«é‡Šæ”¾ã€‚</p>
</li>
</ul>
<p>å†æ¥ä¸ªç»å…¸æ —å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$children = []; <span class="comment">//å®šä¹‰ä¸€ä¸ªæ•°ç»„ç”¨æ¥å­˜å‚¨å­è¿›ç¨‹çš„pid</span></span><br><span class="line">$m = <span class="number">10</span>;    <span class="comment">//fork 10æ¬¡</span></span><br><span class="line"><span class="keyword">for</span> ($x = <span class="number">0</span>; $x &lt; $m; $x++) &#123;</span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'could not fork '</span>.$x);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($pid) &#123;    <span class="comment">//çˆ¶è¿›ç¨‹æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line">        $children[] = $pid;</span><br><span class="line">        printf(<span class="string">"Parent get child %d 's pid: %d\n"</span>, $x, $pid);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    <span class="comment">//å­è¿›ç¨‹æ‰§è¡Œçš„ä»£ç å—</span></span><br><span class="line">        $my_pid = posix_getpid();    <span class="comment">//å­è¿›ç¨‹è·å–è‡ªå·±çš„pid</span></span><br><span class="line">        <span class="comment">//å­è¿›ç¨‹å¾—åˆ°çš„$pidä¸º0, æ‰€ä»¥è¿™é‡Œæ˜¯å­è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘ã€‚</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Child $my_pid running...\n"</span>;</span><br><span class="line">        sleep(<span class="number">10</span>);        <span class="comment">//å­è¿›ç¨‹å¹²ç‚¹å•¥ è¿™é‡Œæ˜¯ç¡10ç§’</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"...Child $my_pid done\n"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);        <span class="comment">//å­è¿›ç¨‹æ‰§è¡Œç»“æŸexit</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(count($children) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span>($children <span class="keyword">as</span> $key =&gt; $pid) &#123;</span><br><span class="line">        $res = pcntl_waitpid($pid, $status, WNOHANG);    <span class="comment">//è·å–è¿”å›æŒ‡å®špidçš„è¿”å›çŠ¶æ€åŠ äº†ç¬¬äºŒä¸ªå‚æ•°éé˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span>($res == <span class="number">-1</span> || $res &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Parent get child $pid 's status: $status\n"</span>;</span><br><span class="line">            <span class="keyword">unset</span>($children[$key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1</span>);        <span class="comment">//æ¯ä¸€ç§’å»è½®è¯¢æ²¡æœ‰é€€å‡ºçš„å­è¿›ç¨‹çŠ¶æ€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€”- æœ€åæ›´æ–°äº 2019-03-27 19:04:55</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>pcntl</tag>
      </tags>
  </entry>
  <entry>
    <title>å®¹å™¨çš„å® å„¿AlpineLinuxçš„åŸºæœ¬ä½¿ç”¨</title>
    <url>/2019/01/17/alpinelinux/</url>
    <content><![CDATA[<p>ç°åœ¨dockerçš„å®¹å™¨æŠ€æœ¯å¾ˆæµè¡Œï¼Œå¯¹äºæˆ‘ä»¬è¿™ç§æ•´å¤©è¢«å„ç§ä¸‡æ¶çš„å¼€å‘ç¯å¢ƒå‘çš„å¼€å‘æ¥è¯´æ˜¯ä¸ªè§£æ”¾ã€‚ä½†æ˜¯å½“æˆ‘ä»¬åœ¨æ‹‰å–dockeré•œåƒçš„æ—¶å€™ï¼Œä¼šå‘ç°æ™®éåŸºäºdebianæˆ–è€…ubuntuçš„é•œåƒéƒ½æ˜¯ä½“ç§¯å¾ˆå¤§ï¼ŒåŠ¨è¾„å‡ åæˆ–è€…ä¸Šç™¾å…†ã€‚å½“ç„¶äº†dockeré•œåƒåœ¨æ„å»ºçš„æ—¶å€™ä¼šåˆ é™¤æ—­ä¸œæ— ç”¨çš„ä¸œè¥¿å¹¶ä¸”ä½¿ç”¨ç²¾ç®€ç³»ç»Ÿæ¨¡æ¿ã€‚å°½ç®¡è¿™æ ·åšè¿˜æ˜¯å¾ˆå¤§ï¼Œèµ·ç ä¹Ÿå¾—æœ‰ä¸ªå‡ åå…†å§ã€‚æ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªæœ¬èº«ä½“ç§¯å°±å°çš„æ“ä½œç³»ç»ŸåšåŸºç¡€æ¨¡æ¿æ¥æ„å»ºæ‰æ˜¯å…³é”®ã€‚AlpineLinuxæ˜¯ä¸€ä¸ªä½¿ç”¨busyboxçš„linuxæ“ä½œç³»ç»Ÿï¼Œè€Œä»–çš„ä½“ç§¯åªéœ€è¦4å…†å¤šã€‚æ‰€ä»¥å¯¹æˆ‘è¿™ç§å–œæ¬¢è½»é‡çº§çš„äººè¿˜è¯´ï¼Œè¿™çœŸæ˜¯å¥½ä¸œè¥¿å•Šï¼</p>
<p>å“ˆå“ˆ~åºŸè¯ä¸å¤šè¯´äº†ï¼Œè¯´è¯´è¿™ä¸ªç³»ç»Ÿçš„åŸºæœ¬ä½¿ç”¨å§</p>
<h2 id="è½¯ä»¶åŒ…ç®¡ç†"><a href="#è½¯ä»¶åŒ…ç®¡ç†" class="headerlink" title="è½¯ä»¶åŒ…ç®¡ç†"></a>è½¯ä»¶åŒ…ç®¡ç†</h2><p>æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apk update</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ„Ÿè§‰ç½‘é€Ÿå¾ˆæ…¢ï¼Œé‚£å¯ä»¥å…ˆæ¢ä¸ªä¸­å›½çš„æº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ä¸­ç§‘å¤§çš„æº é€Ÿåº¦æ æ çš„</span><br><span class="line">sed -i &#39;s&#x2F;dl-cdn.alpinelinux.org&#x2F;mirrors.ustc.edu.cn&#x2F;g&#39; &#x2F;etc&#x2F;apk&#x2F;repositories</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬ä»¥å®‰è£…nginxä¸ºä¾‹</p>
<p>å®‰è£…è½¯ä»¶åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apk add nginx</span><br></pre></td></tr></table></figure>

<p>å®‰è£…è½¯ä»¶åŒ…åˆ°æœ€æ–°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apk add --update nginx</span><br></pre></td></tr></table></figure>

<p>æŸ¥æ‰¾è½¯ä»¶åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apk search nginx</span><br></pre></td></tr></table></figure>

<p>å¸è½½è½¯ä»¶åŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apk del nginx</span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡ç®¡ç†"><a href="#æœåŠ¡ç®¡ç†" class="headerlink" title="æœåŠ¡ç®¡ç†"></a>æœåŠ¡ç®¡ç†</h2><p>å¯åŠ¨Nginx</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;nginx start</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ nginxåˆ°å¯åŠ¨æœåŠ¡ä¸­ï¼Œä¸‹æ¬¡å¼€æœºè‡ªåŠ¨è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rc-update add nginx</span><br></pre></td></tr></table></figure>

<p>æŠŠnginxä»å¯åŠ¨æœåŠ¡ä¸­ç§»é™¤ï¼Œä¸‹æ¬¡å¼€æœºä¸ä¼šè‡ªåŠ¨è¿è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rc-update del nginx</span><br></pre></td></tr></table></figure>

<h2 id="ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…"><a href="#ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…" class="headerlink" title="ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…"></a>ä¸€äº›ç½‘ç»œå·¥å…·æ‰€åœ¨è½¯ä»¶åŒ…</h2><pre><code>telnet  =&gt;  busybox-extras</code></pre>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>AlpineLinux</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨Rediså®ç°PHPå¼‚æ­¥é˜Ÿåˆ—</title>
    <url>/2019/03/29/php-queue/</url>
    <content><![CDATA[<p>æœ€è¿‘é¡¹ç›®ä¸­ç”¨åˆ°å¥½å¤šç”¨å¼‚æ­¥é˜Ÿåˆ—å¤„ç†çš„åå°ä»»åŠ¡ï¼Œæœ‰äº›å¿ƒå¾—ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p>
<p>ä¸‹é¢å¼•ç”¨ç™¾åº¦ç™¾ç§‘çš„å¯¹<a href="https://baike.baidu.com/item/%E9%98%9F%E5%88%97/14580481" target="_blank" rel="noopener">é˜Ÿåˆ—</a>çš„è§£é‡Šï¼š</p>
<blockquote>
<p>é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§è¡¨ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒåªå…è®¸åœ¨è¡¨çš„å‰ç«¯ï¼ˆfrontï¼‰è¿›è¡Œåˆ é™¤æ“ä½œï¼Œè€Œåœ¨è¡¨çš„åç«¯ï¼ˆrearï¼‰è¿›è¡Œæ’å…¥æ“ä½œï¼Œå’Œæ ˆä¸€æ ·ï¼Œé˜Ÿåˆ—æ˜¯ä¸€ç§æ“ä½œå—é™åˆ¶çš„çº¿æ€§è¡¨ã€‚è¿›è¡Œæ’å…¥æ“ä½œçš„ç«¯ç§°ä¸ºé˜Ÿå°¾ï¼Œè¿›è¡Œåˆ é™¤æ“ä½œçš„ç«¯ç§°ä¸ºé˜Ÿå¤´ã€‚<br>ç®€å•ç‚¹è®²å°±æ˜¯ï¼šå…ˆè¿›å…ˆå‡º</p>
</blockquote>
<p>è¦å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªèº«æœåŠ¡å™¨èµ„æºï¼Œå¯é€‰æ•°æ®åº“æˆ–è€…redisæˆ–è€…å…¶ä»–æ›´é«˜çº§çš„é˜Ÿåˆ—èµ„æºæ¥å®ç°ã€‚</p>
<p>ç®€å•å®ç°ï¼Œå¤§æ¦‚ä»£ç æ˜¯è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $items = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span><span class="params">($key, $value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;items[$key]) <span class="keyword">or</span> <span class="keyword">$this</span>-&gt;items[$key] = [];</span><br><span class="line">        <span class="keyword">return</span> array_push(<span class="keyword">$this</span>-&gt;items[$key], $value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     * return mixed $value æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pop</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;items[$key]) <span class="keyword">or</span> <span class="keyword">$this</span>-&gt;items[$key] = [];</span><br><span class="line">        <span class="keyword">return</span> array_shift(<span class="keyword">$this</span>-&gt;items[$key]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$queue = <span class="keyword">new</span> Queue();</span><br><span class="line"></span><br><span class="line">var_dump($queue-&gt;pop(<span class="string">'list_1'</span>));    <span class="comment">//è¾“å‡º NULL</span></span><br><span class="line"></span><br><span class="line">$queue-&gt;push(<span class="string">'list_1'</span>, <span class="string">'1'</span>);</span><br><span class="line">$queue-&gt;push(<span class="string">'list_1'</span>, <span class="string">'2'</span>);</span><br><span class="line">$queue-&gt;push(<span class="string">'list_1'</span>, <span class="string">'3'</span>);</span><br><span class="line"></span><br><span class="line">var_dump($queue-&gt;pop(<span class="string">'list_1'</span>));    <span class="comment">//è¾“å‡º string(1) "1"</span></span><br><span class="line">var_dump($queue-&gt;pop(<span class="string">'list_1'</span>));    <span class="comment">//è¾“å‡º string(1) "2"</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªç›´æ¥å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„é˜Ÿåˆ—ï¼Œåªèƒ½åœ¨ä¸€ä¸ªphpç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå­˜å‚¨çš„æ–¹å¼æ”¹æˆåˆ«çš„ï¼Œä¾‹å¦‚æ•°æ®åº“æˆ–è€…redisä»€ä¹ˆçš„ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨redisï¼Œç”¨åˆ°redisçš„æœ‰åºåˆ—è¡¨ï¼ˆlistï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisQueue</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $client;  <span class="comment">//è¿™é‡Œä½¿ç”¨äº†predisè¿™ä¸ªåº“è¿æ¥redis</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(\Predis\Client $client)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;client = $client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span><span class="params">($key, $value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;rpush($key, $value);  <span class="comment">//ä»å³è¾¹å…¥é˜Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed $value æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pop</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;lpop($key);   <span class="comment">//ä»å·¦è¾¹å–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­æµ‹è¯•ä¸‹ã€‚</p>
<p>å½“ç„¶äº†ï¼Œè¿˜æœ‰å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„é˜Ÿåˆ—è¦å»¶æ—¶å‡ºé˜Ÿï¼Œæˆ‘ä»¬å°±è¦ä½¿ç”¨redisçš„å¦å¤–ä¸¤ç§æ•°æ®ç±»å‹ï¼šæœ‰åºé›†åˆzsetå’Œå“ˆå¸Œhlist</p>
<p>æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisQueue</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span>  $client;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(\Predis\Client $client)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;client = $client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»é˜Ÿåˆ—å°¾éƒ¨æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $delay å»¶è¿Ÿå¤šå°‘ç§’</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed $value æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span><span class="params">($key, $value, $delay = null)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(is_null($delay))&#123;    <span class="comment">//ä¸ä½¿ç”¨å»¶è¿Ÿçš„æ—¶å€™è¿˜æ˜¯ä½¿ç”¨ä»¥å‰çš„rpushå…¥é˜Ÿ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;rpush($key, $value);</span><br><span class="line">        &#125;</span><br><span class="line">        $time = time() + $delay;</span><br><span class="line">        <span class="keyword">if</span>($time &gt; time())&#123;     <span class="comment">//è¿˜æœªåˆ°è¯¥å…¥é˜Ÿçš„æ—¶é—´æ—¶</span></span><br><span class="line">            $hash_key = md5(<span class="keyword">$this</span>-&gt;randString(<span class="number">16</span>).<span class="string">'_'</span>.time().<span class="string">'_'</span>.$value);       <span class="comment">//ç”Ÿæˆä¸€ä¸ªå”¯ä¸€key</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;transaction(<span class="function"><span class="keyword">function</span><span class="params">($tx)</span> <span class="title">use</span> <span class="params">($key, $time, $hash_key, $value)</span></span>&#123;   <span class="comment">//ä½¿ç”¨reidsäº‹åŠ¡</span></span><br><span class="line">                <span class="comment">/** <span class="doctag">@var</span> \Predis\Client $tx */</span></span><br><span class="line">                $tx-&gt;zadd($key.<span class="string">':zset'</span>, [   </span><br><span class="line">                    $hash_key=&gt;$time    <span class="comment">//è¿™é‡Œä»¥ç”Ÿæˆçš„å”¯ä¸€keyåš å¯¹è±¡member ä»¥timeåšåˆ†æ•°score</span></span><br><span class="line">                ]);</span><br><span class="line">                $tx-&gt;hset($key.<span class="string">':hlist'</span>, $hash_key, $value);    <span class="comment">//å¹¶ä¸”ä¿å­˜å”¯ä¸€keyå’Œå€¼çš„æ˜ å°„</span></span><br><span class="line">                $tx-&gt;expire($key.<span class="string">':zset'</span>, <span class="number">7</span>*<span class="number">86400</span>);     <span class="comment">//æœ‰æ•ˆæœŸ7å¤©</span></span><br><span class="line">                $tx-&gt;expire($key.<span class="string">':hlist'</span>, <span class="number">7</span>*<span class="number">86400</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $key å¯¹åˆ—åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">receive</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;getLock($key.<span class="string">':lock'</span>))&#123;   <span class="comment">//ä½¿ç”¨é”ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">            $keys = <span class="keyword">$this</span>-&gt;client-&gt;zrangebyscore($key.<span class="string">':zset'</span>,<span class="number">0</span>, time());   <span class="comment">//æŒ‰å½“å‰æ—¶é—´å–åˆ†æ•°å°äºç­‰äºå½“å‰æ—¶é—´çš„é›†åˆå…ƒç´ </span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">empty</span>($keys)) &#123;</span><br><span class="line">                $message_datas = <span class="keyword">$this</span>-&gt;client-&gt;hmget($key.<span class="string">':hlist'</span>, $keys);    <span class="comment">//é€šè¿‡è¿™äº›keyæ‹¿åˆ°å€¼</span></span><br><span class="line">                <span class="keyword">$this</span>-&gt;client-&gt;transaction(<span class="function"><span class="keyword">function</span><span class="params">($tx)</span> <span class="title">use</span> <span class="params">($key, $keys, $message_datas)</span></span>&#123; <span class="comment">//ç»§ç»­ä½¿ç”¨redisäº‹åŠ¡ä¿è¯æ•°æ®å®Œæ•´</span></span><br><span class="line">                    <span class="comment">/** <span class="doctag">@var</span> \Predis\Client $tx */</span></span><br><span class="line">                    <span class="keyword">foreach</span> ($message_datas <span class="keyword">as</span> $i =&gt; $message_data)&#123;</span><br><span class="line">                        $tx-&gt;rpush($key, $message_data); <span class="comment">//è¿™æ—¶å€™æ‰æ˜¯çœŸæ­£çš„å…¥é˜Ÿ</span></span><br><span class="line">                        $hash_key = $keys[$i];</span><br><span class="line">                        $tx-&gt;hdel($key.<span class="string">':hlist'</span>, $hash_key);    <span class="comment">//ä»hashåˆ—è¡¨åˆ é™¤å…ƒç´ </span></span><br><span class="line">                        $tx-&gt;zrem($key.<span class="string">':zset'</span>, $hash_key); <span class="comment">//ä»é›†åˆåˆ é™¤å…ƒç´ </span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;releaseLock($key.<span class="string">':lock'</span>);<span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;client-&gt;lpop($key); <span class="comment">//å‡ºé˜Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getLock</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $ret = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;client-&gt;incr($key) != <span class="number">1</span>)&#123;</span><br><span class="line">            $ret = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $ttl = <span class="keyword">$this</span>-&gt;client-&gt;ttl($key);</span><br><span class="line">        <span class="keyword">if</span>($ttl == <span class="number">-1</span>) &#123;    <span class="comment">//forever</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;client-&gt;expire($key, <span class="number">60</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">releaseLock</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;client-&gt;del($key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">randString</span><span class="params">($length)</span></span>&#123;</span><br><span class="line">        $str = <span class="string">''</span>;</span><br><span class="line">        $strPol = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"</span>;</span><br><span class="line">        $max = strlen($strPol) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">            $str .= $strPol[mt_rand(<span class="number">0</span>, $max)];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦çœ‹ä¸Šé¢å…¥é˜Ÿï¼ˆpushï¼‰å’Œå‡ºé˜Ÿï¼ˆreceiveï¼‰æ–¹æ³•ï¼Œæˆ‘ä»£ç å†™äº†è¯¦ç»†çš„æ³¨é‡Šã€‚</p>
]]></content>
      <categories>
        <category>Queue</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Queue</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>ç©è½¬ElasticSearchå…¨æ–‡æœç´¢</title>
    <url>/2019/04/09/elasticsearch/</url>
    <content><![CDATA[<p>ç©è½¬ElasticSearchå…¨æ–‡æœç´¢ï¼Œåšä¸ªç¬”è®°ã€‚</p>
<h2 id="è¿è¡ŒElasticSearchæœåŠ¡"><a href="#è¿è¡ŒElasticSearchæœåŠ¡" class="headerlink" title="è¿è¡ŒElasticSearchæœåŠ¡"></a>è¿è¡ŒElasticSearchæœåŠ¡</h2><p>ä¸ºäº†çœå»ç¹æ‚çš„å®‰è£…ï¼Œè·³è¿‡ä¸‡æ¶çš„ç¯å¢ƒï¼Œæˆ‘ä»¬ä½¿ç”¨Dockerå®¹å™¨æ¥è·‘ElasticSearchçš„æœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨å®˜æ–¹çš„<code>elasticsearch:5.6.16-alpine</code>ä½œä¸ºåŸºç¡€é•œåƒï¼Œå¦å¤–æ·»åŠ ä¸€ä¸ªä¸­æ–‡åˆ†è¯æ’ä»¶<code>elasticsearch-ik</code></p>
<p>æˆ‘ä»¬çš„Dockerfileå†…å®¹å¦‚ä¸‹ï¼Œå¾ˆç®€å•ï¼Œåªéœ€ä¸¤è¡Œå“Ÿï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM elasticsearch:5.6.16-alpine</span><br><span class="line">RUN elasticsearch-plugin install https:&#x2F;&#x2F;github.com&#x2F;medcl&#x2F;elasticsearch-analysis-ik&#x2F;releases&#x2F;download&#x2F;v5.6.16&#x2F;elasticsearch-analysis-ik-5.6.16.zip</span><br></pre></td></tr></table></figure>

<p>æ„å»ºé•œåƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker build -t heropoo&#x2F;elasticsearch-ik .</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå®¹å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type&#x3D;single-node&quot; heropoo&#x2F;elasticsearch-ik</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºElasticSearchæä¾›äº†REST APIï¼Œæˆ‘ä»¬ç›´æ¥å¯ä»¥ç”¨æµè§ˆå™¨è®¿é—® <a href="http://localhost:9200" target="_blank" rel="noopener">http://localhost:9200</a> çœ‹çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸ã€‚</p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>Elastic æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå…è®¸å¤šå°æœåŠ¡å™¨ååŒå·¥ä½œï¼Œæ¯å°æœåŠ¡å™¨å¯ä»¥è¿è¡Œå¤šä¸ª Elastic å®ä¾‹ã€‚å•ä¸ª Elastic å®ä¾‹ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ã€‚ä¸€ç»„èŠ‚ç‚¹æ„æˆä¸€ä¸ªé›†ç¾¤ï¼ˆclusterï¼‰ã€‚</p>
<h3 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h3><p>Elastic ä¼šç´¢å¼•æ‰€æœ‰å­—æ®µï¼Œç»è¿‡å¤„ç†åå†™å…¥ä¸€ä¸ªåå‘ç´¢å¼•ã€‚æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥æŸ¥æ‰¾è¯¥ç´¢å¼•ã€‚æ‰€ä»¥ï¼ŒElastic æ•°æ®ç®¡ç†çš„é¡¶å±‚å•ä½å°±å«åš Indexï¼ˆç´¢å¼•ï¼‰ã€‚</p>
<p>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ Index</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X GET &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;indices?v&#39;</span><br></pre></td></tr></table></figure>

<h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p>Index é‡Œé¢å•æ¡çš„è®°å½•ç§°ä¸º Documentï¼ˆæ–‡æ¡£ï¼‰ã€‚è®¸å¤šæ¡ Document æ„æˆäº†ä¸€ä¸ª Indexã€‚Document ä½¿ç”¨ JSON æ ¼å¼è¡¨ç¤ºã€‚<br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;å¼ ä¸‰&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;æ•°æ®åº“ç®¡ç†&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒä¸€ä¸ª Index é‡Œé¢çš„ Documentï¼Œä¸è¦æ±‚æœ‰ç›¸åŒçš„å­—æ®µç»“æ„ï¼Œä½†æ˜¯æœ€å¥½ä¿æŒç›¸åŒï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æœç´¢æ•ˆç‡ã€‚</p>
<h3 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h3><p>ä¸åŒçš„ Type åº”è¯¥æœ‰ç›¸ä¼¼çš„å­—æ®µç»“æ„ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œidå­—æ®µä¸èƒ½åœ¨è¿™ä¸ªç»„æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨å¦ä¸€ä¸ªç»„æ˜¯æ•°å€¼ã€‚è¿™æ˜¯ä¸å…³ç³»å‹æ•°æ®åº“çš„è¡¨çš„ä¸€ä¸ªåŒºåˆ«ã€‚æ€§è´¨å®Œå…¨ä¸åŒçš„æ•°æ®ï¼ˆæ¯”å¦‚productså’Œlogsï¼‰åº”è¯¥å­˜æˆä¸¤ä¸ª Indexï¼Œè€Œä¸æ˜¯ä¸€ä¸ª Index é‡Œé¢çš„ä¸¤ä¸ª Typeï¼ˆè™½ç„¶å¯ä»¥åšåˆ°ï¼‰ã€‚</p>
<p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åˆ—å‡ºæ¯ä¸ª Index æ‰€åŒ…å«çš„ Type</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl &#39;localhost:9200&#x2F;_mapping?pretty&#x3D;true&#39;</span><br></pre></td></tr></table></figure>
<p>prettyå‚æ•°æ˜¯ä¼˜åŒ–æ˜¾ç¤ºç»“æœæ˜“äºæŸ¥çœ‹</p>
<h2 id="Indexæ“ä½œ"><a href="#Indexæ“ä½œ" class="headerlink" title="Indexæ“ä½œ"></a>Indexæ“ä½œ</h2><h3 id="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰-Index"><a href="#æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰-Index" class="headerlink" title="æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ Index"></a>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ Index</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X GET &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;indices?v&#39;</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å»ºIndex"><a href="#æ–°å»ºIndex" class="headerlink" title="æ–°å»ºIndex"></a>æ–°å»ºIndex</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;weather&#39;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤Index"><a href="#åˆ é™¤Index" class="headerlink" title="åˆ é™¤Index"></a>åˆ é™¤Index</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X DELETE &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;weather&#39;</span><br></pre></td></tr></table></figure>

<h3 id="æ–°å»ºä¸€ä¸ª-Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ"><a href="#æ–°å»ºä¸€ä¸ª-Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ" class="headerlink" title="æ–°å»ºä¸€ä¸ª Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ"></a>æ–°å»ºä¸€ä¸ª Indexï¼ŒæŒ‡å®šéœ€è¦åˆ†è¯çš„å­—æ®µ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#39;localhost:9200&#x2F;accounts&#39; -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;person&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;user&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;title&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;desc&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ªåç§°ä¸ºaccountsçš„ Indexï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåç§°ä¸ºpersonçš„ Typeã€‚personæœ‰ä¸‰ä¸ªå­—æ®µ userã€titleã€desc è¿™ä¸‰ä¸ªå­—æ®µéƒ½æ˜¯ä¸­æ–‡ï¼Œè€Œä¸”ç±»å‹éƒ½æ˜¯æ–‡æœ¬ï¼ˆtextï¼‰ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šä¸­æ–‡åˆ†è¯å™¨ï¼Œä¸èƒ½ä½¿ç”¨é»˜è®¤çš„è‹±æ–‡åˆ†è¯å™¨ã€‚</p>
<h2 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h2><h3 id="æ–°å¢è®°å½•"><a href="#æ–°å¢è®°å½•" class="headerlink" title="æ–°å¢è®°å½•"></a>æ–°å¢è®°å½•</h3><p>å‘æŒ‡å®šçš„ /Index/Type å‘é€ PUT è¯·æ±‚ï¼Œå°±å¯ä»¥åœ¨ Index é‡Œé¢æ–°å¢ä¸€æ¡è®°å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;1&#39; -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;å¼ ä¸‰&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;æ•°æ®åº“ç®¡ç†&quot;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>æ–°å¢è®°å½•çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®š Idï¼Œè¿™æ—¶è¦æ”¹æˆ POST è¯·æ±‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X POST &#39;localhost:9200&#x2F;accounts&#x2F;person&#39; -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;æå››&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;è½¯ä»¶å·¥ç¨‹å¸ˆ&quot;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>å…¶å®PUTå°±æ˜¯å­˜åœ¨æ—¶ä¿®æ”¹ï¼Œä¸å­˜åœ¨æ—¶åˆ›å»ºã€‚</p>
<h3 id="æŸ¥çœ‹è®°å½•"><a href="#æŸ¥çœ‹è®°å½•" class="headerlink" title="æŸ¥çœ‹è®°å½•"></a>æŸ¥çœ‹è®°å½•</h3><p>å‘/Index/Type/Idå‘å‡º GET è¯·æ±‚ï¼Œå°±å¯ä»¥æŸ¥çœ‹è¿™æ¡è®°å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;1?pretty&#x3D;true&#39;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤è®°å½•"><a href="#åˆ é™¤è®°å½•" class="headerlink" title="åˆ é™¤è®°å½•"></a>åˆ é™¤è®°å½•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X DELETE &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;1&#39;</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h3><p>å‚è€ƒä¸Šé¢åˆ›å»ºæ“ä½œï¼Œç”¨PUTæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X PUT &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;1&#39; -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user&quot;: &quot;å¼ ä¸‰1&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;å·¥ç¨‹å¸ˆ1&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;æ•°æ®åº“ç®¡ç†1&quot;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®æŸ¥è¯¢"><a href="#æ•°æ®æŸ¥è¯¢" class="headerlink" title="æ•°æ®æŸ¥è¯¢"></a>æ•°æ®æŸ¥è¯¢</h2><h3 id="è¿”å›æ‰€æœ‰è®°å½•"><a href="#è¿”å›æ‰€æœ‰è®°å½•" class="headerlink" title="è¿”å›æ‰€æœ‰è®°å½•"></a>è¿”å›æ‰€æœ‰è®°å½•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;_search&#39;</span><br></pre></td></tr></table></figure>

<h3 id="å…¨æ–‡æœç´¢"><a href="#å…¨æ–‡æœç´¢" class="headerlink" title="å…¨æ–‡æœç´¢"></a>å…¨æ–‡æœç´¢</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;_search&#39;  -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;æ•°æ®åº“&quot; &#125;&#125;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>

<h3 id="é€»è¾‘è¿ç®—"><a href="#é€»è¾‘è¿ç®—" class="headerlink" title="é€»è¾‘è¿ç®—"></a>é€»è¾‘è¿ç®—</h3><p>å¦‚æœæœ‰å¤šä¸ªæœç´¢å…³é”®å­—ï¼Œ Elastic è®¤ä¸ºå®ƒä»¬æ˜¯orå…³ç³»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;_search&#39;  -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;è½¯ä»¶ ç³»ç»Ÿ&quot; &#125;&#125;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æ‰§è¡Œå¤šä¸ªå…³é”®è¯çš„andæœç´¢ï¼Œå¿…é¡»ä½¿ç”¨å¸ƒå°”æŸ¥è¯¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;_search&#39;  -d &#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;desc&quot;: &quot;è½¯ä»¶&quot; &#125; &#125;,</span><br><span class="line">        &#123; &quot;match&quot;: &#123; &quot;desc&quot;: &quot;ç³»ç»Ÿ&quot; &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>æå®š~</p>
<p>å‚è€ƒï¼š<a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a></p>
]]></content>
      <categories>
        <category>å…¨æ–‡æœç´¢</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Docker</tag>
        <tag>å…¨æ–‡æœç´¢</tag>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨nginx webé…ç½®</title>
    <url>/2019/05/22/nginx-web-conf/</url>
    <content><![CDATA[<p>å¸¸ç”¨nginxå¯¹äºwebé¡¹ç›®é…ç½®æ•´ç†ï¼Œåšä¸ªç¬”è®°ã€‚</p>
<h2 id="php-webé¡¹ç›®é…ç½®"><a href="#php-webé¡¹ç›®é…ç½®" class="headerlink" title="php webé¡¹ç›®é…ç½®"></a>php webé¡¹ç›®é…ç½®</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  listen [::]:80;</span><br><span class="line"></span><br><span class="line">  # è®¾ç½®ä¸Šä¼ æœ€å¤§ä¸º5MB</span><br><span class="line">  client_max_body_size 5m;</span><br><span class="line"></span><br><span class="line">  root &#x2F;srv&#x2F;www&#x2F;wechat&#x2F;public;</span><br><span class="line"></span><br><span class="line">  index index.html index.php;</span><br><span class="line"></span><br><span class="line">  server_name example.com;</span><br><span class="line"></span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # æ”¯æŒphp</span><br><span class="line">  location ~ \.php$ &#123;</span><br><span class="line">    # Check that the PHP script exists before passing it</span><br><span class="line">    try_files $fastcgi_script_name &#x3D;404;</span><br><span class="line"></span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line"></span><br><span class="line">    # With php-fpm (or other unix sockets):</span><br><span class="line">    fastcgi_pass unix:&#x2F;var&#x2F;run&#x2F;php&#x2F;php7.2-fpm.sock;</span><br><span class="line">    #  # With php-cgi (or other tcp sockets):</span><br><span class="line">    #  fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # deny access to .htaccess files, if Apache&#39;s document root</span><br><span class="line">  # concurs with nginx&#39;s one</span><br><span class="line">  #</span><br><span class="line">  location ~ &#x2F;\.ht &#123;</span><br><span class="line">    deny all;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="php-webé¡¹ç›®é…ç½®-æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£"><a href="#php-webé¡¹ç›®é…ç½®-æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£" class="headerlink" title="php webé¡¹ç›®é…ç½® æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£"></a>php webé¡¹ç›®é…ç½® æ”¯æŒlaravelã€symfonyã€Yii2å•å…¥å£</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    # First attempt to serve request as file, then</span><br><span class="line">    # as directory, then fall back to displaying a 404.</span><br><span class="line">    #try_files $uri $uri&#x2F; &#x3D;404;  # æ³¨é‡Šä¸Šé¢è¿™å¥ï¼Œä½¿ç”¨ä¸‹é¢è¿™å¥</span><br><span class="line">    try_files $uri $uri&#x2F; &#x2F;index.php?$query_string;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="php-webé¡¹ç›®é…ç½®-æ”¯æŒThinkPHP"><a href="#php-webé¡¹ç›®é…ç½®-æ”¯æŒThinkPHP" class="headerlink" title="php webé¡¹ç›®é…ç½® æ”¯æŒThinkPHP"></a>php webé¡¹ç›®é…ç½® æ”¯æŒThinkPHP</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  location ~ \.php$ &#123;</span><br><span class="line">    # regex to split $uri to $fastcgi_script_name and $fastcgi_path</span><br><span class="line">    fastcgi_split_path_info ^(.+\.php)(&#x2F;.+)$;</span><br><span class="line"></span><br><span class="line">    # Check that the PHP script exists before passing it</span><br><span class="line">    try_files $fastcgi_script_name &#x3D;404;</span><br><span class="line"></span><br><span class="line">    # Bypass the fact that try_files resets $fastcgi_path_info</span><br><span class="line">    # see: http:&#x2F;&#x2F;trac.nginx.org&#x2F;nginx&#x2F;ticket&#x2F;321</span><br><span class="line">    set $path_info $fastcgi_path_info;</span><br><span class="line">    fastcgi_param PATH_INFO $path_info;   # ThinkPHPä¾èµ–PATH_INFOè¿™ä¸ªç¯å¢ƒå˜é‡</span><br><span class="line"></span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line"></span><br><span class="line">    # With php-fpm (or other unix sockets):</span><br><span class="line">    fastcgi_pass unix:&#x2F;var&#x2F;run&#x2F;php&#x2F;php7.2-fpm.sock;</span><br><span class="line">    #  # With php-cgi (or other tcp sockets):</span><br><span class="line">    #  fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="php-webé¡¹ç›®é…ç½®-ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶"><a href="#php-webé¡¹ç›®é…ç½®-ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶" class="headerlink" title="php webé¡¹ç›®é…ç½® ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶"></a>php webé¡¹ç›®é…ç½® ç¦æ­¢è®¿é—®ä¸Šä¼ ç›®å½•ä¸‹çš„phpæ–‡ä»¶</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  # è¿™ä¸ªå—locationè¦æ”¾åœ¨ location ~ \.php$ ä¹‹å‰</span><br><span class="line">  location ~ ^&#x2F;uploads&#x2F;.*\.php$ &#123;     # æ‰€æœ‰&#x2F;uploadsæ–‡ä»¶ç›®å½•ä¸‹çš„.phpæ–‡ä»¶éƒ½è¢«ç¦æ­¢è®¿é—®</span><br><span class="line">    #deny all;  # è¿”å›403</span><br><span class="line">    return 404; #è¿”å›404</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºå¤§æ–‡ä»¶ä¸Šä¼ </title>
    <url>/2019/05/23/upload-large-file/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨åšè§†é¢‘ä¸Šä¼ ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ‡ç‰‡ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œåšä¸ªç¬”è®°ã€‚</p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ul>
<li>ä½¿ç”¨jsè¯»å–formè¡¨å•ä¸­é€‰æ‹©çš„fileï¼Œè®¡ç®—æ–‡ä»¶md5å€¼ï¼Œå¹¶ä¸Šä¼ md5å€¼åˆ°æœåŠ¡ç«¯ï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ä¸Šä¼ è¿‡ï¼ˆç±»ä¼¼ç§’ä¼ åŠŸèƒ½ï¼‰</li>
<li>è‹¥æ–‡ä»¶æœªä¸Šä¼ è¿‡ï¼ŒæŒ‰ç…§å…¶å¤§å°åˆ‡æˆ1MBå¤§å°çš„å—ï¼Œå°äº1MBçš„ä¸ç”¨åˆ‡</li>
<li>ç”¨ajaxå¼‚æ­¥æäº¤åˆ‡å¥½çš„å—ä¸Šä¼ è‡³æœåŠ¡ç«¯ï¼ˆä¸€ä¸ªå—ä¸€ä¸ªè¯·æ±‚ï¼Œä¸é˜»å¡ï¼Œå¤šçº¿ç¨‹ï¼‰</li>
<li>å½“ä¸Šä¼ å®Œæˆæ‰€æœ‰åˆ‡å—ï¼Œå‘èµ·ä¸€ä¸ªåˆå¹¶æ–‡ä»¶çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿›è¡Œå‰é¢ä¸Šä¼ çš„æ–‡ä»¶å—çš„åˆå¹¶ï¼Œåˆå¹¶å®Œæˆå³ä¸Šä¼ å®Œæˆã€‚</li>
</ul>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>jsè®¡ç®—æ–‡ä»¶md5ä½¿ç”¨<a href="https://www.npmjs.com/package/spark-md5" target="_blank" rel="noopener">spark-md5.js</a>,æ®è¯´è¿™ä¸ªåº“ä½¿ç”¨çš„æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„md5ç®—æ³•ã€‚</p>
<p>jså¯¹æ–‡ä»¶åˆ‡ç‰‡å¹¶ä½¿ç”¨ajaxä¸Šä¼ åˆ‡ç‰‡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">let</span> size = file.size; <span class="comment">//è·å–æ–‡ä»¶å¤§å°</span></span><br><span class="line"><span class="keyword">const</span> shardSize = <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// å—å¤§å°1MB</span></span><br><span class="line"><span class="keyword">let</span> shardCount = <span class="built_in">Math</span>.ceil(size/shardSize); <span class="comment">//å¯åˆ‡æˆçš„å—æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; shardCount; i++)&#123;</span><br><span class="line">  <span class="keyword">let</span> start = i * shardSize,</span><br><span class="line">      end = <span class="built_in">Math</span>.min(size, start + shardSize);</span><br><span class="line">  <span class="keyword">let</span> form = <span class="keyword">new</span> FormData();</span><br><span class="line">  form.append(<span class="string">'file'</span>, file.slice(start, end));  <span class="comment">//ç”¨sliceæ–¹æ³•åˆ‡ç‰‡</span></span><br><span class="line">  form.append(<span class="string">'size'</span>, end - start);</span><br><span class="line">  form.append(<span class="string">'name'</span>, name);</span><br><span class="line">  form.append(<span class="string">'total'</span>, shardCount);</span><br><span class="line">  form.append(<span class="string">'md5'</span>, file_md5); <span class="comment">//æ–‡ä»¶md5å€¼</span></span><br><span class="line">  form.append(<span class="string">'index'</span>, i);  <span class="comment">//ç¬¬å‡ å—</span></span><br><span class="line"></span><br><span class="line">  $.ajax(&#123;</span><br><span class="line">    url: <span class="string">'upload.php?type=shard'</span>,</span><br><span class="line">    type: <span class="string">"POST"</span>,</span><br><span class="line">    data: form,</span><br><span class="line">    <span class="comment">// async: false,     //æ˜¯å¦å¼‚æ­¥ä¸Šä¼ ï¼Œé»˜è®¤true</span></span><br><span class="line">    processData: <span class="literal">false</span>, <span class="comment">//å¾ˆé‡è¦ï¼Œå‘Šè¯‰jqueryä¸è¦å¯¹formè¿›è¡Œå¤„ç†</span></span><br><span class="line">    contentType: <span class="literal">false</span>, <span class="comment">//å¾ˆé‡è¦ï¼ŒæŒ‡å®šä¸ºfalseæ‰èƒ½å½¢æˆæ­£ç¡®çš„Content-Type</span></span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æˆåŠŸå›è°ƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>phpç«¯ä¿å­˜åˆ‡ç‰‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$path = <span class="keyword">__DIR__</span> . <span class="string">'/uploads'</span>;</span><br><span class="line">$file = $_FILES[<span class="string">'file'</span>];</span><br><span class="line">$total = $_POST[<span class="string">'total'</span>];</span><br><span class="line">$index = $_POST[<span class="string">'index'</span>];</span><br><span class="line">$size = $_POST[<span class="string">'size'</span>];</span><br><span class="line">$dst_file = $path . <span class="string">'/'</span> . $name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $index;  <span class="comment">// åˆ‡ç‰‡æ–‡ä»¶å­˜å‚¨çš„æ–‡ä»¶å </span></span><br><span class="line"><span class="keyword">if</span> ($file[<span class="string">"error"</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> json_encode([<span class="string">'code'</span>=&gt;<span class="number">400</span>, <span class="string">'msg'</span>=&gt;$file[<span class="string">"error"</span>]]);<span class="keyword">die</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $res = move_uploaded_file($file[<span class="string">'tmp_name'</span>], $dst_file);</span><br><span class="line">    <span class="keyword">if</span> ($res) &#123;</span><br><span class="line">        file_put_contents($dst_file . <span class="string">'.info'</span>, $size);  <span class="comment">// åˆ‡ç‰‡ä¸Šä¼ æˆåŠŸï¼Œå†™ä¸€ä¸ªä¿å­˜å…¶å¤§å°çš„æ–‡ä»¶ï¼Œåç»­åˆå¹¶æ˜¯æ ¡éªŒæ–‡ä»¶ç”¨çš„åˆ°</span></span><br><span class="line">        <span class="keyword">echo</span> json_encode([<span class="string">'code'</span>=&gt;<span class="number">200</span>, <span class="string">'msg'</span>=&gt;<span class="string">'shard ok'</span>]);<span class="keyword">die</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> json_encode([<span class="string">'code'</span>=&gt;<span class="number">400</span>, <span class="string">'msg'</span>=&gt;<span class="string">'shard move_uploaded_file error'</span>]);<span class="keyword">die</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>phpç«¯åˆå¹¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeFile</span><span class="params">($name, $total, &amp;$msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ ¡éªŒåˆ‡ç‰‡æ–‡ä»¶æ˜¯å¦éƒ½ä¸Šä¼ å®Œæˆï¼Œæ˜¯å¦å®Œæ•´</span></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $total; $i++) &#123; </span><br><span class="line">        <span class="keyword">if</span> (!file_exists($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i . <span class="string">'.info'</span>) || !file_exists($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i)) &#123;</span><br><span class="line">            $msg = <span class="string">"shard error $i"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (filesize($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i) != file_get_contents($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i . <span class="string">'.info'</span>)) &#123;</span><br><span class="line">            $msg = <span class="string">"shard size error $i"</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @unlink($name);</span><br><span class="line">    <span class="keyword">if</span> (file_exists($name . <span class="string">'.lock'</span>)) &#123;   <span class="comment">//åŠ é” é˜²æ­¢æœ‰å…¶ä»–è¿›ç¨‹å†™æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶æŸå</span></span><br><span class="line">        $msg = <span class="string">'on lock'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    touch($name . <span class="string">'.lock'</span>);</span><br><span class="line">    $file = fopen($name, <span class="string">'a+'</span>);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $total; $i++) &#123;   <span class="comment">//æŒ‰åˆ‡ç‰‡é¡ºåºå†™å…¥æ–‡ä»¶</span></span><br><span class="line">        $shardFile = fopen($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i, <span class="string">'r'</span>);</span><br><span class="line">        $shardData = fread($shardFile, filesize($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i));</span><br><span class="line">        fwrite($file, $shardData);</span><br><span class="line">        fclose($shardFile);</span><br><span class="line">        unlink($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i); </span><br><span class="line">        unlink($name . <span class="string">'-'</span> . $total . <span class="string">':'</span> . $i . <span class="string">'.info'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose($file);</span><br><span class="line">    unlink($name . <span class="string">'.lock'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä¹Ÿå†™å¥½äº†ä¸€ä¸ªdemoï¼Œ<a href="https://github.com/heropoo/just-code/tree/master/upload-large-file" target="_blank" rel="noopener">ä¼ é€é—¨</a></p>
<p>ä¸‹é¢æ˜¯è¿™ä¸ªdemoçš„æ•ˆæœå›¾ï¼š</p>
<p><img src="/assets/images/WX20190523-103939.png" alt="pic-0"><br><img src="/assets/images/WX20190523-104043.png" alt="pic-1"></p>
<p>è¿™ä¸ªdemoæœ‰äº›æ–¹é¢è¿˜ä¸å¤Ÿå®Œå–„ï¼Œåç»­æŒç»­å®Œå–„å§ï½</p>
]]></content>
      <categories>
        <category>JavaScript</category>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>JavaScript</tag>
        <tag>HTML5</tag>
        <tag>AJAX</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè½¯è¿æ¥å’Œç¡¬é“¾æ¥</title>
    <url>/2019/05/29/linux-symbolic-link/</url>
    <content><![CDATA[<p>Linuxè½¯è¿æ¥å’Œç¡¬é“¾æ¥ï¼Œä¸€ä¸ªç»å¸¸å‚»å‚»åˆ†ä¸æ¸…æ¥šçš„æ¦‚å¿µï¼Œç°åœ¨æˆ‘ä»¬ä»”ç»†ç†ä¸€ç†ã€‚</p>
<h3 id="1-Linuxé“¾æ¥æ¦‚å¿µ"><a href="#1-Linuxé“¾æ¥æ¦‚å¿µ" class="headerlink" title="1.Linuxé“¾æ¥æ¦‚å¿µ"></a>1.Linuxé“¾æ¥æ¦‚å¿µ</h3><p>Linuxé“¾æ¥åˆ†ä¸¤ç§ï¼Œä¸€ç§è¢«ç§°ä¸ºç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰ï¼Œå¦ä¸€ç§è¢«ç§°ä¸ºç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œlnå‘½ä»¤äº§ç”Ÿç¡¬é“¾æ¥ã€‚</p>
<ul>
<li>ã€ç¡¬è¿æ¥ã€‘</li>
</ul>
<p>ç¡¬è¿æ¥æŒ‡é€šè¿‡ç´¢å¼•èŠ‚ç‚¹æ¥è¿›è¡Œè¿æ¥ã€‚åœ¨Linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜åœ¨ç£ç›˜åˆ†åŒºä¸­çš„æ–‡ä»¶ä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹éƒ½ç»™å®ƒåˆ†é…ä¸€ä¸ªç¼–å·ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹å·(Inode Index)ã€‚åœ¨Linuxä¸­ï¼Œå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹æ˜¯å­˜åœ¨çš„ã€‚ä¸€èˆ¬è¿™ç§è¿æ¥å°±æ˜¯ç¡¬è¿æ¥ã€‚ç¡¬è¿æ¥çš„ä½œç”¨æ˜¯å…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªæœ‰æ•ˆè·¯å¾„åï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å»ºç«‹ç¡¬è¿æ¥åˆ°é‡è¦æ–‡ä»¶ï¼Œä»¥é˜²æ­¢â€œè¯¯åˆ â€çš„åŠŸèƒ½ã€‚å…¶åŸå› å¦‚ä¸Šæ‰€è¿°ï¼Œå› ä¸ºå¯¹åº”è¯¥ç›®å½•çš„ç´¢å¼•èŠ‚ç‚¹æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¿æ¥ã€‚åªåˆ é™¤ä¸€ä¸ªè¿æ¥å¹¶ä¸å½±å“ç´¢å¼•èŠ‚ç‚¹æœ¬èº«å’Œå…¶å®ƒçš„è¿æ¥ï¼Œåªæœ‰å½“æœ€åä¸€ä¸ªè¿æ¥è¢«åˆ é™¤åï¼Œæ–‡ä»¶çš„æ•°æ®å—åŠç›®å½•çš„è¿æ¥æ‰ä¼šè¢«é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–‡ä»¶çœŸæ­£åˆ é™¤çš„æ¡ä»¶æ˜¯ä¸ä¹‹ç›¸å…³çš„æ‰€æœ‰ç¡¬è¿æ¥æ–‡ä»¶å‡è¢«åˆ é™¤ã€‚</p>
<ul>
<li>ã€è½¯è¿æ¥ã€‘</li>
</ul>
<p>å¦å¤–ä¸€ç§è¿æ¥ç§°ä¹‹ä¸ºç¬¦å·è¿æ¥ï¼ˆSymbolic Linkï¼‰ï¼Œä¹Ÿå«è½¯è¿æ¥ã€‚è½¯é“¾æ¥æ–‡ä»¶æœ‰ç±»ä¼¼äºWindowsçš„å¿«æ·æ–¹å¼ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ã€‚åœ¨ç¬¦å·è¿æ¥ä¸­ï¼Œæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«çš„æœ‰å¦ä¸€æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ã€‚</p>
<h3 id="2-é€šè¿‡å®éªŒåŠ æ·±ç†è§£"><a href="#2-é€šè¿‡å®éªŒåŠ æ·±ç†è§£" class="headerlink" title="2.é€šè¿‡å®éªŒåŠ æ·±ç†è§£"></a>2.é€šè¿‡å®éªŒåŠ æ·±ç†è§£</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@Linux]$ touch f1 <span class="comment">#åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶f1</span></span><br><span class="line">[root@Linux]$ ln f1 f2 <span class="comment">#åˆ›å»ºf1çš„ä¸€ä¸ªç¡¬è¿æ¥æ–‡ä»¶f2</span></span><br><span class="line">[root@Linux]$ ln -s f1 f3 <span class="comment">#åˆ›å»ºf1çš„ä¸€ä¸ªç¬¦å·è¿æ¥æ–‡ä»¶f3</span></span><br><span class="line">[root@Linux]$ ls -li <span class="comment"># -iå‚æ•°æ˜¾ç¤ºæ–‡ä»¶çš„inodeèŠ‚ç‚¹ä¿¡æ¯</span></span><br><span class="line">total 0</span><br><span class="line">9797648 -rw-r--r-- 2 root root 0 Apr 21 08:11 f1</span><br><span class="line">9797648 -rw-r--r-- 2 root root 0 Apr 21 08:11 f2</span><br><span class="line">9797649 lrwxrwxrwx 1 root root 2 Apr 21 08:11 f3 -&gt; f1</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œç¡¬è¿æ¥æ–‡ä»¶f2ä¸åŸæ–‡ä»¶f1çš„inodeèŠ‚ç‚¹ç›¸åŒï¼Œå‡ä¸º9797648ï¼Œç„¶è€Œç¬¦å·è¿æ¥æ–‡ä»¶çš„inodeèŠ‚ç‚¹ä¸åŒã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@Linux]$ <span class="built_in">echo</span> <span class="string">"I am f1 file"</span> &gt;&gt;f1</span><br><span class="line">[root@Linux]$ cat f1</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ cat f2</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ cat f3</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ rm -f f1</span><br><span class="line">[root@Linux]$ cat f2</span><br><span class="line">I am f1 file</span><br><span class="line">[root@Linux]$ cat f3</span><br><span class="line">cat: f3: No such file or directory</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„æµ‹è¯•å¯ä»¥çœ‹å‡ºï¼šå½“åˆ é™¤åŸå§‹æ–‡ä»¶f1åï¼Œç¡¬è¿æ¥f2ä¸å—å½±å“ï¼Œä½†æ˜¯ç¬¦å·è¿æ¥f1æ–‡ä»¶æ— æ•ˆã€‚</p>
<h3 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3.æ€»ç»“"></a>3.æ€»ç»“</h3><p>ä¾æ­¤æ‚¨å¯ä»¥åšä¸€äº›ç›¸å…³çš„æµ‹è¯•ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å…¨éƒ¨ç»“è®ºï¼š</p>
<ul>
<li><p>1).åˆ é™¤ç¬¦å·è¿æ¥f3,å¯¹f1,f2æ— å½±å“ï¼›</p>
</li>
<li><p>2).åˆ é™¤ç¡¬è¿æ¥f2ï¼Œå¯¹f1,f3ä¹Ÿæ— å½±å“ï¼›</p>
</li>
<li><p>3).åˆ é™¤åŸæ–‡ä»¶f1ï¼Œå¯¹ç¡¬è¿æ¥f2æ²¡æœ‰å½±å“ï¼Œå¯¼è‡´ç¬¦å·è¿æ¥f3å¤±æ•ˆï¼›</p>
</li>
<li><p>4).åŒæ—¶åˆ é™¤åŸæ–‡ä»¶f1,ç¡¬è¿æ¥f2ï¼Œæ•´ä¸ªæ–‡ä»¶ä¼šçœŸæ­£çš„è¢«åˆ é™¤ã€‚</p>
</li>
</ul>
<p>æœ¬æ–‡æ‘˜è‡ªäº’è”ç½‘ï¼Œä¾µåˆ ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLæƒé™ç®¡ç†</title>
    <url>/2019/06/10/mysql-user/</url>
    <content><![CDATA[<p>MySQLä¸­çš„è´¦å·ä¸æƒé™ç®¡ç†</p>
<h3 id="æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†"><a href="#æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†" class="headerlink" title="æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†"></a>æƒé™ç³»ç»Ÿçš„å·¥ä½œåŸç†</h3><p>MySQLæƒé™ç³»ç»Ÿé€šè¿‡ä¸‹é¢ä¸¤ä¸ªé˜¶æ®µè¿›è¡Œè®¤è¯ï¼š</p>
<ol>
<li>å¯¹è¿æ¥çš„ç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ï¼Œåˆæ³•çš„ç”¨æˆ·é€šè¿‡è®¤è¯ã€ä¸åˆæ³•çš„ç”¨æˆ·æ‹’ç»è¿æ¥ã€‚</li>
<li>å¯¹é€šè¿‡è®¤è¯çš„åˆæ³•ç”¨æˆ·èµ‹äºˆç›¸åº”çš„æƒé™ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™äº›æƒé™èŒƒå›´å†…å¯¹æ•°æ®åº“åšç›¸åº”çš„æ“ä½œã€‚</li>
</ol>
<p>å¯¹äºèº«ä»½ï¼ŒMySQLæ˜¯é€šè¿‡<code>IPåœ°å€</code>å’Œ<code>ç”¨æˆ·å</code>è”åˆè¿›è¡Œç¡®è®¤çš„ï¼Œä¾‹å¦‚MySQLå®‰è£…é»˜è®¤åˆ›å»ºçš„ç”¨æˆ·<code>root@localhost</code>è¡¨ç¤ºç”¨æˆ·rootåªèƒ½ä»æœ¬åœ°ï¼ˆlocalhostï¼‰è¿›è¡Œè¿æ¥æ‰å¯ä»¥é€šè¿‡è®¤è¯ï¼Œæ­¤ç”¨æˆ·ä»å…¶ä»–ä»»ä½•ä¸»æœºå¯¹æ•°æ®åº“è¿›è¡Œçš„è¿æ¥éƒ½å°†è¢«æ‹’ç»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒæ ·çš„ä¸€ä¸ªç”¨æˆ·åï¼Œå¦‚æœæ¥è‡ªä¸åŒçš„IPåœ°å€ï¼Œåˆ™MySQLå°†å…¶è§†ä¸ºä¸åŒçš„ç”¨æˆ·ã€‚</p>
<p>MySQLçš„æƒé™è¡¨åœ¨æ•°æ®åº“å¯åŠ¨åœ°æ—¶å€™å°±è½½å…¥å†…å­˜ï¼Œå½“ç”¨æˆ·é€šè¿‡èº«ä»½è®¤è¯åï¼Œå°±åœ¨å†…å­˜ä¸­è¿›è¡Œç›¸åº”æƒé™çš„å­˜å–ï¼Œè¿™æ ·ï¼Œæ­¤ç”¨æˆ·å°±å¯ä»¥åœ¨æ•°æ®åº“ä¸­åšæƒé™èŒƒå›´å†…çš„å„ç§æ“ä½œäº†ã€‚</p>
<h3 id="æƒé™è¡¨"><a href="#æƒé™è¡¨" class="headerlink" title="æƒé™è¡¨"></a>æƒé™è¡¨</h3><p>ç³»ç»Ÿä¼šç”¨åˆ°åå«â€œmysqlâ€æ•°æ®åº“ï¼ˆå®‰è£…MySQLæ—¶è¢«åˆ›å»ºï¼‰ä¸­userè¡¨ä½œä¸ºæƒé™è¡¨</p>
<p>æˆ‘ä»¬çœ‹çœ‹userè¡¨çš„ç»“æ„ï¼ˆæ³¨ï¼šæœ¬æ–‡ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯MySQL5.7.25ç‰ˆæœ¬ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; desc user;</span><br><span class="line">+------------------------+-----------------------------------+------+-----+-----------------------+-------+</span><br><span class="line">| Field                  | Type                              | Null | Key | Default               | Extra |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+-----------------------+-------+</span><br><span class="line">| Host                   | char(60)                          | NO   | PRI |                       |       |</span><br><span class="line">| User                   | char(32)                          | NO   | PRI |                       |       |</span><br><span class="line">| Select_priv            | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Insert_priv            | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Update_priv            | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Delete_priv            | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_priv            | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Drop_priv              | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Reload_priv            | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Shutdown_priv          | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Process_priv           | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| File_priv              | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Grant_priv             | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| References_priv        | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Index_priv             | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Alter_priv             | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Show_db_priv           | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Super_priv             | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_tmp_table_priv  | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Lock_tables_priv       | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Execute_priv           | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Repl_slave_priv        | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Repl_client_priv       | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_view_priv       | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Show_view_priv         | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_routine_priv    | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Alter_routine_priv     | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_user_priv       | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Event_priv             | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Trigger_priv           | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| Create_tablespace_priv | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| ssl_type               | enum(&#39;&#39;,&#39;ANY&#39;,&#39;X509&#39;,&#39;SPECIFIED&#39;) | NO   |     |                       |       |</span><br><span class="line">| ssl_cipher             | blob                              | NO   |     | NULL                  |       |</span><br><span class="line">| x509_issuer            | blob                              | NO   |     | NULL                  |       |</span><br><span class="line">| x509_subject           | blob                              | NO   |     | NULL                  |       |</span><br><span class="line">| max_questions          | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| max_updates            | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| max_connections        | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| max_user_connections   | int(11) unsigned                  | NO   |     | 0                     |       |</span><br><span class="line">| plugin                 | char(64)                          | NO   |     | mysql_native_password |       |</span><br><span class="line">| authentication_string  | text                              | YES  |     | NULL                  |       |</span><br><span class="line">| password_expired       | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">| password_last_changed  | timestamp                         | YES  |     | NULL                  |       |</span><br><span class="line">| password_lifetime      | smallint(5) unsigned              | YES  |     | NULL                  |       |</span><br><span class="line">| account_locked         | enum(&#39;N&#39;,&#39;Y&#39;)                     | NO   |     | N                     |       |</span><br><span class="line">+------------------------+-----------------------------------+------+-----+-----------------------+-------+</span><br><span class="line">45 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>å½“ç”¨æˆ·è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼Œæƒé™è¡¨çš„å­˜å–è¿‡ç¨‹æœ‰ä»¥ä¸‹ç°ä¸ªé˜¶æ®µã€‚</p>
<ul>
<li>å…ˆä»userè¡¨ä¸­çš„<code>Host</code>ã€<code>User</code>ã€<code>authentication_string</code>(å¯†ç )ã€<code>password_expired</code>å’Œ<code>password_lifetime</code>è¿™å‡ ä¸ªå­—æ®µä¸­åˆ¤æ–­è¿æ¥çš„IPã€ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦å­˜åœ¨äºè¡¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™é€šè¿‡èº«ä»½éªŒè¯ï¼Œå¦åˆ™æ‹’ç»è¿æ¥ã€‚</li>
<li>å¦‚æœéªŒè¯é€šè¿‡ï¼Œå†é€šè¿‡ä»¥<code>_priv</code>ç»“å°¾çš„é‚£äº›æšä¸¾å­—æ®µï¼ˆè¿™äº›éƒ½æ˜¯ç”¨æˆ·çš„æƒé™å¼€å…³ï¼ˆY/Nï¼‰ï¼‰å¾—åˆ°ç”¨æˆ·æ‹¥æœ‰çš„æƒé™ã€‚</li>
</ul>
<h3 id="è´¦å·ç®¡ç†"><a href="#è´¦å·ç®¡ç†" class="headerlink" title="è´¦å·ç®¡ç†"></a>è´¦å·ç®¡ç†</h3><p>è´¦å·ç®¡ç†ä¸»è¦åŒ…æ‹¬è´¦å·çš„åˆ›å»ºã€æƒé™æ›´æ”¹å’Œè´¦å·çš„åˆ é™¤ã€‚ç”¨æˆ·è¿æ¥æ•°æ®åº“çš„ç¬¬ä¸€æ­¥éƒ½ä»è´¦å·åˆ›å»ºå¼€å§‹ã€‚</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç”¨æ¥åˆ›å»ºè´¦å·ï¼šä½¿ç”¨<code>GRANT</code>è¯­æ³•åˆ›å»ºæˆ–è€…ç›´æ¥æ“ä½œæˆæƒè¡¨ï¼Œä½†æ›´æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå› ä¸ºæ“ä½œç®€å•ï¼Œå‡ºé”™å‡ ç‡æ›´å°‘ã€‚</p>
<p>æˆ‘ä»¬ç”¨å‡ ä¸ªä¾‹å­æ¥è¯´æ˜å§ï¼š</p>
<ol>
<li><p>åˆ›å»ºç”¨æˆ·</p>
<p> åˆ›å»ºç”¨æˆ·tomï¼Œæƒé™ä¸ºå¯ä»¥åœ¨æ‰€æœ‰æ•°æ®åº“ä¸Šæ‰§è¡Œæ‰€æœ‰æƒé™ï¼Œåªèƒ½ä»æœ¬åœ°è¿›è¡Œè¿æ¥ã€‚</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO tom@localhost IDENTIFIED BY &#39;tompassword&#39; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure>
<p> å¦‚æœä½ æ‰§è¡Œè¿™ä¸ªè¯­å¥ç¢°åˆ°ä»¥ä¸‹é”™è¯¯ï¼š<code>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</code>ã€‚è¿™ä¸ªæ˜¯å¯†ç ç­–ç•¥çš„é—®é¢˜ï¼Œè¯·è®¾ç½®æ¯”è¾ƒå¤æ‚çš„å¯†ç ï¼Œæˆ–è€…ä¿®æ”¹å¯†ç ç­–ç•¥ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†è¯´äº†ã€‚</p>
<p> GRANTå‘½ä»¤è¯´æ˜ï¼š</p>
<blockquote>
<p><code>ALL PRIVILEGES</code>æ˜¯è¡¨ç¤ºæ‰€æœ‰æƒé™ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨selectã€updateç­‰æƒé™ã€‚</p>
</blockquote>
<blockquote>
<p><code>ON</code>ç”¨æ¥æŒ‡å®šæƒé™é’ˆå¯¹å“ªäº›åº“å’Œè¡¨ï¼Œæ ¼å¼æ˜¯<code>æ•°æ®åº“å.è¡¨å</code>ï¼Œè¿™é‡Œ<code>*.*</code>è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“å’Œæ‰€æœ‰è¡¨ã€‚</p>
</blockquote>
<blockquote>
<p><code>TO</code> è¡¨ç¤ºå°†æƒé™èµ‹äºˆæŸä¸ªç”¨æˆ·ã€‚<code>tom@localhost</code>ï¼Œè¡¨ç¤º<code>tom</code>ç”¨æˆ·ï¼Œ<code>@</code>åé¢æ¥é™åˆ¶çš„ä¸»æœºï¼Œå¯ä»¥æ˜¯<code>IP</code>ã€<code>IPæ®µ</code>ã€<code>åŸŸå</code>ä»¥åŠ<code>%</code>ï¼Œ<code>%</code>è¡¨ç¤ºä»»ä½•åœ°æ–¹ã€‚æ³¨æ„ï¼šè¿™é‡Œ%æœ‰çš„ç‰ˆæœ¬ä¸åŒ…æ‹¬æœ¬åœ°ï¼Œä»¥å‰ç¢°åˆ°è¿‡ç»™æŸä¸ªç”¨æˆ·è®¾ç½®äº†%å…è®¸ä»»ä½•åœ°æ–¹ç™»å½•ï¼Œä½†æ˜¯åœ¨æœ¬åœ°ç™»å½•ä¸äº†ï¼Œè¿™ä¸ªå’Œç‰ˆæœ¬æœ‰å…³ç³»ï¼Œé‡åˆ°è¿™ä¸ªé—®é¢˜å†åŠ ä¸€ä¸ªlocalhostçš„ç”¨æˆ·å°±å¯ä»¥äº†ã€‚</p>
</blockquote>
<blockquote>
<p><code>IDENTIFIED BY</code> æŒ‡å®šç”¨æˆ·çš„ç™»å½•å¯†ç ï¼Œ è¿™é‡Œ<code>&#39;tompassword&#39;</code>å°±æ˜¯ç”¨æˆ·tomçš„å¯†ç ã€‚</p>
</blockquote>
<blockquote>
<p><code>WITH GRANT OPTION</code> è¿™ä¸ªé€‰é¡¹è¡¨ç¤ºè¯¥ç”¨æˆ·å¯ä»¥å°†è‡ªå·±æ‹¥æœ‰çš„æƒé™æˆæƒç»™åˆ«äººã€‚æ³¨æ„ï¼šç»å¸¸æœ‰äººåœ¨åˆ›å»ºæ“ä½œç”¨æˆ·çš„æ—¶å€™ä¸æŒ‡å®šWITH GRANT OPTIONé€‰é¡¹å¯¼è‡´åæ¥è¯¥ç”¨æˆ·ä¸èƒ½ä½¿ç”¨GRANTå‘½ä»¤åˆ›å»ºç”¨æˆ·æˆ–è€…ç»™å…¶å®ƒç”¨æˆ·æˆæƒã€‚</p>
</blockquote>
<p> å¤‡æ³¨ï¼šå¯ä»¥ä½¿ç”¨<code>GRANT</code>é‡å¤ç»™ç”¨æˆ·æ·»åŠ æƒé™ï¼Œæƒé™å åŠ ï¼Œæ¯”å¦‚ä½ å…ˆç»™ç”¨æˆ·æ·»åŠ ä¸€ä¸ªselectæƒé™ï¼Œç„¶ååˆç»™ç”¨æˆ·æ·»åŠ ä¸€ä¸ªinsertæƒé™ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å°±åŒæ—¶æ‹¥æœ‰äº†selectå’Œinsertæƒé™ã€‚</p>
<p> ä½¿ç”¨<code>GRANT</code>æ“ä½œç”¨æˆ·æƒé™ä¹‹åï¼Œå†ä½¿ç”¨<code>FLUSH PRIVILEGES</code>å‘½ä»¤æ¥åˆ·æ–°æƒé™ä½¿å…¶ç«‹å³ç”Ÿæ•ˆ</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ç”¨æˆ·çš„æƒé™</p>
<p> ç›´æ¥ä½¿ç”¨<code>SHOW GRANTS</code>é»˜è®¤æŸ¥çœ‹<code>root@localhost</code>çš„æƒé™</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW GRANTS;</span><br><span class="line">+---------------------------------------------------------------------+</span><br><span class="line">| Grants for root@localhost                                           |</span><br><span class="line">+---------------------------------------------------------------------+</span><br><span class="line">| GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;localhost&#39; WITH GRANT OPTION |</span><br><span class="line">| GRANT PROXY ON &#39;&#39;@&#39;&#39; TO &#39;root&#39;@&#39;localhost&#39; WITH GRANT OPTION        |</span><br><span class="line">+---------------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p> æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æƒé™</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW GRANTS FOR tom@localhost;</span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line">| Grants for tom@localhost                                           |</span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line">| GRANT ALL PRIVILEGES ON *.* TO &#39;tom&#39;@&#39;localhost&#39; WITH GRANT OPTION |</span><br><span class="line">+----------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ”¶å›æƒé™</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; REVOKE DELETE ON *.* FROM &#39;tom&#39;@&#39;localhost&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹ç”¨æˆ·è´¦æˆ·é‡å‘½å</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; RENAME USER tom@localhost to jerry@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ é™¤ç”¨æˆ·</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; DROP USER jerry@localhost;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹å’Œé‡ç½®å¯†ç </p>
<ul>
<li><p>ç”¨<code>SET PASSWORD</code>å‘½ä»¤ä¿®æ”¹å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET PASSWORD FOR root@localhost &#x3D; PASSWORD(&#39;123456&#39;);</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç›´æ¥ä¿®æ”¹userè¡¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; UPDATE user SET authentication_string&#x3D;PASSWORD(&#39;123456root&#39;) WHERE user&#x3D;&#39;root&#39; and host&#x3D;&#39;localhost&#39;;</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 1</span><br><span class="line"></span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨æœªç™»å½•mysqlçš„æƒ…å†µä¸‹ç”¨mysqladminå‘½ä»¤ä¿®æ”¹å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mysqladmin -uroot -p123456root password 123321</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ä¸¢å¤±rootå¯†ç çš„æ—¶å€™<br>å…³é—­mysqlæœåŠ¡ï¼ˆæ ¹æ®ä½ è‡ªå·±çš„æ“ä½œç³»ç»Ÿè‡ªè¡Œå…³é—­ï¼‰ï¼Œç„¶åè·³è¿‡æƒé™è®¤è¯å¯åŠ¨mysqlæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mysqld_safe --skip-grant-tables &amp;</span><br></pre></td></tr></table></figure>

<p>æ— å¯†ç ç™»é™†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mysql -uroot</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ä¹‹åä½¿ç”¨ä¸Šé¢ç›´æ¥ä¿®æ”¹userè¡¨çš„æ–¹æ³•ä¿®æ”¹rootç”¨æˆ·çš„å¯†ç </p>
<p>æœ€åæ€æ‰<code>mysqld_safe</code>å’Œ<code>mysqld</code>çš„è¿›ç¨‹</p>
<p>é‡æ–°å¯åŠ¨mysqlæœåŠ¡ï¼Œç”¨æ–°çš„å¯†ç ç™»é™†å§ã€‚</p>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜³å…‰æ˜åªšï¼Œæ—¶å…‰é™å¥½</title>
    <url>/2019/06/15/good-morning/</url>
    <content><![CDATA[<p>èµ·äº†ä¸ªè€æ—©ï¼Œå»ç»ƒè½¦ï¼Œæœ¬æ¥ç¡ä¸å¥½ï¼Œè¿˜æœ‰ç‚¹æƒ…ç»ªï¼Œåœ¨ä¸‹è½¦è¿‡æ¡¥æ—¶çªç„¶å‘ç°æ—©ä¸Šçš„é˜³å…‰æ ¼å¤–çš„å¥½ã€‚</p>
<p><img src="/assets/images/20190619210216.jpg" alt="example-pic"></p>
<p><img src="/assets/images/20190619210339.jpg" alt="example-pic"></p>
<p><img src="/assets/images/20190619210745.jpg" alt="example-pic"></p>
]]></content>
      <categories>
        <category>å²æœˆé™å¥½</category>
      </categories>
      <tags>
        <tag>å²æœˆé™å¥½</tag>
      </tags>
  </entry>
  <entry>
    <title>SSHä½¿ç”¨å¯†ç è‡ªåŠ¨ç™»å½•è„šæœ¬</title>
    <url>/2019/08/28/ssh-autologin/</url>
    <content><![CDATA[<p>åˆ†äº«ä¸€ä¸ªsshä½¿ç”¨å¯†ç ç™»å½•çš„è„šæœ¬</p>
<p>å†™ä¸ªè„šæœ¬<code>autologin.sh</code>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect -f</span></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> host [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> password [lindex <span class="variable">$argv</span> 2]</span><br><span class="line"><span class="built_in">set</span> timeout -1</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$host</span></span><br><span class="line">expect <span class="string">"password:*"</span></span><br><span class="line">send <span class="string">"<span class="variable">$password</span>\r"</span></span><br><span class="line">interact</span><br><span class="line">expect eof</span><br></pre></td></tr></table></figure>

<p>å¹¶ç»™è¿™ä¸ªè„šæœ¬å¯æ‰§è¡Œæƒé™</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chmod +x ./autologin.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨æ–¹æ³•ï¼š<br>å‡å¦‚å¹³æ—¶ä½¿ç”¨<code>ssh root@127.0.0.1</code>,ç„¶åè¾“å…¥å¯†ç <code>123456</code>ç™»å½•</li>
</ul>
<p>ç°åœ¨ç”¨è¿™ä¸ªè„šæœ¬å°±æ˜¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./autologin.sh root 127.0.0.1 123456</span><br></pre></td></tr></table></figure>

<p>æŒºæ–¹ä¾¿çš„å§ï½</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨å‘½ä»¤æ“ä½œVirtualBox</title>
    <url>/2019/12/17/virtual-box-manager/</url>
    <content><![CDATA[<p>æœ€è¿‘ä¸€æ—¶å¤´è„‘å‘çƒ­æ‰¾äº†æœ¬æ±‡ç¼–çš„ä¹¦åœ¨å•ƒï¼Œä¹¦ä¸­æ˜¯ä½¿ç”¨æ‰‹åŠ¨æ“ä½œ<code>VirtualBox</code>æŒ‚è½½ç¡¬ç›˜è°ƒè¯•çš„ä¸å¤ªæ–¹ä¾¿ï¼Œé‚ä½¿ç”¨å‘½ä»¤æèµ·ï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚</p>
<p>VirtualBoxæ˜¯ä¸ªå…è´¹çš„è™šæ‹Ÿæœºè½¯ä»¶ï¼Œä¸è®ºlinuxã€winã€macä¸‹éƒ½å¯ä»¥ç›´æ¥å®‰è£…ä½¿ç”¨ã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒä½¿ç”¨å‘½ä»¤æ§åˆ¶ï¼Œæ„Ÿè§‰è¿™ä¸€ç‚¹ç»™äº†å¼€å‘è€…æ— é™çš„æƒ³è±¡ç©ºé—´å’Œåˆ›é€ åŠ›ã€‚</p>
<p>è€Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ä¸€ä¸ª<code>VBoxManage</code>å‘½ä»¤å®Œæˆçš„ã€‚ç°åœ¨æ•´ç†ä¸€ä¸‹ï¼š</p>
<p>ä¸‹é¢æˆ‘ä»¬ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code>learnAsm</code>çš„è™šæ‹Ÿæœºä¸ºä¾‹ï¼Œå±•ç¤ºä¸‹åŸºæœ¬çš„æ“ä½œã€‚</p>
<h2 id="åˆ›å»ºè™šæ‹Ÿæœº"><a href="#åˆ›å»ºè™šæ‹Ÿæœº" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿæœº"></a>åˆ›å»ºè™šæ‹Ÿæœº</h2><p>åˆ›å»ºå¹¶æ³¨å†Œ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage createvm --name learnAsm --register</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤è™šæ‹Ÿæœº"><a href="#åˆ é™¤è™šæ‹Ÿæœº" class="headerlink" title="åˆ é™¤è™šæ‹Ÿæœº"></a>åˆ é™¤è™šæ‹Ÿæœº</h2><p>ï¼ˆï¼ï¼ï¼ä¼šåˆ é™¤æ‰€æœ‰è™šæ‹Ÿç¡¬ç›˜ï¼Œè°¨æ…æ“ä½œï¼ï¼ï¼ï¼‰</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage unregistervm --delete learnAsm</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨å†Œè™šæ‹Ÿæœº"><a href="#æ³¨å†Œè™šæ‹Ÿæœº" class="headerlink" title="æ³¨å†Œè™šæ‹Ÿæœº"></a>æ³¨å†Œè™šæ‹Ÿæœº</h2><p>å‡å¦‚ä½ æ³¨é”€äº†ï¼Œæˆ–è€…ä»åˆ«äººé‚£é‡Œå¤åˆ¶æ¥çš„è™šæ‹Ÿæœºæ–‡ä»¶ï¼Œå¯ä»¥é‡æ–°æ³¨å†Œå®ƒ</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage registervm &lt;your vms path&gt;/learnAsm.vbox</span><br></pre></td></tr></table></figure>

<h2 id="ä»…æ³¨é”€è™šæ‹Ÿæœº"><a href="#ä»…æ³¨é”€è™šæ‹Ÿæœº" class="headerlink" title="ä»…æ³¨é”€è™šæ‹Ÿæœº"></a>ä»…æ³¨é”€è™šæ‹Ÿæœº</h2><p>æ³¨é”€ä¹‹åVirtualBoxåˆ—è¡¨ä¸­æ˜¾ç¤ºäº†</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage unregistervm learnAsm</span><br></pre></td></tr></table></figure>

<h2 id="åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº"><a href="#åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº" class="headerlink" title="åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº"></a>åˆ—å‡ºå·²æœ‰çš„è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage list vms</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu-64"><a href="#è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu-64" class="headerlink" title="è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu_64"></a>è®¾ç½®ç³»ç»Ÿç±»å‹Ubuntu_64</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm --ostype Ubuntu_64</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®å†…å­˜å¤§å°1G"><a href="#è®¾ç½®å†…å­˜å¤§å°1G" class="headerlink" title="è®¾ç½®å†…å­˜å¤§å°1G"></a>è®¾ç½®å†…å­˜å¤§å°1G</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm --memory 1024 <span class="comment">#å•ä½MB</span></span><br></pre></td></tr></table></figure>

<h2 id="å»ºç«‹è™šæ‹Ÿç£ç›˜"><a href="#å»ºç«‹è™šæ‹Ÿç£ç›˜" class="headerlink" title="å»ºç«‹è™šæ‹Ÿç£ç›˜"></a>å»ºç«‹è™šæ‹Ÿç£ç›˜</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage createmedium --filename HDD10G.vdi --size 10000 <span class="comment">#å•ä½MB</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA"><a href="#åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA" class="headerlink" title="åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA"></a>åˆ›å»ºå­˜å‚¨æ§åˆ¶å™¨IDEã€SATA</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage storagectl learnAsm --name IDE --add ide --controller PIIX4 --bootable on</span><br><span class="line">VBoxManage storagectl learnAsm --name SATA --add sata --controller IntelAhci --bootable on</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç§»é™¤</span></span><br><span class="line">VBoxManage storagectl learnAsm --name IDE --remove</span><br><span class="line">VBoxManage storagectl learnAsm --name SATA --remove</span><br></pre></td></tr></table></figure>

<h2 id="å…³è”è™šæ‹Ÿæœºç£ç›˜"><a href="#å…³è”è™šæ‹Ÿæœºç£ç›˜" class="headerlink" title="å…³è”è™šæ‹Ÿæœºç£ç›˜"></a>å…³è”è™šæ‹Ÿæœºç£ç›˜</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage storageattach learnAsm --storagectl SATA --port 0 --device 0 --<span class="built_in">type</span> hdd --medium HDD10G.vdi</span><br><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 0 --device 0 --<span class="built_in">type</span> hdd --medium HDD10G.vdi</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é™¤å…³è”</span></span><br><span class="line">VBoxManage storageattach learnAsm --storagectl SATA --port 0 --device 0 --<span class="built_in">type</span> hdd --medium none</span><br><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 0 --device 0 --<span class="built_in">type</span> hdd --medium none</span><br></pre></td></tr></table></figure>

<h2 id="å¢åŠ å…‰é©±"><a href="#å¢åŠ å…‰é©±" class="headerlink" title="å¢åŠ å…‰é©±"></a>å¢åŠ å…‰é©±</h2><p>å…³è”å…‰ç›˜é•œåƒæ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 1 --device 0 --<span class="built_in">type</span> dvddrive --medium ubuntu.iso</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£é™¤å…³è”ï¼š</span></span><br><span class="line">VBoxManage storageattach learnAsm --storagectl IDE --port 1 --device 0 --<span class="built_in">type</span> dvddrive --medium none</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰"><a href="#è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰" class="headerlink" title="è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰"></a>è®¾ç½®CPUæ•°é‡ï¼ˆå¿…é¡»æ‰“å¼€IOAPICï¼‰</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm  --ioapic on</span><br><span class="line">VBoxManage modifyvm learnAsm --cpus 4</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®CPUè¿è¡Œå³°å€¼"><a href="#è®¾ç½®CPUè¿è¡Œå³°å€¼" class="headerlink" title="è®¾ç½®CPUè¿è¡Œå³°å€¼"></a>è®¾ç½®CPUè¿è¡Œå³°å€¼</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage modifyvm learnAsm --cpuexecutioncap 80</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯"><a href="#æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯"></a>æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage -v</span><br><span class="line">VBoxManage list vms  <span class="comment">#åˆ—å‡ºè™šæ‹Ÿæœº</span></span><br><span class="line">VBoxManage list runningvms  <span class="comment">#åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœº</span></span><br><span class="line">VBoxManage showvminfo learnAsm <span class="comment">#æ˜¾ç¤ºè™šæ‹ŸæœºlearnAsmçš„ä¿¡æ¯</span></span><br><span class="line">VBoxManage list hdds <span class="comment">#åˆ—å‡ºç¡¬ç›˜</span></span><br><span class="line">VBoxManage list dvds <span class="comment">#åˆ—å‡ºdvd</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨è™šæ‹Ÿæœº"><a href="#å¯åŠ¨è™šæ‹Ÿæœº" class="headerlink" title="å¯åŠ¨è™šæ‹Ÿæœº"></a>å¯åŠ¨è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage startvm learnAsm --<span class="built_in">type</span> headless <span class="comment">#--type headlesså‚æ•°æ˜¯æ— çª—å£é™é»˜å¯åŠ¨</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº"><a href="#ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº" class="headerlink" title="ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº"></a>ä¿æŒçŠ¶æ€å…³é—­è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage controlvm learnAsm savestate</span><br></pre></td></tr></table></figure>

<h2 id="æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€"><a href="#æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€" class="headerlink" title="æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€"></a>æ”¾å¼ƒå·²ä¿å­˜çš„çŠ¶æ€</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage discardstate learnAsm</span><br></pre></td></tr></table></figure>

<h2 id="æ–­ç”µå…³é—­è™šæ‹Ÿæœº"><a href="#æ–­ç”µå…³é—­è™šæ‹Ÿæœº" class="headerlink" title="æ–­ç”µå…³é—­è™šæ‹Ÿæœº"></a>æ–­ç”µå…³é—­è™šæ‹Ÿæœº</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage controlvm learnAsm poweroff</span><br></pre></td></tr></table></figure>

<h2 id="æ­£å¸¸å…³æœº-ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€"><a href="#æ­£å¸¸å…³æœº-ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€" class="headerlink" title="æ­£å¸¸å…³æœº[ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€]"></a>æ­£å¸¸å…³æœº[ä¸èƒ½å½»åº•å…³é—­ï¼Œä¸€ç›´å¤„äºstoppingçŠ¶æ€]</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VBoxManage controlvm learnAsm acpipowerbutton</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨çš„å¤§æ¦‚å°±è¿™äº›å§ã€‚</p>
<p>æˆ‘æ˜¯é…åˆMakefileä½¿ç”¨çš„ï¼Œè¿™é‡Œé™„ä¸Šï¼Œå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">ASM_FILE=c05_mbr.asm</span><br><span class="line">DIST_PATH=.</span><br><span class="line">VHD_FILE=<span class="variable">$(DIST_PATH)</span>/boot.vhd</span><br><span class="line">VM_NAME=learn-asm</span><br><span class="line"></span><br><span class="line"><span class="variable">$(VHD_FILE)</span>: mbr.bin</span><br><span class="line">	-rm <span class="variable">$(VHD_FILE)</span></span><br><span class="line">	VBoxManage convertfromraw mbr.bin <span class="variable">$(VHD_FILE)</span> --format VHD --variant Fixed</span><br><span class="line"></span><br><span class="line"><span class="section">mbr.bin: <span class="variable">$(ASM_FILE)</span></span></span><br><span class="line">	nasm -f bin <span class="variable">$(ASM_FILE)</span> -o mbr.bin -l mbr.list</span><br><span class="line"></span><br><span class="line"><span class="section">run: <span class="variable">$(VHD_FILE)</span> change-vm-vhd</span></span><br><span class="line">	VBoxManage startvm <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line"><span class="section">stop:</span></span><br><span class="line">	-VBoxManage controlvm <span class="variable">$(VM_NAME)</span> savestate</span><br><span class="line">	-VBoxManage discardstate <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line"><span class="section">create-vm: <span class="variable">$(VHD_FILE)</span></span></span><br><span class="line">	VBoxManage createvm --name <span class="variable">$(VM_NAME)</span> --register</span><br><span class="line">	VBoxManage modifyvm <span class="variable">$(VM_NAME)</span> --memory 64</span><br><span class="line">	VBoxManage storagectl <span class="variable">$(VM_NAME)</span> --name SATA --add sata --controller IntelAhci --bootable on</span><br><span class="line"></span><br><span class="line"><span class="section">change-vm-vhd: <span class="variable">$(VHD_FILE)</span></span></span><br><span class="line">	cp <span class="variable">$(VHD_FILE)</span> <span class="variable">$(VHD_FILE)</span>.bk</span><br><span class="line">	-VBoxManage discardstate <span class="variable">$(VM_NAME)</span></span><br><span class="line">	-VBoxManage storageattach <span class="variable">$(VM_NAME)</span> --storagectl SATA --port 0 --device 0 --type hdd --medium none</span><br><span class="line">	-VBoxManage closemedium disk <span class="variable">$(VHD_FILE)</span> --delete <span class="comment"># å› ä¸ºç¡¬ç›˜æ˜¯é‡æ–°åˆ é™¤åˆ›å»ºçš„ï¼Œuuidä¹Ÿå˜äº†ï¼Œç›´æ¥æŒ‚è½½æ— æ³•å¯åŠ¨ã€‚æ‰€ä»¥è¿™é‡Œå…ˆåˆ é™¤ï¼Œå†æŒ‚è½½ã€‚</span></span><br><span class="line">	mv <span class="variable">$(VHD_FILE)</span>.bk <span class="variable">$(VHD_FILE)</span></span><br><span class="line">	VBoxManage storageattach <span class="variable">$(VM_NAME)</span> --storagectl SATA --port 0 --device 0 --type hdd --medium <span class="variable">$(VHD_FILE)</span></span><br><span class="line"></span><br><span class="line"><span class="section">unregister-vm:</span></span><br><span class="line">	-VBoxManage unregistervm <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line"><span class="section">delete-vm:</span></span><br><span class="line">	-VBoxManage unregistervm --delete <span class="variable">$(VM_NAME)</span></span><br><span class="line"></span><br><span class="line">clean :</span><br><span class="line">	-rm -rf *.vhd *.bin *.list</span><br></pre></td></tr></table></figure>


<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://www.jianshu.com/p/a2d4840341fb" target="_blank" rel="noopener">https://www.jianshu.com/p/a2d4840341fb</a></li>
<li><a href="https://www.virtualbox.org/manual/" target="_blank" rel="noopener">https://www.virtualbox.org/manual/</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>è™šæ‹ŸåŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨ç½‘é¡µä¸Šä½¿ç”¨MathJaxæ¸²æŸ“LaTexæ ¼å¼æ•°å­¦å…¬å¼</title>
    <url>/2019/05/27/math-jax/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨çœ‹ä¸€äº›æœºå™¨å­¦ä¹ ç®—æ³•çš„ä¸œè¥¿ï¼Œç”¨åˆ°å¥½å¤šæ•°å­¦å…¬å¼ï¼Œå‘ç°æœ‰ä¸ªå¾ˆå¼ºå¤§çš„jsåº“å¯ä»¥å®Œç¾çš„æ¸²æŸ“LaTexæ ¼å¼æ•°å­¦å…¬å¼ï¼Œå€¼å¾—æ¨èä¸‹ã€‚</p>
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<h2 id="ä½¿ç”¨æ–¹æ³•ï¼š"><a href="#ä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a>ä½¿ç”¨æ–¹æ³•ï¼š</h2><p>åœ¨ä½ çš„htmlæ¨¡ç‰ˆä¸­å¼•å…¥è¿™ä¸ªjs</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;&#x2F;&#x2F;cdn.mathjax.org&#x2F;mathjax&#x2F;latest&#x2F;MathJax.js?config&#x3D;TeX-AMS-MML_HTMLorMML&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>å†™å‡ ä¸ªå…¬å¼æµ‹è¯•ä¸‹ï¼š</p>
<p>è´¨èƒ½æ–¹ç¨‹æ˜¯$$E=mc^2$$</p>
<p>ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$$E&#x3D;mc^2$$</span><br></pre></td></tr></table></figure>

<p>k-meansç®—æ³•çš„ä»£ä»·å‡½æ•°:<br>$$J(c,\mu )=\sum_{i=1}^{k}\left | x^{(i)}-\mu _{c^{(i)}} \right |^{2}$$</p>
<p>ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$$J(c,\mu )&#x3D;\sum_&#123;i&#x3D;1&#125;^&#123;k&#125;\left \| x^&#123;(i)&#125;-\mu _&#123;c^&#123;(i)&#125;&#125; \right \|^&#123;2&#125;$$</span><br></pre></td></tr></table></figure>

<p>æ„Ÿå—æ•ˆæœè¿˜å¯ä»¥ğŸ˜‰ğŸ˜›ğŸ˜›</p>
<p>å†é™„é€ä¸€ä¸ªåœ¨çº¿çš„å…¬å¼ç¼–è¾‘å™¨<a href="https://www.codecogs.com/latex/eqneditor.php" target="_blank" rel="noopener">https://www.codecogs.com/latex/eqneditor.php</a></p>
]]></content>
      <categories>
        <category>æ•°å­¦</category>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>æ•°å­¦</tag>
        <tag>MathJax</tag>
        <tag>LaTex</tag>
      </tags>
  </entry>
  <entry>
    <title>èŠä¸€èŠphpçš„åºåˆ—åŒ–</title>
    <url>/2020/03/31/php-serialize/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨é¡¹ç›®ç§ç»å¸¸ç”¨<code>redis</code>ç¼“å­˜æ•°æ®åºåˆ—åŒ–çš„æ•°æ®ï¼Œæœ‰ç‚¹å¿ƒå¾—ï¼Œæˆ‘ä»¬ç°åœ¨èŠä¸€èŠphpçš„åºåˆ—åŒ–æ“ä½œ</p>
<p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„æ˜¯ä¸€å¯¹å­¦åˆ—åŒ–å‡½æ•°<code>serialize</code>å’Œ<code>unserialize</code>ã€‚å¸¸ç”¨çš„æ“ä½œå¾ˆç®€å•ï¼Œå°±æ˜¯ï¼š</p>
<ol>
<li><p>ä½¿ç”¨<code>serialize</code>åºåˆ—åŒ–æˆ‘ä»¬çš„å˜é‡ä½¿å…¶å˜æˆå­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$data = [<span class="string">'id'</span>=&gt;<span class="number">1</span>, <span class="string">'name'</span>=&gt;<span class="string">'xiaoming'</span>, <span class="string">'sex'</span>=&gt;<span class="number">1</span>];</span><br><span class="line">$dataString = serialize($data);</span><br><span class="line"><span class="comment">// echo $dataString</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™äº›å­—ç¬¦ä¸²å¯ä»¥ç¦»çº¿ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…ä¸€äº›ç¼“å­˜ä»‹è´¨ä¸­ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// example</span></span><br><span class="line">$redis-&gt;set(<span class="string">'test_user1'</span>, $dataString);</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ä½¿ç”¨çš„æ—¶å€™ä»ä¸Šé¢çš„ä¸€äº›ä»‹è´¨ä¸­å–å‡ºå­—ç¬¦ä¸²ï¼Œç„¶åè°ƒç”¨<code>unserialize</code>ååºåˆ—åŒ–åˆ°å˜é‡ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$dataString = $redis-&gt;get(<span class="string">'test_user1'</span>);</span><br><span class="line">$data = unserialize($dataString);</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>æˆ‘ä»¬å†çœ‹çœ‹phpå„ç§æ•°æ®ç±»å‹åºåˆ—åŒ–ä¹‹åçš„ç»“æœå¦‚ä½•ï¼š</p>
<ol>
<li><p>æ•´å‹int</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º i:1;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ®ç‚¹å‹float</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="number">1.1</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º d:1.1;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¸ƒå°”bool</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º b:1;</span></span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º b:0;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç©ºå€¼null</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º n:1;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å­—ç¬¦ä¸²string</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize(<span class="string">'1'</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º s:1:"1";</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ•°ç»„array</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> serialize([]); <span class="comment">//ç©ºæ•°ç»„</span></span><br><span class="line"><span class="comment">// è¾“å‡º a:0:&#123;&#125;</span></span><br><span class="line"><span class="keyword">echo</span> serialize([<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// è¾“å‡º a:1:&#123;i:0;i:1;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯¹è±¡object</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;&#125;</span><br><span class="line">$a = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="comment">// è¾“å‡º O:1:"A":0:&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $name;</span><br><span class="line">&#125;</span><br><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br><span class="line"><span class="comment">// è¾“å‡º O:1:"B":1:&#123;s:4:"name";N;&#125;</span></span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">new</span> stdClass();</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br><span class="line"><span class="comment">// è¾“å‡º O:8:"stdClass":0:&#123;&#125;</span></span><br><span class="line"></span><br><span class="line">$d = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">echo</span> serialize($d);</span><br><span class="line"><span class="comment">// è¾“å‡ºæŠ¥é”™ PHP Warning:  Uncaught Exception: Serialization of 'Closure' is not allowed</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>èµ„æºresource</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$f = fopen(<span class="string">"/tmp/t.txt"</span>, <span class="string">"r"</span>);  <span class="comment">//å‡å¦‚æ–‡ä»¶/tmp/t.txtå­˜åœ¨</span></span><br><span class="line"><span class="keyword">echo</span> serialize($f);</span><br><span class="line">fclose($f);</span><br><span class="line"><span class="comment">// è¾“å‡º todo</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹æ¥phpçš„serializeå‡½æ•°æ— æ³•åºåˆ—åŒ–ä¸€ä¸ªåŒ¿åå‡½æ•°</p>
<p>ï¼ˆæœªå®Œå¾…ç»­ï¼‰</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>åºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>VSCodeç©è½¬è¿œç¨‹å¼€å‘ä¹‹Dockerå®¹å™¨</title>
    <url>/2020/04/13/vscode-remote-container/</url>
    <content><![CDATA[<p>å‰äº›æ—¥å­è¯•äº†ä¸‹vscodeé…åˆdockerå®¹å™¨å¼€å‘ï¼Œä½“éªŒç‰¹åˆ«ä¸é”™ï¼Œæ¯”æ•²dockerå‘½ä»¤èˆ’çˆ½å¤šäº†ã€‚åœ¨è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚</p>
<h2 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h2><p>é¦–å…ˆä½ çš„æœºå™¨ä¸Šå®‰è£…å¥½dockerå’Œvscodeä¸¤ä¸ªåŸºæœ¬è½¯ä»¶å¹¶å¯åŠ¨å®ƒä¿©ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼è¿›å…¥ä¸»é¢˜ï¼š</p>
<p>åœ¨vscodeçš„æ‰©å±•æ ä¸­æœç´¢ï¼šRemoteæˆ–è€…Containersï¼Œæ‰¾åˆ°<code>Remote - Containers</code>è¿™ä¸ªæ’ä»¶ï¼Œå¹¶ä¸”å®‰è£…å¥½ï¼Œå¦‚å›¾ï¼š<br><img src="/assets/images/20200413221730.png" alt="install"></p>
<h2 id="é¡¹ç›®é…ç½®æ„å»º"><a href="#é¡¹ç›®é…ç½®æ„å»º" class="headerlink" title="é¡¹ç›®é…ç½®æ„å»º"></a>é¡¹ç›®é…ç½®æ„å»º</h2><p>è¿™é‡Œæ‹¿ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€phpæ¥åšä¸ªç¤ºèŒƒï¼Œä½¿ç”¨gitæ‹‰å–å¾®è½¯å®˜æ–¹æä¾›çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;vscode-remote-try-php.git</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨vscodeæ‰“å¼€è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ .devcontainer</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Dockerfile</span><br><span class="line">â”‚Â Â  â””â”€â”€ devcontainer.json</span><br><span class="line">â”œâ”€â”€ .vscode</span><br><span class="line">â”‚Â Â  â””â”€â”€ launch.json</span><br><span class="line">â””â”€â”€ index.php</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç†Ÿæ‚‰çš„<code>Dockerfile</code>ï¼Œ å¤§æ¦‚çœ‹çœ‹å®ƒçš„å†…å®¹ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> php:<span class="number">7</span>-cli</span><br><span class="line"></span><br><span class="line"><span class="comment"># Avoid warnings by switching to noninteractive</span></span><br><span class="line"><span class="keyword">ENV</span> DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line"><span class="comment"># This Dockerfile adds a non-root user with sudo access. Use the "remoteUser"</span></span><br><span class="line"><span class="comment"># property in devcontainer.json to use it. On Linux, the container user's GID/UIDs</span></span><br><span class="line"><span class="comment"># will be updated to match your local UID/GID (when using the dockerFile property).</span></span><br><span class="line"><span class="comment"># See https://aka.ms/vscode-remote/containers/non-root-user for details.</span></span><br><span class="line"><span class="keyword">ARG</span> USERNAME=vscode  <span class="comment"># vscodeç”¨æˆ·</span></span><br><span class="line"><span class="keyword">ARG</span> USER_UID=<span class="number">1000</span></span><br><span class="line"><span class="keyword">ARG</span> USER_GID=$USER_UID</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/security.debian.org/mirrors.aliyun.com/g'</span> /etc/apt/sources.list \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">'s/deb.debian.org/mirrors.aliyun.com/g'</span> /etc/apt/sources.list </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure apt and install packages</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get -y install --no-install-recommends apt-utils dialog 2&gt;&amp;1 \</span></span><br><span class="line"><span class="bash">    <span class="comment">#</span></span></span><br><span class="line">    <span class="comment"># install git iproute2, procps, lsb-release (useful for CLI installs)</span></span><br><span class="line">    &amp;&amp; apt-get -y install git openssh-client less iproute2 procps iproute2 lsb-release \</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Install xdebug  å®‰è£…äº†xdebug</span></span><br><span class="line">    &amp;&amp; yes | pecl install xdebug \</span><br><span class="line">    &amp;&amp; echo <span class="string">"zend_extension=$(find /usr/local/lib/php/extensions/ -name xdebug.so)"</span> &gt; /usr/local/etc/php/conf.d/xdebug.ini \</span><br><span class="line">    &amp;&amp; echo <span class="string">"xdebug.remote_enable=on"</span> &gt;&gt; /usr/local/etc/php/conf.d/xdebug.ini \</span><br><span class="line">    &amp;&amp; echo <span class="string">"xdebug.remote_autostart=on"</span> &gt;&gt; /usr/local/etc/php/conf.d/xdebug.ini \</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Create a non-root user to use if preferred - see https://aka.ms/vscode-remote/containers/non-root-user.</span></span><br><span class="line">    &amp;&amp; groupadd --gid $USER_GID $USERNAME \</span><br><span class="line">    &amp;&amp; useradd -s /bin/bash --uid $USER_UID --gid $USER_GID -m $USERNAME \</span><br><span class="line">    <span class="comment"># [Optional] Add sudo support for the non-root user</span></span><br><span class="line">    &amp;&amp; apt-get install -y sudo \</span><br><span class="line">    &amp;&amp; echo $USERNAME ALL=\(root\) NOPASSWD:ALL &gt; /etc/sudoers.d/$USERNAME\   <span class="comment"># æŠŠvscodeè¿™ä¸ªç”¨æˆ·æˆæƒsodo</span></span><br><span class="line">    &amp;&amp; chmod <span class="number">0440</span> /etc/sudoers.d/$USERNAME \</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Clean up</span></span><br><span class="line">    &amp;&amp; apt-get autoremove -y \</span><br><span class="line">    &amp;&amp; apt-get clean -y \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch back to dialog for any ad-hoc use of apt-get</span></span><br><span class="line"><span class="keyword">ENV</span> DEBIAN_FRONTEND=dialog</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªåŸºäº<code>php:7-cli</code>çš„phpç¯å¢ƒå¹¶ä¸”è£…äº†<code>xdebug</code>æ‰©å±•ï¼Œå†æ·»åŠ äº†ä¸€ä¸ªåå«<code>vscode</code>çš„ç”¨æˆ·å¹¶æˆæƒsudoã€‚</p>
<p>è€ƒè™‘åˆ°æˆ‘ä»¬çš„ç½‘ç»œé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨aliyunçš„é•œåƒåœ°å€æ¥åŠ é€Ÿæ„å»ºã€‚åœ¨ä¸Šé¢çš„Dockerfileä¸­åŠ äº†ä¸¤è¡Œï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> sed -i <span class="string">'s/security.debian.org/mirrors.aliyun.com/g'</span> /etc/apt/sources.list \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i <span class="string">'s/deb.debian.org/mirrors.aliyun.com/g'</span> /etc/apt/sources.list</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><p>å®Œäº‹å…·å¤‡ï¼Œå¼€å§‹è¿è¡Œå®ƒï¼š<br>æŒ‰<code>F1</code>ç„¶åé€‰æ‹©<code>Remote-Containers: Open Repository in Container</code>ã€‚æˆ–è€…ç‚¹å·¦ä¸‹è§’çš„å›¾æ ‡ï¼š<br><img src="/assets/images/20200413224822.png" alt="icon"></p>
<p>å› ä¸ºæ›´æ¢äº†æºï¼Œå‡ åˆ†é’Ÿæ—¶é—´å°±æ„å»ºå¥½ã€‚</p>
<p>è¿è¡ŒæˆåŠŸä¹‹åï¼Œä½ å¯ä»¥å‘ç°ï¼Œå¼€å‘æµç¨‹å’Œæœ¬åœ°å¼€å‘å‡ ä¹ä¸€æ‘¸ä¸€æ ·ã€‚æˆ‘ä»¬æ‰“å¼€vscodeä¸‹çš„terminalç»ˆç«¯ï¼Œå¯ä»¥çœ‹åˆ°å‘½ä»¤æç¤ºç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vscode@0d2acb021651:&#x2F;workspaces&#x2F;vscode-remote-try-php$</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªvscodeç”¨æˆ·å°±æ˜¯ä¹‹å‰Dockerfileä¸­å®šä¹‰çš„ç”¨æˆ·ã€‚</p>
<p>æ¥ä¸‹æ¥å°±å®Œå…¨å½“æœ¬åœ°å¼€å‘å§ã€‚</p>
<h2 id="æ·»åŠ ç«¯å£"><a href="#æ·»åŠ ç«¯å£" class="headerlink" title="æ·»åŠ ç«¯å£"></a>æ·»åŠ ç«¯å£</h2><p>æˆ‘ä»¬phpå¼€å‘ï¼Œå¤§å¤šæ˜¯webå¼€å‘ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢æ‰“å¼€çš„ç»ˆç«¯ä¸­å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php -S 0.0.0.0:8080</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™éœ€è¦æ˜ å°„ä¸€ä¸ªç«¯å£åˆ°æœ¬åœ°ï¼š<br>æŒ‰<code>F1</code>ç„¶åé€‰æ‹©<code>Forward a port</code>ï¼Œæ¯”å¦‚ä¹Ÿè¾“å…¥8080ã€‚åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€127.0.0.1:8080å°±å¯ä»¥è®¿é—®æˆ‘ä»¬çš„webæœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™è®©å®ƒè‡ªåŠ¨æ˜ å°„ç«¯å£ï¼Œæˆ‘ä»¬åœ¨<code>devcontainer.json</code>æ–‡ä»¶ä¸­åŠ å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; An array port numbers to forward</span><br><span class="line">&quot;forwardPorts&quot;: [8080],</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯ç‰¹åˆ«çš„æ–¹ä¾¿~ğŸ˜ğŸ˜ğŸ˜</p>
<p>æœ€åæƒ³è¯´çš„æ˜¯ï¼šè™½ç„¶ç°åœ¨vscodeä¸‹å¼€å‘phpè¿˜ä¸å¦‚phpstormæ¥çš„çˆ½å¿«ï¼Œä½†æ˜¯è¿™ç§å¼€å‘æ¨¡å¼ç¡®å®å·²ç»è¶…è¿‡äº†phpstormã€‚ä½“éªŒå¥½ï¼Œç®€å•è¿˜æœ‰ä¾‹å­ï¼Œæ–‡æ¡£ä¹Ÿé½å…¨ã€‚å…¶ä»–è¯­è¨€çš„ä¾‹å­ä¹Ÿéƒ½æœ‰ï¼Œå¤§å®¶å¯è‡ªå·±å°è¯•ä¸‹ã€‚</p>
<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" target="_blank" rel="noopener">https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers</a></li>
<li><a href="https://code.visualstudio.com/remote-tutorials/containers/getting-started" target="_blank" rel="noopener">https://code.visualstudio.com/remote-tutorials/containers/getting-started</a></li>
</ul>
]]></content>
      <categories>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>Docker</tag>
        <tag>vscode</tag>
        <tag>å®¹å™¨a</tag>
        <tag>IDE</tag>
      </tags>
  </entry>
  <entry>
    <title>linux-process-manager</title>
    <url>/2020/04/16/linux-process-manager/</url>
    <content><![CDATA[]]></content>
  </entry>
</search>
